<!doctype html><html lang=ja-jp><head prefix="og: http://ogp.me/ns# fb: http://ogp.me/ns/fb#"><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><title>Hugo Modules の仕組みで Hugo サイト用のコンテンツを分割して管理する - まくまく Hugo ノート</title><script async src="https://www.googletagmanager.com/gtag/js?id=G-X5962TDYXS"></script>
<script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-X5962TDYXS")</script><link rel=icon sizes="16x16 32x32 48x48 64x64" href=../../assets/img/favicon/favicon.ico><link rel=icon sizes=192x192 href=../../assets/img/favicon/192x192.png><link rel=apple-touch-icon href=../../assets/img/favicon/180x180.png><meta name=twitter:card content="summary"><meta property="og:site_name" content="天才まくまくノート"><meta property="og:title" content="Hugo Modules の仕組みで Hugo サイト用のコンテンツを分割して管理する"><meta property="og:type" content="article"><meta property="og:url" content="https://maku77.github.io/p/bqar8o6/"><meta property="og:locale" content="ja_JP"><meta property="og:image" content="https://maku77.github.io/img/site-logo.png"><meta property="og:image:width" content="1200"><meta property="og:image:height" content="630"><meta property="og:description" content="Hugo Modules とは Hugo Modules の仕組みを使うと、異なるディレクトリに配置されたファイル群をまとめて、1 つの Hugo サイトを構成することができます。 Hugo Module の実体は、Hugo サイト用のファイルが格納されたディレクトリです。 Hugo Module は、ローカル PC 上のディレクトリであってもよいし、GitHub リポジトリ内のディレクトリであっても構いません（通常は GitHub で管理することになるでしょう）。
graph RL subgraph my-hugo-module-1 mod1(&#34;Hugo Module&#34;) end subgraph my-hugo-module-2 mod2(&#34;Hugo Module&#34;) end subgraph my-hugo-site mod1_imported(&#34;Hugo Module&#34;) mod2_imported(&#34;Hugo Module&#34;) end mod1 -- import --> mod1_imported mod2 -- import --> mod2_imported classDef classMod fill:#36f,color:white,stroke:none class mod1,mod2,mod1_imported,mod2_imported classMod この仕組みは、一見すると、Hugo テーマを Git サブモジュールとして取り込むのと同じように見えますが、Hugo Modules はより柔軟で、コンテンツを含むほとんどのファイルをインポートできます。 現状、下記の 7 つのディレクトリに格納されるファイルを、Hugo Module からインポートすることができます。
archetypes &mldr; 複数サイトでコンテンツ作成用テンプレート (."><meta property="fb:app_id" content="447708168769292"><link rel=stylesheet href=../../css/mm/all.min.e24c66b636a90ef91911e8a754364b4f018776b87620a5bff34272c1264fb94d.css><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-6317852277883092" crossorigin=anonymous></script>
<link rel=stylesheet href=../../css/all.min.13f0b28ea5ecd0bb813e7143882eab74f7621eb7644e322bf58a4b49b3edb6bb.css></head><body><div class=l-pageHeader><header class=header><a href=../../hugo/><img class=header__icon src=../../hugo/logo-hugo.png></a><div class=header__right><div class=header__category><a href=../../hugo/>まくまく Hugo ノート</a></div><div class=header__title>Hugo Modules の仕組みで Hugo サイト用のコンテンツを分割して管理する</div></div></header></div><div class=l-withSidebar><div class=l-withSidebar__sidebarLeft><style>#tocStub{position:-webkit-sticky;position:sticky;top:2rem;margin-top:2rem;line-height:1.5;max-height:calc(100vh - 4rem);overflow-y:auto;-webkit-overflow-scrolling:touch}#tocStub ul{font-size:.9em;list-style:none;padding:0;border-top:solid 1px #ccc}#tocStub li{border:solid 1px #ccc;border-right:none;margin-top:-1px}#tocStub a{color:#666;padding:.6em .3em .6em .5em;display:block;text-decoration:none;font-weight:400}.level-2{margin-left:.8em}.level-3{padding-left:1.6em}</style><div id=tocStub></div><script>document.addEventListener("DOMContentLoaded",()=>{function e(e){const t=document.createElement("a");return t.setAttribute("id",e),t}function t(t,n){n.parentNode.insertBefore(e(t),n)}function n(e,t,n){const s=document.createElement("li");return s.classList.add("level-"+e),s.innerHTML='<a href="#'+t+'">'+n+"</a>",s}function s(){const e=document.createElement("ul");return document.querySelectorAll("h2, h3").forEach((s,o)=>{const i="section-"+o;t(i,s);const a=s.tagName.charAt(1)-1;e.appendChild(n(a,i,s.textContent))}),e}document.getElementById("tocStub").appendChild(s())})</script></div><div class=l-withSidebar__content><article class=article itemscope itemtype=https://schema.org/BlogPosting><div class=article__header><div class=breadcrumb><a href=../../>&#x1F3E0;HOME</a> > <a href=../../hugo/>まくまく Hugo ノート</a></div><div class=article__snsButtons><div class=snsButtons><a rel=nofollow target=_blank href="https://twitter.com/intent/post?url=https%3a%2f%2fmaku77.github.io%2fp%2fbqar8o6%2f&text=Hugo%20Modules%20%e3%81%ae%e4%bb%95%e7%b5%84%e3%81%bf%e3%81%a7%20Hugo%20%e3%82%b5%e3%82%a4%e3%83%88%e7%94%a8%e3%81%ae%e3%82%b3%e3%83%b3%e3%83%86%e3%83%b3%e3%83%84%e3%82%92%e5%88%86%e5%89%b2%e3%81%97%e3%81%a6%e7%ae%a1%e7%90%86%e3%81%99%e3%82%8b%20-%20%e3%81%be%e3%81%8f%e3%81%be%e3%81%8f%20Hugo%20%e3%83%8e%e3%83%bc%e3%83%88"><span class="snsButtons__icon snsButtons__icon--twitter"><svg xmlns="http://www.w3.org/2000/svg" width="100" height="100" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-twitter"><path d="M23 3a10.9 10.9.0 01-3.14 1.53 4.48 4.48.0 00-7.86 3v1A10.66 10.66.0 013 4s-4 9 5 13a11.64 11.64.0 01-7 2c9 5 20 0 20-11.5a4.5 4.5.0 00-.08-.83A7.72 7.72.0 0023 3z"/></svg></span></a><a rel=nofollow target=_blank href="https://www.facebook.com/share.php?u=https%3a%2f%2fmaku77.github.io%2fp%2fbqar8o6%2f&t=Hugo%20Modules%20%e3%81%ae%e4%bb%95%e7%b5%84%e3%81%bf%e3%81%a7%20Hugo%20%e3%82%b5%e3%82%a4%e3%83%88%e7%94%a8%e3%81%ae%e3%82%b3%e3%83%b3%e3%83%86%e3%83%b3%e3%83%84%e3%82%92%e5%88%86%e5%89%b2%e3%81%97%e3%81%a6%e7%ae%a1%e7%90%86%e3%81%99%e3%82%8b%20-%20%e3%81%be%e3%81%8f%e3%81%be%e3%81%8f%20Hugo%20%e3%83%8e%e3%83%bc%e3%83%88"><span class="snsButtons__icon snsButtons__icon--facebook"><svg xmlns="http://www.w3.org/2000/svg" width="100" height="100" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-facebook"><path d="M18 2h-3a5 5 0 00-5 5v3H7v4h3v8h4v-8h3l1-4h-4V7a1 1 0 011-1h3z"/></svg></span></a><a rel=nofollow target=_blank href="https://getpocket.com/edit?url=https%3a%2f%2fmaku77.github.io%2fp%2fbqar8o6%2f&title=Hugo%20Modules%20%e3%81%ae%e4%bb%95%e7%b5%84%e3%81%bf%e3%81%a7%20Hugo%20%e3%82%b5%e3%82%a4%e3%83%88%e7%94%a8%e3%81%ae%e3%82%b3%e3%83%b3%e3%83%86%e3%83%b3%e3%83%84%e3%82%92%e5%88%86%e5%89%b2%e3%81%97%e3%81%a6%e7%ae%a1%e7%90%86%e3%81%99%e3%82%8b%20-%20%e3%81%be%e3%81%8f%e3%81%be%e3%81%8f%20Hugo%20%e3%83%8e%e3%83%bc%e3%83%88"><span class="snsButtons__icon snsButtons__icon--pocket"><svg xmlns="http://www.w3.org/2000/svg" width="100" height="100" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-pocket"><path d="M4 3h16a2 2 0 012 2v6A10 10 0 0112 21 10 10 0 012 11V5a2 2 0 012-2z"/><polyline points="8 10 12 14 16 10"/></svg></span></a></div></div><div class=article__date><time class=pageDate>2023-04-01</time></div></div><div class=article__body><h2 id=hugo-modules-とは>Hugo Modules とは</h2><p><a href=https://gohugo.io/hugo-modules/>Hugo Modules</a> の仕組みを使うと、異なるディレクトリに配置されたファイル群をまとめて、1 つの Hugo サイトを構成することができます。
Hugo Module の実体は、Hugo サイト用のファイルが格納されたディレクトリです。
Hugo Module は、ローカル PC 上のディレクトリであってもよいし、GitHub リポジトリ内のディレクトリであっても構いません（通常は GitHub で管理することになるでしょう）。</p><figure style=text-align:center><div class=mermaid>graph RL
subgraph my-hugo-module-1
mod1("Hugo Module")
end
subgraph my-hugo-module-2
mod2("Hugo Module")
end
subgraph my-hugo-site
mod1_imported("Hugo Module")
mod2_imported("Hugo Module")
end
mod1 -- import --> mod1_imported
mod2 -- import --> mod2_imported
classDef classMod fill:#36f,color:white,stroke:none
class mod1,mod2,mod1_imported,mod2_imported classMod</div></figure><script>(function(){if(window.isMermaidLoaded)return;window.isMermaidLoaded=!0;const e=document.createElement("script");e.src="https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js",e.onload=()=>{mermaid.initialize({startOnLoad:!0})},document.body.appendChild(e)})()</script><p>この仕組みは、一見すると、Hugo テーマを Git サブモジュールとして取り込むのと同じように見えますが、Hugo Modules はより柔軟で、コンテンツを含むほとんどのファイルをインポートできます。
現状、下記の 7 つのディレクトリに格納されるファイルを、Hugo Module からインポートすることができます。</p><ul><li><strong><code>archetypes</code></strong> &mldr; 複数サイトでコンテンツ作成用テンプレート (<code>.md</code>) を共有できます。</li><li><strong><code>assets</code></strong> &mldr; 複数サイトでビルド用のアセット（<code>.scss</code> など）を共有できます。</li><li><strong><code>content</code></strong> &mldr; 複数サイトでコンテンツファイル (<code>.md</code>) を共有できます。</li><li><strong><code>data</code></strong> &mldr; 複数サイトでデータ（<code>.yml</code>、<code>.json</code> など）を共有できます。複数の Hugo Module で定義されたデータをマージできます。</li><li><strong><code>i18n</code></strong> &mldr; 複数サイトで翻訳データ (<code>.yml</code>、<code>.json</code> など）を共有できます。複数の Hugo Module で定義された翻訳データをマージできます。</li><li><strong><code>layouts</code></strong> &mldr; 複数サイトでレイアウトやショートコード (<code>.html</code>) を共有できます。</li><li><strong><code>static</code></strong> &mldr; 複数サイトで静的なファイル（<code>.js</code> ファイルなど）を共有できます。</li></ul><p>Hugo Modules の仕組みでテーマ系のファイル（<code>assets</code>、<code>layouts</code>、<code>static</code> など）をインポートするようにすれば、<strong>もう Git サブモジュールの仕組みを使う必要はありません</strong>。
Hugo Modules の特徴をまとめると次のような感じになります。
主に、従来の Git サブモジュールによるテーマ導入の仕組みとの比較です。</p><ul><li>Hugo Modules を使えば、前述のような様々なファイルを柔軟に組み合わせることができます。テーマのように完全な <code>layouts</code> を用意する必要はなく、必要なファイルだけを個別にインポートできます。可能性は無限大です。</li><li>Hugo Modules を使えば、Git サブモジュールの複雑なコマンド (<code>git submodule</code>) を使う必要がありません。代わりに <code>hugo mod</code> コマンドを使う必要はありますが、Git サブモジュールの更新管理に比べれば分かりやすいです。</li><li>Git サブモジュールを使用している場合、<code>git clone</code> 時に <code>--recurse-submodules</code> フラグを指定するなどしてサブモジュールの取り込みを忘れないよう注意する必要がありますが、Hugo Modules の場合は、単純に <code>git clone</code> して <code>hugo serve</code> するだけで、自動的に依存モジュールをインポートしてくれます（GitHub などから取得してくれる）。</li><li>Hugo Module 内の各ディレクトリ（Golang 用語ではパッケージ）を、Hugo プロジェクト内のどのディレクトリに展開（マウント）するかを指定できます。Git サブモジュールの場合は、リポジトリ単位でしか展開先を指定できません。</li><li>Hugo Modules を使うには、Golang の環境をインストールしておく必要があります。Golang の Go Modules という仕組みをベースにしているので、Golang を使ったことがないと、若干のとっつきにくさはあるかもしれません。とはいえ、基本的には Golang の知識は必要ありません。</li></ul><h2 id=事前準備>事前準備</h2><h3 id=golang-のインストール>Golang のインストール</h3><p>Hugo Modules の仕組みは、Golang（Go 言語）の Go Modules という仕組みを利用して提供されています。
Hugo Modules の仕組みを使用するには、<strong>Golang の実行環境をインストール</strong> しておく必要があります。</p><ul><li><a href=https://go.dev/doc/install>Download and install - The Go Programming Language</a></li></ul><p>Golang のインストールが完了すると、Hugo Modules 用のサブコマンド (<strong><code>hugo mod</code></strong>) などが正しく動作するようになります。
逆に、Golang がインストールされていない環境で Hugo Modules を使用する Hugo サイトをビルドしようとすると、<code>go</code> コマンドがないというエラーになります（例: <code>Error: failed to download modules: binary with name "go" not found</code>）。</p><h3 id=hugo-プロジェクトの作成>Hugo プロジェクトの作成</h3><p>テスト用に Hugo サイト（プロジェクト）を作成しておきます。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-console data-lang=console><span class=line><span class=cl><span class=gp>$</span> <span class=nb>cd</span> ~
</span></span><span class=line><span class=cl><span class=gp>$</span> hugo new site my-hugo-site
</span></span></code></pre></div><h2 id=hugo-サイトを-hugo-module-化する>Hugo サイトを Hugo Module 化する</h2><p>既存の Hugo サイトで Hugo Modules の仕組みを使用するには、<strong><code>hugo mod init</code></strong> コマンドで、その Hugo サイト自体も Hugo Module として初期化しておく必要があります。
これにより、他の Hugo Module を GitHub などから自動取得できるようになります。</p><p>Hugo Module には、（Go Modules の仕組み上）<strong>一意のモジュール名</strong> を設定しておく必要があり、通常は GitHub リポジトリのパスを <strong><code>github.com/USER/REPO</code></strong> のような感じで指定します（<code>USER</code> と <code>REPO</code> の部分は適切に置き換えてください）。</p><figure class=codeBlock><figcaption class=codeBlock__title>Hugo サイトを Hugo Module 化</figcaption><div class=codeBlock__code><div class=highlight><pre tabindex=0 class=chroma><code class=language-console data-lang=console><span class=line><span class=cl><span class=gp>$</span> <span class=nb>cd</span> ~/my-hugo-site
</span></span><span class=line><span class=cl><span class=gp>$</span> hugo mod init github.com/USER/my-hugo-site
</span></span></code></pre></div></div></figure><div class=note><span class=note__title>☝️ 実はモジュール名は何でもよい</span>
<span class=note__body>上記の説明では、Hugo Module には <code>github.com/&lt;USER>/&lt;REPO></code> のような一意の名前を付ける必要があると記述しましたが、正確に言うと、これはインポートされる側の Hugo Module の要件です。
なので、実際には Hugo サイト側（他の Hugo Module をインポートする側）のモジュール名は何でもよかったりします（単純に <code>mysite</code> など）。</span></div><p>Hugo Module 化といっても、このコマンドは、次のような <strong><code>go.mod</code></strong> というファイルを生成するだけです。
最初は、自身のモジュール名と使用した Golang バージョンくらいしか記述されていませんが、このあと Hugo Module を追加するたびにこのファイルに依存関係が追加されていきます。</p><figure class=codeBlock><figcaption class=codeBlock__title>go.mod</figcaption><div class=codeBlock__code><div class=highlight><pre tabindex=0 class=chroma><code class=language-plain data-lang=plain><span class=line><span class=cl>module github.com/USER/my-hugo-site
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>go 1.18</span></span></code></pre></div></div></figure><h2 id=hugo-modules-の仕組みでテーマをインポートする>Hugo Modules の仕組みでテーマをインポートする</h2><p><a href=https://themes.gohugo.io/>GitHub 上で公開されている Hugo テーマ</a> を Hugo Module としてインポートするには、Hugo の設定ファイル（<code>hugo.toml</code> や <code>config.toml</code>）内に次のような <strong><code>module</code></strong> セクションを追加します。
ここでは、<a href=https://github.com/adityatelange/hugo-PaperMod/>PaperMod</a> というテーマを使ってみます。</p><figure class=codeBlock><figcaption class=codeBlock__title>hugo.toml に追加</figcaption><div class=codeBlock__code><div class=highlight><pre tabindex=0 class=chroma><code class=language-toml data-lang=toml><span class=line><span class=cl><span class=p>[</span><span class=nx>module</span><span class=p>]</span>
</span></span><span class=line><span class=cl>  <span class=p>[[</span><span class=nx>module</span><span class=p>.</span><span class=nx>imports</span><span class=p>]]</span>
</span></span><span class=line><span class=cl>    <span class=nx>path</span> <span class=p>=</span> <span class=s1>&#39;github.com/adityatelange/hugo-PaperMod&#39;</span></span></span></code></pre></div></div></figure><p>これにより、GitHub リポジトリ上のファイル群が Hugo サイトにマージされてビルドされることになるので、<code>hugo.toml</code> 内のテーマ名指定（<code>theme = 'PaperMod'</code> など）は必要ありません。
もっと言うと、<code>themes</code> ディレクトリ自体必要ありません。</p><p>インポート対象の GitHub リポジトリ（Hugo テーマ）は、Hugo Module として初期化 (<code>hugo mod init</code>) されていなくてもインポートできるようになっています。
つまり、現在公開されている Hugo テーマは、すべてこの仕組みでインポートできます。
ただし、依存関係を正しく管理するため、Hugo テーマは Hugo Module として初期化しておく（つまり、<code>go.mod</code> を配置しておく）ことが推奨されています。</p><p>Hugo Module のインポート設定ができたら、Hugo サーバーを起動して正しく Hugo Module がダウンロードされるか確認します。</p><figure class=codeBlock><figcaption class=codeBlock__title>Hugo サーバーの起動</figcaption><div class=codeBlock__code><div class=highlight><pre tabindex=0 class=chroma><code class=language-console data-lang=console><span class=line><span class=cl><span class=gp>$</span> hugo serve
</span></span></code></pre></div></div></figure><p><code>http://localhost:1313</code> にアクセスして、次のように正しくテーマが反映されていれば成功です。</p><figure class=image><a href=../../p/bqar8o6/img-001.png target=_blank><img style="border:solid #ccc 2px" width=500 height=104 src=../../p/bqar8o6/img-001_hu01d4d80fc4436a036e8cb4f2e2fc645a_6843_500x0_resize_box_3.png alt="Hugo Modules の仕組みでテーマをインポートできた"></a><figcaption class=image__caption>図: Hugo Modules の仕組みでテーマをインポートできた</figcaption></figure><h2 id=コンテンツを提供する-hugo-module-を作ってみる>コンテンツを提供する Hugo Module を作ってみる</h2><p>今度は、コンテンツ（<code>.md</code> ファイル）を提供する Hugo Module を新しく作成してインポートしてみます。
ここでは、最終的に GitHub の <code>https://github.com/USER/my-hugo-module</code> というリポジトリで管理するものとして、モジュール名を付けておきます。</p><figure class=codeBlock><figcaption class=codeBlock__title>共有可能な Hugo Module を作成する</figcaption><div class=codeBlock__code><div class=highlight><pre tabindex=0 class=chroma><code class=language-console data-lang=console><span class=line><span class=cl><span class=gp>$</span> mkdir ~/my-hugo-module
</span></span><span class=line><span class=cl><span class=gp>$</span> <span class=nb>cd</span> ~/my-hugo-module
</span></span><span class=line><span class=cl><span class=gp>$</span> hugo mod init github.com/USER/my-hugo-module
</span></span></code></pre></div></div></figure><p>次に、この Hugo Module が提供するコンテンツを作成します。</p><figure class=codeBlock><figcaption class=codeBlock__title>~/my-hugo-module/content/posts/hello.md</figcaption><div class=codeBlock__code><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nn>---</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>title</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;Hello&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>date</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;2023-04-01&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nn>---</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=l>Hello, Hugo Modules!</span></span></span></code></pre></div></div></figure><p>これだけで、Hugo Module は完成です。
Hugo サイトの本体側 (<code>my-hugo-site</code>) から、この Hugo Module をインポートするよう設定します。</p><figure class=codeBlock><figcaption class=codeBlock__title>~/my-hugo-site/hugo.toml（抜粋）</figcaption><div class=codeBlock__code><div class=highlight><pre tabindex=0 class=chroma><code class=language-toml data-lang=toml><span class=line><span class=cl><span class=p>[</span><span class=nx>module</span><span class=p>]</span>
</span></span><span class=line><span class=cl>  <span class=p>[[</span><span class=nx>module</span><span class=p>.</span><span class=nx>imports</span><span class=p>]]</span>
</span></span><span class=line><span class=cl>    <span class=nx>path</span> <span class=p>=</span> <span class=s1>&#39;github.com/adityatelange/hugo-PaperMod&#39;</span>
</span></span><span class="line hl"><span class=cl>  <span class=p>[[</span><span class=nx>module</span><span class=p>.</span><span class=nx>imports</span><span class=p>]]</span>
</span></span><span class="line hl"><span class=cl>    <span class=nx>path</span> <span class=p>=</span> <span class=s1>&#39;github.com/USER/my-hugo-module&#39;</span></span></span></code></pre></div></div></figure><p>この時点では、この Hugo Module はまだ GitHub 上で管理していないので、Hugo サイトをビルドしようとすると Hugo Module をダウンロードできないというエラーになります。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-console data-lang=console><span class=line><span class=cl><span class=gp>$</span> <span class=nb>cd</span> ~/my-hugo-site
</span></span><span class=line><span class=cl><span class=gp>$</span> hugo
</span></span><span class=line><span class=cl><span class=go>...
</span></span></span><span class=line><span class=cl><span class=go>	remote: Repository not found.
</span></span></span><span class=line><span class=cl><span class=go>	fatal: repository &#39;https://github.com/USER/my-hugo-module/&#39; not found
</span></span></span></code></pre></div><p>そこで、一時的に GitHub の URL（モジュールパス）をローカル PC のディレクトリパスに置き換える、Go Modules の <strong>replacement</strong> 機能を使用します。
置換内容は、Hugo 専用の <strong><code>HUGO_MODULE_REPLACEMENTS</code></strong> 環境変数で設定できます。</p><figure class=codeBlock><figcaption class=codeBlock__title>ローカル PC 上の Hugo Module を参照して起動</figcaption><div class=codeBlock__code><div class=highlight><pre tabindex=0 class=chroma><code class=language-console data-lang=console><span class=line><span class=cl><span class=gp>$</span> <span class=nb>export</span> <span class=nv>HUGO_MODULE_REPLACEMENTS</span><span class=o>=</span><span class=s2>&#34;github.com/USER/my-hugo-module -&gt; /Users/maku/my-hugo-module&#34;</span>
</span></span><span class=line><span class=cl><span class=gp>$</span> hugo serve
</span></span></code></pre></div></div></figure><p>複数の置換設定を行いたいときは、カンマで区切って指定すれば OK です。
これで、正しくすべての Hugo Module をインポートできるようになり、Hugo サイトのビルドに成功するはずです。
今回のケースでは、<code>http://localhost:1313/posts/hello/</code> にアクセスして記事が表示されれば成功です。</p><figure class=image><a href=../../p/bqar8o6/img-002.png target=_blank><img style="border:solid #ccc 2px" width=550 height=243 src=../../p/bqar8o6/img-002_hu9f16fb28133e906883ee5c2f9626b7d9_15156_550x0_resize_box_3.png alt="コンテンツ用の Hugo Module もインポートできた"></a><figcaption class=image__caption>図: コンテンツ用の Hugo Module もインポートできた</figcaption></figure><p>ちなみに、replacement の置換内容は、<a href=https://go.dev/ref/mod#go-mod-file-replace>go.mod ファイル内の replace ディレクティブ</a> でも設定可能ですが、最終的にはこの設定は削除して、正しく GitHub 上のリポジトリを参照するように戻さなければいけないので、<code>HUGO_MODULE_REPLACEMENTS</code> 環境変数を使った方が都合がよいと思います。</p><h2 id=hugo-module-の依存関係を確認する>Hugo Module の依存関係を確認する</h2><p><strong><code>hugo mod graph</code></strong> コマンドを使用すると、（Hugo Module 化した）Hugo サイトが依存している Hugo Module の一覧を確認できます。</p><figure class=codeBlock><figcaption class=codeBlock__title>Hugo Module の依存グラフを表示</figcaption><div class=codeBlock__code><div class=highlight><pre tabindex=0 class=chroma><code class=language-console data-lang=console><span class=line><span class=cl><span class=gp>$</span> <span class=nb>cd</span> ~/my-hugo-site
</span></span><span class=line><span class=cl><span class=gp>$</span> hugo mod graph
</span></span><span class=line><span class=cl><span class=go>github.com/USER/my-hugo-site github.com/adityatelange/hugo-PaperMod@v0.0.0-20230331160356-2210bf20b365
</span></span></span><span class=line><span class=cl><span class=go>github.com/USER/my-hugo-site /Users/maku/my-hugo-module
</span></span></span></code></pre></div></div></figure><p>この例では、Hugo サイト (<code>my-hugo-site</code>) が、2 つの Hugo Module（<code>hugo-PaperMod</code> と <code>my-hugo-module</code>）に依存していることが分かります。</p><h2 id=hugo-module-の更新を取り込む>Hugo Module の更新を取り込む</h2><p>GitHub 上で管理されている Hugo Module のファイルが更新された場合に、それを Hugo サイト側に反映するには、<strong><code>hugo mod get -u</code></strong> コマンドを使用します。</p><figure class=codeBlock><figcaption class=codeBlock__title>Hugo Module の更新</figcaption><div class=codeBlock__code><div class=highlight><pre tabindex=0 class=chroma><code class=language-console data-lang=console><span class=line><span class=cl><span class=gp>$</span> hugo mod get -u ./...  <span class=c1># すべての Hugo Module を再帰的に更新</span>
</span></span><span class=line><span class=cl><span class=gp>$</span> hugo mod get -u        <span class=c1># すべての Hugo Module を更新</span>
</span></span><span class=line><span class=cl><span class=gp>$</span> hugo mod get -u github.com/USER/my-hugo-module  <span class=c1># 指定した Hugo Module を更新</span>
</span></span><span class=line><span class=cl><span class=gp>$</span> hugo mod get -u github.com/USER/my-hugo-module@v.1.0.2  <span class=c1># バージョンを指定</span>
</span></span></code></pre></div></div></figure><h2 id=応用各ディレクトリのマウント先を変更する>（応用）各ディレクトリのマウント先を変更する</h2><p>Hugo Modules は、複数のディレクトリに散らばったファイルを集めて 1 つの Hugo サイトとしてビルドする仕組みなので、どうしてもファイル名の競合が発生してしまう可能性があります。
<code>content</code> ディレクトリ以下の記事ファイルや、<code>static</code> ディレクトリ以下の静的ファイルの名前が、複数の Hugo Module の間で競合してしまった場合、最初に見つかったファイルがビルド対象になります。</p><p>例えば、Hugo サイト本体 (<code>my-hugo-site</code>) から、2 つの Hugo Module（<code>my-hugo-module-1</code>、<code>my-hugo-module-2</code>）をインポートしているとして、それぞれが次のように競合する名前（パス）のファイルを持っているとすると、採用されるのは Hugo サイト本体に置かれたファイルだけです。</p><ul><li><code>my-hugo-site/static/js/hello.js</code> &mldr; <code>http://YOUR-SITE/js/hello.js</code> で見えるのはこのファイル</li><li><code>my-hugo-module-1/static/js/hello.js</code> &mldr; このファイルは見えなくなる</li><li><code>my-hugo-module-2/static/js/hello.js</code> &mldr; このファイルも見えなくなる</li></ul><p>このように、インポートした Hugo Module のファイルが見えなくなると都合が悪い場合は、Hugo サイトの設定ファイル（<code>hugo.toml</code> や <code>config.toml</code>）の <strong><code>[[module.imports.mounts]]</code></strong> セクションで、ディレクトリ単位でマウント先を変更します。</p><figure class=codeBlock><figcaption class=codeBlock__title>hugo.toml（抜粋）</figcaption><div class=codeBlock__code><div class=highlight><pre tabindex=0 class=chroma><code class=language-toml data-lang=toml><span class=line><span class=cl><span class=p>[</span><span class=nx>module</span><span class=p>]</span>
</span></span><span class=line><span class=cl>  <span class=p>[[</span><span class=nx>module</span><span class=p>.</span><span class=nx>imports</span><span class=p>]]</span>
</span></span><span class=line><span class=cl>    <span class=nx>path</span> <span class=p>=</span> <span class=s1>&#39;github.com/USER/my-hugo-module-1&#39;</span>
</span></span><span class=line><span class=cl>    <span class=p>[[</span><span class=nx>module</span><span class=p>.</span><span class=nx>imports</span><span class=p>.</span><span class=nx>mounts</span><span class=p>]]</span>
</span></span><span class=line><span class=cl>      <span class=nx>source</span> <span class=p>=</span> <span class=s1>&#39;static/js&#39;</span>
</span></span><span class=line><span class=cl>      <span class=nx>target</span> <span class=p>=</span> <span class=s1>&#39;static/mod1/js&#39;</span>
</span></span><span class=line><span class=cl>  <span class=p>[[</span><span class=nx>module</span><span class=p>.</span><span class=nx>imports</span><span class=p>]]</span>
</span></span><span class=line><span class=cl>    <span class=nx>path</span> <span class=p>=</span> <span class=s1>&#39;github.com/USER/my-hugo-module-2&#39;</span>
</span></span><span class=line><span class=cl>    <span class=p>[[</span><span class=nx>module</span><span class=p>.</span><span class=nx>imports</span><span class=p>.</span><span class=nx>mounts</span><span class=p>]]</span>
</span></span><span class=line><span class=cl>      <span class=nx>source</span> <span class=p>=</span> <span class=s1>&#39;static/js&#39;</span>
</span></span><span class=line><span class=cl>      <span class=nx>target</span> <span class=p>=</span> <span class=s1>&#39;static/mod2/js&#39;</span></span></span></code></pre></div></div></figure><p>これで、各 Hugo Module のディレクトリが別々のディレクトリにマウントされ、次のような URL でアクセスできるようになります。</p><ul><li><code>http://YOUR-SITE/js/hello.js</code> &mldr; Hugo サイト本体の JS ファイル</li><li><code>http://YOUR-SITE/mod1/js/hello.js</code> &mldr; my-hugo-module-1 の JS ファイル</li><li><code>http://YOUR-SITE/mod2/js/hello.js</code> &mldr; my-hugo-module-2 の JS ファイル</li></ul><p>上記の設定例では、<code>static/js</code> ディレクトリのマウント先を変更していますが、親ディレクトリの <code>static</code> ディレクトリごとマウント先を変更してしまっても OK です。</p><h2 id=応用github-actions-の設定>（応用）GitHub Actions の設定</h2><p>GitHub Actions を使って Hugo サイトをビルドしている場合は、ワークフロー内で Golang 環境をセットアップするよう指定しておく必要があります。
このセットアップを忘れると、<code>hugo</code> コマンドによるビルド時に次のようなエラーになります（サイト自体を Hugo Module として初期化していない場合も同様のエラーが発生します）。</p><pre tabindex=0><code>Error: module &#34;github.com/USER/my-hugo-module&#34; not found;
either add it as a Hugo Module or store it in &#34;/home/runner/work/my-hugo-site/my-hugo-site/themes&#34;.:
module does not exist
</code></pre><p>ワークフローファイルの中で、<a href=https://github.com/actions/setup-go>actions/setup-go</a> アクションを指定するだけで、Golang の実行環境は簡単にインストールすることができます。
あとは、今まで通り Hugo によるビルドを行うだけで、依存する Hugo Module を自動でダウンロードしてビルドしてくれます。</p><figure class=codeBlock><figcaption class=codeBlock__title>.github/workflows/hugo-build.yml</figcaption><div class=codeBlock__code><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>Build Hugo site</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>on</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>push</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>branches</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>main, master]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>jobs</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>build</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>runs-on</span><span class=p>:</span><span class=w> </span><span class=l>ubuntu-latest</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>steps</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=nt>uses</span><span class=p>:</span><span class=w> </span><span class=l>actions/checkout@v3</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>with</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>submodules</span><span class=p>:</span><span class=w> </span><span class=s1>&#39;recursive&#39;</span><span class=w>  </span><span class=c># Fetch Hugo themes (true OR recursive)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>fetch-depth</span><span class=p>:</span><span class=w> </span><span class=m>0</span><span class=w>  </span><span class=c># Fetch all history for .GitInfo and .Lastmod</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class="line hl"><span class=cl><span class=w>    </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>Setup Go environment</span><span class=w>
</span></span></span><span class="line hl"><span class=cl><span class=w>      </span><span class=nt>uses</span><span class=p>:</span><span class=w> </span><span class=l>actions/setup-go@v4.0.0</span><span class=w>
</span></span></span><span class="line hl"><span class=cl><span class=w>      </span><span class=nt>with</span><span class=p>:</span><span class=w>
</span></span></span><span class="line hl"><span class=cl><span class=w>        </span><span class=nt>go-version</span><span class=p>:</span><span class=w> </span><span class=s1>&#39;^1.20&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>Setup Hugo environment</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>uses</span><span class=p>:</span><span class=w> </span><span class=l>peaceiris/actions-hugo@v2.6.0</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>with</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>hugo-version</span><span class=p>:</span><span class=w> </span><span class=s1>&#39;0.111.3&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>extended</span><span class=p>:</span><span class=w> </span><span class=kc>true</span><span class=w>  </span><span class=c># Enable scss</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>Build Hugo site</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>run</span><span class=p>:</span><span class=w> </span><span class=l>hugo --minify</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c># ...</span></span></span></code></pre></div></div></figure></div><div class=article__footer><div class=article__date><time class=pageDate>2023-04-01</time></div><div class=article__snsButtons><div class=snsButtons><a rel=nofollow target=_blank href="https://twitter.com/intent/post?url=https%3a%2f%2fmaku77.github.io%2fp%2fbqar8o6%2f&text=Hugo%20Modules%20%e3%81%ae%e4%bb%95%e7%b5%84%e3%81%bf%e3%81%a7%20Hugo%20%e3%82%b5%e3%82%a4%e3%83%88%e7%94%a8%e3%81%ae%e3%82%b3%e3%83%b3%e3%83%86%e3%83%b3%e3%83%84%e3%82%92%e5%88%86%e5%89%b2%e3%81%97%e3%81%a6%e7%ae%a1%e7%90%86%e3%81%99%e3%82%8b%20-%20%e3%81%be%e3%81%8f%e3%81%be%e3%81%8f%20Hugo%20%e3%83%8e%e3%83%bc%e3%83%88"><span class="snsButtons__icon snsButtons__icon--twitter"><svg xmlns="http://www.w3.org/2000/svg" width="100" height="100" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-twitter"><path d="M23 3a10.9 10.9.0 01-3.14 1.53 4.48 4.48.0 00-7.86 3v1A10.66 10.66.0 013 4s-4 9 5 13a11.64 11.64.0 01-7 2c9 5 20 0 20-11.5a4.5 4.5.0 00-.08-.83A7.72 7.72.0 0023 3z"/></svg></span></a><a rel=nofollow target=_blank href="https://www.facebook.com/share.php?u=https%3a%2f%2fmaku77.github.io%2fp%2fbqar8o6%2f&t=Hugo%20Modules%20%e3%81%ae%e4%bb%95%e7%b5%84%e3%81%bf%e3%81%a7%20Hugo%20%e3%82%b5%e3%82%a4%e3%83%88%e7%94%a8%e3%81%ae%e3%82%b3%e3%83%b3%e3%83%86%e3%83%b3%e3%83%84%e3%82%92%e5%88%86%e5%89%b2%e3%81%97%e3%81%a6%e7%ae%a1%e7%90%86%e3%81%99%e3%82%8b%20-%20%e3%81%be%e3%81%8f%e3%81%be%e3%81%8f%20Hugo%20%e3%83%8e%e3%83%bc%e3%83%88"><span class="snsButtons__icon snsButtons__icon--facebook"><svg xmlns="http://www.w3.org/2000/svg" width="100" height="100" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-facebook"><path d="M18 2h-3a5 5 0 00-5 5v3H7v4h3v8h4v-8h3l1-4h-4V7a1 1 0 011-1h3z"/></svg></span></a><a rel=nofollow target=_blank href="https://getpocket.com/edit?url=https%3a%2f%2fmaku77.github.io%2fp%2fbqar8o6%2f&title=Hugo%20Modules%20%e3%81%ae%e4%bb%95%e7%b5%84%e3%81%bf%e3%81%a7%20Hugo%20%e3%82%b5%e3%82%a4%e3%83%88%e7%94%a8%e3%81%ae%e3%82%b3%e3%83%b3%e3%83%86%e3%83%b3%e3%83%84%e3%82%92%e5%88%86%e5%89%b2%e3%81%97%e3%81%a6%e7%ae%a1%e7%90%86%e3%81%99%e3%82%8b%20-%20%e3%81%be%e3%81%8f%e3%81%be%e3%81%8f%20Hugo%20%e3%83%8e%e3%83%bc%e3%83%88"><span class="snsButtons__icon snsButtons__icon--pocket"><svg xmlns="http://www.w3.org/2000/svg" width="100" height="100" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-pocket"><path d="M4 3h16a2 2 0 012 2v6A10 10 0 0112 21 10 10 0 012 11V5a2 2 0 012-2z"/><polyline points="8 10 12 14 16 10"/></svg></span></a></div></div><div class=breadcrumb><a href=../../>&#x1F3E0;HOME</a> > <a href=../../hugo/>まくまく Hugo ノート</a></div></div></article><script>var SIDEBAR_HIDE_THRESHOLD=800,SIDEBAR_WIDTH=250,OFFSET=10,w=window.innerWidth;w>=SIDEBAR_HIDE_THRESHOLD&&(w-=SIDEBAR_WIDTH),w-=OFFSET,w>=728?rakuten_size="728x200":w>=600?rakuten_size="600x200":w>=468?rakuten_size="468x160":w>=336?rakuten_size="336x280":w>=300?rakuten_size="300x250":w>=250?rakuten_size="250x250":rakuten_size="200x350",rakuten_design="slide",rakuten_affiliateId="1239b074.74af6526.1239b075.bc72ef6e",rakuten_items="ctsmatch",rakuten_genreId=0,rakuten_target="_blank",rakuten_theme="gray",rakuten_border="off",rakuten_auto_mode="on",rakuten_genre_title="off",rakuten_recommend="on",rakuten_txtColor="333333",rakuten_moverColor="30C030",rakuten_bgColor="FFFFFF",rakuten_captionColor="333333"</script><script src=https://xml.affiliate.rakuten.co.jp/widget/js/rakuten_widget.js></script></div><div class=l-withSidebar__sidebarRight><nav class=navigation><div class=navigation__header>カテゴリ一覧</div><ul><li><a class=navigation__item href=https://maku77.github.io/memo/>いろいろ</a><li><a class=navigation__item href=https://maku77.github.io/android/>Android</a><li><a class=navigation__item href=https://maku.blog/p/8t6hr3d/>Ansible</a><li><a class=navigation__item href=https://maku77.github.io/blender/>Blender</a><li><a class=navigation__item href=https://maku77.github.io/cpp/>C/C++</a><li><a class=navigation__item href=https://maku77.github.io/docker/>Docker</a><li><a class=navigation__item href=https://maku77.github.io/git/>Git</a><li><a class=navigation__item href=https://maku77.github.io/go/>Go言語</a><li><a class=navigation__item href=https://maku77.github.io/gradle/>Gradle</a><li><a class=navigation__item href=https://maku77.github.io/web/>HTML/CSS</a><li><a class="navigation__item navigation__item--focused" href=https://maku77.github.io/hugo/>Hugo</a><li><a class=navigation__item href=https://maku77.github.io/java/>Java</a><li><a class=navigation__item href=https://maku77.github.io/js/>JavaScript</a><li><a class=navigation__item href=https://maku77.github.io/kotlin/>Kotlin</a><li><a class=navigation__item href=https://maku77.github.io/linux/>Linux/Shell</a><li><a class=navigation__item href=https://maku77.github.io/mac/>Mac</a><li><a class=navigation__item href=https://maku77.github.io/middleman/>Middleman</a><li><a class=navigation__item href=https://toushi.maku.blog/p/etedykx/>MetaTrader</a><li><a class=navigation__item href=https://maku77.github.io/nodejs/>Node.js</a><li><a class=navigation__item href=https://maku77.github.io/octave/>Octave</a><li><a class=navigation__item href=https://maku77.github.io/p4/>Perforce</a><li><a class=navigation__item href=https://maku77.github.io/perl/>Perl</a><li><a class=navigation__item href=https://maku77.github.io/php/>PHP</a><li><a class=navigation__item href=https://maku77.github.io/python/>Python</a><li><a class=navigation__item href=https://maku77.github.io/r/>R</a><li><a class=navigation__item href=https://maku77.github.io/ruby/>Ruby</a><li><a class=navigation__item href=https://maku77.github.io/rust/>Rust</a><li><a class=navigation__item href=https://maku77.github.io/sass/>Sass</a><li><a class=navigation__item href=https://maku77.github.io/sed/>sed/awk</a><li><a class=navigation__item href=https://maku77.github.io/sql/>SQL</a><li><a class=navigation__item href=https://maku77.github.io/tradestation/>トレードステーション</a><li><a class=navigation__item href=https://maku77.github.io/vagrant/>Vagrant</a><li><a class=navigation__item href=https://maku77.github.io/vba/>VBA</a><li><a class=navigation__item href=https://maku77.github.io/vim/>Vim</a><li><a class=navigation__item href=https://maku77.github.io/windows/>Windows</a></ul></nav><style>.codoc-support{display:inline-block;margin:0!important;padding:12px!important;width:200px!important;max-width:100%}.codoc-support .codoc-support-title{font-size:smaller!important;white-space:nowrap;margin-bottom:12px!important}.codoc-support .codoc-btn{width:160px!important}</style><script src=https://codoc.jp/js/cms.js data-css=black data-usercode=tp6ZPzTj3w defer></script><div id=codoc-entry-4gYwTntzzw class=codoc-entries data-without-body=1 data-support-button-text="（っ'-')╮シュッ🔴" data-show-like=0 data-show-about-codoc=0 data-show-powered-by=0 data-support-message=まくに投げ銭できます。></div></div></div><script>document.addEventListener("DOMContentLoaded",function(){const e=document.querySelectorAll("a[href^=http]");for(let n=0;n<e.length;++n){const t=e[n];if(t.href.startsWith("https://maku77.github.io"))continue;const s=t.getElementsByTagName("img");if(s.length>0)continue;const o=t.getElementsByTagName("svg");if(o.length>0)continue;t.classList.add("externalLinkIcon"),t.setAttribute("target","_blank"),t.setAttribute("rel","noopener")}})</script></body></html>