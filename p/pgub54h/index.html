<!doctype html><html lang=ja-jp><head prefix="og: http://ogp.me/ns# fb: http://ogp.me/ns/fb#"><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><title>Hugo で同一セクション内のページ／セクションの一覧を表示する - まくまく Hugo ノート</title><script async src="https://www.googletagmanager.com/gtag/js?id=G-X5962TDYXS"></script>
<script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-X5962TDYXS")</script><link rel=icon sizes="16x16 32x32 48x48 64x64" href=../../assets/img/favicon/favicon.ico><link rel=icon sizes=192x192 href=../../assets/img/favicon/192x192.png><link rel=apple-touch-icon href=../../assets/img/favicon/180x180.png><meta name=twitter:card content="summary"><meta property="og:site_name" content="天才まくまくノート"><meta property="og:title" content="Hugo で同一セクション内のページ／セクションの一覧を表示する"><meta property="og:type" content="article"><meta property="og:url" content="https://maku77.github.io/p/pgub54h/"><meta property="og:locale" content="ja_JP"><meta property="og:image" content="https://maku77.github.io/img/site-logo.png"><meta property="og:image:width" content="1200"><meta property="og:image:height" content="630"><meta property="og:description" content="そのセクション内のページ一覧を取得する (.Pages、.RegularPages) リストテンプレートやセクションテンプレートの中で、.Pages を参照すると、そのセクション（やタクソノミー）直下の記事ページ (regular page) とセクションページ (list page) の一覧を Page オブジェクトの配列として取得することができます。
layouts/_default/section.html <h3>セクションに含まれる記事ページ（あるいはセクションページ）の一覧</h3> <ul> {{ range .Pages }} <li><a href=&#34;{{ .RelPermalink }}&#34;>{{ .Title }}</a> {{ end }} </ul> 記事ページ (regular page) のみを列挙したい場合は、.Pages の部分を .RegularPages に変更してください。 逆に、セクションページ (list page) のみを列挙したい場合は、.Pages の部分を Sections に変更してください。
.Pages &mldr; セクションページと記事ページの一覧 .RegularPages &mldr; 記事ページの一覧 .Sections &mldr; セクションページの一覧 上記のようなテンプレートは、タクソノミーテンプレート（タグの一覧ページ）でも同様に使用することができます。
ただし、.Pages や .RegularPages は、リスト系のページから参照することが想定されているため、シングルページテンプレート内で参照すると、サイズ 0 の配列 が返されることに注意してください。 そのため、基本的には上記のコードはリスト系のテンプレートでのみ使用することができます。
シングルページテンプレートからも、同一セクション内のページの一覧を取得したい場合は、まず .CurrentSection でカレントセクションを示す Page オブジェクトを取得するとよいでしょう（下記参照)。
同一セクション内のページ一覧を取得する (.CurrentSection.Pages) 下記のテンプレートコードは、現在の記事ページ（あるいはセクションページ）が所属するセクションの直下のページ（記事ページおよびセクションページ）の一覧を表示します。
例えば、ホームページを含むトップレベルの階層に置いた記事で実行された場合は、第一階層にあるセクションおよび記事ページの一覧が表示されます。 何らかのセクション内の記事で実行された場合は、その記事が所属するセクション内のサブセクションおよび記事ページの一覧が表示されます。"><meta property="fb:app_id" content="447708168769292"><link rel=stylesheet href=../../css/mm/all.min.5212ff25ce4d956d7b3798c3bc2aada554d4b64f49fc55bd8998d3e1ebe8e53f.css><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-6317852277883092" crossorigin=anonymous></script>
<link rel=stylesheet href=../../css/all.min.13f0b28ea5ecd0bb813e7143882eab74f7621eb7644e322bf58a4b49b3edb6bb.css></head><body><div class=l-pageHeader><header class=header><a href=../../hugo/><img class=header__icon src=../../hugo/logo-hugo.png></a><div class=header__right><div class=header__category><a href=../../hugo/>まくまく Hugo ノート</a></div><div class=header__title>Hugo で同一セクション内のページ／セクションの一覧を表示する</div></div></header></div><div class=l-withSidebar><div class=l-withSidebar__sidebarLeft><style>#tocStub{position:-webkit-sticky;position:sticky;top:2rem;margin-top:2rem;line-height:1.5;max-height:calc(100vh - 4rem);overflow-y:auto;-webkit-overflow-scrolling:touch}#tocStub ul{font-size:.9em;list-style:none;padding:0;border-top:solid 1px #ccc}#tocStub li{border:solid 1px #ccc;border-right:none;margin-top:-1px}#tocStub a{color:#666;padding:.6em .3em .6em .5em;display:block;text-decoration:none;font-weight:400}.level-2{margin-left:.8em}.level-3{padding-left:1.6em}</style><div id=tocStub></div><script>document.addEventListener("DOMContentLoaded",()=>{function e(e){const t=document.createElement("a");return t.setAttribute("id",e),t}function t(t,n){n.parentNode.insertBefore(e(t),n)}function n(e,t,n){const s=document.createElement("li");return s.classList.add("level-"+e),s.innerHTML='<a href="#'+t+'">'+n+"</a>",s}function s(){const e=document.createElement("ul");return document.querySelectorAll("h2, h3").forEach((s,o)=>{const i="section-"+o;t(i,s);const a=s.tagName.charAt(1)-1;e.appendChild(n(a,i,s.textContent))}),e}document.getElementById("tocStub").appendChild(s())})</script></div><div class=l-withSidebar__content><article class=article itemscope itemtype=https://schema.org/BlogPosting><div class=article__header><div class=breadcrumb><a href=../../>&#x1F3E0;HOME</a> > <a href=../../hugo/>まくまく Hugo ノート</a></div><div class=article__snsButtons><div class=snsButtons><a rel=nofollow target=_blank href="https://twitter.com/intent/post?url=https%3a%2f%2fmaku77.github.io%2fp%2fpgub54h%2f&text=Hugo%20%e3%81%a7%e5%90%8c%e4%b8%80%e3%82%bb%e3%82%af%e3%82%b7%e3%83%a7%e3%83%b3%e5%86%85%e3%81%ae%e3%83%9a%e3%83%bc%e3%82%b8%ef%bc%8f%e3%82%bb%e3%82%af%e3%82%b7%e3%83%a7%e3%83%b3%e3%81%ae%e4%b8%80%e8%a6%a7%e3%82%92%e8%a1%a8%e7%a4%ba%e3%81%99%e3%82%8b%20-%20%e3%81%be%e3%81%8f%e3%81%be%e3%81%8f%20Hugo%20%e3%83%8e%e3%83%bc%e3%83%88"><span class="snsButtons__icon snsButtons__icon--twitter"><svg xmlns="http://www.w3.org/2000/svg" width="100" height="100" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-twitter"><path d="M23 3a10.9 10.9.0 01-3.14 1.53 4.48 4.48.0 00-7.86 3v1A10.66 10.66.0 013 4s-4 9 5 13a11.64 11.64.0 01-7 2c9 5 20 0 20-11.5a4.5 4.5.0 00-.08-.83A7.72 7.72.0 0023 3z"/></svg></span></a><a rel=nofollow target=_blank href="https://www.facebook.com/share.php?u=https%3a%2f%2fmaku77.github.io%2fp%2fpgub54h%2f&t=Hugo%20%e3%81%a7%e5%90%8c%e4%b8%80%e3%82%bb%e3%82%af%e3%82%b7%e3%83%a7%e3%83%b3%e5%86%85%e3%81%ae%e3%83%9a%e3%83%bc%e3%82%b8%ef%bc%8f%e3%82%bb%e3%82%af%e3%82%b7%e3%83%a7%e3%83%b3%e3%81%ae%e4%b8%80%e8%a6%a7%e3%82%92%e8%a1%a8%e7%a4%ba%e3%81%99%e3%82%8b%20-%20%e3%81%be%e3%81%8f%e3%81%be%e3%81%8f%20Hugo%20%e3%83%8e%e3%83%bc%e3%83%88"><span class="snsButtons__icon snsButtons__icon--facebook"><svg xmlns="http://www.w3.org/2000/svg" width="100" height="100" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-facebook"><path d="M18 2h-3a5 5 0 00-5 5v3H7v4h3v8h4v-8h3l1-4h-4V7a1 1 0 011-1h3z"/></svg></span></a><a rel=nofollow target=_blank href="https://getpocket.com/edit?url=https%3a%2f%2fmaku77.github.io%2fp%2fpgub54h%2f&title=Hugo%20%e3%81%a7%e5%90%8c%e4%b8%80%e3%82%bb%e3%82%af%e3%82%b7%e3%83%a7%e3%83%b3%e5%86%85%e3%81%ae%e3%83%9a%e3%83%bc%e3%82%b8%ef%bc%8f%e3%82%bb%e3%82%af%e3%82%b7%e3%83%a7%e3%83%b3%e3%81%ae%e4%b8%80%e8%a6%a7%e3%82%92%e8%a1%a8%e7%a4%ba%e3%81%99%e3%82%8b%20-%20%e3%81%be%e3%81%8f%e3%81%be%e3%81%8f%20Hugo%20%e3%83%8e%e3%83%bc%e3%83%88"><span class="snsButtons__icon snsButtons__icon--pocket"><svg xmlns="http://www.w3.org/2000/svg" width="100" height="100" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-pocket"><path d="M4 3h16a2 2 0 012 2v6A10 10 0 0112 21 10 10 0 012 11V5a2 2 0 012-2z"/><polyline points="8 10 12 14 16 10"/></svg></span></a></div></div><div class=article__date><time class=pageDate>2020-01-14</time></div></div><div class=article__body><h2 id=そのセクション内のページ一覧を取得する-pagesregularpages>そのセクション内のページ一覧を取得する (.Pages、.RegularPages)</h2><p>リストテンプレートやセクションテンプレートの中で、<strong><code>.Pages</code></strong> を参照すると、そのセクション（やタクソノミー）直下の記事ページ (regular page) とセクションページ (list page) の一覧を <strong><code>Page</code></strong> オブジェクトの配列として取得することができます。</p><figure class=codeBlock><figcaption class=codeBlock__title>layouts/_default/section.html</figcaption><div class=codeBlock__code><div class=highlight><pre tabindex=0 class=chroma><code class=language-go-html-template data-lang=go-html-template><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>h3</span><span class=p>&gt;</span>セクションに含まれる記事ページ（あるいはセクションページ）の一覧<span class=p>&lt;/</span><span class=nt>h3</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>ul</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=cp>{{</span><span class=w> </span><span class=k>range</span><span class=w> </span><span class=na>.Pages</span><span class=w> </span><span class=cp>}}</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>li</span><span class=p>&gt;&lt;</span><span class=nt>a</span> <span class=na>href</span><span class=o>=</span><span class=s>&#34;</span><span class=cp>{{</span><span class=w> </span><span class=na>.RelPermalink</span><span class=w> </span><span class=cp>}}</span><span class=s>&#34;</span><span class=p>&gt;</span><span class=cp>{{</span><span class=w> </span><span class=na>.Title</span><span class=w> </span><span class=cp>}}</span><span class=p>&lt;/</span><span class=nt>a</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=cp>{{</span><span class=w> </span><span class=k>end</span><span class=w> </span><span class=cp>}}</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>ul</span><span class=p>&gt;</span></span></span></code></pre></div></div></figure><p>記事ページ (regular page) のみを列挙したい場合は、<code>.Pages</code> の部分を <strong><code>.RegularPages</code></strong> に変更してください。
逆に、セクションページ (list page) のみを列挙したい場合は、<code>.Pages</code> の部分を <strong><code>Sections</code></strong> に変更してください。</p><ul><li><strong><code>.Pages</code></strong> &mldr; セクションページと記事ページの一覧</li><li><strong><code>.RegularPages</code></strong> &mldr; 記事ページの一覧</li><li><strong><code>.Sections</code></strong> &mldr; セクションページの一覧</li></ul><p>上記のようなテンプレートは、タクソノミーテンプレート（タグの一覧ページ）でも同様に使用することができます。</p><p>ただし、<code>.Pages</code> や <code>.RegularPages</code> は、リスト系のページから参照することが想定されているため、シングルページテンプレート内で参照すると、<strong>サイズ 0 の配列</strong> が返されることに注意してください。
そのため、基本的には上記のコードはリスト系のテンプレートでのみ使用することができます。</p><p>シングルページテンプレートからも、同一セクション内のページの一覧を取得したい場合は、まず <strong><code>.CurrentSection</code></strong> でカレントセクションを示す <code>Page</code> オブジェクトを取得するとよいでしょう（下記参照)。</p><h2 id=同一セクション内のページ一覧を取得する-currentsectionpages>同一セクション内のページ一覧を取得する (.CurrentSection.Pages)</h2><p>下記のテンプレートコードは、現在の記事ページ（あるいはセクションページ）が所属するセクションの直下のページ（記事ページおよびセクションページ）の一覧を表示します。</p><p>例えば、ホームページを含むトップレベルの階層に置いた記事で実行された場合は、第一階層にあるセクションおよび記事ページの一覧が表示されます。
何らかのセクション内の記事で実行された場合は、その記事が所属するセクション内のサブセクションおよび記事ページの一覧が表示されます。</p><figure class=codeBlock><figcaption class=codeBlock__title>layouts/_default/single.html など</figcaption><div class=codeBlock__code><div class=highlight><pre tabindex=0 class=chroma><code class=language-go-html-template data-lang=go-html-template><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>h3</span><span class=p>&gt;</span>同じセクション内のページ一覧（セクションページを含む）<span class=p>&lt;/</span><span class=nt>h3</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=cp>{{</span><span class=w> </span><span class=k>with</span><span class=w> </span><span class=na>.CurrentSection</span><span class=w> </span><span class=cp>}}</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;</span><span class=nt>ul</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=cp>{{</span><span class=w> </span><span class=k>range</span><span class=w> </span><span class=na>.Pages</span><span class=w> </span><span class=cp>}}</span>
</span></span><span class=line><span class=cl>      <span class=p>&lt;</span><span class=nt>li</span><span class=p>&gt;&lt;</span><span class=nt>a</span> <span class=na>href</span><span class=o>=</span><span class=s>&#34;</span><span class=cp>{{</span><span class=w> </span><span class=na>.RelPermalink</span><span class=w> </span><span class=cp>}}</span><span class=s>&#34;</span><span class=p>&gt;</span><span class=cp>{{</span><span class=w> </span><span class=na>.Title</span><span class=w> </span><span class=cp>}}</span><span class=p>&lt;/</span><span class=nt>a</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=cp>{{</span><span class=w> </span><span class=k>end</span><span class=w> </span><span class=cp>}}</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;/</span><span class=nt>ul</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=cp>{{</span><span class=w> </span><span class=k>end</span><span class=w> </span><span class=cp>}}</span></span></span></code></pre></div></div></figure><p><code>.Pages</code> 変数はリスト系ページ（セクションページなど）の <code>Page</code> オブジェクトにしか要素が格納されない（記事ページでは空配列）になってしまうので、まずは自分自身の記事ページが所属するセクションに対応する <code>Page</code> オブジェクトを、<code>.CurrentSection</code> で取得してから処理を行うようにしています。</p><p>先に説明したのと同様、記事ページのみを列挙したい場合は <code>.Pages</code> の代わりに <code>.RegularPages</code> を、セクションページのみを列挙したい場合は <code>.Pages</code> の代わりに <code>.Sections</code> を参照してください。</p><p>このコードは、シングルページテンプレートからも、リストテンプレートからも使用できます。</p><ul><li>参考: <a href=https://gohugo.io/variables/page/>Hugo | Page Variables</a><blockquote><p>a collection of associated pages. This value will be nil for regular content pages. .Pages is an alias for .Data.Pages.</p></blockquote></li><li>参考: <a href=https://github.com/gohugoio/hugo/blob/master/hugolib/page.go#L101>hugo/page.go at master · gohugoio/hugo · GitHub</a><blockquote><p>Since Hugo 0.18 we got rid of the Node type. So now all pages are pages (regular pages, home page, sections etc.).
Sections etc. will have child pages. These were earlier placed in .Data.Pages, but can now be more intuitively also be fetched directly from .Pages.
This collection will be nil for regular pages.</p></blockquote></li></ul><h2 id=コラムホームページでの-pages-変数の振る舞いについて>（コラム）ホームページでの .Pages 変数の振る舞いについて</h2><p><strong>（下記は Hugo v0.58.0 より前のバージョンの記事です）</strong></p><p>Hugo v0.58.0 で、ホームページにおける <code>.Pages</code> 変数、<code>.RegularPages</code> 変数の振る舞いが、他のセクションページと同じになりました（そのセクション直下のページだけ返す）。
なので、<strong>v0.58.0 以降を使用する場合は、下記の対応は必要ありません</strong>。</p><ul><li>参考: <a href=https://github.com/gohugoio/hugo/releases/tag/v0.58.0>Hugo v0.58.0 Release Note</a><blockquote><p>home.Pages now behaves like all the other sections, see #6240. If you want to list all the regular pages, use .Site.RegularPages.</p></blockquote></li></ul><h3 id=ホームページテンプレートとセクションテンプレートでの-pages-の振る舞いの違い>ホームページテンプレートとセクションテンプレートでの .Pages の振る舞いの違い</h3><p>ホームページテンプレート (<code>layouts/index.html</code>) 内で <code>.Pages</code> を参照すると、<strong>サイト内のすべてのページ</strong> の <code>Page</code> 配列が返されるのですが、セクションテンプレート (<code>layouts/_default/section.html</code>) 内で <code>.Pages</code> を参照すると、その <strong>セクション直下にあるページ</strong> のみの <code>Page</code> 配列が返されるという違いがあるようです。</p><p>テンプレート内で <code>.Pages</code> 変数を参照するときは、そのテンプレートがホームページテンプレートと、セクションテンプレートのどちらのコンテキストで使用されるかを意識して扱い方を変える必要があります。
特に、<code>layouts/_default/list.html</code> のような、ホームページテンプレートとしても、セクションテンプレートとしても使用されるファイルを作成する場合には注意してください。</p><p>次の節では、この点を考慮して、カレントセクション直下に配置されたページのみのリストを取得する方法を示します。</p><h3 id=同一セクションの直下の記事ページのリストを表示する>同一セクションの直下の記事ページのリストを表示する</h3><p>下記のテンプレートコードは、現在のページが所属するセクションの直下に配置された記事ページのリストを表示します。</p><figure class=codeBlock><figcaption class=codeBlock__title>layouts/partials/subpages.html</figcaption><div class=codeBlock__code><div class=highlight><pre tabindex=0 class=chroma><code class=language-go-html-template data-lang=go-html-template><span class=line><span class=cl><span class=cp>{{-</span><span class=w> </span><span class=nx>$sec</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=na>.CurrentSection</span><span class=w> </span><span class=cp>}}</span>
</span></span><span class=line><span class=cl><span class=cp>{{-</span><span class=w> </span><span class=k>if</span><span class=w> </span><span class=nx>$sec</span><span class=w> </span><span class=cp>}}</span>
</span></span><span class=line><span class=cl>  <span class=cp>{{-</span><span class=w> </span><span class=k>if</span><span class=w> </span><span class=nx>$sec</span><span class=na>.IsHome</span><span class=w> </span><span class=cp>}}</span>
</span></span><span class=line><span class=cl>    <span class=cp>{{</span><span class=w> </span><span class=na>.Scratch.Set</span><span class=w> </span><span class=s>&#34;pages&#34;</span><span class=w> </span><span class=o>(</span><span class=nx>where</span><span class=w> </span><span class=na>$.Site.RegularPages</span><span class=w> </span><span class=s>&#34;Section&#34;</span><span class=w> </span><span class=s>&#34;&#34;</span><span class=o>)</span><span class=w> </span><span class=cp>}}</span>
</span></span><span class=line><span class=cl>  <span class=cp>{{-</span><span class=w> </span><span class=k>else</span><span class=w> </span><span class=cp>}}</span>
</span></span><span class=line><span class=cl>    <span class=cp>{{</span><span class=w> </span><span class=na>.Scratch.Set</span><span class=w> </span><span class=s>&#34;pages&#34;</span><span class=w> </span><span class=nx>$sec</span><span class=na>.Pages</span><span class=w> </span><span class=cp>}}</span>
</span></span><span class=line><span class=cl>  <span class=cp>{{-</span><span class=w> </span><span class=k>end</span><span class=w> </span><span class=cp>}}</span>
</span></span><span class=line><span class=cl><span class=cp>{{-</span><span class=w> </span><span class=k>end</span><span class=w> </span><span class=cp>}}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>h3</span><span class=p>&gt;</span>同じセクション内の記事ページ一覧<span class=p>&lt;/</span><span class=nt>h3</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>ul</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=cp>{{-</span><span class=w> </span><span class=k>range</span><span class=w> </span><span class=o>(</span><span class=na>.Scratch.Get</span><span class=w> </span><span class=s>&#34;pages&#34;</span><span class=o>)</span><span class=w> </span><span class=cp>}}</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>li</span><span class=p>&gt;&lt;</span><span class=nt>a</span> <span class=na>href</span><span class=o>=</span><span class=s>&#34;</span><span class=cp>{{</span><span class=w> </span><span class=na>.RelPermalink</span><span class=w> </span><span class=cp>}}</span><span class=s>&#34;</span><span class=p>&gt;</span><span class=cp>{{</span><span class=w> </span><span class=na>.Title</span><span class=w> </span><span class=cp>}}</span><span class=p>&lt;/</span><span class=nt>a</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=cp>{{-</span><span class=w> </span><span class=k>end</span><span class=w> </span><span class=cp>}}</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>ul</span><span class=p>&gt;</span></span></span></code></pre></div></div></figure><p>例えば、<code>mysection</code> セクションに所属する記事ページのテンプレートで上記のコードが実行されると、同じ <code>mysection</code> セクションに所属する記事ページのリストが表示されます。
また、ホームページを含む、トップレベル（<code>content</code> ディレクトリ直下）に配置したページ内で実行した場合は、トップレベルに配置した記事ページのリストが表示されます。
つまり、上記のパーシャルテンプレートは、下記のような様々なテンプレートファイル内から同様に使用することができます。</p><ul><li>ホームページテンプレート (<code>layouts/index.html</code>)</li><li>セクションテンプレート (<code>layouts/_default/section.html</code>)</li><li>汎用リストテンプレート (<code>layouts/_default/list.html</code>)</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-go-html-template data-lang=go-html-template><span class=line><span class=cl><span class=cp>{{</span><span class=w> </span><span class=nx>partial</span><span class=w> </span><span class=s>&#34;subpages&#34;</span><span class=w> </span><span class=na>.</span><span class=w> </span><span class=cp>}}</span>
</span></span></code></pre></div><p>テンプレートコードが若干複雑になっているのは、<code>.Pages</code> の振る舞いがコンテキストによって変わってくることが影響しています。
セクションページ内では、単純に <code>.Pages</code> を参照すれば、セクション直下の記事ページ一覧を取得できるのですが、ホームページで <code>.Pages</code> を参照すると、サイト内のすべてのページが含まれてしまいます。
そこで、現在のページがトップレベルの階層の記事である場合は、ちょっと特殊な方法、セクションを持たない記事の一覧を取得する (<code>where $.Site.RegularPages "Section" ""</code>) といった回りくどいことを行っています。</p><p>ちなみに、前半部分は次のようにセクション名 (<code>.Section</code>) の有無で分岐するように書けそうですが、このような記述はタクソノミーテンプレートのコンテキストではエラーになってしまいます。
なぜなら、<code>https://example.com/tags/tag1/</code> のようなタグページにアクセスした場合に、セクション名 (<code>.Section</code>) に <code>tags</code> という文字列が格納されるのにもかかわらず、<code>.CurrentSection</code> の値は <code>nil</code> になってしまうからです（<code>.CurrentSection</code> の nil dereference エラーが発生する）。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-go-html-template data-lang=go-html-template><span class=line><span class=cl><span class=cm>{{/* カレントセクション直下の記事ページ一覧を &#34;pages&#34; スクラッチに格納 */}}</span>
</span></span><span class=line><span class=cl><span class=cp>{{-</span><span class=w> </span><span class=k>if</span><span class=w> </span><span class=na>.Section</span><span class=w> </span><span class=cp>}}</span>
</span></span><span class=line><span class=cl>  <span class=cp>{{</span><span class=w> </span><span class=na>.Scratch.Set</span><span class=w> </span><span class=s>&#34;pages&#34;</span><span class=w> </span><span class=na>.CurrentSection.Pages</span><span class=w> </span><span class=cp>}}</span>
</span></span><span class=line><span class=cl><span class=cp>{{-</span><span class=w> </span><span class=k>else</span><span class=w> </span><span class=cp>}}</span>
</span></span><span class=line><span class=cl>  <span class=cp>{{</span><span class=w> </span><span class=na>.Scratch.Set</span><span class=w> </span><span class=s>&#34;pages&#34;</span><span class=w> </span><span class=o>(</span><span class=nx>where</span><span class=w> </span><span class=na>$.Site.RegularPages</span><span class=w> </span><span class=s>&#34;Section&#34;</span><span class=w> </span><span class=s>&#34;&#34;</span><span class=o>)</span><span class=w> </span><span class=cp>}}</span>
</span></span><span class=line><span class=cl><span class=cp>{{-</span><span class=w> </span><span class=k>end</span><span class=w> </span><span class=cp>}}</span>
</span></span></code></pre></div><p>このような記述をするのであれば、全体を <code>{{ if nq .Kind "taxonomy" }} 〜 {{ end }}</code> のように囲んで、タクソノミーテンプレートのコンテキストでは実行されないようにしておくべきでしょう。
そうすると、結局のところ、最初の例とあまりコード量は変わらなくなります。</p><p>あと、<code>$pages</code> 変数のようなものを作成せずに、わざわざ <code>.Scratch.Set</code> を使ってスクラッチ領域にページリストを保存しているのは、Go テンプレートの構文で、変数の条件代入を行ううまい方法が用意されていないからです。
このあたりの話は、<a href=https://github.com/golang/go/issues/10608>こちらの Hugo のサイトで議論されています</a>。
スクラッチ領域 (<code>.Scratch</code>) を使用するのが気持ち悪いという場合は、下記のように、<code>define</code> による部分テンプレートを定義してしまえば、変数を用意しなくてすみますね。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-go-html-template data-lang=go-html-template><span class=line><span class=cl><span class=cp>{{-</span><span class=w> </span><span class=nx>define</span><span class=w> </span><span class=s>&#34;showPageList&#34;</span><span class=w> </span><span class=cp>}}</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;</span><span class=nt>h3</span><span class=p>&gt;</span>同じセクション内の記事ページ一覧<span class=p>&lt;/</span><span class=nt>h3</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;</span><span class=nt>ul</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=cp>{{-</span><span class=w> </span><span class=k>range</span><span class=w> </span><span class=na>.</span><span class=w> </span><span class=cp>}}</span>
</span></span><span class=line><span class=cl>      <span class=p>&lt;</span><span class=nt>li</span><span class=p>&gt;&lt;</span><span class=nt>a</span> <span class=na>href</span><span class=o>=</span><span class=s>&#34;</span><span class=cp>{{</span><span class=w> </span><span class=na>.RelPermalink</span><span class=w> </span><span class=cp>}}</span><span class=s>&#34;</span><span class=p>&gt;</span><span class=cp>{{</span><span class=w> </span><span class=na>.Title</span><span class=w> </span><span class=cp>}}</span><span class=p>&lt;/</span><span class=nt>a</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=cp>{{-</span><span class=w> </span><span class=k>end</span><span class=w> </span><span class=cp>}}</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;/</span><span class=nt>ul</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=cp>{{-</span><span class=w> </span><span class=k>end</span><span class=w> </span><span class=cp>}}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=cp>{{-</span><span class=w> </span><span class=k>with</span><span class=w> </span><span class=nx>$sec</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=na>.CurrentSection</span><span class=w> </span><span class=cp>}}</span>
</span></span><span class=line><span class=cl>  <span class=cp>{{-</span><span class=w> </span><span class=k>if</span><span class=w> </span><span class=nx>$sec</span><span class=na>.IsHome</span><span class=w> </span><span class=cp>}}</span>
</span></span><span class=line><span class=cl>    <span class=cp>{{</span><span class=w> </span><span class=k>template</span><span class=w> </span><span class=s>&#34;showPageList&#34;</span><span class=w> </span><span class=o>(</span><span class=nx>where</span><span class=w> </span><span class=na>$.Site.RegularPages</span><span class=w> </span><span class=s>&#34;Section&#34;</span><span class=w> </span><span class=s>&#34;&#34;</span><span class=o>)</span><span class=w> </span><span class=cp>}}</span>
</span></span><span class=line><span class=cl>  <span class=cp>{{-</span><span class=w> </span><span class=k>else</span><span class=w> </span><span class=cp>}}</span>
</span></span><span class=line><span class=cl>    <span class=cp>{{</span><span class=w> </span><span class=k>template</span><span class=w> </span><span class=s>&#34;showPageList&#34;</span><span class=w> </span><span class=nx>$sec</span><span class=na>.Pages</span><span class=w> </span><span class=cp>}}</span>
</span></span><span class=line><span class=cl>  <span class=cp>{{-</span><span class=w> </span><span class=k>end</span><span class=w> </span><span class=cp>}}</span>
</span></span><span class=line><span class=cl><span class=cp>{{-</span><span class=w> </span><span class=k>end</span><span class=w> </span><span class=cp>}}</span>
</span></span></code></pre></div><h3 id=条件代入は-cond-関数でスッキリかける2017-12-30-追記>条件代入は cond 関数でスッキリかける！？（2017-12-30 追記）</h3><p>Hugo v0.27 で、三項演算子のようなことが実現できる <strong><code>cond</code></strong> 関数が追加されました（参考: <a href=https://github.com/gohugoio/hugo/issues/3860>Ternary operator-like function · Issue #3860 · gohugoio/hugo · GitHub</a>）。
まだ公式ドキュエントには <code>cond</code> 関数の記載がないようですが、下記のように使用できます。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-go-html-template data-lang=go-html-template><span class=line><span class=cl><span class=cp>{{</span><span class=w> </span><span class=na>$</span><span class=err>変数</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=o>(</span><span class=nx>cond</span><span class=w> </span><span class=o>(</span><span class=err>条件式</span><span class=o>)</span><span class=w> </span><span class=err>真の場合の値</span><span class=w> </span><span class=err>偽の場合の値</span><span class=o>)</span><span class=w> </span><span class=cp>}}</span>
</span></span></code></pre></div><p>これで回りくどい <code>.Scratch</code> イディオムを使用しなくて済む！やったー！(^o^)/
と思って、下記のように書いてみました。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-go-html-template data-lang=go-html-template><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>h3</span><span class=p>&gt;</span>同じセクション内の記事ページ一覧<span class=p>&lt;/</span><span class=nt>h3</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>ul</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=cp>{{-</span><span class=w> </span><span class=nx>$pages</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=o>(</span><span class=nx>cond</span><span class=w> </span><span class=o>(</span><span class=k>eq</span><span class=w> </span><span class=na>.Section</span><span class=w> </span><span class=s>&#34;&#34;</span><span class=o>)</span><span class=w> </span><span class=o>(</span><span class=nx>where</span><span class=w> </span><span class=na>$.Site.RegularPages</span><span class=w> </span><span class=s>&#34;Section&#34;</span><span class=w> </span><span class=s>&#34;&#34;</span><span class=o>)</span><span class=w> </span><span class=na>.CurrentSection.RegularPages</span><span class=o>)</span><span class=w> </span><span class=cp>}}</span>
</span></span><span class=line><span class=cl>  <span class=cp>{{-</span><span class=w> </span><span class=k>range</span><span class=w> </span><span class=nx>$pages</span><span class=w> </span><span class=cp>}}</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>li</span><span class=p>&gt;&lt;</span><span class=nt>a</span> <span class=na>href</span><span class=o>=</span><span class=s>&#34;</span><span class=cp>{{</span><span class=w> </span><span class=na>.RelPermalink</span><span class=w> </span><span class=cp>}}</span><span class=s>&#34;</span><span class=p>&gt;</span><span class=cp>{{</span><span class=w> </span><span class=na>.Title</span><span class=w> </span><span class=cp>}}</span><span class=p>&lt;/</span><span class=nt>a</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=cp>{{-</span><span class=w> </span><span class=k>end</span><span class=w> </span><span class=cp>}}</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>ul</span><span class=p>&gt;</span>
</span></span></code></pre></div><p>がしかし！
<code>cond</code> 関数を使用して上記のように記述すると、条件式が真と判定される場合も、後ろの <code>.CurrentSection.Pages</code> の部分が評価されてしまうようです（値が実際に使われなくても実行される）。
<code>.CurrentSection</code> は <code>nil</code> になるケースがあるので、そのようなコンテキストで実行された場合にエラーになってしまいます。
Go の並列実行の都合なのだと思いますが、惜しい！</p></div><div class=article__footer><div class=article__date><time class=pageDate>2020-01-14</time></div><div class=article__snsButtons><div class=snsButtons><a rel=nofollow target=_blank href="https://twitter.com/intent/post?url=https%3a%2f%2fmaku77.github.io%2fp%2fpgub54h%2f&text=Hugo%20%e3%81%a7%e5%90%8c%e4%b8%80%e3%82%bb%e3%82%af%e3%82%b7%e3%83%a7%e3%83%b3%e5%86%85%e3%81%ae%e3%83%9a%e3%83%bc%e3%82%b8%ef%bc%8f%e3%82%bb%e3%82%af%e3%82%b7%e3%83%a7%e3%83%b3%e3%81%ae%e4%b8%80%e8%a6%a7%e3%82%92%e8%a1%a8%e7%a4%ba%e3%81%99%e3%82%8b%20-%20%e3%81%be%e3%81%8f%e3%81%be%e3%81%8f%20Hugo%20%e3%83%8e%e3%83%bc%e3%83%88"><span class="snsButtons__icon snsButtons__icon--twitter"><svg xmlns="http://www.w3.org/2000/svg" width="100" height="100" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-twitter"><path d="M23 3a10.9 10.9.0 01-3.14 1.53 4.48 4.48.0 00-7.86 3v1A10.66 10.66.0 013 4s-4 9 5 13a11.64 11.64.0 01-7 2c9 5 20 0 20-11.5a4.5 4.5.0 00-.08-.83A7.72 7.72.0 0023 3z"/></svg></span></a><a rel=nofollow target=_blank href="https://www.facebook.com/share.php?u=https%3a%2f%2fmaku77.github.io%2fp%2fpgub54h%2f&t=Hugo%20%e3%81%a7%e5%90%8c%e4%b8%80%e3%82%bb%e3%82%af%e3%82%b7%e3%83%a7%e3%83%b3%e5%86%85%e3%81%ae%e3%83%9a%e3%83%bc%e3%82%b8%ef%bc%8f%e3%82%bb%e3%82%af%e3%82%b7%e3%83%a7%e3%83%b3%e3%81%ae%e4%b8%80%e8%a6%a7%e3%82%92%e8%a1%a8%e7%a4%ba%e3%81%99%e3%82%8b%20-%20%e3%81%be%e3%81%8f%e3%81%be%e3%81%8f%20Hugo%20%e3%83%8e%e3%83%bc%e3%83%88"><span class="snsButtons__icon snsButtons__icon--facebook"><svg xmlns="http://www.w3.org/2000/svg" width="100" height="100" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-facebook"><path d="M18 2h-3a5 5 0 00-5 5v3H7v4h3v8h4v-8h3l1-4h-4V7a1 1 0 011-1h3z"/></svg></span></a><a rel=nofollow target=_blank href="https://getpocket.com/edit?url=https%3a%2f%2fmaku77.github.io%2fp%2fpgub54h%2f&title=Hugo%20%e3%81%a7%e5%90%8c%e4%b8%80%e3%82%bb%e3%82%af%e3%82%b7%e3%83%a7%e3%83%b3%e5%86%85%e3%81%ae%e3%83%9a%e3%83%bc%e3%82%b8%ef%bc%8f%e3%82%bb%e3%82%af%e3%82%b7%e3%83%a7%e3%83%b3%e3%81%ae%e4%b8%80%e8%a6%a7%e3%82%92%e8%a1%a8%e7%a4%ba%e3%81%99%e3%82%8b%20-%20%e3%81%be%e3%81%8f%e3%81%be%e3%81%8f%20Hugo%20%e3%83%8e%e3%83%bc%e3%83%88"><span class="snsButtons__icon snsButtons__icon--pocket"><svg xmlns="http://www.w3.org/2000/svg" width="100" height="100" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-pocket"><path d="M4 3h16a2 2 0 012 2v6A10 10 0 0112 21 10 10 0 012 11V5a2 2 0 012-2z"/><polyline points="8 10 12 14 16 10"/></svg></span></a></div></div><div class=breadcrumb><a href=../../>&#x1F3E0;HOME</a> > <a href=../../hugo/>まくまく Hugo ノート</a></div></div></article><script>var SIDEBAR_HIDE_THRESHOLD=800,SIDEBAR_WIDTH=250,OFFSET=10,w=window.innerWidth;w>=SIDEBAR_HIDE_THRESHOLD&&(w-=SIDEBAR_WIDTH),w-=OFFSET,w>=728?rakuten_size="728x200":w>=600?rakuten_size="600x200":w>=468?rakuten_size="468x160":w>=336?rakuten_size="336x280":w>=300?rakuten_size="300x250":w>=250?rakuten_size="250x250":rakuten_size="200x350",rakuten_design="slide",rakuten_affiliateId="1239b074.74af6526.1239b075.bc72ef6e",rakuten_items="ctsmatch",rakuten_genreId=0,rakuten_target="_blank",rakuten_theme="gray",rakuten_border="off",rakuten_auto_mode="on",rakuten_genre_title="off",rakuten_recommend="on",rakuten_txtColor="333333",rakuten_moverColor="30C030",rakuten_bgColor="FFFFFF",rakuten_captionColor="333333"</script><script src=https://xml.affiliate.rakuten.co.jp/widget/js/rakuten_widget.js></script></div><div class=l-withSidebar__sidebarRight><nav class=navigation><div class=navigation__header>カテゴリ一覧</div><ul><li><a class=navigation__item href=https://maku77.github.io/memo/>いろいろ</a><li><a class=navigation__item href=https://maku77.github.io/android/>Android</a><li><a class=navigation__item href=https://maku.blog/p/8t6hr3d/>Ansible</a><li><a class=navigation__item href=https://maku77.github.io/blender/>Blender</a><li><a class=navigation__item href=https://maku77.github.io/cpp/>C/C++</a><li><a class=navigation__item href=https://maku77.github.io/docker/>Docker</a><li><a class=navigation__item href=https://maku77.github.io/git/>Git</a><li><a class=navigation__item href=https://maku77.github.io/go/>Go言語</a><li><a class=navigation__item href=https://maku77.github.io/gradle/>Gradle</a><li><a class=navigation__item href=https://maku77.github.io/web/>HTML/CSS</a><li><a class="navigation__item navigation__item--focused" href=https://maku77.github.io/hugo/>Hugo</a><li><a class=navigation__item href=https://maku77.github.io/java/>Java</a><li><a class=navigation__item href=https://maku77.github.io/js/>JavaScript</a><li><a class=navigation__item href=https://maku77.github.io/kotlin/>Kotlin</a><li><a class=navigation__item href=https://maku77.github.io/linux/>Linux/Shell</a><li><a class=navigation__item href=https://maku77.github.io/mac/>Mac</a><li><a class=navigation__item href=https://maku77.github.io/middleman/>Middleman</a><li><a class=navigation__item href=https://toushi.maku.blog/p/etedykx/>MetaTrader</a><li><a class=navigation__item href=https://maku77.github.io/nodejs/>Node.js</a><li><a class=navigation__item href=https://maku77.github.io/octave/>Octave</a><li><a class=navigation__item href=https://maku77.github.io/p4/>Perforce</a><li><a class=navigation__item href=https://maku77.github.io/perl/>Perl</a><li><a class=navigation__item href=https://maku77.github.io/php/>PHP</a><li><a class=navigation__item href=https://maku77.github.io/python/>Python</a><li><a class=navigation__item href=https://maku77.github.io/r/>R</a><li><a class=navigation__item href=https://maku77.github.io/ruby/>Ruby</a><li><a class=navigation__item href=https://maku77.github.io/rust/>Rust</a><li><a class=navigation__item href=https://maku77.github.io/sass/>Sass</a><li><a class=navigation__item href=https://maku77.github.io/sed/>sed/awk</a><li><a class=navigation__item href=https://maku77.github.io/sql/>SQL</a><li><a class=navigation__item href=https://maku77.github.io/tradestation/>トレードステーション</a><li><a class=navigation__item href=https://maku77.github.io/vagrant/>Vagrant</a><li><a class=navigation__item href=https://maku77.github.io/vba/>VBA</a><li><a class=navigation__item href=https://maku77.github.io/vim/>Vim</a><li><a class=navigation__item href=https://maku77.github.io/windows/>Windows</a></ul></nav><style>.codoc-support{display:inline-block;margin:0!important;padding:12px!important;width:200px!important;max-width:100%}.codoc-support .codoc-support-title{font-size:smaller!important;white-space:nowrap;margin-bottom:12px!important}.codoc-support .codoc-btn{width:160px!important}</style><script src=https://codoc.jp/js/cms.js data-css=black data-usercode=tp6ZPzTj3w defer></script><div id=codoc-entry-4gYwTntzzw class=codoc-entries data-without-body=1 data-support-button-text="（っ'-')╮シュッ🔴" data-show-like=0 data-show-about-codoc=0 data-show-powered-by=0 data-support-message=まくに投げ銭できます。></div></div></div><script>document.addEventListener("DOMContentLoaded",function(){const e=document.querySelectorAll("a[href^=http]");for(let n=0;n<e.length;++n){const t=e[n];if(t.href.startsWith("https://maku77.github.io"))continue;const s=t.getElementsByTagName("img");if(s.length>0)continue;const o=t.getElementsByTagName("svg");if(o.length>0)continue;t.classList.add("externalLinkIcon"),t.setAttribute("target","_blank"),t.setAttribute("rel","noopener")}})</script></body></html>