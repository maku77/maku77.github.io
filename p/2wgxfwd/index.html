<!doctype html><html lang=ja-jp><head prefix="og: http://ogp.me/ns# fb: http://ogp.me/ns/fb#"><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><title>Traceview でプロファイル情報を表示する - まくまく Android ノート</title><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-6317852277883092" crossorigin=anonymous></script>
<link rel=icon sizes="16x16 32x32 48x48 64x64" href=../../assets/img/favicon/favicon.ico><link rel=icon sizes=192x192 href=../../assets/img/favicon/192x192.png><link rel=apple-touch-icon href=../../assets/img/favicon/180x180.png><script async src="https://www.googletagmanager.com/gtag/js?id=G-X5962TDYXS"></script>
<script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-X5962TDYXS")</script><meta property="og:site_name" content="天才まくまくノート"><meta property="og:title" content="Traceview でプロファイル情報を表示する - まくまく Android ノート"><meta property="og:type" content="website"><meta property="og:url" content="https://maku77.github.io/p/2wgxfwd/"><meta property="og:locale" content="ja_JP"><meta property="og:description" content="参考: Traceview - Android Developers
プロファイリングデータを取得する アプリケーション内の特定のコード区間のプロファイリングを行うには、プロファイリンク期間を android.os.debug.Debug クラスの startMethodTracing() と stopMethodTracing() で囲みます。
Debug.startMethodTracing(); ... プロファイリング中 ... Debug.stopMethodTracing(); プロファイリング結果は、/sdcard/dmtrace.trace というバイナリファイルに出力されます。 端末に SD カードが挿入されていないとエラーになります。
startMethodTracing メソッドのパラメータでファイル名のベース名を指定すると、/sdcard/<basename>.trace というファイル名で出力されるようになります。 結局 SD カードに出力されることには変わりありません。
ドキュメントには、
These methods start and stop method tracing across the entire virtual machine.
と記述されているので、Debug.startMethodTracing() を呼び出した時点から、アプリケーション全体（正確には Dalvik VM 全体）のプロファイリングが行われることになります。 Activity がそのアプリのエントリポイントとなっているのなら、onCreate(), onDestroy() でそれぞれ、startMethodTracing()、stopMethodTracing() を呼び出すようにすれば、そのアプリ全体のプロファイリングを行うことができます。
プロファイリングデータを表示する Android SDK に含まれている traceview コマンドを使用すると、プロファイリング結果をグラフィカルに表示することができます。
図: Traceview 上記の図では、タイムラインに main スレッドが一本だけ表示されていますが、複数のスレッドが存在すれば、main 以外のスレッドもその下に表示されます。
まずは、/sdcard/dmtrace.trace ファイルを PC に取得します。
C:\> adb pull /sdcard/dmtrace."><link rel=stylesheet href=../../css/all.min.fcd49439ce56e99e92bb2634d4d9f145fa809e9d33d8a55d49e996b7fd6995cd.css></head><body><div class=l-pageHeader><header class=header><a href=../../android/><img class=header__icon src=../../android/_index.svg></a><div class=header__right><div class=header__category><a href=../../android/>まくまく Android ノート</a></div><div class=header__title>Traceview でプロファイル情報を表示する</div></div></header></div><div class=l-withSidebar><div class=l-withSidebar__sidebarLeft><style>#tocStub{position:-webkit-sticky;position:sticky;top:2rem;margin-top:2rem;line-height:1.5;max-height:calc(100vh - 4rem);overflow-y:auto;-webkit-overflow-scrolling:touch}#tocStub ul{font-size:.9em;list-style:none;padding:0;border-top:solid 1px #ccc}#tocStub li{border:solid 1px #ccc;border-right:none;margin-top:-1px}#tocStub a{color:#666;padding:.6em .3em .6em .5em;display:block;text-decoration:none;font-weight:400}.level-2{margin-left:.8em}.level-3{padding-left:1.6em}</style><div id=tocStub></div><script>document.addEventListener("DOMContentLoaded",()=>{function e(e){const t=document.createElement("a");return t.setAttribute("id",e),t}function t(t,n){n.parentNode.insertBefore(e(t),n)}function n(e,t,n){const s=document.createElement("li");return s.classList.add("level-"+e),s.innerHTML='<a href="#'+t+'">'+n+"</a>",s}function s(){const e=document.createElement("ul");return document.querySelectorAll("h2, h3").forEach((s,o)=>{const i="section-"+o;t(i,s);const a=s.tagName.charAt(1)-1;e.appendChild(n(a,i,s.textContent))}),e}document.getElementById("tocStub").appendChild(s())})</script></div><div class=l-withSidebar__content><article class=article itemscope itemtype=https://schema.org/BlogPosting><div class=article__header><div class=breadcrumb><a href=../../>&#x1F3E0;HOME</a> > <a href=../../android/>まくまく Android ノート</a></div><div class=article__snsButtons><div class=snsButtons><a rel=nofollow target=_blank href="https://twitter.com/share?url=https%3a%2f%2fmaku77.github.io%2fp%2f2wgxfwd%2f&text=Traceview%20%e3%81%a7%e3%83%97%e3%83%ad%e3%83%95%e3%82%a1%e3%82%a4%e3%83%ab%e6%83%85%e5%a0%b1%e3%82%92%e8%a1%a8%e7%a4%ba%e3%81%99%e3%82%8b%20-%20%e3%81%be%e3%81%8f%e3%81%be%e3%81%8f%20Android%20%e3%83%8e%e3%83%bc%e3%83%88"><span class="snsButtons__icon snsButtons__icon--twitter"><svg xmlns="http://www.w3.org/2000/svg" width="100" height="100" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-twitter"><path d="M23 3a10.9 10.9.0 01-3.14 1.53 4.48 4.48.0 00-7.86 3v1A10.66 10.66.0 013 4s-4 9 5 13a11.64 11.64.0 01-7 2c9 5 20 0 20-11.5a4.5 4.5.0 00-.08-.83A7.72 7.72.0 0023 3z"/></svg></span></a><a rel=nofollow target=_blank href="https://www.facebook.com/share.php?u=https%3a%2f%2fmaku77.github.io%2fp%2f2wgxfwd%2f&t=Traceview%20%e3%81%a7%e3%83%97%e3%83%ad%e3%83%95%e3%82%a1%e3%82%a4%e3%83%ab%e6%83%85%e5%a0%b1%e3%82%92%e8%a1%a8%e7%a4%ba%e3%81%99%e3%82%8b%20-%20%e3%81%be%e3%81%8f%e3%81%be%e3%81%8f%20Android%20%e3%83%8e%e3%83%bc%e3%83%88"><span class="snsButtons__icon snsButtons__icon--facebook"><svg xmlns="http://www.w3.org/2000/svg" width="100" height="100" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-facebook"><path d="M18 2h-3a5 5 0 00-5 5v3H7v4h3v8h4v-8h3l1-4h-4V7a1 1 0 011-1h3z"/></svg></span></a><a rel=nofollow target=_blank href="https://getpocket.com/edit?url=https%3a%2f%2fmaku77.github.io%2fp%2f2wgxfwd%2f&title=Traceview%20%e3%81%a7%e3%83%97%e3%83%ad%e3%83%95%e3%82%a1%e3%82%a4%e3%83%ab%e6%83%85%e5%a0%b1%e3%82%92%e8%a1%a8%e7%a4%ba%e3%81%99%e3%82%8b%20-%20%e3%81%be%e3%81%8f%e3%81%be%e3%81%8f%20Android%20%e3%83%8e%e3%83%bc%e3%83%88"><span class="snsButtons__icon snsButtons__icon--pocket"><svg xmlns="http://www.w3.org/2000/svg" width="100" height="100" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-pocket"><path d="M4 3h16a2 2 0 012 2v6A10 10 0 0112 21 10 10 0 012 11V5a2 2 0 012-2z"/><polyline points="8 10 12 14 16 10"/></svg></span></a></div></div><div class=article__date><time class=pageDate>2011-01-14</time></div></div><div class=article__body><p>参考: <a href=https://developer.android.com/studio/profile/traceview>Traceview - Android Developers</a></p><h2 id=プロファイリングデータを取得する>プロファイリングデータを取得する</h2><p>アプリケーション内の特定のコード区間のプロファイリングを行うには、プロファイリンク期間を <code>android.os.debug.Debug</code> クラスの <code>startMethodTracing()</code> と <code>stopMethodTracing()</code> で囲みます。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=n>Debug</span><span class=o>.</span><span class=na>startMethodTracing</span><span class=o>();</span>
</span></span><span class=line><span class=cl><span class=o>...</span> <span class=err>プロファイリング中</span> <span class=o>...</span>
</span></span><span class=line><span class=cl><span class=n>Debug</span><span class=o>.</span><span class=na>stopMethodTracing</span><span class=o>();</span>
</span></span></code></pre></div><p>プロファイリング結果は、<code>/sdcard/dmtrace.trace</code> というバイナリファイルに出力されます。
端末に SD カードが挿入されていないとエラーになります。</p><p><code>startMethodTracing</code> メソッドのパラメータでファイル名のベース名を指定すると、<code>/sdcard/&lt;basename>.trace</code> というファイル名で出力されるようになります。
結局 SD カードに出力されることには変わりありません。</p><p>ドキュメントには、</p><blockquote><p>These methods start and stop method tracing across the entire virtual machine.</p></blockquote><p>と記述されているので、<code>Debug.startMethodTracing()</code> を呼び出した時点から、アプリケーション全体（正確には Dalvik VM 全体）のプロファイリングが行われることになります。
Activity がそのアプリのエントリポイントとなっているのなら、<code>onCreate()</code>, <code>onDestroy()</code> でそれぞれ、<code>startMethodTracing()</code>、<code>stopMethodTracing()</code> を呼び出すようにすれば、そのアプリ全体のプロファイリングを行うことができます。</p><h2 id=プロファイリングデータを表示する>プロファイリングデータを表示する</h2><p>Android SDK に含まれている <code>traceview</code> コマンドを使用すると、プロファイリング結果をグラフィカルに表示することができます。</p><figure class=image><a href=../../p/2wgxfwd/img-001.png target=_blank><img width=654 height=426 src=../../p/2wgxfwd/img-001.png alt=Traceview></a><figcaption class=image__caption>図: Traceview</figcaption></figure><p>上記の図では、タイムラインに main スレッドが一本だけ表示されていますが、複数のスレッドが存在すれば、main 以外のスレッドもその下に表示されます。</p><p>まずは、<code>/sdcard/dmtrace.trace</code> ファイルを PC に取得します。</p><pre tabindex=0><code>C:\&gt; adb pull /sdcard/dmtrace.trace
</code></pre><p>あとは <code>traceview</code> コマンドのパラメータとして、<code>dmtrace.trace</code> のパスを渡すだけです。
Windows ではフルパスで指定する必要があります。</p><pre tabindex=0><code>C:\&gt; traceview D:\z\dmtrace.trace
</code></pre><h2 id=プロファイリングデータからメソッドの呼び出しグラフを作成する>プロファイリングデータからメソッドの呼び出しグラフを作成する</h2><div class=highlight><pre tabindex=0 class=chroma><code class=language-console data-lang=console><span class=line><span class=cl><span class=gp>$</span> dmtracedump -g output.png dmtrace.trace
</span></span></code></pre></div><p>※ <code>dmtracedump</code> は Windows では動作しません。</p><h2 id=プロファイリングデータを-html-で出力する>プロファイリングデータを HTML で出力する</h2><div class=highlight><pre tabindex=0 class=chroma><code class=language-console data-lang=console><span class=line><span class=cl><span class=gp>$</span> dmtracedump -h dmtrace.trace &gt; output.html
</span></span></code></pre></div><p>※ <code>dmtracedump</code> は Windows では動作しません。</p></div><div class=article__footer><div class=article__date><time class=pageDate>2011-01-14</time></div><div class=article__snsButtons><div class=snsButtons><a rel=nofollow target=_blank href="https://twitter.com/share?url=https%3a%2f%2fmaku77.github.io%2fp%2f2wgxfwd%2f&text=Traceview%20%e3%81%a7%e3%83%97%e3%83%ad%e3%83%95%e3%82%a1%e3%82%a4%e3%83%ab%e6%83%85%e5%a0%b1%e3%82%92%e8%a1%a8%e7%a4%ba%e3%81%99%e3%82%8b%20-%20%e3%81%be%e3%81%8f%e3%81%be%e3%81%8f%20Android%20%e3%83%8e%e3%83%bc%e3%83%88"><span class="snsButtons__icon snsButtons__icon--twitter"><svg xmlns="http://www.w3.org/2000/svg" width="100" height="100" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-twitter"><path d="M23 3a10.9 10.9.0 01-3.14 1.53 4.48 4.48.0 00-7.86 3v1A10.66 10.66.0 013 4s-4 9 5 13a11.64 11.64.0 01-7 2c9 5 20 0 20-11.5a4.5 4.5.0 00-.08-.83A7.72 7.72.0 0023 3z"/></svg></span></a><a rel=nofollow target=_blank href="https://www.facebook.com/share.php?u=https%3a%2f%2fmaku77.github.io%2fp%2f2wgxfwd%2f&t=Traceview%20%e3%81%a7%e3%83%97%e3%83%ad%e3%83%95%e3%82%a1%e3%82%a4%e3%83%ab%e6%83%85%e5%a0%b1%e3%82%92%e8%a1%a8%e7%a4%ba%e3%81%99%e3%82%8b%20-%20%e3%81%be%e3%81%8f%e3%81%be%e3%81%8f%20Android%20%e3%83%8e%e3%83%bc%e3%83%88"><span class="snsButtons__icon snsButtons__icon--facebook"><svg xmlns="http://www.w3.org/2000/svg" width="100" height="100" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-facebook"><path d="M18 2h-3a5 5 0 00-5 5v3H7v4h3v8h4v-8h3l1-4h-4V7a1 1 0 011-1h3z"/></svg></span></a><a rel=nofollow target=_blank href="https://getpocket.com/edit?url=https%3a%2f%2fmaku77.github.io%2fp%2f2wgxfwd%2f&title=Traceview%20%e3%81%a7%e3%83%97%e3%83%ad%e3%83%95%e3%82%a1%e3%82%a4%e3%83%ab%e6%83%85%e5%a0%b1%e3%82%92%e8%a1%a8%e7%a4%ba%e3%81%99%e3%82%8b%20-%20%e3%81%be%e3%81%8f%e3%81%be%e3%81%8f%20Android%20%e3%83%8e%e3%83%bc%e3%83%88"><span class="snsButtons__icon snsButtons__icon--pocket"><svg xmlns="http://www.w3.org/2000/svg" width="100" height="100" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-pocket"><path d="M4 3h16a2 2 0 012 2v6A10 10 0 0112 21 10 10 0 012 11V5a2 2 0 012-2z"/><polyline points="8 10 12 14 16 10"/></svg></span></a></div></div><div class=breadcrumb><a href=../../>&#x1F3E0;HOME</a> > <a href=../../android/>まくまく Android ノート</a></div></div></article><script>var SIDEBAR_HIDE_THRESHOLD=800,SIDEBAR_WIDTH=250,OFFSET=10,w=window.innerWidth;w>=SIDEBAR_HIDE_THRESHOLD&&(w-=SIDEBAR_WIDTH),w-=OFFSET,w>=728?rakuten_size="728x200":w>=600?rakuten_size="600x200":w>=468?rakuten_size="468x160":w>=336?rakuten_size="336x280":w>=300?rakuten_size="300x250":w>=250?rakuten_size="250x250":rakuten_size="200x350",rakuten_design="slide",rakuten_affiliateId="1239b074.74af6526.1239b075.bc72ef6e",rakuten_items="ctsmatch",rakuten_genreId=0,rakuten_target="_blank",rakuten_theme="gray",rakuten_border="off",rakuten_auto_mode="on",rakuten_genre_title="off",rakuten_recommend="on",rakuten_txtColor="333333",rakuten_moverColor="30C030",rakuten_bgColor="FFFFFF",rakuten_captionColor="333333"</script><script src=https://xml.affiliate.rakuten.co.jp/widget/js/rakuten_widget.js></script></div><div class=l-withSidebar__sidebarRight><nav class=navigation><div class=navigation__header>カテゴリ一覧</div><ul><li><a class=navigation__item href=https://maku77.github.io/memo/>いろいろ</a><li><a class="navigation__item navigation__item--focused" href=https://maku77.github.io/android/>Android</a><li><a class=navigation__item href=https://maku.blog/p/8t6hr3d/>Ansible</a><li><a class=navigation__item href=https://maku77.github.io/blender/>Blender</a><li><a class=navigation__item href=https://maku77.github.io/cpp/>C/C++</a><li><a class=navigation__item href=https://maku77.github.io/docker/>Docker</a><li><a class=navigation__item href=https://maku77.github.io/git/>Git</a><li><a class=navigation__item href=https://maku77.github.io/go/>Go言語</a><li><a class=navigation__item href=https://maku77.github.io/gradle/>Gradle</a><li><a class=navigation__item href=https://maku77.github.io/web/>HTML/CSS</a><li><a class=navigation__item href=https://maku77.github.io/hugo/>Hugo</a><li><a class=navigation__item href=https://maku77.github.io/java/>Java</a><li><a class=navigation__item href=https://maku77.github.io/js/>JavaScript</a><li><a class=navigation__item href=https://maku77.github.io/kotlin/>Kotlin</a><li><a class=navigation__item href=https://maku77.github.io/linux/>Linux/Shell</a><li><a class=navigation__item href=https://maku77.github.io/mac/>Mac</a><li><a class=navigation__item href=https://maku77.github.io/middleman/>Middleman</a><li><a class=navigation__item href=https://toushi.maku.blog/p/etedykx/>MetaTrader</a><li><a class=navigation__item href=https://maku77.github.io/nodejs/>Node.js</a><li><a class=navigation__item href=https://maku77.github.io/octave/>Octave</a><li><a class=navigation__item href=https://maku77.github.io/p4/>Perforce</a><li><a class=navigation__item href=https://maku77.github.io/perl/>Perl</a><li><a class=navigation__item href=https://maku77.github.io/php/>PHP</a><li><a class=navigation__item href=https://maku77.github.io/python/>Python</a><li><a class=navigation__item href=https://maku77.github.io/r/>R</a><li><a class=navigation__item href=https://maku77.github.io/ruby/>Ruby</a><li><a class=navigation__item href=https://maku77.github.io/rust/>Rust</a><li><a class=navigation__item href=https://maku77.github.io/sass/>Sass</a><li><a class=navigation__item href=https://maku77.github.io/sed/>sed/awk</a><li><a class=navigation__item href=https://maku77.github.io/sql/>SQL</a><li><a class=navigation__item href=https://maku77.github.io/tradestation/>トレードステーション</a><li><a class=navigation__item href=https://maku77.github.io/vagrant/>Vagrant</a><li><a class=navigation__item href=https://maku77.github.io/vba/>VBA</a><li><a class=navigation__item href=https://maku77.github.io/vim/>Vim</a><li><a class=navigation__item href=https://maku77.github.io/windows/>Windows</a></ul></nav><style>.codoc-support{display:inline-block;margin:0!important;padding:12px!important;width:200px!important;max-width:100%}.codoc-support .codoc-support-title{font-size:smaller!important;white-space:nowrap;margin-bottom:12px!important}.codoc-support .codoc-btn{width:160px!important}</style><script src=https://codoc.jp/js/cms.js data-css=black data-usercode=tp6ZPzTj3w defer></script><div id=codoc-entry-4gYwTntzzw class=codoc-entries data-without-body=1 data-support-button-text="（っ'-')╮シュッ🔴" data-show-like=0 data-show-about-codoc=0 data-show-powered-by=0 data-support-message=まくに投げ銭できます。></div></div></div><script>document.addEventListener("DOMContentLoaded",function(){const e=document.querySelectorAll("a[href^=http]");for(let n=0;n<e.length;++n){const t=e[n];if(t.href.startsWith("https://maku77.github.io"))continue;const s=t.getElementsByTagName("img");if(s.length>0)continue;const o=t.getElementsByTagName("svg");if(o.length>0)continue;t.classList.add("externalLinkIcon"),t.setAttribute("target","_blank"),t.setAttribute("rel","noopener")}})</script></body></html>