<!doctype html><html lang=ja-jp><head prefix="og: http://ogp.me/ns# fb: http://ogp.me/ns/fb#"><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><title>Bash の変数展開機能を活用する（文字列の置換、デフォルト値など） - まくまく Linux/Shell ノート</title>
<script async src="https://www.googletagmanager.com/gtag/js?id=G-X5962TDYXS"></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-X5962TDYXS")</script><link rel=icon sizes="16x16 32x32 48x48 64x64" href=../../assets/img/favicon/favicon.ico><link rel=icon sizes=192x192 href=../../assets/img/favicon/192x192.png><link rel=apple-touch-icon href=../../assets/img/favicon/180x180.png><meta name=twitter:card content="summary"><meta property="og:site_name" content="天才まくまくノート"><meta property="og:title" content="Bash の変数展開機能を活用する（文字列の置換、デフォルト値など）"><meta property="og:type" content="article"><meta property="og:url" content="https://maku77.github.io/p/jsctar8/"><meta property="og:locale" content="ja_JP"><meta property="og:image" content="https://maku77.github.io/img/site-logo.png"><meta property="og:image:width" content="1200"><meta property="og:image:height" content="630"><meta property="og:description" content="Bash の変数展開の仕組みを活用すると、変数に格納された文字列を置換したり、変数のデフォルト値を指定したりすることができるようになります。"><meta property="fb:app_id" content="447708168769292"><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-6317852277883092" crossorigin=anonymous></script><link rel=stylesheet href=../../css/mm/all.min.03f769de5588c124e5b7baaab243e1f44bc5ccf6139987424d26c43c9491512f.css><link rel=stylesheet href=../../css/all.min.dfed075b80927eec3d408410bcff6d7ec1bbbd82933e2853c49a99f55ed6689b.css></head><body><div class=l-pageHeader><header class=header><a href=../../linux/><img class=header__icon src=../../linux/_index.svg></a><div class=header__right><div class=header__category><a href=../../linux/>まくまく Linux/ShellScript ノート</a></div><h1 class=header__title>Bash の変数展開機能を活用する（文字列の置換、デフォルト値など）</h1></div></header></div><div class=l-withSidebar><div class=l-withSidebar__sidebarLeft><style>#tocStub{position:-webkit-sticky;position:sticky;top:2rem;margin-top:2rem;line-height:1.5;max-height:calc(100vh - 4rem);overflow-y:auto;-webkit-overflow-scrolling:touch}#tocStub ul{font-size:.9em;list-style:none;padding:0;border-top:solid 1px #ccc}#tocStub li{border:solid 1px #ccc;border-right:none;margin-top:-1px}#tocStub a{color:#666;padding:.6em .3em .6em .5em;display:block;text-decoration:none;font-weight:400}.level-2{margin-left:.8em}.level-3{padding-left:1.6em}</style><div id=tocStub></div><script>document.addEventListener("DOMContentLoaded",()=>{function e(e){const t=document.createElement("a");return t.setAttribute("id",e),t}function t(t,n){n.parentNode.insertBefore(e(t),n)}function n(e,t,n){const s=document.createElement("li");return s.classList.add("level-"+e),s.innerHTML='<a href="#'+t+'">'+n+"</a>",s}function s(){const e=document.createElement("ul");return document.querySelectorAll("h2, h3").forEach((s,o)=>{const i="section-"+o;t(i,s);const a=s.tagName.charAt(1)-1;e.appendChild(n(a,i,s.textContent))}),e}document.getElementById("tocStub").appendChild(s())})</script></div><div class=l-withSidebar__content><article class=article itemscope itemtype=https://schema.org/BlogPosting><div class=article__header><div class=breadcrumb><a href=../../>&#x1F3E0;HOME</a> > <a href=../../linux/>まくまく Linux/ShellScript ノート</a></div><div style=text-align:right><div class=mm-snsButtons><a rel="nofollow noopener noreferrer" target=_blank href="https://twitter.com/intent/post?url=https%3a%2f%2fmaku77.github.io%2fp%2fjsctar8%2f"><span class=mm-snsButtons__icon><svg fill="#000" role="img" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><title>X</title><path d="M18.901 1.153h3.68l-8.04 9.19L24 22.846h-7.406l-5.8-7.584-6.638 7.584H.474l8.6-9.83L0 1.154h7.594l5.243 6.932zM17.61 20.644h2.039L6.486 3.24H4.298z"/></svg></span></a><a rel="nofollow noopener noreferrer" target=_blank href="https://www.threads.net/intent/post?text=https%3a%2f%2fmaku77.github.io%2fp%2fjsctar8%2f" name=HOGE><span class=mm-snsButtons__icon><svg fill="#000" role="img" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><title>Threads</title><path d="M12.186 24h-.007c-3.581-.024-6.334-1.205-8.184-3.509C2.35 18.44 1.5 15.586 1.472 12.01v-.017c.03-3.579.879-6.43 2.525-8.482C5.845 1.205 8.6.024 12.18.0h.014c2.746.02 5.043.725 6.826 2.098 1.677 1.29 2.858 3.13 3.509 5.467l-2.04.569c-1.104-3.96-3.898-5.984-8.304-6.015-2.91.022-5.11.936-6.54 2.717C4.307 6.504 3.616 8.914 3.589 12c.027 3.086.718 5.496 2.057 7.164 1.43 1.783 3.631 2.698 6.54 2.717 2.623-.02 4.358-.631 5.8-2.045 1.647-1.613 1.618-3.593 1.09-4.798-.31-.71-.873-1.3-1.634-1.75-.192 1.352-.622 2.446-1.284 3.272-.886 1.102-2.14 1.704-3.73 1.79-1.202.065-2.361-.218-3.259-.801-1.063-.689-1.685-1.74-1.752-2.964-.065-1.19.408-2.285 1.33-3.082.88-.76 2.119-1.207 3.583-1.291a13.853 13.853.0 013.02.142c-.126-.742-.375-1.332-.75-1.757-.513-.586-1.308-.883-2.359-.89h-.029c-.844.0-1.992.232-2.721 1.32L7.734 7.847c.98-1.454 2.568-2.256 4.478-2.256h.044c3.194.02 5.097 1.975 5.287 5.388.108.046.216.094.321.142 1.49.7 2.58 1.761 3.154 3.07.797 1.82.871 4.79-1.548 7.158-1.85 1.81-4.094 2.628-7.277 2.65zm1.003-11.69c-.242.0-.487.007-.739.021-1.836.103-2.98.946-2.916 2.143.067 1.256 1.452 1.839 2.784 1.767 1.224-.065 2.818-.543 3.086-3.71a10.5 10.5.0 00-2.215-.221z"/></svg></span></a><a rel="nofollow noopener noreferrer" target=_blank href="https://www.facebook.com/share.php?u=https%3a%2f%2fmaku77.github.io%2fp%2fjsctar8%2f"><span class=mm-snsButtons__icon><svg fill="#0866ff" role="img" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><title>Facebook</title><path d="M9.101 23.691v-7.98H6.627v-3.667h2.474v-1.58c0-4.085 1.848-5.978 5.858-5.978.401.0.955.042 1.468.103a8.68 8.68.0 011.141.195v3.325a8.623 8.623.0 00-.653-.036 26.805 26.805.0 00-.733-.009c-.707.0-1.259.096-1.675.309a1.686 1.686.0 00-.679.622c-.258.42-.374.995-.374 1.752v1.297h3.919l-.386 2.103-.287 1.564h-3.246v8.245C19.396 23.238 24 18.179 24 12.044c0-6.627-5.373-12-12-12s-12 5.373-12 12c0 5.628 3.874 10.35 9.101 11.647z"/></svg></span></a><a rel="nofollow noopener noreferrer" target=_blank href="https://timeline.line.me/social-plugin/share?url=https%3a%2f%2fmaku77.github.io%2fp%2fjsctar8%2f&text=Bash%20%e3%81%ae%e5%a4%89%e6%95%b0%e5%b1%95%e9%96%8b%e6%a9%9f%e8%83%bd%e3%82%92%e6%b4%bb%e7%94%a8%e3%81%99%e3%82%8b%ef%bc%88%e6%96%87%e5%ad%97%e5%88%97%e3%81%ae%e7%bd%ae%e6%8f%9b%e3%80%81%e3%83%87%e3%83%95%e3%82%a9%e3%83%ab%e3%83%88%e5%80%a4%e3%81%aa%e3%81%a9%ef%bc%89%20-%20%e5%a4%a9%e6%89%8d%e3%81%be%e3%81%8f%e3%81%be%e3%81%8f%e3%83%8e%e3%83%bc%e3%83%88"><span class=mm-snsButtons__icon><svg fill="#00c300" role="img" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><title>LINE</title><path d="M19.365 9.863c.349.0.63.285.63.631.0.345-.281.63-.63.63H17.61v1.125h1.755c.349.0.63.283.63.63.0.344-.281.629-.63.629h-2.386c-.345.0-.627-.285-.627-.629V8.108c0-.345.282-.63.63-.63h2.386c.346.0.627.285.627.63.0.349-.281.63-.63.63H17.61v1.125h1.755zm-3.855 3.016c0 .27-.174.51-.432.596-.064.021-.133.031-.199.031-.211.0-.391-.09-.51-.25l-2.443-3.317v2.94c0 .344-.279.629-.631.629-.346.0-.626-.285-.626-.629V8.108c0-.27.173-.51.43-.595.06-.023.136-.033.194-.033.195.0.375.104.495.254l2.462 3.33V8.108c0-.345.282-.63.63-.63.345.0.63.285.63.63v4.771zm-5.741.0c0 .344-.282.629-.631.629-.345.0-.627-.285-.627-.629V8.108c0-.345.282-.63.63-.63.346.0.628.285.628.63v4.771zm-2.466.629H4.917c-.345.0-.63-.285-.63-.629V8.108c0-.345.285-.63.63-.63.348.0.63.285.63.63v4.141h1.756c.348.0.629.283.629.63.0.344-.282.629-.629.629M24 10.314C24 4.943 18.615.572 12 .572S0 4.943.0 10.314c0 4.811 4.27 8.842 10.035 9.608.391.082.923.258 1.058.59.12.301.079.766.038 1.08l-.164 1.02c-.045.301-.24 1.186 1.049.645 1.291-.539 6.916-4.078 9.436-6.975C23.176 14.393 24 12.458 24 10.314"/></svg></span></a><a rel="nofollow noopener noreferrer" target=_blank href="https://b.hatena.ne.jp/entry?url=https%3a%2f%2fmaku77.github.io%2fp%2fjsctar8%2f"><span class=mm-snsButtons__icon><svg fill="#00a4de" role="img" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><title>Hatena Bookmark</title><path d="M20.47.0C22.42.0 24 1.58 24 3.53v16.94c0 1.95-1.58 3.53-3.53 3.53H3.53C1.58 24 0 22.42.0 20.47V3.53C0 1.58 1.58.0 3.53.0h16.94zm-3.705 14.47c-.78.0-1.41.63-1.41 1.41s.63 1.414 1.41 1.414 1.41-.645 1.41-1.425-.63-1.41-1.41-1.41zM8.61 17.247c1.2.0 2.056-.042 2.58-.12.526-.084.976-.222 1.32-.412.45-.232.78-.564 1.02-.99s.36-.915.36-1.48c0-.78-.21-1.403-.63-1.87-.42-.48-.99-.734-1.74-.794.66-.18 1.156-.45 1.456-.81.315-.344.465-.824.465-1.424.0-.48-.103-.885-.3-1.26-.21-.36-.493-.645-.883-.87-.345-.195-.735-.315-1.215-.405-.464-.074-1.29-.12-2.474-.12H5.654v10.486H8.61zm.736-4.185c.705.0 1.185.088 1.44.262.27.18.39.495.39.93.0.405-.135.69-.42.855-.27.18-.765.254-1.44.254H8.31v-2.297h1.05zm8.656.706v-7.06h-2.46v7.06H18zM8.925 9.08c.71.0 1.185.08 1.432.24.245.16.367.435.367.83.0.38-.13.646-.39.804-.265.154-.747.232-1.452.232h-.57V9.08h.615z"/></svg></span></a><a rel="nofollow noopener noreferrer" target=_blank href="https://getpocket.com/edit?url=https%3a%2f%2fmaku77.github.io%2fp%2fjsctar8%2f&title=Bash%20%e3%81%ae%e5%a4%89%e6%95%b0%e5%b1%95%e9%96%8b%e6%a9%9f%e8%83%bd%e3%82%92%e6%b4%bb%e7%94%a8%e3%81%99%e3%82%8b%ef%bc%88%e6%96%87%e5%ad%97%e5%88%97%e3%81%ae%e7%bd%ae%e6%8f%9b%e3%80%81%e3%83%87%e3%83%95%e3%82%a9%e3%83%ab%e3%83%88%e5%80%a4%e3%81%aa%e3%81%a9%ef%bc%89%20-%20%e5%a4%a9%e6%89%8d%e3%81%be%e3%81%8f%e3%81%be%e3%81%8f%e3%83%8e%e3%83%bc%e3%83%88"><span class=mm-snsButtons__icon><svg fill="#ef3f56" role="img" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><title>Pocket</title><path d="M18.813 10.259l-5.646 5.419c-.32.305-.73.458-1.141.458-.41.0-.821-.153-1.141-.458l-5.646-5.419c-.657-.628-.677-1.671-.049-2.326.63-.657 1.671-.679 2.325-.05l4.511 4.322 4.517-4.322c.66-.631 1.697-.607 2.326.049.631.645.615 1.695-.045 2.326l-.011.001zm5.083-7.546c-.299-.858-1.125-1.436-2.041-1.436H2.179c-.9.0-1.717.564-2.037 1.405-.094.25-.142.511-.142.774v7.245l.084 1.441c.348 3.277 2.047 6.142 4.682 8.139.045.036.094.07.143.105l.03.023c1.411 1.03 2.989 1.728 4.694 2.072.786.158 1.591.24 2.389.24.739.0 1.481-.067 2.209-.204.088-.029.176-.045.264-.06.023.0.049-.015.074-.029 1.633-.36 3.148-1.036 4.508-2.025l.029-.031.135-.105c2.627-1.995 4.324-4.862 4.686-8.148L24 10.678V3.445c0-.251-.031-.5-.121-.742l.017.01z"/></svg></span></a></div></div><div class=article__date><time class=pageDate>2010-07-20</time></div></div><div class=article__body><p>Bash の変数は通常 <code>${x}</code> のような形で参照しますが、様々な変数展開機能を利用すると、変数の存在を確認したり、一部を置換したり、デフォルト値を設定したりすることができます。
下記にざっと紹介しますが、公式なドキュメントは <code>man bash</code> の <code>Parameter Expansion</code> のセクションで参照することができます。</p><h2 id=パターン照合演算子>パターン照合演算子</h2><p>次のような変数展開の構文を使用すると、変数に格納された文字列の一部を置換した文字列を作成することができます。</p><table><thead><tr><th>構文</th><th>意味</th></tr></thead><tbody><tr><td><strong><code>${変数/パターン/置換文字列}</code></strong></td><td>パターンに一致する部分を置換文字列に置き換える（１つだけ）</td></tr><tr><td><strong><code>${変数//パターン/置換文字列}</code></strong></td><td>パターンに一致する部分を置換文字列に置き換える（すべて）</td></tr><tr><td><strong><code>${変数#パターン}</code></strong></td><td><b>先頭</b>から<b>最短一致</b>でパターンに一致する部分を取り除く</td></tr><tr><td><strong><code>${変数##パターン}</code></strong></td><td><b>先頭</b>から<b>最長一致</b>でパターンに一致する部分を取り除く</td></tr><tr><td><strong><code>${変数%パターン}</code></strong></td><td><b>末尾</b>から<b>最短一致</b>でパターンに一致する部分を取り除く</td></tr><tr><td><strong><code>${変数%%パターン}</code></strong></td><td><b>末尾</b>から<b>最長一致</b>でパターンに一致する部分を取り除く</td></tr></tbody></table><p>パターン部分では、ワイルドカード（<code>*</code>、<code>?</code>、<code>[a-z]</code> など）を使用できます。</p><h3 id=例-変数内の-b-を-b-に置換する>例: 変数内の b を B に置換する</h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-console data-lang=console><span class=line><span class=cl><span class=gp>$</span> <span class=nv>x</span><span class=o>=</span>aaabbbccc
</span></span><span class=line><span class=cl><span class=gp>$</span> <span class=nv>y</span><span class=o>=</span><span class=si>${</span><span class=nv>x</span><span class=p>/b/B</span><span class=si>}</span>
</span></span><span class=line><span class=cl><span class=gp>$</span> <span class=nb>echo</span> <span class=nv>$y</span>
</span></span><span class=line><span class=cl><span class=go>aaaBbbccc
</span></span></span></code></pre></div><p>最初に見つかった文字列だけが置換されていることがわかります。
パターンに一致する文字列をすべて置換するには次のようにします（最初のスラッシュを2つにします）。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-console data-lang=console><span class=line><span class=cl><span class=gp>$</span> <span class=nv>x</span><span class=o>=</span>aaabbbccc
</span></span><span class=line><span class=cl><span class=gp>$</span> <span class=nv>y</span><span class=o>=</span><span class=si>${</span><span class=nv>x</span><span class=p>//b/B</span><span class=si>}</span>
</span></span><span class=line><span class=cl><span class=gp>$</span> <span class=nb>echo</span> <span class=nv>$y</span>
</span></span><span class=line><span class=cl><span class=go>aaaBBBccc
</span></span></span></code></pre></div><p>以下のように sed コマンドを使ったのと同様の効果を bash の機能だけで実現できていることになります。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-console data-lang=console><span class=line><span class=cl><span class=gp>$</span> <span class=nv>y</span><span class=o>=</span><span class=k>$(</span><span class=nb>echo</span> <span class=nv>$x</span> <span class=p>|</span> sed -e <span class=s1>&#39;s/bbb/BBB/g&#39;</span><span class=k>)</span>
</span></span></code></pre></div><h3 id=例-フルパスから-basename-を取り出す>例: フルパスから basename を取り出す</h3><p>下記の例では <code>/aaa/bbb/ccc</code> という絶対パスから、ベースネーム部分の <code>ccc</code> を抽出しています。
<code>*/</code> というパターンで先頭から最長一致させ、<code>/aaa/bbb/</code> という部分を取り除いています。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-console data-lang=console><span class=line><span class=cl><span class=gp>$</span> <span class=nv>x</span><span class=o>=</span>/aaa/bbb/ccc
</span></span><span class=line><span class=cl><span class=gp>$</span> <span class=nv>y</span><span class=o>=</span><span class=si>${</span><span class=nv>x</span><span class=p>##*/</span><span class=si>}</span>
</span></span><span class=line><span class=cl><span class=gp>$</span> <span class=nb>echo</span> <span class=nv>$y</span>
</span></span><span class=line><span class=cl><span class=go>ccc
</span></span></span></code></pre></div><p>ちなみに、ベースネーム部分を取得したいのであれば、通常は <code>basename</code> コマンドを使って以下のようにした方が簡単です。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-console data-lang=console><span class=line><span class=cl><span class=gp>$</span> basename <span class=nv>$x</span>
</span></span></code></pre></div><h3 id=例-フルパスから-dirname-を取り出す>例: フルパスから dirname を取り出す</h3><p>下記の例では、<code>/aaa/bbb/ccc</code> という絶対パスから、ディレクトリ名部分の <code>/aaa/bbb</code> を抽出しています。
<code>/*</code> というパターンで末尾から最短一致させ、<code>/ccc</code> という部分を取り除いています。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-console data-lang=console><span class=line><span class=cl><span class=gp>$</span> <span class=nv>x</span><span class=o>=</span>/aaa/bbb/ccc
</span></span><span class=line><span class=cl><span class=gp>$</span> <span class=nv>y</span><span class=o>=</span><span class=si>${</span><span class=nv>x</span><span class=p>%/*</span><span class=si>}</span>
</span></span><span class=line><span class=cl><span class=gp>$</span> <span class=nb>echo</span> <span class=nv>$y</span>
</span></span><span class=line><span class=cl><span class=go>/aaa/bbb
</span></span></span></code></pre></div><p>ちなみに、ディレクトリ部分を取得したいのであれば、通常は <code>dirname</code> コマンドを使用して以下のようにした方が簡単です。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-console data-lang=console><span class=line><span class=cl><span class=gp>$</span> dirname <span class=nv>$x</span>
</span></span></code></pre></div><h3 id=例--以降のコメントを削除する>例: &lsquo;#&rsquo; 以降のコメントを削除する</h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-console data-lang=console><span class=line><span class=cl><span class=gp>$</span> <span class=nv>line</span><span class=o>=</span><span class=s2>&#34;aaa bbb # This is a comment&#34;</span>
</span></span><span class=line><span class=cl><span class=gp>$</span> <span class=nv>line</span><span class=o>=</span><span class=si>${</span><span class=nv>line</span><span class=p>%%#*</span><span class=si>}</span>
</span></span><span class=line><span class=cl><span class=gp>$</span> <span class=nb>echo</span> <span class=nv>$line</span>
</span></span><span class=line><span class=cl><span class=go>aaa bbb
</span></span></span></code></pre></div><p><code>line</code> 変数の中を末尾から見て、<code>#*</code> という表現で最長一致する部分を削除してます。</p><h2 id=デフォルト値など>デフォルト値など</h2><table><thead><tr><th>構文</th><th>意味</th></tr></thead><tbody><tr><td><strong><code>${変数:-word}</code></strong></td><td>変数が未定義のとき word を返す</td></tr><tr><td><strong><code>${変数:=word}</code></strong></td><td>変数が未定義のとき word を代入して返す</td></tr><tr><td><strong><code>${変数:?}</code></strong><br><strong><code>${変数:?word}</code></strong></td><td>変数が未定義のときエラーを表示する</td></tr><tr><td><strong><code>${変数:+word}</code></strong></td><td>変数が定義されているとき word を返す</td></tr></tbody></table><h3 id=param-word-の使用例><code>${param:-word}</code> の使用例</h3><p>下記は man bash の抜粋です。</p><blockquote><p>Use Default Values. If parameter is unset or null, the expansion of word is substituted. Otherwise, the value of parameter is substituted. If parameter is unset or null, the expansion of word is substituted. Otherwise, the value of parameter is substituted.</p></blockquote><p>例えば、</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=nv>x</span><span class=o>=</span><span class=si>${</span><span class=nv>count</span><span class=k>:-</span><span class=nv>0</span><span class=si>}</span>
</span></span></code></pre></div><p>とすると、<code>$x</code> の値は <code>$count</code> が定義されていなければ 0 になります。
つまり、<code>$count</code> のデフォルト値を 0 とみなして参照していることになります。</p><p>この構文は、コマンドライン引数が省略されたときのデフォルト値を設定するために使用できます。
例えば、</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=nv>filename</span><span class=o>=</span><span class=si>${</span><span class=nv>1</span><span class=k>:-</span><span class=nv>input</span><span class=p>.txt</span><span class=si>}</span>
</span></span></code></pre></div><p>とすると、変数 <code>$filename</code> の値は、第1パラメータで指定された値か、あるいはデフォルト値の <code>input.txt</code> になります。</p><h3 id=paramword-の使用例><code>${param:=word}</code> の使用例</h3><p>下記は man bash の抜粋です。</p><blockquote><p>Assign Default Values. If parameter is unset or null, the expansion of word is assigned to parameter. The value of parameter is then substituted. Positional parameters and special parameters may not be assigned to in this way.</p></blockquote><p>例えば、</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=nv>x</span><span class=o>=</span><span class=si>${</span><span class=nv>count</span><span class=p>:=0</span><span class=si>}</span>
</span></span></code></pre></div><p>とすると、<code>$x</code> の値は <code>$count</code> が定義されていなければ 0 になります。
ここまでは、<code>${count:-0}</code> とした場合と同様ですが、<code>${count:=0}</code> とすると、<code>$count</code> にも 0 が代入されます（代入 <code>=</code> だと考えると分かりやすいですね）。</p><p>変数に代入しようとするため、コマンドラインパラメータや関数のパラメータの <code>$1</code> を参照するときにこの方法は使用できません。</p><h3 id=paramword-の使用例-1><code>${param:?word}</code> の使用例</h3><p>下記は man bash の抜粋です。</p><blockquote><p>Display Error if Null or Unset. If parameter is null or unset, the expansion of word (or a message to that effect if word is not present) is written to the standard error and the shell, if it is not interactive, exits. Otherwise, the value of parameter is substituted.</p></blockquote><p>例えば、下記のようにすると、<code>$count</code> 変数が定義されていないければエラーを出力して終了します。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-console data-lang=console><span class=line><span class=cl><span class=gp>$</span> <span class=nb>echo</span> <span class=si>${</span><span class=nv>count</span><span class=p>:?</span><span class=si>}</span>
</span></span><span class=line><span class=cl><span class=go>-bash: count: パラメータが null または設定されていません
</span></span></span></code></pre></div><p><code>?</code> の後ろに表示するメッセージを指定することもできます。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-console data-lang=console><span class=line><span class=cl><span class=gp>$</span> <span class=nb>echo</span> <span class=si>${</span><span class=nv>count</span><span class=p>:?パラメータが設定されていません</span><span class=si>}</span>
</span></span><span class=line><span class=cl><span class=go>-bash: count: パラメータが設定されていません
</span></span></span></code></pre></div><h3 id=paramword-の使用例-2><code>${param:+word}</code> の使用例</h3><p>下記は man bash の抜粋です。</p><blockquote><p>Use Alternate Value. If parameter is null or unset, nothing is substituted, otherwise the expansion of word is substituted.</p></blockquote><p>これはちょっと特殊で、変数 <code>$param</code> が定義されているときに、代わりに <code>word</code> の方の値が返されます。
例えば、<code>${count:+1}</code> は、<code>$count</code> が定義されていたら 1 と評価されます。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-console data-lang=console><span class=line><span class=cl><span class=gp>$</span> <span class=nv>count</span><span class=o>=</span><span class=m>9999</span>
</span></span><span class=line><span class=cl><span class=gp>$</span> <span class=nb>echo</span> <span class=si>${</span><span class=nv>count</span><span class=p>:+1</span><span class=si>}</span>
</span></span><span class=line><span class=cl><span class=go>1
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=gp>$</span> <span class=nb>unset</span> count
</span></span><span class=line><span class=cl><span class=gp>$</span> <span class=nb>echo</span> <span class=si>${</span><span class=nv>count</span><span class=p>:+1</span><span class=si>}</span>
</span></span></code></pre></div><h2 id=位置指定で部分文字列を抽出する>位置指定で部分文字列を抽出する</h2><table><thead><tr><th>構文</th><th>意味</th></tr></thead><tbody><tr><td><strong><code>${変数:offset}</code></strong></td><td>offset で指定した位置から末尾までの文字列を抽出する</td></tr><tr><td><strong><code>${変数:offset:length}</code></strong></td><td>offset で指定した位置から length 分の文字列を抽出する</td></tr></tbody></table><div class=highlight><pre tabindex=0 class=chroma><code class=language-console data-lang=console><span class=line><span class=cl><span class=gp>$</span> <span class=nv>hoge</span><span class=o>=</span>ABCDEFGHIJ
</span></span><span class=line><span class=cl><span class=gp>$</span> <span class=nb>echo</span> <span class=si>${</span><span class=nv>hoge</span><span class=p>:</span><span class=nv>3</span><span class=si>}</span>
</span></span><span class=line><span class=cl><span class=go>DEFGHIJ
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=gp>$</span> <span class=nb>echo</span> <span class=si>${</span><span class=nv>hoge</span><span class=p>:</span><span class=nv>3</span><span class=p>:</span><span class=nv>4</span><span class=si>}</span>
</span></span><span class=line><span class=cl><span class=go>DEFG
</span></span></span></code></pre></div><p><code>offset</code> や <code>length</code> に負の値を指定して、末尾からの位置を示すこともできます。
ただし、その場合、<code>offset</code> の前に 1 つ以上のスペースが必要です（スペースを入れないと、<code>${変数:-word}</code> という形でデフォルト値が指定されたとみなされてしまいます）。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-console data-lang=console><span class=line><span class=cl><span class=gp>$</span> <span class=nv>hoge</span><span class=o>=</span>ABCDEFGHIJ
</span></span><span class=line><span class=cl><span class=gp>$</span> <span class=nb>echo</span> <span class=si>${</span><span class=nv>hoge</span><span class=p>: -3</span><span class=si>}</span>
</span></span><span class=line><span class=cl><span class=go>HIJ
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=gp>$</span> <span class=nb>echo</span> <span class=si>${</span><span class=nv>hoge</span><span class=p>: -5</span><span class=k>:-</span><span class=nv>2</span><span class=si>}</span>
</span></span><span class=line><span class=cl><span class=go>FGH
</span></span></span></code></pre></div></div><div class=article__footer><div class=article__date><time class=pageDate>2010-07-20</time></div><div style=text-align:right><div class=mm-snsButtons><a rel="nofollow noopener noreferrer" target=_blank href="https://twitter.com/intent/post?url=https%3a%2f%2fmaku77.github.io%2fp%2fjsctar8%2f"><span class=mm-snsButtons__icon><svg fill="#000" role="img" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><title>X</title><path d="M18.901 1.153h3.68l-8.04 9.19L24 22.846h-7.406l-5.8-7.584-6.638 7.584H.474l8.6-9.83L0 1.154h7.594l5.243 6.932zM17.61 20.644h2.039L6.486 3.24H4.298z"/></svg></span></a><a rel="nofollow noopener noreferrer" target=_blank href="https://www.threads.net/intent/post?text=https%3a%2f%2fmaku77.github.io%2fp%2fjsctar8%2f" name=HOGE><span class=mm-snsButtons__icon><svg fill="#000" role="img" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><title>Threads</title><path d="M12.186 24h-.007c-3.581-.024-6.334-1.205-8.184-3.509C2.35 18.44 1.5 15.586 1.472 12.01v-.017c.03-3.579.879-6.43 2.525-8.482C5.845 1.205 8.6.024 12.18.0h.014c2.746.02 5.043.725 6.826 2.098 1.677 1.29 2.858 3.13 3.509 5.467l-2.04.569c-1.104-3.96-3.898-5.984-8.304-6.015-2.91.022-5.11.936-6.54 2.717C4.307 6.504 3.616 8.914 3.589 12c.027 3.086.718 5.496 2.057 7.164 1.43 1.783 3.631 2.698 6.54 2.717 2.623-.02 4.358-.631 5.8-2.045 1.647-1.613 1.618-3.593 1.09-4.798-.31-.71-.873-1.3-1.634-1.75-.192 1.352-.622 2.446-1.284 3.272-.886 1.102-2.14 1.704-3.73 1.79-1.202.065-2.361-.218-3.259-.801-1.063-.689-1.685-1.74-1.752-2.964-.065-1.19.408-2.285 1.33-3.082.88-.76 2.119-1.207 3.583-1.291a13.853 13.853.0 013.02.142c-.126-.742-.375-1.332-.75-1.757-.513-.586-1.308-.883-2.359-.89h-.029c-.844.0-1.992.232-2.721 1.32L7.734 7.847c.98-1.454 2.568-2.256 4.478-2.256h.044c3.194.02 5.097 1.975 5.287 5.388.108.046.216.094.321.142 1.49.7 2.58 1.761 3.154 3.07.797 1.82.871 4.79-1.548 7.158-1.85 1.81-4.094 2.628-7.277 2.65zm1.003-11.69c-.242.0-.487.007-.739.021-1.836.103-2.98.946-2.916 2.143.067 1.256 1.452 1.839 2.784 1.767 1.224-.065 2.818-.543 3.086-3.71a10.5 10.5.0 00-2.215-.221z"/></svg></span></a><a rel="nofollow noopener noreferrer" target=_blank href="https://www.facebook.com/share.php?u=https%3a%2f%2fmaku77.github.io%2fp%2fjsctar8%2f"><span class=mm-snsButtons__icon><svg fill="#0866ff" role="img" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><title>Facebook</title><path d="M9.101 23.691v-7.98H6.627v-3.667h2.474v-1.58c0-4.085 1.848-5.978 5.858-5.978.401.0.955.042 1.468.103a8.68 8.68.0 011.141.195v3.325a8.623 8.623.0 00-.653-.036 26.805 26.805.0 00-.733-.009c-.707.0-1.259.096-1.675.309a1.686 1.686.0 00-.679.622c-.258.42-.374.995-.374 1.752v1.297h3.919l-.386 2.103-.287 1.564h-3.246v8.245C19.396 23.238 24 18.179 24 12.044c0-6.627-5.373-12-12-12s-12 5.373-12 12c0 5.628 3.874 10.35 9.101 11.647z"/></svg></span></a><a rel="nofollow noopener noreferrer" target=_blank href="https://timeline.line.me/social-plugin/share?url=https%3a%2f%2fmaku77.github.io%2fp%2fjsctar8%2f&text=Bash%20%e3%81%ae%e5%a4%89%e6%95%b0%e5%b1%95%e9%96%8b%e6%a9%9f%e8%83%bd%e3%82%92%e6%b4%bb%e7%94%a8%e3%81%99%e3%82%8b%ef%bc%88%e6%96%87%e5%ad%97%e5%88%97%e3%81%ae%e7%bd%ae%e6%8f%9b%e3%80%81%e3%83%87%e3%83%95%e3%82%a9%e3%83%ab%e3%83%88%e5%80%a4%e3%81%aa%e3%81%a9%ef%bc%89%20-%20%e5%a4%a9%e6%89%8d%e3%81%be%e3%81%8f%e3%81%be%e3%81%8f%e3%83%8e%e3%83%bc%e3%83%88"><span class=mm-snsButtons__icon><svg fill="#00c300" role="img" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><title>LINE</title><path d="M19.365 9.863c.349.0.63.285.63.631.0.345-.281.63-.63.63H17.61v1.125h1.755c.349.0.63.283.63.63.0.344-.281.629-.63.629h-2.386c-.345.0-.627-.285-.627-.629V8.108c0-.345.282-.63.63-.63h2.386c.346.0.627.285.627.63.0.349-.281.63-.63.63H17.61v1.125h1.755zm-3.855 3.016c0 .27-.174.51-.432.596-.064.021-.133.031-.199.031-.211.0-.391-.09-.51-.25l-2.443-3.317v2.94c0 .344-.279.629-.631.629-.346.0-.626-.285-.626-.629V8.108c0-.27.173-.51.43-.595.06-.023.136-.033.194-.033.195.0.375.104.495.254l2.462 3.33V8.108c0-.345.282-.63.63-.63.345.0.63.285.63.63v4.771zm-5.741.0c0 .344-.282.629-.631.629-.345.0-.627-.285-.627-.629V8.108c0-.345.282-.63.63-.63.346.0.628.285.628.63v4.771zm-2.466.629H4.917c-.345.0-.63-.285-.63-.629V8.108c0-.345.285-.63.63-.63.348.0.63.285.63.63v4.141h1.756c.348.0.629.283.629.63.0.344-.282.629-.629.629M24 10.314C24 4.943 18.615.572 12 .572S0 4.943.0 10.314c0 4.811 4.27 8.842 10.035 9.608.391.082.923.258 1.058.59.12.301.079.766.038 1.08l-.164 1.02c-.045.301-.24 1.186 1.049.645 1.291-.539 6.916-4.078 9.436-6.975C23.176 14.393 24 12.458 24 10.314"/></svg></span></a><a rel="nofollow noopener noreferrer" target=_blank href="https://b.hatena.ne.jp/entry?url=https%3a%2f%2fmaku77.github.io%2fp%2fjsctar8%2f"><span class=mm-snsButtons__icon><svg fill="#00a4de" role="img" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><title>Hatena Bookmark</title><path d="M20.47.0C22.42.0 24 1.58 24 3.53v16.94c0 1.95-1.58 3.53-3.53 3.53H3.53C1.58 24 0 22.42.0 20.47V3.53C0 1.58 1.58.0 3.53.0h16.94zm-3.705 14.47c-.78.0-1.41.63-1.41 1.41s.63 1.414 1.41 1.414 1.41-.645 1.41-1.425-.63-1.41-1.41-1.41zM8.61 17.247c1.2.0 2.056-.042 2.58-.12.526-.084.976-.222 1.32-.412.45-.232.78-.564 1.02-.99s.36-.915.36-1.48c0-.78-.21-1.403-.63-1.87-.42-.48-.99-.734-1.74-.794.66-.18 1.156-.45 1.456-.81.315-.344.465-.824.465-1.424.0-.48-.103-.885-.3-1.26-.21-.36-.493-.645-.883-.87-.345-.195-.735-.315-1.215-.405-.464-.074-1.29-.12-2.474-.12H5.654v10.486H8.61zm.736-4.185c.705.0 1.185.088 1.44.262.27.18.39.495.39.93.0.405-.135.69-.42.855-.27.18-.765.254-1.44.254H8.31v-2.297h1.05zm8.656.706v-7.06h-2.46v7.06H18zM8.925 9.08c.71.0 1.185.08 1.432.24.245.16.367.435.367.83.0.38-.13.646-.39.804-.265.154-.747.232-1.452.232h-.57V9.08h.615z"/></svg></span></a><a rel="nofollow noopener noreferrer" target=_blank href="https://getpocket.com/edit?url=https%3a%2f%2fmaku77.github.io%2fp%2fjsctar8%2f&title=Bash%20%e3%81%ae%e5%a4%89%e6%95%b0%e5%b1%95%e9%96%8b%e6%a9%9f%e8%83%bd%e3%82%92%e6%b4%bb%e7%94%a8%e3%81%99%e3%82%8b%ef%bc%88%e6%96%87%e5%ad%97%e5%88%97%e3%81%ae%e7%bd%ae%e6%8f%9b%e3%80%81%e3%83%87%e3%83%95%e3%82%a9%e3%83%ab%e3%83%88%e5%80%a4%e3%81%aa%e3%81%a9%ef%bc%89%20-%20%e5%a4%a9%e6%89%8d%e3%81%be%e3%81%8f%e3%81%be%e3%81%8f%e3%83%8e%e3%83%bc%e3%83%88"><span class=mm-snsButtons__icon><svg fill="#ef3f56" role="img" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><title>Pocket</title><path d="M18.813 10.259l-5.646 5.419c-.32.305-.73.458-1.141.458-.41.0-.821-.153-1.141-.458l-5.646-5.419c-.657-.628-.677-1.671-.049-2.326.63-.657 1.671-.679 2.325-.05l4.511 4.322 4.517-4.322c.66-.631 1.697-.607 2.326.049.631.645.615 1.695-.045 2.326l-.011.001zm5.083-7.546c-.299-.858-1.125-1.436-2.041-1.436H2.179c-.9.0-1.717.564-2.037 1.405-.094.25-.142.511-.142.774v7.245l.084 1.441c.348 3.277 2.047 6.142 4.682 8.139.045.036.094.07.143.105l.03.023c1.411 1.03 2.989 1.728 4.694 2.072.786.158 1.591.24 2.389.24.739.0 1.481-.067 2.209-.204.088-.029.176-.045.264-.06.023.0.049-.015.074-.029 1.633-.36 3.148-1.036 4.508-2.025l.029-.031.135-.105c2.627-1.995 4.324-4.862 4.686-8.148L24 10.678V3.445c0-.251-.031-.5-.121-.742l.017.01z"/></svg></span></a></div></div><div class=breadcrumb><a href=../../>&#x1F3E0;HOME</a> > <a href=../../linux/>まくまく Linux/ShellScript ノート</a></div></div></article><script>const SIDEBAR_HIDE_THRESHOLD=800,SIDEBAR_WIDTH=250,OFFSET=10;let w=window.innerWidth;w>=SIDEBAR_HIDE_THRESHOLD&&(w-=SIDEBAR_WIDTH),w-=OFFSET,w>=728?rakuten_size="728x200":w>=600?rakuten_size="600x200":w>=468?rakuten_size="468x160":w>=336?rakuten_size="336x280":w>=300?rakuten_size="300x250":w>=250?rakuten_size="250x250":rakuten_size="200x350",rakuten_design="slide",rakuten_affiliateId="1239b074.74af6526.1239b075.bc72ef6e",rakuten_items="ctsmatch",rakuten_genreId=0,rakuten_target="_blank",rakuten_theme="gray",rakuten_border="off",rakuten_auto_mode="on",rakuten_genre_title="off",rakuten_recommend="on",rakuten_txtColor="333333",rakuten_moverColor="30C030",rakuten_bgColor="FFFFFF",rakuten_captionColor="333333"</script><script src=https://xml.affiliate.rakuten.co.jp/widget/js/rakuten_widget.js></script></div><div class=l-withSidebar__sidebarRight><nav class=navigation><div class=navigation__header>カテゴリ一覧</div><ul><li><a class=navigation__item href=https://maku77.github.io/memo/>いろいろ</a><li><a class=navigation__item href=https://maku77.github.io/android/>Android</a><li><a class=navigation__item href=https://maku.blog/p/8t6hr3d/>Ansible</a><li><a class=navigation__item href=https://maku77.github.io/blender/>Blender</a><li><a class=navigation__item href=https://maku77.github.io/cpp/>C/C++</a><li><a class=navigation__item href=https://maku77.github.io/docker/>Docker</a><li><a class=navigation__item href=https://maku77.github.io/git/>Git</a><li><a class=navigation__item href=https://maku77.github.io/go/>Go言語</a><li><a class=navigation__item href=https://maku77.github.io/gradle/>Gradle</a><li><a class=navigation__item href=https://maku77.github.io/web/>HTML/CSS</a><li><a class=navigation__item href=https://maku77.github.io/hugo/>Hugo</a><li><a class=navigation__item href=https://maku77.github.io/java/>Java</a><li><a class=navigation__item href=https://maku77.github.io/js/>JavaScript</a><li><a class=navigation__item href=https://maku77.github.io/kotlin/>Kotlin</a><li><a class="navigation__item navigation__item--focused" href=https://maku77.github.io/linux/>Linux/Shell</a><li><a class=navigation__item href=https://maku.blog/p/somcgdw/>Mac</a><li><a class=navigation__item href=https://maku77.github.io/middleman/>Middleman</a><li><a class=navigation__item href=https://toushi.maku.blog/p/etedykx/>MetaTrader</a><li><a class=navigation__item href=https://maku77.github.io/nodejs/>Node.js</a><li><a class=navigation__item href=https://maku77.github.io/octave/>Octave</a><li><a class=navigation__item href=https://maku77.github.io/p4/>Perforce</a><li><a class=navigation__item href=https://maku77.github.io/perl/>Perl</a><li><a class=navigation__item href=https://maku77.github.io/php/>PHP</a><li><a class=navigation__item href=https://maku77.github.io/python/>Python</a><li><a class=navigation__item href=https://maku77.github.io/r/>R</a><li><a class=navigation__item href=https://maku77.github.io/ruby/>Ruby</a><li><a class=navigation__item href=https://maku77.github.io/rust/>Rust</a><li><a class=navigation__item href=https://maku77.github.io/sass/>Sass</a><li><a class=navigation__item href=https://maku77.github.io/sed/>sed/awk</a><li><a class=navigation__item href=https://maku77.github.io/sql/>SQL</a><li><a class=navigation__item href=https://maku77.github.io/tradestation/>トレードステーション</a><li><a class=navigation__item href=https://maku77.github.io/vagrant/>Vagrant</a><li><a class=navigation__item href=https://maku77.github.io/vba/>VBA</a><li><a class=navigation__item href=https://maku77.github.io/vim/>Vim</a><li><a class=navigation__item href=https://maku77.github.io/windows/>Windows</a></ul></nav><style>.codoc-support{display:inline-block;margin:0!important;padding:12px!important;width:200px!important;max-width:100%}.codoc-support .codoc-support-title{font-size:smaller!important;white-space:nowrap;margin-bottom:12px!important}.codoc-support .codoc-btn{width:160px!important}</style><script src=https://codoc.jp/js/cms.js data-css=black data-usercode=tp6ZPzTj3w defer></script><div id=codoc-entry-4gYwTntzzw class=codoc-entries data-without-body=1 data-support-button-text="（っ'-')╮シュッ🔴" data-show-like=0 data-show-about-codoc=0 data-show-powered-by=0 data-support-message=まくに投げ銭できます。></div></div></div><script>document.addEventListener("DOMContentLoaded",function(){const e=document.querySelectorAll("a[href^=http]");for(let n=0;n<e.length;++n){const t=e[n];if(t.href.startsWith("https://maku77.github.io"))continue;const s=t.getElementsByTagName("img");if(s.length>0)continue;const o=t.getElementsByTagName("svg");if(o.length>0)continue;t.classList.add("xExternalLinkIcon"),t.setAttribute("target","_blank"),t.setAttribute("rel","noopener")}})</script></body></html>