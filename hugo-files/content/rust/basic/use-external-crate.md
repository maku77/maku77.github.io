---
title: "Cargo で外部クレートの依存関係を管理する (Cargo.toml)"
url: "p/4yj2hzf/"
date: "2022-12-29"
tags: ["Rust"]
draft: true
---

Rust に組み込まれている `std` クレートではなく、[crates.io](https://crates.io/) で公開されている外部クレートを使用する場合、`Cargo.toml` ファイルの __`[dependencies]`__ セクションに使用するクレートを列挙しておく必要があります。
例えば、`rand` クレートを使用する場合は次のように記述します。

{{< code lang="toml" title="Cargo.toml" >}}
[dependencies]
rand = "0.8.3"
{{< /code >}}

{{% private %}}
- [The Rust Rand Book](https://rust-random.github.io/book/)
{{% /private %}}

`=` の右辺には、使用する外部クレートのバージョンを[セマンティックバージョニング形式](https://semver.org/)で指定します。
`0.8.3` という指定は、`^0.8.4` の省略記法であり、0.8.3 以上 0.9.0 未満の任意のバージョンを使用することを意味しています。
指定方法にはいくつかのバリエーションがあり、次のような形式で記述します。

- __`^`__ プレフィックス or プレフィックスなし（一般的な互換性を考慮。1.0.0 以前のバージョンでは扱い方が異なることに注意）
  - `1.2.3` ... >=1.2.3, <2.0.0
  - `1.2` ... >=1.2.0, <2.0.0
  - `1` ... >=1.0.0, <2.0.0
  - `0.2.3` ... >=0.2.3, <0.3.0
  - `0.2` ... >=0.2.0, <0.3.0
  - `0.0.3` ... >=0.0.3, <0.0.4
  - `0.0` ... >=0.0.0, <0.1.0
  - `0` ... >=0.0.0, <1.0.0
- __`~`__ プレフィックス（パッチバージョンのみの更新を許可。ただし、メジャーバージョンだけ指定した場合は、マイナーバージョンの更新も許可する）
  - `~1` ... >=1.0.0, <2.0.0
  - `~1.2` ... >=1.2.0, <1.3.0
  - `~1.2.3` ... >=1.2.3, <1.3.0
- __`*`__ ワイルドカード（その部分はどのバージョンも許可）
  - `*` ... >=0.0.0（注: crates.io はこの指定方法は許可していない）
  - `1.*` ... >=1.0.0, <2.0.0
  - `1.2.*` ... >=1.2.0, <1.3.0
- __`=`__, __`<`__, __`>`__, __`<=`__, __`>=`__（正確な一致、大なり小なりでの指定）
  - `= 1.2.3` ... 1.2.3 を使う
  - `>= 1.2.0` ... 1.2.0 以上
  - `< 2` ... 2.0.0 未満
  - `>= 1.2, < 1.5` ... 1.2.0 以上 1.5.0 未満

{{% private %}}
- [Specifying Dependencies - The Cargo Book](https://doc.rust-lang.org/cargo/reference/specifying-dependencies.html)
{{% /private %}}


使用するクレートのバージョンを更新する (carge update)
----

`Cargo.toml` に記述した外部クレートは、`cargo build` コマンドなどを実行したときにダウンロードされ、依存クレートを含めた具体的なバージョン情報が __`Cargo.lock`__ ファイルに保存されます。
`Cargo.lock` ファイルは、GitHub などのバージョン管理システムにコミットされ、他の人が同じビルド結果を再現するために使用されます。
つまり、あるクレートのバージョンが一度 `Cargo.lock` に記録されると、それ以降の `cargo build` コマンドでは、そのクレートのバージョンは更新されません。

`Cargo.lock` に記録されたクレートのバージョンを明示的に更新するには、__`cargo update`__ コマンドを使用します。

```console
$ cargo update
```

このとき、`Cargo.toml` の依存情報として次のように記述されているとすると、

{{< code lang="toml" title="Cargo.toml" >}}
[dependencies]
rand = "0.8.3"
{{< /code >}}

`rand` クレートのバージョンは、0.8.3 以上 0.9.0 未満のうち、最新のバージョンに更新されます。


