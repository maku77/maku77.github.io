<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>Golang on 天才まくまくノート</title><link>https://maku77.github.io/go/</link><description>Recent content in Golang on 天才まくまくノート</description><generator>Hugo</generator><language>ja-jp</language><lastBuildDate>Sat, 05 Nov 2022 00:00:00 +0900</lastBuildDate><atom:link href="https://maku77.github.io/go/index.xml" rel="self" type="application/rss+xml"/><item><title>fmt.Println による構造体の出力をカスタマイズする (Stringer)</title><link>https://maku77.github.io/p/kziyhzg/</link><pubDate>Sat, 05 Nov 2022 00:00:00 +0900</pubDate><guid>https://maku77.github.io/p/kziyhzg/</guid><description>&lt;h2 id="golang-での構造体の出力">Golang での構造体の出力&lt;/h2>
&lt;p>Golang の構造体の内容は、&lt;code>fmt&lt;/code> パッケージの各種関数で出力できるようになっています。
次のコードでは、&lt;code>Game&lt;/code> 構造体の内容をいくつかの方法で出力しています。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-go" data-lang="go">&lt;span class="line">&lt;span class="cl">&lt;span class="kn">package&lt;/span> &lt;span class="nx">main&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kn">import&lt;/span> &lt;span class="s">&amp;#34;fmt&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kd">type&lt;/span> &lt;span class="nx">Game&lt;/span> &lt;span class="kd">struct&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">	&lt;span class="nx">Title&lt;/span> &lt;span class="kt">string&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">	&lt;span class="nx">Price&lt;/span> &lt;span class="kt">int&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kd">func&lt;/span> &lt;span class="nf">main&lt;/span>&lt;span class="p">()&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">	&lt;span class="nx">g&lt;/span> &lt;span class="o">:=&lt;/span> &lt;span class="o">&amp;amp;&lt;/span>&lt;span class="nx">Game&lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="nx">Title&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s">&amp;#34;ドンキーコング&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">Price&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mi">4500&lt;/span>&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">	&lt;span class="nx">fmt&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Println&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">g&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="c1">// &amp;amp;{ドンキーコング 4500}
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>	&lt;span class="nx">fmt&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Printf&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;%v\n&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">g&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="c1">// &amp;amp;{ドンキーコング 4500}
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>	&lt;span class="nx">fmt&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Printf&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;%+v\n&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">g&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="c1">// &amp;amp;{Title:ドンキーコング Price:4500}
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>	&lt;span class="nx">fmt&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Printf&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;%#v\n&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">g&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="c1">// &amp;amp;main.Game{Title:&amp;#34;ドンキーコング&amp;#34;, Price:4500}
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>こういった出力で十分であればよいのですが、異なる出力が欲しいときは、次に説明する &lt;code>Stringer&lt;/code> インタフェースを実装することで対応できます。&lt;/p>
&lt;h2 id="string-関数による出力のカスタマイズ">String 関数による出力のカスタマイズ&lt;/h2>
&lt;p>&lt;code>fmt&lt;/code> パッケージで構造体を文字列表現に変換するとき、内部で &lt;code>String&lt;/code> 関数が呼び出されます。
&lt;code>String&lt;/code> 関数は、&lt;code>fmt&lt;/code> パッケージの &lt;a href="https://pkg.go.dev/fmt#Stringer">Stringer&lt;/a> インタフェースとして定義されています。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-go" data-lang="go">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">type&lt;/span> &lt;span class="nx">Stringer&lt;/span> &lt;span class="kd">interface&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nf">String&lt;/span>&lt;span class="p">()&lt;/span> &lt;span class="kt">string&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>例えば、&lt;code>Game&lt;/code> 構造体の出力をカスタマイズしたいときは、次のように &lt;code>String()&lt;/code> 関数を実装します。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-go" data-lang="go">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">type&lt;/span> &lt;span class="nx">Game&lt;/span> &lt;span class="kd">struct&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">	&lt;span class="nx">Title&lt;/span> &lt;span class="kt">string&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">	&lt;span class="nx">Price&lt;/span> &lt;span class="kt">int&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// Game 構造体の文字列表現
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="kd">func&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="nx">g&lt;/span> &lt;span class="nx">Game&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="nf">String&lt;/span>&lt;span class="p">()&lt;/span> &lt;span class="kt">string&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">	&lt;span class="k">return&lt;/span> &lt;span class="nx">fmt&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Sprintf&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;「%s」 %d円&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">g&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">Title&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">g&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">Price&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>すると、&lt;code>fmt&lt;/code> パッケージの各種関数による出力は次のように変化します。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-go" data-lang="go">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">func&lt;/span> &lt;span class="nf">main&lt;/span>&lt;span class="p">()&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">	&lt;span class="nx">g&lt;/span> &lt;span class="o">:=&lt;/span> &lt;span class="o">&amp;amp;&lt;/span>&lt;span class="nx">Game&lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="nx">Title&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s">&amp;#34;ドンキーコング&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">Price&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mi">4500&lt;/span>&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">	&lt;span class="nx">fmt&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Println&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">g&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="c1">// 「ドンキーコング」 4500円
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>	&lt;span class="nx">fmt&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Printf&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;%v\n&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">g&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="c1">// 「ドンキーコング」 4500円
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>	&lt;span class="nx">fmt&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Printf&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;%+v\n&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">g&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="c1">// 「ドンキーコング」 4500円
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>	&lt;span class="nx">fmt&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Printf&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;%#v\n&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">g&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="c1">// &amp;amp;main.Game{Title:&amp;#34;ドンキーコング&amp;#34;, Price:4500}
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>Golang のソースコード表現を表す &lt;strong>&lt;code>%#v&lt;/code>&lt;/strong> の出力だけは変化しないようです。&lt;/p></description></item><item><title>Golang の文字列操作いろいろ</title><link>https://maku77.github.io/p/xssnvmh/</link><pubDate>Fri, 04 Nov 2022 00:00:00 +0900</pubDate><guid>https://maku77.github.io/p/xssnvmh/</guid><description>&lt;p>Go 言語の文字列操作に関するメモです。&lt;/p>
&lt;h2 id="空文字列と-nil-のチェック">空文字列と nil のチェック&lt;/h2>
&lt;h3 id="文字列が空かどうか調べる">文字列が空かどうか調べる&lt;/h3>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-go" data-lang="go">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">var&lt;/span> &lt;span class="nx">s&lt;/span> &lt;span class="kt">string&lt;/span> &lt;span class="c1">// s := &amp;#34;&amp;#34; と同じ（string のゼロ値は空文字列）
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="nx">fmt&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Println&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">s&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="s">&amp;#34;&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="c1">//=&amp;gt; true
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="nx">fmt&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Println&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nb">len&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">s&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="mi">0&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="c1">//=&amp;gt; true
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;code>string&lt;/code> 変数の内容が空文字列かどうかの確認は、&lt;strong>&lt;code>s == &amp;quot;&amp;quot;&lt;/code>&lt;/strong> と &lt;strong>&lt;code>len(s) == 0&lt;/code>&lt;/strong> のどちらでも OK です。&lt;/p>
&lt;h3 id="文字列ポインタが-nil-あるいは空文字を指しているかを調べる">文字列ポインタが nil あるいは空文字を指しているかを調べる&lt;/h3>

&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">golibs/strutil/strutil.go&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-go" data-lang="go">&lt;span class="line">&lt;span class="cl">&lt;span class="kn">package&lt;/span> &lt;span class="nx">strutil&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kd">func&lt;/span> &lt;span class="nf">NilOrEmpty&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">s&lt;/span> &lt;span class="o">*&lt;/span>&lt;span class="kt">string&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="kt">bool&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">	&lt;span class="k">return&lt;/span> &lt;span class="nx">s&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="kc">nil&lt;/span> &lt;span class="o">||&lt;/span> &lt;span class="o">*&lt;/span>&lt;span class="nx">s&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="s">&amp;#34;&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>

&lt;h2 id="文字列を連結する">文字列を連結する&lt;/h2>

&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">文字列同士の連結（&amp;#43; 演算子）&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-go" data-lang="go">&lt;span class="line">&lt;span class="cl">&lt;span class="nx">s1&lt;/span> &lt;span class="o">:=&lt;/span> &lt;span class="s">&amp;#34;AAA&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nx">s2&lt;/span> &lt;span class="o">:=&lt;/span> &lt;span class="nx">s1&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="s">&amp;#34;BBB&amp;#34;&lt;/span> &lt;span class="c1">//=&amp;gt; &amp;#34;AAABBB&amp;#34;
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>


&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">文字列同士の連結（&amp;#43;= 演算子）&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-go" data-lang="go">&lt;span class="line">&lt;span class="cl">&lt;span class="nx">s&lt;/span> &lt;span class="o">:=&lt;/span> &lt;span class="s">&amp;#34;AAA&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nx">s&lt;/span> &lt;span class="o">+=&lt;/span> &lt;span class="s">&amp;#34;BBB&amp;#34;&lt;/span> &lt;span class="c1">//=&amp;gt; &amp;#34;AAABBB&amp;#34;
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>


&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">文字列スライスの連結 (strings.Join)&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-go" data-lang="go">&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// import &amp;#34;strings&amp;#34;
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="nx">ss&lt;/span> &lt;span class="o">:=&lt;/span> &lt;span class="p">[]&lt;/span>&lt;span class="kt">string&lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="s">&amp;#34;AA&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s">&amp;#34;BB&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s">&amp;#34;CC&amp;#34;&lt;/span>&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nx">result&lt;/span> &lt;span class="o">:=&lt;/span> &lt;span class="nx">strings&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Join&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">ss&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s">&amp;#34;-&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="c1">//=&amp;gt; &amp;#34;AA-BB-CC&amp;#34;
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>


&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">書式文字列で連結 (strings.Join)&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-go" data-lang="go">&lt;span class="line">&lt;span class="cl">&lt;span class="nx">str&lt;/span> &lt;span class="o">:=&lt;/span> &lt;span class="s">&amp;#34;ABC&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nx">num&lt;/span> &lt;span class="o">:=&lt;/span> &lt;span class="mi">100&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nx">result&lt;/span> &lt;span class="o">:=&lt;/span> &lt;span class="nx">fmt&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Sprintf&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;%s%d&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">str&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">num&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="c1">//=&amp;gt; &amp;#34;ABC100&amp;#34;
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>


&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">効率のよい連続連結 (strings.Builder)&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-go" data-lang="go">&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// import &amp;#34;strings&amp;#34;
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="kd">var&lt;/span> &lt;span class="nx">buf&lt;/span> &lt;span class="nx">strings&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">Builder&lt;/span> &lt;span class="c1">// bytes.Buffer
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="nx">buf&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">WriteString&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;AAA&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nx">buf&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">WriteString&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;BBB&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nx">buf&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">WriteRune&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="sc">&amp;#39;X&amp;#39;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nx">buf&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">WriteRune&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="sc">&amp;#39;Y&amp;#39;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nx">buf&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">WriteByte&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">90&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="c1">// &amp;#39;Z&amp;#39;
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="nx">result&lt;/span> &lt;span class="o">:=&lt;/span> &lt;span class="nx">buf&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">String&lt;/span>&lt;span class="p">()&lt;/span> &lt;span class="c1">//=&amp;gt; &amp;#34;AAABBBXYZ
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>


&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">繰り返し文字列 (string.Repeat)&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-go" data-lang="go">&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// import &amp;#34;strings&amp;#34;
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="nx">s&lt;/span> &lt;span class="o">:=&lt;/span> &lt;span class="nx">strings&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Repeat&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;X&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">4&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="c1">//=&amp;gt; &amp;#34;XXXX&amp;#34;
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>

&lt;h2 id="文字列を分割する-stringssplit">文字列を分割する (strings.Split)&lt;/h2>
&lt;h3 id="区切り文字列セパレーターで分割する-stringssplit">区切り文字列（セパレーター）で分割する (strings.Split)&lt;/h3>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-go" data-lang="go">&lt;span class="line">&lt;span class="cl">&lt;span class="nx">s&lt;/span> &lt;span class="o">:=&lt;/span> &lt;span class="s">&amp;#34;AA, BB, CC&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// 単純な分割
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="nx">ss1&lt;/span> &lt;span class="o">:=&lt;/span> &lt;span class="nx">strings&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Split&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">s&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s">&amp;#34;,&amp;#34;&lt;/span>&lt;span class="p">))&lt;/span> &lt;span class="c1">//=&amp;gt; [&amp;#34;AA&amp;#34;, &amp;#34; BB&amp;#34;, &amp;#34; CC&amp;#34;]
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// 単純な分割（最大分割数 N 個）
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="nx">ss2&lt;/span> &lt;span class="o">:=&lt;/span> &lt;span class="nx">strings&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">SplitN&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">s&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s">&amp;#34;,&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">2&lt;/span>&lt;span class="p">))&lt;/span> &lt;span class="c1">//=&amp;gt; [&amp;#34;AA&amp;#34;, &amp;#34; BB, CC&amp;#34;]
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// 区切り文字列を残す
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="nx">ss3&lt;/span> &lt;span class="o">:=&lt;/span> &lt;span class="nx">strings&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">SplitAfter&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">s&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s">&amp;#34;,&amp;#34;&lt;/span>&lt;span class="p">))&lt;/span> &lt;span class="c1">//=&amp;gt; [&amp;#34;AA,&amp;#34;, &amp;#34; BB,&amp;#34;, &amp;#34; CC&amp;#34;]
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// 区切り文字列を残す（最大分割数 N 個）
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="nx">ss4&lt;/span> &lt;span class="o">:=&lt;/span> &lt;span class="nx">strings&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">SplitAfterN&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">s&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s">&amp;#34;,&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">2&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="c1">//=&amp;gt; [&amp;#34;AA,&amp;#34;, &amp;#34; BB, CC&amp;#34;]
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;code>strings.SplitN&lt;/code> の最大分割数 &lt;code>n&lt;/code> に 0 を指定すると戻り値は &lt;code>nil&lt;/code> になります。
&lt;code>n&lt;/code> に負の値（-1 など）を指定すると、分割数を制限しません（&lt;code>strings.Split&lt;/code> と同じ動作になります）。&lt;/p></description></item><item><title>Golang で MongoDB を扱う (go.mongodb.org/mongo-driver)</title><link>https://maku77.github.io/p/uft7jv9/</link><pubDate>Sun, 16 Oct 2022 00:00:00 +0900</pubDate><guid>https://maku77.github.io/p/uft7jv9/</guid><description>&lt;p>Golang を使って MongoDB サーバーに接続する方法の説明です。&lt;/p>
&lt;h2 id="golang-用の-mongodb-ドライバー">Golang 用の MongoDB ドライバー&lt;/h2>
&lt;p>&lt;strong>&lt;code>go.mongodb.org/mongo-driver/mongo&lt;/code>&lt;/strong> モジュールは、Golang 用の MongoDB 公式ドライバーです。
Golang のプロジェクトをモジュールモードで初期化して、&lt;code>go get&lt;/code> で依存関係を追加すれば MongoDB にアクセスする準備は完了です。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-console" data-lang="console">&lt;span class="line">&lt;span class="cl">&lt;span class="gp">$&lt;/span> mkdir example-mongo
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="gp">$&lt;/span> &lt;span class="nb">cd&lt;/span> example-mongo
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="gp">$&lt;/span> go mod init example-mongo
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="gp">$&lt;/span> go get go.mongodb.org/mongo-driver/mongo
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="mongodb-サーバーの準備">MongoDB サーバーの準備&lt;/h2>
&lt;p>接続先の MongoDB サーバーはローカルで起動しておくか、&lt;a href="https://www.mongodb.com/atlas">MongoDB Atlas&lt;/a> などのクラウドサービスで用意しておいてください。&lt;/p>
&lt;ul>
&lt;li>参考: &lt;a href="https://maku.blog/p/qikq9o8/">MongoDB 関連記事｜まくろぐ&lt;/a>&lt;/li>
&lt;/ul>
&lt;p>以下の説明では、&lt;code>localhost:27017&lt;/code> で MongoDB サーバーが稼働していることを想定しています。&lt;/p>
&lt;h2 id="mongodb-に接続する">MongoDB に接続する&lt;/h2>
&lt;p>MongoDB へ接続するためのクライアント設定は、&lt;a href="https://pkg.go.dev/go.mongodb.org/mongo-driver/mongo/options#ClientOptions">options.ClientOptions&lt;/a> インスタンスで表現します。
このインスタンスは &lt;strong>&lt;code>options.Client()&lt;/code>&lt;/strong> 関数で生成できるので、あとは各種セッターメソッドでオプション指定していきます。
MongoDB Atlas などのサービスを使っているのであれば、接続文字列が提供されているはずなので、それをそのまま &lt;strong>&lt;code>ApplyURI&lt;/code>&lt;/strong> メソッドに渡してやるだけで最低限の接続設定は完了します（参考: &lt;a href="https://www.mongodb.com/docs/manual/reference/connection-string/">接続文字列の形式&lt;/a>）。&lt;/p>

&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">main.go（localhost:27017 への接続例）&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-go" data-lang="go">&lt;span class="line">&lt;span class="cl">&lt;span class="kn">package&lt;/span> &lt;span class="nx">main&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kn">import&lt;/span> &lt;span class="p">(&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">	&lt;span class="s">&amp;#34;context&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">	&lt;span class="s">&amp;#34;fmt&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">	&lt;span class="s">&amp;#34;log&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">	&lt;span class="s">&amp;#34;go.mongodb.org/mongo-driver/mongo&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">	&lt;span class="s">&amp;#34;go.mongodb.org/mongo-driver/mongo/options&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// MongoDB サーバーの接続文字列
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="kd">const&lt;/span> &lt;span class="nx">uri&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="s">&amp;#34;mongodb://localhost:27017&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kd">func&lt;/span> &lt;span class="nf">main&lt;/span>&lt;span class="p">()&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">	&lt;span class="nx">ctx&lt;/span> &lt;span class="o">:=&lt;/span> &lt;span class="nx">context&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Background&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">	&lt;span class="c1">// 接続文字列の設定
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>	&lt;span class="nx">opt&lt;/span> &lt;span class="o">:=&lt;/span> &lt;span class="nx">options&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Client&lt;/span>&lt;span class="p">().&lt;/span>&lt;span class="nf">ApplyURI&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">uri&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">	&lt;span class="k">if&lt;/span> &lt;span class="nx">err&lt;/span> &lt;span class="o">:=&lt;/span> &lt;span class="nx">opt&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Validate&lt;/span>&lt;span class="p">();&lt;/span> &lt;span class="nx">err&lt;/span> &lt;span class="o">!=&lt;/span> &lt;span class="kc">nil&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">		&lt;span class="nx">log&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Fatal&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">err&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">	&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">	&lt;span class="c1">// MongoDB サーバーへの接続
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>	&lt;span class="nx">client&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">err&lt;/span> &lt;span class="o">:=&lt;/span> &lt;span class="nx">mongo&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Connect&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">ctx&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">opt&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">	&lt;span class="k">if&lt;/span> &lt;span class="nx">err&lt;/span> &lt;span class="o">!=&lt;/span> &lt;span class="kc">nil&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">		&lt;span class="nx">log&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Fatal&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">err&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">	&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">	&lt;span class="c1">// 関数を抜けるときに自動クローズ
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>	&lt;span class="k">defer&lt;/span> &lt;span class="kd">func&lt;/span>&lt;span class="p">()&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">		&lt;span class="k">if&lt;/span> &lt;span class="nx">err&lt;/span> &lt;span class="o">:=&lt;/span> &lt;span class="nx">client&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Disconnect&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">ctx&lt;/span>&lt;span class="p">);&lt;/span> &lt;span class="nx">err&lt;/span> &lt;span class="o">!=&lt;/span> &lt;span class="kc">nil&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">			&lt;span class="nx">log&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Fatal&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">err&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">		&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">	&lt;span class="p">}()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">	&lt;span class="c1">// Ping してみる
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>	&lt;span class="k">if&lt;/span> &lt;span class="nx">err&lt;/span> &lt;span class="o">:=&lt;/span> &lt;span class="nx">client&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Ping&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">ctx&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="kc">nil&lt;/span>&lt;span class="p">);&lt;/span> &lt;span class="nx">err&lt;/span> &lt;span class="o">!=&lt;/span> &lt;span class="kc">nil&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">		&lt;span class="nx">log&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Fatal&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">err&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">	&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">	&lt;span class="nx">fmt&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Println&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;Ping to MongoDB server succeeded&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>


&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">実行結果&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-console" data-lang="console">&lt;span class="line">&lt;span class="cl">&lt;span class="gp">$&lt;/span> go run .
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">Connected to MongoDB
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>

&lt;h2 id="クラス化で見通しをよくする">クラス化で見通しをよくする&lt;/h2>
&lt;p>次のように構造体で &lt;code>mongo.Client&lt;/code> インスタンスを保持するようにすれば、コレクション操作などをメソッドの形にまとめることができます。
接続先のアドレスを &lt;strong>&lt;code>MONGODB_URI&lt;/code>&lt;/strong> のような環境変数で設定できるようにしておくと、様々な環境で実行できるプログラムになります。&lt;/p></description></item><item><title>gqlgen で子フィールドの情報を返すリゾルバーを実装する</title><link>https://maku77.github.io/p/wdvdtap/</link><pubDate>Wed, 05 Oct 2022 00:00:00 +0900</pubDate><guid>https://maku77.github.io/p/wdvdtap/</guid><description>&lt;h2 id="何をするか">何をするか？&lt;/h2>
&lt;p>Golang の GraphQL ライブラリである &lt;strong>&lt;code>gqlgen&lt;/code>&lt;/strong> を使って、GraphQL スキーマからサーバー実装用のコードを自動生成するときに、オブジェクト型の子フィールド用のリゾルバーを生成する方法を説明します。
&lt;code>gqlgen&lt;/code> の基本的な使い方は下記を参照してください。&lt;/p>
&lt;ul>
&lt;li>参考: &lt;a href="../p/v48adgi/">GraphQL サーバーを作成する (gqlgen)&lt;/a>&lt;/li>
&lt;/ul>
&lt;h2 id="デフォルト設定でコード生成した場合">デフォルト設定でコード生成した場合&lt;/h2>
&lt;p>ここでは、入力用の GraphQL スキーマとして次のようなファイルを使うことにします。
オブジェクト型として &lt;code>Book&lt;/code> と &lt;code>Author&lt;/code> があり、&lt;code>Author&lt;/code> は &lt;code>Book&lt;/code> の &lt;code>author&lt;/code> フィールドとしてのみ使用されています。&lt;/p>

&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">graph/schema.graphqls&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-graphql" data-lang="graphql">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">type&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nc">Query&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="py">books&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="nc">Book&lt;/span>&lt;span class="p">!]!&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="kd">type&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nc">Book&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="py">id&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nc">ID&lt;/span>&lt;span class="p">!&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="py">title&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nc">String&lt;/span>&lt;span class="p">!&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="py">author&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nc">Author&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="kd">type&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nc">Author&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="py">id&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nc">ID&lt;/span>&lt;span class="p">!&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="py">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nc">String&lt;/span>&lt;span class="p">!&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>

&lt;p>&lt;code>gqlgen generate&lt;/code> すると、次のようなモデル（型情報）コードが生成されます。&lt;/p>

&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">graph/model/models_gen.go&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-go" data-lang="go">&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// Code generated by github.com/99designs/gqlgen, DO NOT EDIT.
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kn">package&lt;/span> &lt;span class="nx">model&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kd">type&lt;/span> &lt;span class="nx">Author&lt;/span> &lt;span class="kd">struct&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">	&lt;span class="nx">ID&lt;/span> &lt;span class="kt">string&lt;/span> &lt;span class="s">`json:&amp;#34;id&amp;#34;`&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">	&lt;span class="nx">Name&lt;/span> &lt;span class="kt">string&lt;/span> &lt;span class="s">`json:&amp;#34;name&amp;#34;`&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kd">type&lt;/span> &lt;span class="nx">Book&lt;/span> &lt;span class="kd">struct&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">	&lt;span class="nx">ID&lt;/span> &lt;span class="kt">string&lt;/span> &lt;span class="s">`json:&amp;#34;id&amp;#34;`&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">	&lt;span class="nx">Title&lt;/span> &lt;span class="kt">string&lt;/span> &lt;span class="s">`json:&amp;#34;title&amp;#34;`&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">	&lt;span class="nx">Author&lt;/span> &lt;span class="o">*&lt;/span>&lt;span class="nx">Author&lt;/span> &lt;span class="s">`json:&amp;#34;author&amp;#34;`&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>

&lt;p>さらに、リゾルバーのテンプレートコードとして次のようなメソッドが自動生成されるのですが、デフォルトの設定 (&lt;code>gqlgen.yml&lt;/code>) では、&lt;strong>&lt;code>Query&lt;/code> 型のフィールドに対応するリゾルバーメソッドしか生成されません&lt;/strong>。
例えば、今回のスキーマの場合 &lt;code>books&lt;/code> フィールドを取得するためのリゾルバーメソッドのみが生成されます。&lt;/p></description></item><item><title>Golang のジェネリクスで複数の型を扱える関数を定義する (generics)</title><link>https://maku77.github.io/p/cp8o6m2/</link><pubDate>Sun, 25 Sep 2022 00:00:00 +0900</pubDate><guid>https://maku77.github.io/p/cp8o6m2/</guid><description>&lt;p>Golang のジェネリクスを使用すると、複数の型を扱う関数を定義できます。
ジェネリクスは別の言語ではごく一般的な機能として提供されていますが、シンプルな言語仕様を理想としている Golang では当初提供されていませんでした。
ただ、ジェネリクスを望む声は多く、Golang ver 1.8 で導入されることになりました。&lt;/p>
&lt;h2 id="ジェネリクスを使わない場合">ジェネリクスを使わない場合&lt;/h2>
&lt;p>次のコードの &lt;code>SumInt64&lt;/code> 関数と &lt;code>SumFloat64&lt;/code> 関数は、両方とも数値スライスの要素を足し合わせる関数ですが、パラメーターの型が &lt;code>int64&lt;/code> と &lt;code>float64&lt;/code> で異なっているため、別々の関数として定義しています。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-go" data-lang="go">&lt;span class="line">&lt;span class="cl">&lt;span class="kn">package&lt;/span> &lt;span class="nx">main&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kn">import&lt;/span> &lt;span class="s">&amp;#34;fmt&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// int64 スライスの全要素を足し合わせた結果を返します。
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="kd">func&lt;/span> &lt;span class="nf">SumInt64&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">vals&lt;/span> &lt;span class="p">[]&lt;/span>&lt;span class="kt">int64&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="kt">int64&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">	&lt;span class="kd">var&lt;/span> &lt;span class="nx">sum&lt;/span> &lt;span class="kt">int64&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">	&lt;span class="k">for&lt;/span> &lt;span class="nx">_&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">v&lt;/span> &lt;span class="o">:=&lt;/span> &lt;span class="k">range&lt;/span> &lt;span class="nx">vals&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">		&lt;span class="nx">sum&lt;/span> &lt;span class="o">+=&lt;/span> &lt;span class="nx">v&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">	&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">	&lt;span class="k">return&lt;/span> &lt;span class="nx">sum&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// float64 スライスの全要素を足し合わせた結果を返します。
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="kd">func&lt;/span> &lt;span class="nf">SumFloat64&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">vals&lt;/span> &lt;span class="p">[]&lt;/span>&lt;span class="kt">float64&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="kt">float64&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">	&lt;span class="kd">var&lt;/span> &lt;span class="nx">sum&lt;/span> &lt;span class="kt">float64&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">	&lt;span class="k">for&lt;/span> &lt;span class="nx">_&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">v&lt;/span> &lt;span class="o">:=&lt;/span> &lt;span class="k">range&lt;/span> &lt;span class="nx">vals&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">		&lt;span class="nx">sum&lt;/span> &lt;span class="o">+=&lt;/span> &lt;span class="nx">v&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">	&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">	&lt;span class="k">return&lt;/span> &lt;span class="nx">sum&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kd">func&lt;/span> &lt;span class="nf">main&lt;/span>&lt;span class="p">()&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">	&lt;span class="nx">fmt&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Println&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nf">SumInt64&lt;/span>&lt;span class="p">([]&lt;/span>&lt;span class="kt">int64&lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="mi">100&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">200&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">300&lt;/span>&lt;span class="p">}))&lt;/span> &lt;span class="c1">//=&amp;gt; 600
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>	&lt;span class="nx">fmt&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Println&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nf">SumFloat64&lt;/span>&lt;span class="p">([]&lt;/span>&lt;span class="kt">float64&lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="mf">0.1&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mf">0.2&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mf">0.3&lt;/span>&lt;span class="p">}))&lt;/span> &lt;span class="c1">//=&amp;gt; 0.6
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>でも、&lt;code>SumInt64&lt;/code> と &lt;code>SumFloat64&lt;/code> の実装はほぼ同じなので、別の関数として実装するのは無駄な気がします。
さらに悲しいことに、次のように定義された &lt;code>MyInt&lt;/code> 型のスライスを &lt;code>SumInt64&lt;/code> 関数に渡そうとしてもエラーになります。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-go" data-lang="go">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">type&lt;/span> &lt;span class="nx">MyInt&lt;/span> &lt;span class="kt">int64&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nx">fmt&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Println&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nf">SumInt64&lt;/span>&lt;span class="p">([]&lt;/span>&lt;span class="nx">MyInt&lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">2&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">3&lt;/span>&lt;span class="p">}))&lt;/span> &lt;span class="c1">// エラー（MyInt は int64 ではない）
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>そこで、ジェネリクスの出番です。&lt;/p>
&lt;h2 id="ジェネリクスの基本">ジェネリクスの基本&lt;/h2>
&lt;p>ジェネリクス対応の関数を定義するには、関数名の後ろにブラケット (&lt;code>[]&lt;/code>) で囲んだ &lt;strong>型パラメーター (type parameters)&lt;/strong> を記述し、その型を関数内で使用します。
次の &lt;code>Sum&lt;/code> 関数は、&lt;code>int64&lt;/code> と &lt;code>float64&lt;/code> のどちらの型のスライスでも引数に指定できるようにしています。&lt;/p></description></item><item><title>Golang でランダム値（乱数）を扱う (math/rand, crypto/rand)</title><link>https://maku77.github.io/p/graq8o5/</link><pubDate>Sat, 24 Sep 2022 00:00:00 +0900</pubDate><guid>https://maku77.github.io/p/graq8o5/</guid><description>&lt;p>Golang でランダム値を扱うパッケージは以下の 2 つが用意されています。&lt;/p>
&lt;ul>
&lt;li>&lt;a href="https://pkg.go.dev/math/rand">math/rand&lt;/a> &amp;hellip; 擬似乱数生成器 (pseudo-random number generator)。初期化のための Seed によって生成される一連の乱数が決定するため、再現性がある。高速な生成が可能だが、生成されるランダム値が予測され得るため、暗号系技術での使用には適さない。&lt;/li>
&lt;li>&lt;a href="https://pkg.go.dev/crypto/rand">crypto/rand&lt;/a> &amp;hellip; 暗号論的擬似乱数生成器（CSPRNG: cryptographically secure pseudo random number generator)。生成されるランダム値を予測するのが困難で、暗号系技術での使用に適している。例えば、秘密鍵の生成や、Nonce 値の生成に用いることができる。&lt;code>math/rand&lt;/code> に比べ、&lt;code>crypto/rand&lt;/code> でのランダム値生成は時間がかかる。&lt;/li>
&lt;/ul>
&lt;h2 id="mathrand-による乱数生成">math/rand による乱数生成&lt;/h2>
&lt;p>&lt;code>math/rand&lt;/code> パッケージのランダム生成器 (&lt;code>*rand.Rand&lt;/code>) は、&lt;strong>&lt;code>rand.New&lt;/code>&lt;/strong> コンストラクタで生成します。
典型的には、現在時刻を元にしたシードを与えて初期化します。&lt;/p>

&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">*rand.Rand を生成する方法&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-go" data-lang="go">&lt;span class="line">&lt;span class="cl">&lt;span class="nx">seed&lt;/span> &lt;span class="o">:=&lt;/span> &lt;span class="nx">time&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Now&lt;/span>&lt;span class="p">().&lt;/span>&lt;span class="nf">UnixNano&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nx">r&lt;/span> &lt;span class="o">:=&lt;/span> &lt;span class="nx">rand&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">New&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">rand&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">NewSource&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">seed&lt;/span>&lt;span class="p">))&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nx">val&lt;/span> &lt;span class="o">:=&lt;/span> &lt;span class="nx">r&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Float64&lt;/span>&lt;span class="p">()&lt;/span> &lt;span class="c1">// 乱数を生成（rand.Rand のメソッド）
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>

&lt;p>あるいは、&lt;strong>&lt;code>rand.Seed&lt;/code>&lt;/strong> 関数で、トップレベル関数用のシードを設定することもできます。
こちらの方法を使う場合は、&lt;code>*rand.Rand&lt;/code> インスタンスを生成する必要はありません。&lt;/p>

&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">トップレベル関数用のシードを設定する方法&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-go" data-lang="go">&lt;span class="line">&lt;span class="cl">&lt;span class="nx">seed&lt;/span> &lt;span class="o">:=&lt;/span> &lt;span class="nx">time&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Now&lt;/span>&lt;span class="p">().&lt;/span>&lt;span class="nf">UnixNano&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nx">rand&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Seed&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">seed&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nx">val&lt;/span> &lt;span class="o">:=&lt;/span> &lt;span class="nx">rand&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Float64&lt;/span>&lt;span class="p">()&lt;/span> &lt;span class="c1">// 乱数を生成（rand のトップレベル関数）
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>

&lt;p>&lt;code>math/rand&lt;/code> パッケージは、次のような乱数生成関数を提供しています。&lt;/p>
&lt;table>
 &lt;thead>
 &lt;tr>
 &lt;th>メソッド&lt;/th>
 &lt;th>説明&lt;/th>
 &lt;th>戻り値の型&lt;/th>
 &lt;th>値の範囲&lt;/th>
 &lt;/tr>
 &lt;/thead>
 &lt;tbody>
 &lt;tr>
 &lt;td>&lt;strong>&lt;code>Int31()&lt;/code>&lt;/strong>&lt;/td>
 &lt;td>0 以上の 31 ビット整数&lt;/td>
 &lt;td>&lt;code>int32&lt;/code>&lt;/td>
 &lt;td>&lt;code>0&lt;/code> 〜 &lt;code>2,147,483,647&lt;/code>&lt;/td>
 &lt;/tr>
 &lt;tr>
 &lt;td>&lt;strong>&lt;code>Int31n(n)&lt;/code>&lt;/strong>&lt;/td>
 &lt;td>0 以上 n 未満の 31 ビット整数&lt;/td>
 &lt;td>&lt;code>int32&lt;/code>&lt;/td>
 &lt;td>&lt;code>0&lt;/code> 〜 &lt;code>n&lt;/code>（n ≧ 1）&lt;/td>
 &lt;/tr>
 &lt;tr>
 &lt;td>&lt;strong>&lt;code>Uint32()&lt;/code>&lt;/strong>&lt;/td>
 &lt;td>0 以上の 32 ビット整数&lt;/td>
 &lt;td>&lt;code>uint32&lt;/code>&lt;/td>
 &lt;td>&lt;code>0&lt;/code> 〜 &lt;code>4,294,967,295&lt;/code>&lt;/td>
 &lt;/tr>
 &lt;tr>
 &lt;td>&lt;strong>&lt;code>Int63()&lt;/code>&lt;/strong>&lt;/td>
 &lt;td>0 以上の 63 ビット整数&lt;/td>
 &lt;td>&lt;code>int64&lt;/code>&lt;/td>
 &lt;td>&lt;code>0&lt;/code> 〜 &lt;code>9,223,372,036,854,775,807&lt;/code>&lt;/td>
 &lt;/tr>
 &lt;tr>
 &lt;td>&lt;strong>&lt;code>Int63n(n)&lt;/code>&lt;/strong>&lt;/td>
 &lt;td>0 以上 n 未満の 63 ビット整数&lt;/td>
 &lt;td>&lt;code>int64&lt;/code>&lt;/td>
 &lt;td>&lt;code>0&lt;/code> 〜 &lt;code>n&lt;/code>（n ≧ 1）&lt;/td>
 &lt;/tr>
 &lt;tr>
 &lt;td>&lt;strong>&lt;code>Uint64()&lt;/code>&lt;/strong>&lt;/td>
 &lt;td>0 以上の 64 ビット整数&lt;/td>
 &lt;td>&lt;code>uint64&lt;/code>&lt;/td>
 &lt;td>&lt;code>0&lt;/code> 〜 &lt;code>18,446,744,073,709,551,615&lt;/code>&lt;/td>
 &lt;/tr>
 &lt;tr>
 &lt;td>&lt;strong>&lt;code>Int()&lt;/code>&lt;/strong>&lt;/td>
 &lt;td>0 以上の整数（少なくとも 32 ビット）&lt;/td>
 &lt;td>&lt;code>int&lt;/code>&lt;/td>
 &lt;td>&lt;code>0&lt;/code> 〜 システム依存&lt;/td>
 &lt;/tr>
 &lt;tr>
 &lt;td>&lt;strong>&lt;code>Intn(n)&lt;/code>&lt;/strong>&lt;/td>
 &lt;td>0 以上 n 未満の整数（少なくとも 32 ビット）&lt;/td>
 &lt;td>&lt;code>int&lt;/code>&lt;/td>
 &lt;td>&lt;code>0&lt;/code> 〜 &lt;code>n&lt;/code>（n ≧ 1）&lt;/td>
 &lt;/tr>
 &lt;tr>
 &lt;td>&lt;strong>&lt;code>Float32()&lt;/code>&lt;/strong>&lt;/td>
 &lt;td>浮動小数点数（&lt;code>float32&lt;/code> 型）&lt;/td>
 &lt;td>&lt;code>float32&lt;/code>&lt;/td>
 &lt;td>&lt;code>[0.0, 1.0)&lt;/code>（0.0 以上 1.0 未満）&lt;/td>
 &lt;/tr>
 &lt;tr>
 &lt;td>&lt;strong>&lt;code>Float64()&lt;/code>&lt;/strong>&lt;/td>
 &lt;td>浮動小数点数（&lt;code>float64&lt;/code> 型）&lt;/td>
 &lt;td>&lt;code>float64&lt;/code>&lt;/td>
 &lt;td>&lt;code>[0.0, 1.0)&lt;/code>（0.0 以上 1.0 未満）&lt;/td>
 &lt;/tr>
 &lt;/tbody>
&lt;/table>

&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">math/rand による乱数生成の例&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-go" data-lang="go">&lt;span class="line">&lt;span class="cl">&lt;span class="kn">package&lt;/span> &lt;span class="nx">main&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kn">import&lt;/span> &lt;span class="p">(&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">	&lt;span class="s">&amp;#34;fmt&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">	&lt;span class="s">&amp;#34;math/rand&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">	&lt;span class="s">&amp;#34;time&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kd">func&lt;/span> &lt;span class="nf">main&lt;/span>&lt;span class="p">()&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">	&lt;span class="nx">seed&lt;/span> &lt;span class="o">:=&lt;/span> &lt;span class="nx">time&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Now&lt;/span>&lt;span class="p">().&lt;/span>&lt;span class="nf">UnixNano&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">	&lt;span class="nx">r&lt;/span> &lt;span class="o">:=&lt;/span> &lt;span class="nx">rand&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">New&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">rand&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">NewSource&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">seed&lt;/span>&lt;span class="p">))&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">	&lt;span class="nx">fmt&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Println&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">r&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Int31&lt;/span>&lt;span class="p">())&lt;/span> &lt;span class="c1">// 1401608483 (int32)
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>	&lt;span class="nx">fmt&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Println&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">r&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Uint32&lt;/span>&lt;span class="p">())&lt;/span> &lt;span class="c1">// 3362137694 (uint32)
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>	&lt;span class="nx">fmt&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Println&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;-------&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">	&lt;span class="nx">fmt&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Println&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">r&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Int63&lt;/span>&lt;span class="p">())&lt;/span> &lt;span class="c1">// 9200732467715261966 (int64)
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>	&lt;span class="nx">fmt&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Println&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">r&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Uint64&lt;/span>&lt;span class="p">())&lt;/span> &lt;span class="c1">// 17815840155156866386 (uint64)
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>	&lt;span class="nx">fmt&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Println&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;-------&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">	&lt;span class="nx">fmt&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Println&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">r&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Float32&lt;/span>&lt;span class="p">())&lt;/span> &lt;span class="c1">// 0.34179267 (float32)
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>	&lt;span class="nx">fmt&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Println&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">r&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Float64&lt;/span>&lt;span class="p">())&lt;/span> &lt;span class="c1">// 0.7233553795829966 (float64)
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>	&lt;span class="nx">fmt&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Println&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;-------&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">	&lt;span class="nx">fmt&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Println&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">r&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Int31n&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">10000&lt;/span>&lt;span class="p">))&lt;/span> &lt;span class="c1">// 1451 (int32)
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>	&lt;span class="nx">fmt&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Println&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">r&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Int63n&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">10000&lt;/span>&lt;span class="p">))&lt;/span> &lt;span class="c1">// 7504 (int64)
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="p">}&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>

&lt;p>&lt;strong>&lt;code>Read(p []byte)&lt;/code>&lt;/strong> メソッドを使用すると、任意の長さのバイト配列を生成することができます。&lt;/p></description></item><item><title>Golang でカレントディレクトリ、実行ファイルのパスを取得する (os.Getwd, os.Executable)</title><link>https://maku77.github.io/p/egs2bjt/</link><pubDate>Fri, 23 Sep 2022 00:00:00 +0900</pubDate><guid>https://maku77.github.io/p/egs2bjt/</guid><description>&lt;h2 id="カレントディレクトリのパス-osgetwd">カレントディレクトリのパス (os.Getwd)&lt;/h2>
&lt;p>Golang でカレントディレクトリのパスを取得するには、&lt;a href="https://pkg.go.dev/os#Getwd">os.Getwd 関数&lt;/a> を使用します。
戻り値は、カレントディレクトリを示す &lt;strong>絶対パス（フルパス）&lt;/strong> の文字列になります。
カレントディレクトリは、&lt;code>go run&lt;/code> コマンドなどを実行したときのディレクトリのことであり、&lt;code>.go&lt;/code> ファイルのあるパスではないことに注意してください。&lt;/p>

&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">main.go&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-go" data-lang="go">&lt;span class="line">&lt;span class="cl">&lt;span class="kn">package&lt;/span> &lt;span class="nx">main&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kn">import&lt;/span> &lt;span class="p">(&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">	&lt;span class="s">&amp;#34;fmt&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">	&lt;span class="s">&amp;#34;os&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kd">func&lt;/span> &lt;span class="nf">main&lt;/span>&lt;span class="p">()&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line hl">&lt;span class="cl">	&lt;span class="nx">dir&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">err&lt;/span> &lt;span class="o">:=&lt;/span> &lt;span class="nx">os&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Getwd&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">	&lt;span class="k">if&lt;/span> &lt;span class="nx">err&lt;/span> &lt;span class="o">!=&lt;/span> &lt;span class="kc">nil&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">		&lt;span class="nb">panic&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">err&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">	&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">	&lt;span class="nx">fmt&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Println&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">dir&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>


&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">実行結果&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-console" data-lang="console">&lt;span class="line">&lt;span class="cl">&lt;span class="gp">$&lt;/span> &lt;span class="nb">cd&lt;/span> /Users/maku/hello
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="gp">$&lt;/span> go run main.go
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">/Users/maku/hello
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">&lt;/span>&lt;span class="err">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="err">&lt;/span>&lt;span class="gp">$&lt;/span> &lt;span class="nb">cd&lt;/span> /Users/maku
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="gp">$&lt;/span> go run hello/main.go
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">/Users/maku
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>

&lt;h2 id="実行中のファイルのパス-osexecutable">実行中のファイルのパス (os.Executable)&lt;/h2>
&lt;p>実行中のファイル (executable) のフルパスを取得するには、&lt;a href="https://pkg.go.dev/os#Executable">os.Executable 関数&lt;/a> を使用します。&lt;/p>

&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">main.go&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-go" data-lang="go">&lt;span class="line">&lt;span class="cl">&lt;span class="kn">package&lt;/span> &lt;span class="nx">main&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kn">import&lt;/span> &lt;span class="p">(&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">	&lt;span class="s">&amp;#34;fmt&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">	&lt;span class="s">&amp;#34;os&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kd">func&lt;/span> &lt;span class="nf">main&lt;/span>&lt;span class="p">()&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line hl">&lt;span class="cl">	&lt;span class="nx">path&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">err&lt;/span> &lt;span class="o">:=&lt;/span> &lt;span class="nx">os&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Executable&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">	&lt;span class="k">if&lt;/span> &lt;span class="nx">err&lt;/span> &lt;span class="o">!=&lt;/span> &lt;span class="kc">nil&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">		&lt;span class="nb">panic&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">err&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">	&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">	&lt;span class="nx">fmt&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Println&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">path&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>


&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">実行結果&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-console" data-lang="console">&lt;span class="line">&lt;span class="cl">&lt;span class="gp">$&lt;/span> &lt;span class="nb">cd&lt;/span> ~/hello
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="gp">$&lt;/span> go build -o myexe main.go
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="gp">$&lt;/span> ./myexe
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">/Users/maku/hello/myexe
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>

&lt;p>&lt;code>go run&lt;/code> コマンドで &lt;code>.go&lt;/code> ファイルを指定して実行した場合は、内部的にビルドされて生成された実行ファイルのパスが表示されます。&lt;/p></description></item><item><title>Golang で CSV 形式の文字列やファイルを扱う (encoding/csv)</title><link>https://maku77.github.io/p/6k5m3iz/</link><pubDate>Tue, 20 Sep 2022 00:00:00 +0900</pubDate><guid>https://maku77.github.io/p/6k5m3iz/</guid><description>&lt;p>Golang 標準パッケージの &lt;a href="https://pkg.go.dev/encoding/csv">encoding/csv&lt;/a> を使用すると、CSV 形式のテキストやファイルを Golang の string 配列で読み書きできます。
CSV はカンマ区切りの単純なフォーマットなので、自力でテキストファイルを読み書きすれば済んでしまいそうですが、改行やダブルクォート (&lt;code>&amp;quot;&lt;/code>) 含むフィールドの扱い方 (&lt;a href="https://www.rfc-editor.org/rfc/rfc4180.html">RFC 4180&lt;/a>) など、微妙に考慮しないといけない部分もあるので、やはり専用の Reader/Writer 実装を使った方が安心です。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-go" data-lang="go">&lt;span class="line">&lt;span class="cl">&lt;span class="kn">import&lt;/span> &lt;span class="s">&amp;#34;encoding/csv&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>このパッケージは、主に次のクラスを提供しています。&lt;/p>
&lt;ul>
&lt;li>&lt;code>csv.Reader&lt;/code> &amp;hellip; CSV の読み出しに使用&lt;/li>
&lt;li>&lt;code>csv.Writer&lt;/code> &amp;hellip; CSV の書き込みに使用&lt;/li>
&lt;/ul>
&lt;p>パッケージ名に &lt;code>csv&lt;/code> という名前が使われていますが、オプション指定によりタブ区切り形式の TSV データを扱うこともできます（後述）。&lt;/p>
&lt;h2 id="csv-ファイルテキストを読み出す-csvreader">CSV ファイル／テキストを読み出す (csv.Reader)&lt;/h2>
&lt;p>CSV 形式のファイルやテキストを読み出すには、&lt;strong>&lt;code>csv.NewReader&lt;/code>&lt;/strong> コンストラクタで &lt;strong>&lt;code>csv.Reader&lt;/code>&lt;/strong> を生成します。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-go" data-lang="go">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">func&lt;/span> &lt;span class="nx">csv&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">NewReader&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">r&lt;/span> &lt;span class="nx">io&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">Reader&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="o">*&lt;/span>&lt;span class="nx">csv&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">Reader&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>このコンストラクタは、データソースを読み出すための &lt;code>io.Reader&lt;/code> を受け取るようになっているので、CSV テキストを扱いたいときは &lt;code>strings.Reader&lt;/code> を、CSV ファイルを扱いたいときは &lt;code>os.File&lt;/code> を渡してやれば OK です（どちらも &lt;code>io.Reader&lt;/code> のメソッド &lt;code>Read&lt;/code> を実装しています）。
あとは、次のようなメソッドで各レコードを文字列スライスとして読み出すことができます。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-go" data-lang="go">&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// 1 つのレコードを読み出す
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="kd">func&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="nx">r&lt;/span> &lt;span class="o">*&lt;/span>&lt;span class="nx">csv&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">Reader&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="nf">Read&lt;/span>&lt;span class="p">()&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="nx">record&lt;/span> &lt;span class="p">[]&lt;/span>&lt;span class="kt">string&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">err&lt;/span> &lt;span class="kt">error&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// すべてのレコードを読み出す
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="kd">func&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="nx">r&lt;/span> &lt;span class="o">*&lt;/span>&lt;span class="nx">csv&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">Reader&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="nf">ReadAll&lt;/span>&lt;span class="p">()&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="nx">records&lt;/span> &lt;span class="p">[][]&lt;/span>&lt;span class="kt">string&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">err&lt;/span> &lt;span class="kt">error&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="csv-ファイル読み出しの実装例">CSV ファイル読み出しの実装例&lt;/h3>

&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">input.csv（入力ファイル）&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;pre tabindex="0">&lt;code class="language-csv" data-lang="csv">name,age,blood_type
Asuka,14,A
Maya,24,A
Ritsuko,30,B&lt;/code>&lt;/pre>&lt;/div>
&lt;/figure>


&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">main.go&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-go" data-lang="go">&lt;span class="line">&lt;span class="cl">&lt;span class="kn">package&lt;/span> &lt;span class="nx">main&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kn">import&lt;/span> &lt;span class="p">(&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">	&lt;span class="s">&amp;#34;encoding/csv&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">	&lt;span class="s">&amp;#34;fmt&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">	&lt;span class="s">&amp;#34;io&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">	&lt;span class="s">&amp;#34;log&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">	&lt;span class="s">&amp;#34;os&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kd">func&lt;/span> &lt;span class="nf">main&lt;/span>&lt;span class="p">()&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">	&lt;span class="nx">file&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">err&lt;/span> &lt;span class="o">:=&lt;/span> &lt;span class="nx">os&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Open&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;input.csv&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">	&lt;span class="k">if&lt;/span> &lt;span class="nx">err&lt;/span> &lt;span class="o">!=&lt;/span> &lt;span class="kc">nil&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">		&lt;span class="nx">log&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Fatal&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">err&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">	&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">	&lt;span class="k">defer&lt;/span> &lt;span class="nx">file&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Close&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">	&lt;span class="nx">reader&lt;/span> &lt;span class="o">:=&lt;/span> &lt;span class="nx">csv&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">NewReader&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">file&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">	&lt;span class="k">for&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">		&lt;span class="nx">record&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">err&lt;/span> &lt;span class="o">:=&lt;/span> &lt;span class="nx">reader&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Read&lt;/span>&lt;span class="p">()&lt;/span> &lt;span class="c1">// CSV を 1 レコードずつ読み込み
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>		&lt;span class="k">if&lt;/span> &lt;span class="nx">err&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="nx">io&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">EOF&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">			&lt;span class="k">break&lt;/span> &lt;span class="c1">// 最後まで読み出した
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>		&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">		&lt;span class="k">if&lt;/span> &lt;span class="nx">err&lt;/span> &lt;span class="o">!=&lt;/span> &lt;span class="kc">nil&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">			&lt;span class="nx">log&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Fatal&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">err&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="c1">// 読み出し時にエラー発生
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>		&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">		&lt;span class="c1">// 1 レコード分のデータを出力（record は []string 型）
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>		&lt;span class="nx">fmt&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Println&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">record&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">	&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>


&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">実行結果&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-console" data-lang="console">&lt;span class="line">&lt;span class="cl">&lt;span class="gp">$&lt;/span> go run main.go
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">[name age blood_type]
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">[Asuka 14 A]
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">[Maya 24 A]
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">[Ritsuko 30 B]
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>

&lt;h3 id="2-次元スライスに一括で読み出す-osreadall">2 次元スライスに一括で読み出す (os.ReadAll)&lt;/h3>
&lt;p>&lt;code>(*csv.Reader) Read&lt;/code> の代わりに &lt;strong>&lt;code>(*csv.Reader) ReadAll&lt;/code>&lt;/strong> メソッドを使用すると、CSV の全レコードを 2 次元スライス (&lt;code>[][]string&lt;/code>) 変数に一括で読み出すことができます。
大きな CSV ファイルを扱わないことが分かっているのであれば、こちらを使った方が手っ取り早いかもしれません。&lt;/p></description></item><item><title>Golang で RDB（リレーショナルデーターベース）を扱う (database/sql)</title><link>https://maku77.github.io/p/kgzfwdt/</link><pubDate>Sat, 17 Sep 2022 00:00:00 +0900</pubDate><guid>https://maku77.github.io/p/kgzfwdt/</guid><description>&lt;p>Golang の &lt;a href="https://pkg.go.dev/database/sql">database/sql パッケージ&lt;/a> を使用すると、Postgres、MariaDB (MySQL)、SQLite といった RDB 系のデータベースを共通のインタフェースで操作することができます。
&lt;code>database/sql&lt;/code> を使ってコーディングしておけば、将来的な RDBMS の乗り換えが容易になります。&lt;/p>
&lt;h2 id="ドライバーのインストール">ドライバーのインストール&lt;/h2>
&lt;p>&lt;code>database/sql&lt;/code> はデータベース操作用の抽象化レイヤーを提供するだけなので、実際にデータベースに接続するには、それぞれのデータベースごとのドライバーが必要です。&lt;/p>


&lt;figure class="xImage">
 &lt;img style="" width="" height="auto" src="../p/kgzfwdt/img-001.drawio.svg" alt="/p/kgzfwdt/img-001.drawio.svg" />
&lt;/figure>

&lt;p>ドライバーは &lt;a href="https://github.com/golang/go/wiki/SQLDrivers">SQLDrivers の一覧ページ&lt;/a> から好きなものを選択します。
例えば、mattn 氏の SQLite 用ドライバーを使う場合は、次のように &lt;code>go.mod&lt;/code> の依存関係を更新し、&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-console" data-lang="console">&lt;span class="line">&lt;span class="cl">&lt;span class="gp">$&lt;/span> go get github.com/mattn/go-sqlite3
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>Go プログラム内で次のようにインポートしておきます（先にインポート文を書いてから &lt;code>go get .&lt;/code> とする方法もあります）。&lt;/p>

&lt;figure class="xCodeBlock">

&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-go" data-lang="go">&lt;span class="line">&lt;span class="cl">&lt;span class="kn">import&lt;/span> &lt;span class="p">(&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">	&lt;span class="s">&amp;#34;database/sql&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line hl">&lt;span class="cl">	&lt;span class="nx">_&lt;/span> &lt;span class="s">&amp;#34;github.com/mattn/go-sqlite3&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">)&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>

&lt;div class="xNote">
 &lt;span class="xNote_title">☝️ ブランク・インポートが必要&lt;/span>
 &lt;span class="xNote_body">アプリケーションのコードの中でドライバーが提供する関数を直接参照しない場合は、上記のようにアンダースコアを使ったブランク・インポートを行い、&lt;code>go mod tidy&lt;/code> 時にこの行が削除されないようにしておく必要があります。
インポート行が削除されてしまうと、&lt;code>database/sql&lt;/code> パッケージがドライバーを見つけられれず、&lt;code>unknown driver &amp;quot;sqlite3&amp;quot; (forgotten import?)&lt;/code> といったエラーが発生します。&lt;/span>
&lt;/div>
&lt;h2 id="データベースへの接続-sqlopen-dbping">データベースへの接続 (sql.Open, DB.Ping)&lt;/h2>
&lt;p>データベースに接続（ドライバーをオープン）するには、&lt;a href="https://pkg.go.dev/database/sql#Open">sql.Open 関数&lt;/a> を使用します。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-go" data-lang="go">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">func&lt;/span> &lt;span class="nf">Open&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">driverName&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">dataSourceName&lt;/span> &lt;span class="kt">string&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="o">*&lt;/span>&lt;span class="nx">sql&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">DB&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="kt">error&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>第 1 引数には使用するドライバーの名前（例: &lt;code>mysql&lt;/code>、&lt;code>sqlite3&lt;/code>）、第 2 引数にはドライバーごとの接続文字列 (DSN: data source name) を指定します。
SQLite3 の場合は、接続文字列はデータベースファイル名なので、とてもシンプルです。&lt;/p></description></item><item><title>Golang でコマンドライン引数を扱う (os.Args, flags)</title><link>https://maku77.github.io/p/o8vbo2f/</link><pubDate>Fri, 09 Sep 2022 00:00:00 +0900</pubDate><guid>https://maku77.github.io/p/o8vbo2f/</guid><description>&lt;p>Golang でコマンドライン引数を扱うには、標準パッケージの &lt;code>os&lt;/code> や &lt;code>flags&lt;/code> を使用します。&lt;/p>
&lt;ul>
&lt;li>&lt;code>os.Args&lt;/code> &amp;hellip; 単純に文字列配列で参照する場合&lt;/li>
&lt;li>&lt;a href="https://pkg.go.dev/flag">flags パッケージ&lt;/a> &amp;hellip; &lt;code>-key value&lt;/code> スタイルのオプションを扱う場合&lt;/li>
&lt;/ul>
&lt;h2 id="文字列配列でコマンドライン引数を参照する-osargs">文字列配列でコマンドライン引数を参照する (os.Args)&lt;/h2>
&lt;p>&lt;strong>&lt;code>os.Args&lt;/code>&lt;/strong> という文字列配列を参照すると、コマンド実行時に指定したファイル名と、コマンドライン引数を取得することができます。
次のサンプルコードでは、この配列のサイズと、各要素を出力しています。&lt;/p>

&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">main.go&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-go" data-lang="go">&lt;span class="line">&lt;span class="cl">&lt;span class="kn">package&lt;/span> &lt;span class="nx">main&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kn">import&lt;/span> &lt;span class="p">(&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">	&lt;span class="s">&amp;#34;fmt&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">	&lt;span class="s">&amp;#34;os&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kd">func&lt;/span> &lt;span class="nf">main&lt;/span>&lt;span class="p">()&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">	&lt;span class="nx">fmt&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Printf&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;Length = %d\n&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nb">len&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">os&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">Args&lt;/span>&lt;span class="p">))&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">	&lt;span class="k">for&lt;/span> &lt;span class="nx">i&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">arg&lt;/span> &lt;span class="o">:=&lt;/span> &lt;span class="k">range&lt;/span> &lt;span class="nx">os&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">Args&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">		&lt;span class="nx">fmt&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Printf&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;[%d] %s\n&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">i&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">arg&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">	&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>


&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">実行例&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-console" data-lang="console">&lt;span class="line">&lt;span class="cl">&lt;span class="gp">$&lt;/span> go build -o hello.exe &lt;span class="c1"># ビルド&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="gp">$&lt;/span> hello AAA BBB &lt;span class="s2">&amp;#34;CCC DDD&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">Length = 4
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">[0] hello
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">[1] AAA
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">[2] BBB
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">[3] CCC DDD
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>

&lt;p>上記の &lt;code>&amp;quot;CCC DDD&amp;quot;&lt;/code> のように、コマンドライン引数をダブルクォート (&lt;code>&amp;quot;&lt;/code>) で囲むことで、1 つの引数として扱われます。&lt;/p>
&lt;p>ちなみに、&lt;code>os.Args[0]&lt;/code> に入る実行ファイルの名前は、コマンドラインで指定した通りの文字列になることに注意してください。
次のように呼び出し方を変えると、&lt;code>os.Args[0]&lt;/code> の内容も変わります。&lt;/p></description></item><item><title>Golang で JSON 形式の文字列やファイルを扱う (encoding/json)</title><link>https://maku77.github.io/p/dsbs9p5/</link><pubDate>Sun, 04 Sep 2022 00:00:00 +0900</pubDate><guid>https://maku77.github.io/p/dsbs9p5/</guid><description>&lt;p>Golang 標準パッケージの &lt;a href="https://pkg.go.dev/encoding/json">encoding/json&lt;/a> を使用すると、Golang のオブジェクトと JSON テキストを相互に変換することができます。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-go" data-lang="go">&lt;span class="line">&lt;span class="cl">&lt;span class="kn">import&lt;/span> &lt;span class="s">&amp;#34;encoding/json&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>Go と JSON の型を変換するとき、次のように対応付けられます（Channel など、一部扱えないデータはあります）。&lt;/p>
&lt;table>
 &lt;thead>
 &lt;tr>
 &lt;th>Go の型&lt;/th>
 &lt;th>JSON の型&lt;/th>
 &lt;/tr>
 &lt;/thead>
 &lt;tbody>
 &lt;tr>
 &lt;td>&lt;code>bool&lt;/code>&lt;/td>
 &lt;td>boolean&lt;/td>
 &lt;/tr>
 &lt;tr>
 &lt;td>&lt;code>float64&lt;/code>&lt;/td>
 &lt;td>number&lt;/td>
 &lt;/tr>
 &lt;tr>
 &lt;td>&lt;code>string&lt;/code>&lt;/td>
 &lt;td>string&lt;/td>
 &lt;/tr>
 &lt;tr>
 &lt;td>&lt;code>[]interface{}&lt;/code>&lt;/td>
 &lt;td>配列&lt;/td>
 &lt;/tr>
 &lt;tr>
 &lt;td>&lt;code>map[string]interface{}&lt;/code>&lt;/td>
 &lt;td>オブジェクト&lt;/td>
 &lt;/tr>
 &lt;tr>
 &lt;td>&lt;code>nil&lt;/code>&lt;/td>
 &lt;td>null&lt;/td>
 &lt;/tr>
 &lt;/tbody>
&lt;/table>
&lt;p>デフォルトでは、Go の構造体のフィールド名がそのまま JSON のプロパティ名になりますが、構造体フィールドのタグで &lt;a href="#struct-tag">JSON のプロパティ名を指定する&lt;/a> ことができます。
構造体のフィールドがポインタ型である場合は、ポインタが指す実際の値を使って JSON データに変換してくれます。&lt;/p>
&lt;h2 id="struct-tag">JSON のプロパティ名を指定する&lt;/h2>
&lt;p>Golang の構造体は、&lt;a href="../p/hxhzfbs/">各フィールドにタグという情報を追加&lt;/a> できるようになっています。
&lt;code>encoding/json&lt;/code> パッケージは、構造体の &lt;strong>&lt;code>json&lt;/code>&lt;/strong> タグを読み取って、JSON データに変換したときのプロパティ名として使用するようになっています。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-go" data-lang="go">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">type&lt;/span> &lt;span class="nx">Person&lt;/span> &lt;span class="kd">struct&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">	&lt;span class="nx">Name&lt;/span> &lt;span class="kt">string&lt;/span> &lt;span class="s">`json:&amp;#34;name&amp;#34;`&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">	&lt;span class="nx">Age&lt;/span> &lt;span class="kt">int&lt;/span> &lt;span class="s">`json:&amp;#34;age&amp;#34;`&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>上記ように &lt;code>json&lt;/code> タグ設定した構造体を、&lt;code>encoding/json&lt;/code> パッケージの各種メソッドで JSON に変換すると、次のような感じの JSON データになります。
&lt;code>json&lt;/code> タグで指定した通り、プロパティ名がすべて小文字になっていることが分かります。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-json" data-lang="json">&lt;span class="line">&lt;span class="cl">&lt;span class="p">{&lt;/span>&lt;span class="nt">&amp;#34;name&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="s2">&amp;#34;まく&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="nt">&amp;#34;age&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">14&lt;/span>&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>さらに、&lt;code>json&lt;/code> タグでは次のようなオプション指定もできるようになっています（&lt;strong>&lt;code>omitempty&lt;/code>&lt;/strong> や &lt;strong>&lt;code>-&lt;/code>&lt;/strong> の部分）。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-go" data-lang="go">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">type&lt;/span> &lt;span class="nx">Book&lt;/span> &lt;span class="kd">struct&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">	&lt;span class="nx">Title&lt;/span> &lt;span class="kt">string&lt;/span> &lt;span class="s">`json:&amp;#34;title&amp;#34;`&lt;/span> &lt;span class="c1">// ベーシックな使い方
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>	&lt;span class="nx">Price&lt;/span> &lt;span class="kt">int&lt;/span> &lt;span class="s">`json:&amp;#34;price,omitempty&amp;#34;`&lt;/span> &lt;span class="c1">// ゼロ値の場合はこのフィールドを出力しない
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>	&lt;span class="nx">Author&lt;/span> &lt;span class="kt">string&lt;/span> &lt;span class="s">`json:&amp;#34;-&amp;#34;`&lt;/span> &lt;span class="c1">// このフィールドは出力しない
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;ul>
&lt;li>参考: &lt;a href="../p/hxhzfbs/">Golang の構造体にタグ情報を追加する (struct tags)&lt;/a>&lt;/li>
&lt;/ul>
&lt;h2 id="go-オブジェクト--json-文字列">Go オブジェクト → JSON 文字列&lt;/h2>
&lt;p>&lt;strong>&lt;code>json.Marshal&lt;/code>&lt;/strong> 関数を使用すると、任意の Go オブジェクト（構造体）を JSON 形式の文字列データに変換できます。&lt;/p></description></item><item><title>Golang の構造体にタグ情報を追加する (struct tags)</title><link>https://maku77.github.io/p/hxhzfbs/</link><pubDate>Sat, 03 Sep 2022 00:00:00 +0900</pubDate><guid>https://maku77.github.io/p/hxhzfbs/</guid><description>&lt;h2 id="構造体タグ-struct-tags-の基本">構造体タグ (struct tags) の基本&lt;/h2>
&lt;p>Go 言語の構造体 (struct) では、各フィールドの末尾に、&lt;strong>タグ (struct tags)&lt;/strong> と呼ばれるメタ情報を付加することができます。
JSON データを扱うプログラムの構造体で、&lt;code>`json:&amp;quot;id&amp;quot;`&lt;/code> のような記述があるのを見かけたことがあるかもしれません。
下記の例は、タグを追加した &lt;code>Book&lt;/code> 構造体の例です。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-go" data-lang="go">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">type&lt;/span> &lt;span class="nx">Book&lt;/span> &lt;span class="kd">struct&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">	&lt;span class="nx">Title&lt;/span> &lt;span class="kt">string&lt;/span> &lt;span class="s">`label:&amp;#34;タイトル&amp;#34;`&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">	&lt;span class="nx">Price&lt;/span> &lt;span class="kt">int&lt;/span> &lt;span class="s">`label:&amp;#34;価格&amp;#34;`&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>各タグは、&lt;strong>&lt;code>タグ名:&amp;quot;タグ値&amp;quot;&lt;/code>&lt;/strong> というフォーマットの文字列リテラルで設定します。
&lt;strong>コロン (&lt;code>:&lt;/code>) の前後にスペースを入れてはいけません&lt;/strong>。
&lt;a href="https://go.dev/ref/spec#Struct_types">Golang の言語仕様 (Struct types)&lt;/a> では、任意の文字列リテラルを配置できると記述されていますが、VS Code などの Lint 系プラグインでは、上記のようなフォーマットで記述していないと警告が出たりするので、このフォーマットで記述しておくのが無難です。
通常はダブルクォート (&lt;code>&amp;quot;&lt;/code>) のエスケープをしなくて済むように、バッククォート (&lt;code>`&lt;/code>) で囲んだ &lt;a href="https://go.dev/ref/spec#String_literals">Raw string literals（生文字列リテラル）&lt;/a> を使います。&lt;/p>
&lt;h2 id="構造体タグを参照する">構造体タグを参照する&lt;/h2>
&lt;p>構造体の各フィールドに付加したタグを参照するには、&lt;code>reflect&lt;/code> パッケージを使ったリフレクションを利用します。
次の例では、各フィールドの &lt;code>label&lt;/code> タグの値を出力しています。&lt;/p>

&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">main.go&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-go" data-lang="go">&lt;span class="line">&lt;span class="cl">&lt;span class="kn">package&lt;/span> &lt;span class="nx">main&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kn">import&lt;/span> &lt;span class="p">(&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">	&lt;span class="s">&amp;#34;fmt&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">	&lt;span class="s">&amp;#34;reflect&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kd">type&lt;/span> &lt;span class="nx">Book&lt;/span> &lt;span class="kd">struct&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">	&lt;span class="nx">Title&lt;/span> &lt;span class="kt">string&lt;/span> &lt;span class="s">`label:&amp;#34;タイトル&amp;#34;`&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">	&lt;span class="nx">Price&lt;/span> &lt;span class="kt">int&lt;/span> &lt;span class="s">`label:&amp;#34;価格&amp;#34;`&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kd">func&lt;/span> &lt;span class="nf">main&lt;/span>&lt;span class="p">()&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">	&lt;span class="nx">book&lt;/span> &lt;span class="o">:=&lt;/span> &lt;span class="nx">Book&lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="nx">Title&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s">&amp;#34;Golang入門&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">Price&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mi">2000&lt;/span>&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">	&lt;span class="c1">// リフレクションで構造体の各フィールドをループ処理
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>	&lt;span class="nx">t&lt;/span> &lt;span class="o">:=&lt;/span> &lt;span class="nx">reflect&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">TypeOf&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">book&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">	&lt;span class="k">for&lt;/span> &lt;span class="nx">i&lt;/span> &lt;span class="o">:=&lt;/span> &lt;span class="mi">0&lt;/span>&lt;span class="p">;&lt;/span> &lt;span class="nx">i&lt;/span> &lt;span class="p">&amp;lt;&lt;/span> &lt;span class="nx">t&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">NumField&lt;/span>&lt;span class="p">();&lt;/span> &lt;span class="nx">i&lt;/span>&lt;span class="o">++&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">		&lt;span class="nx">fieldName&lt;/span> &lt;span class="o">:=&lt;/span> &lt;span class="nx">t&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Field&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">i&lt;/span>&lt;span class="p">).&lt;/span>&lt;span class="nx">Name&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">		&lt;span class="nx">tag&lt;/span> &lt;span class="o">:=&lt;/span> &lt;span class="nx">t&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Field&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">i&lt;/span>&lt;span class="p">).&lt;/span>&lt;span class="nx">Tag&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">		&lt;span class="nx">fmt&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Printf&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;%s フィールドの label タグの値は「%s」だよ\n&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">			&lt;span class="nx">fieldName&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">tag&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Get&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;label&amp;#34;&lt;/span>&lt;span class="p">))&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">	&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>


&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">実行結果&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-console" data-lang="console">&lt;span class="line">&lt;span class="cl">&lt;span class="gp">$&lt;/span> go run main.go
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">Title フィールドの label タグの値は「タイトル」だよ
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">Price フィールドの label タグの値は「価格」だよ
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>

&lt;p>上記の例では、タグ値の取得に &lt;strong>&lt;code>tag.Get&lt;/code>&lt;/strong> メソッドを使用していますが、設定されていないタグ名を指定すると、戻り値は空文字列 (&lt;code>&amp;quot;&amp;quot;&lt;/code>) になります。
&lt;code>tag.Get&lt;/code> の代わりに &lt;strong>&lt;code>tag.Lookup&lt;/code>&lt;/strong> メソッドを使用すると、タグの有無を判別することができます。
タグ値として空文字列を設定することに意味を持たせたい場合はこちらを使用します。&lt;/p></description></item><item><title>Golang で GraphQL サーバーを作成する (gqlgen)</title><link>https://maku77.github.io/p/v48adgi/</link><pubDate>Sat, 20 Aug 2022 00:00:00 +0900</pubDate><guid>https://maku77.github.io/p/v48adgi/</guid><description>&lt;p>Go 言語用の GraphQL ライブラリ &lt;a href="https://gqlgen.com">gqlgen&lt;/a> を使って、GraphQL サーバーを作ってみます。
gqlgen は、スキーマファーストの設計を採用しており、最初に GraphQL スキーマを定義し、それに合わせて各クエリ用のリゾルバーを実装していきます。
リゾルバーの雛形は、&lt;code>gqlgen generate&lt;/code> というコマンドで生成できます。&lt;/p>
&lt;h2 id="go-プロジェクトを作成して-gqlgen-コマンドをインストールする">Go プロジェクトを作成して gqlgen コマンドをインストールする&lt;/h2>
&lt;h3 id="go-プロジェクトの作成">Go プロジェクトの作成&lt;/h3>
&lt;p>まずは、Go のプロジェクトを Go Modules として作成します。
モジュール名は適当に &lt;code>example.com/myapp&lt;/code> としておきます。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-console" data-lang="console">&lt;span class="line">&lt;span class="cl">&lt;span class="gp">$&lt;/span> mkdir myapp &lt;span class="o">&amp;amp;&amp;amp;&lt;/span> &lt;span class="nb">cd&lt;/span> myapp
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="gp">$&lt;/span> go mod init example.com/myapp
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>これで、&lt;code>myapp&lt;/code> ディレクトリ内に &lt;code>go.mod&lt;/code> ファイルが生成されます。&lt;/p>
&lt;h3 id="gqlgen-コマンドのインストール">gqlgen コマンドのインストール&lt;/h3>
&lt;p>&lt;code>gqlgen&lt;/code> コマンドは &lt;code>github.com/99designs/gqlgen&lt;/code> という Go モジュールとして提供されています。
Go 言語の慣例として、プロジェクトのビルドに必要なツールのモジュール依存情報は、&lt;strong>&lt;code>tools.go&lt;/code>&lt;/strong> というファイルに記述すべしとされているので、次のような内容で作成しておきます（参考: &lt;a href="https://github.com/golang/go/wiki/Modules#how-can-i-track-tool-dependencies-for-a-module">How can I track tool dependencies for a module?&lt;/a>）。&lt;/p>

&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">tools.go&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-go" data-lang="go">&lt;span class="line">&lt;span class="cl">&lt;span class="c1">//go:build tools
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kn">package&lt;/span> &lt;span class="nx">tools&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kn">import&lt;/span> &lt;span class="p">(&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">	&lt;span class="nx">_&lt;/span> &lt;span class="s">&amp;#34;github.com/99designs/gqlgen&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">)&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>

&lt;p>&lt;code>go get&lt;/code> コマンドを実行して、プロジェクトの &lt;code>go.mod&lt;/code> に &lt;code>gqlgen&lt;/code> コマンド用のモジュール依存情報を追加します。
指定可能なバージョンは &lt;a href="https://github.com/99designs/gqlgen/releases">gqlgen の Release ページ&lt;/a> で確認してください。&lt;/p></description></item><item><title>Golang で HTTP サーバーを作成する (net/http, rs/cors)</title><link>https://maku77.github.io/p/goruwy4/</link><pubDate>Sat, 20 Aug 2022 00:00:00 +0900</pubDate><guid>https://maku77.github.io/p/goruwy4/</guid><description>&lt;p>Hugo 標準ライブラリの &lt;a href="https://pkg.go.dev/net/http">net/http パッケージ&lt;/a> (&lt;a href="https://cs.opensource.google/go/go/+/master:src/net/http/">src&lt;/a>) は、HTTP クライアント／サーバーを作成するためのパッケージです。
ここでは、この &lt;code>net/http&lt;/code> パッケージを使って、簡単な Web サーバーを実装してみます。&lt;/p>
&lt;h2 id="最小限の-http-サーバーを作る">最小限の HTTP サーバーを作る&lt;/h2>

&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">main.go&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-go" data-lang="go">&lt;span class="line">&lt;span class="cl">&lt;span class="kn">package&lt;/span> &lt;span class="nx">main&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kn">import&lt;/span> &lt;span class="p">(&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">	&lt;span class="s">&amp;#34;log&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">	&lt;span class="s">&amp;#34;net/http&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kd">func&lt;/span> &lt;span class="nf">main&lt;/span>&lt;span class="p">()&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">	&lt;span class="c1">// ポート番号 8080 で待ち受けを開始
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>	&lt;span class="nx">log&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Fatal&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">http&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">ListenAndServe&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;:8080&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="kc">nil&lt;/span>&lt;span class="p">))&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>

&lt;p>これがおそらく Golang における最小の HTTP サーバー実装です。
&lt;a href="https://pkg.go.dev/net/http#ListenAndServe">http.ListenAndServe 関数&lt;/a> で、指定したアドレスとポート番号で待ち受けを開始しています。
ここではポート番号 &lt;code>8080&lt;/code> だけを指定しているため、&lt;strong>&lt;code>localhost:8080&lt;/code>&lt;/strong> で待ち受けることになります。&lt;/p>
&lt;div class="xNote">
 &lt;span class="xNote_title">☝️ log.Fatal で囲んでいるのはなぜ？&lt;/span>
 &lt;span class="xNote_body">&lt;code>http.ListenAndServe&lt;/code> 関数はサーバーの起動に失敗すると &lt;code>error&lt;/code> オブジェクトを返します。
&lt;code>log.Fatal&lt;/code> 関数で囲んでいるのは、エラーが発生した場合にその内容を出力してから終了するためです。
例えば、サーバーを 2 回続けて起動しようとしたときに、ポート番号が使用中であることを表示してくれます。
逆にサーバーの起動に成功した場合は、&lt;code>http.ListenAndServe&lt;/code> 関数は戻ってこないので、&lt;code>log.Fatal&lt;/code> 関数が実行されることはありません。
サーバーを &lt;kbd>Ctrl + C&lt;/kbd> で終了したときも、&lt;code>log.Fatal&lt;/code> 関数は実行されません。
このイディオムは、&lt;code>net/http&lt;/code> パッケージのドキュメントでも使われています。&lt;/span>
&lt;/div>
&lt;p>&lt;code>go run main.go&lt;/code> でプログラムを起動してから、Web ブラウザで &lt;code>http://localhost:8080/&lt;/code> にアクセスするとレスポンスを確認できます。
ただし、まだ何もコンテンツを返していないので、&lt;code>404 page not found&lt;/code> エラーが返ってきます。
サーバーを停止するときは、&lt;kbd>Ctrl + C&lt;/kbd> と入力します。&lt;/p></description></item><item><title>Golang で環境変数を扱う (os.Getenv, os.LookupEnv)</title><link>https://maku77.github.io/p/4ox6dmu/</link><pubDate>Sat, 13 Aug 2022 00:00:00 +0900</pubDate><guid>https://maku77.github.io/p/4ox6dmu/</guid><description>&lt;p>Go 言語で OS の環境変数を扱うには、標準ライブラリの &lt;a href="https://pkg.go.dev/os">os パッケージ&lt;/a> を使用します。&lt;/p>
&lt;h2 id="環境変数を参照する-osgetenv-oslookupenv">環境変数を参照する (os.Getenv, os.LookupEnv)&lt;/h2>
&lt;p>&lt;a href="https://pkg.go.dev/os#Getenv">os.Getenv 関数&lt;/a> を使うと、特定の環境変数を参照することができます。
指定した名前の環境変数が設定されていない場合は、空文字列 (&lt;code>&amp;quot;&amp;quot;&lt;/code>) を返します。&lt;/p>

&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">main.go&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-go" data-lang="go">&lt;span class="line">&lt;span class="cl">&lt;span class="kn">package&lt;/span> &lt;span class="nx">main&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kn">import&lt;/span> &lt;span class="p">(&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">	&lt;span class="s">&amp;#34;fmt&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">	&lt;span class="s">&amp;#34;os&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kd">func&lt;/span> &lt;span class="nf">main&lt;/span>&lt;span class="p">()&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">	&lt;span class="nx">shell&lt;/span> &lt;span class="o">:=&lt;/span> &lt;span class="nx">os&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Getenv&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;SHELL&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">	&lt;span class="k">if&lt;/span> &lt;span class="nx">shell&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="s">&amp;#34;&amp;#34;&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">		&lt;span class="nx">fmt&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Println&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;環境変数 SHELL が設定されていません&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">		&lt;span class="k">return&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">	&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">	&lt;span class="nx">fmt&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Printf&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;SHELL = %s\n&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">shell&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>

&lt;p>環境変数の値として、明示的に空文字列が設定されていることを判別したい場合は、&lt;code>os.Getenv&lt;/code> の代わりに &lt;a href="https://pkg.go.dev/os#LookupEnv">os.LookupEnv 関数&lt;/a> 関数を使用します。
&lt;code>os.LookupEnv&lt;/code> は、2 番目の &lt;code>bool&lt;/code> 型戻り値で、環境変数が設定されているかどうかを返します。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-go" data-lang="go">&lt;span class="line">&lt;span class="cl">&lt;span class="nx">val&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">ok&lt;/span> &lt;span class="o">:=&lt;/span> &lt;span class="nx">os&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">LookupEnv&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">key&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">if&lt;/span> &lt;span class="p">!&lt;/span>&lt;span class="nx">ok&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">	&lt;span class="nx">fmt&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Printf&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;%s not set\n&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">key&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span> &lt;span class="k">else&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">	&lt;span class="nx">fmt&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Printf&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;%s=%s\n&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">key&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">val&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="文字列リテラルで環境変数を参照する-sexpandenv">文字列リテラルで環境変数を参照する (s.ExpandEnv)&lt;/h2>
&lt;p>環境変数の値を文字列に展開したいことはよくあります。
そのような場合は、&lt;a href="https://pkg.go.dev/os#ExpandEnv">os.ExpandEnv 関数&lt;/a> を使用すると、文字列リテラル内で &lt;strong>&lt;code>$key&lt;/code>&lt;/strong> や &lt;strong>&lt;code>${key}&lt;/code>&lt;/strong> という形で環境変数を展開できます。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-go" data-lang="go">&lt;span class="line">&lt;span class="cl">&lt;span class="nx">s&lt;/span> &lt;span class="o">:=&lt;/span> &lt;span class="nx">os&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">ExpandEnv&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;環境変数 HOME の値は ${HOME} です&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nx">fmt&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Println&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">s&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="すべての環境変数を参照する-osenviron">すべての環境変数を参照する (os.Environ)&lt;/h2>
&lt;p>&lt;a href="https://pkg.go.dev/os#Environ">os.Environ 関数&lt;/a> は、すべての環境変数を文字列配列で返します。
ただし、それぞれの要素は &lt;code>key=value&lt;/code> という文字列になっているので、キーと値を別々に取り出したい場合は、&lt;code>=&lt;/code> で文字列分割する必要があります。&lt;/p></description></item><item><title>Go でコマンドラインツールを作って GitHub で公開する</title><link>https://maku77.github.io/p/whs2bjt/</link><pubDate>Sun, 10 Apr 2022 00:00:00 +0900</pubDate><guid>https://maku77.github.io/p/whs2bjt/</guid><description>&lt;h2 id="何をするか">何をするか？&lt;/h2>
&lt;p>ここでは、Go 言語の HelloWorld として、&lt;code>go-hello&lt;/code> というコマンドを作って、GitHub で公開できるようにしてみます。
この手順が完了すると、世界中のユーザーが次のように &lt;code>go-hello&lt;/code> コマンドをインストールできるようになります。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-console" data-lang="console">&lt;span class="line">&lt;span class="cl">&lt;span class="gp">$&lt;/span> go install github.com/&amp;lt;User&amp;gt;/go-hello@latest
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="go-hello-プロジェクトの作成">go-hello プロジェクトの作成&lt;/h2>
&lt;p>まず、適当なディレクトリにプロジェクト用のディレクトリを作成します。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-console" data-lang="console">&lt;span class="line">&lt;span class="cl">&lt;span class="gp">$&lt;/span> mkdir -p ~/go-hello
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="gp">$&lt;/span> &lt;span class="nb">cd&lt;/span> ~/go-hello
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;strong>&lt;code>go mod&lt;/code>&lt;/strong> コマンドで、プロジェクトのルートディレクトリに &lt;strong>&lt;code>go.mod&lt;/code>&lt;/strong> ファイルを作成します。
引数として、モジュール名（モジュールパス）を指定します。
GitHub で公開するのであれば次のような感じで指定します（&lt;code>maku77&lt;/code> の部分は自分の GitHub ユーザー ID に変更してください）。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-console" data-lang="console">&lt;span class="line">&lt;span class="cl">&lt;span class="gp">$&lt;/span> go mod init github.com/maku77/go-hello
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>
&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">作成された go.mod の内容&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-plain" data-lang="plain">&lt;span class="line">&lt;span class="cl">module github.com/maku77/go-hello
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">go 1.18&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>

&lt;p>Go は、&lt;code>go.mod&lt;/code> ファイルのあるディレクトリをモジュールルートとみなします。&lt;/p>
&lt;h2 id="go-hello-コマンドの実装">go-hello コマンドの実装&lt;/h2>
&lt;h3 id="実装">実装&lt;/h3>
&lt;p>Go 言語では実行可能なコマンドは &lt;code>main&lt;/code> パッケージの &lt;code>main&lt;/code> 関数として実装します。
ファイル名は何でもよいのですが、ここでは &lt;code>main.go&lt;/code> として作成します。&lt;/p>

&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">go-hello/main.go&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-go" data-lang="go">&lt;span class="line">&lt;span class="cl">&lt;span class="kn">package&lt;/span> &lt;span class="nx">main&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kn">import&lt;/span> &lt;span class="s">&amp;#34;fmt&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kd">func&lt;/span> &lt;span class="nf">main&lt;/span>&lt;span class="p">()&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">	&lt;span class="nx">fmt&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Println&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;Hello, world!&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>

&lt;h3 id="動作確認">動作確認&lt;/h3>
&lt;p>この Hello World プログラムは、&lt;strong>&lt;code>go run&lt;/code>&lt;/strong> コマンドでファイル名かディレクトリパスを指定して直接実行できます。&lt;/p></description></item><item><title>Go のコマンドインストール先にパスを通す (GOBIN, GOPATH/bin)</title><link>https://maku77.github.io/p/s258beh/</link><pubDate>Sun, 10 Apr 2022 00:00:00 +0900</pubDate><guid>https://maku77.github.io/p/s258beh/</guid><description>&lt;p>&lt;code>go install&lt;/code> コマンドで Go の実行可能コマンドをインストールすると、次のようなディレクトリにコマンドがインストールされます。&lt;/p>
&lt;ol>
&lt;li>&lt;strong>&lt;code>GOBIN&lt;/code>&lt;/strong> 環境変数が設定されていれば、&lt;strong>&lt;code>$GOBIN&lt;/code>&lt;/strong> が指すディレクトリ&lt;/li>
&lt;li>&lt;strong>&lt;code>GOPATH&lt;/code>&lt;/strong> 環境変数が設定されていれば、&lt;strong>&lt;code>$GOPATH/bin&lt;/code>&lt;/strong> が指すディレクトリ&lt;/li>
&lt;li>&lt;strong>&lt;code>$HOME/go/bin&lt;/code>&lt;/strong> ディレクトリ&lt;/li>
&lt;/ol>
&lt;p>これらのディレクトリに OS のパスを通しておくと、どのディレクトリからでもインストールしたコマンドを実行できるようになります。
Linux や macOS であれば、&lt;code>~/.zlogin&lt;/code> や &lt;code>~/.bash_profile&lt;/code> で次のような感じで設定できます。
ここでは、&lt;code>GOBIN&lt;/code> 環境変数を設定して、コマンドのインストール先を &lt;code>~/bin&lt;/code> に設定しています。&lt;/p>

&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">~/.zlogin&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="line">&lt;span class="cl">&lt;span class="nb">export&lt;/span> &lt;span class="nv">GOBIN&lt;/span>&lt;span class="o">=&lt;/span>~/bin
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">export&lt;/span> &lt;span class="nv">PATH&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="nv">$PATH&lt;/span>:&lt;span class="nv">$GOBIN&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>

&lt;p>でも、なんだかんだ言って次のような標準的な構成にしておくとトラブルが少なくてよい気がします。&lt;/p>

&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">~/.zlogin&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="line">&lt;span class="cl">&lt;span class="nb">export&lt;/span> &lt;span class="nv">GOPATH&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="nv">$HOME&lt;/span>/go
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">export&lt;/span> &lt;span class="nv">GOBIN&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="nv">$GOPATH&lt;/span>/bin
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">export&lt;/span> &lt;span class="nv">PATH&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="nv">$PATH&lt;/span>:&lt;span class="nv">$GOBIN&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>

&lt;p>Windows の場合は、コントロールパネルの「環境変数を編集」から次のような感じで設定します（&lt;code>%USERPROFILE%&lt;/code> 以外の変数を参照すると、うまく展開できなくて問題が出たりするので注意）。&lt;/p>
&lt;pre tabindex="0">&lt;code>GOPATH → %USERPROFILE%\go
GOBIN → %USERPROFILE%\go\bin
PATH → %USERPROFILE%\go\bin （を PATH に追加）
&lt;/code>&lt;/pre>&lt;p>上記のようにパスを通しておけば、&lt;code>go install&lt;/code> でインストールしたコマンドを、どこからでも実行できるようになります。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-console" data-lang="console">&lt;span class="line">&lt;span class="cl">&lt;span class="gp">$&lt;/span> go install github.com/maku77/go-hello@latest
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="gp">$&lt;/span> go-hello
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">Hello, world!
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div></description></item><item><title>インタフェース埋め込みと構造体埋め込みによる拡張 (Embedding)</title><link>https://maku77.github.io/p/tbf357g/</link><pubDate>Tue, 12 Sep 2017 00:00:00 +0900</pubDate><guid>https://maku77.github.io/p/tbf357g/</guid><description>&lt;p>Go 言語には継承の仕組みはありませんが、&lt;strong>埋め込み (Embedding)&lt;/strong> という仕組みによって型の拡張（結合）を行うことができます。&lt;/p>
&lt;h2 id="インタフェース埋め込み-interface-embedding">インタフェース埋め込み (Interface Embedding)&lt;/h2>
&lt;p>Go 言語標準の &lt;code>io&lt;/code> パッケージには、下記のような &lt;code>Reader&lt;/code> インタフェースと &lt;code>Writer&lt;/code> インタフェースが定義されています。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-go" data-lang="go">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">type&lt;/span> &lt;span class="nx">Reader&lt;/span> &lt;span class="kd">interface&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">	&lt;span class="nf">Read&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">p&lt;/span> &lt;span class="p">[]&lt;/span>&lt;span class="kt">byte&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="nx">n&lt;/span> &lt;span class="kt">int&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">err&lt;/span> &lt;span class="kt">error&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kd">type&lt;/span> &lt;span class="nx">Writer&lt;/span> &lt;span class="kd">interface&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">	&lt;span class="nf">Write&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">p&lt;/span> &lt;span class="p">[]&lt;/span>&lt;span class="kt">byte&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="nx">n&lt;/span> &lt;span class="kt">int&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">err&lt;/span> &lt;span class="kt">error&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>ここで、&lt;code>Read&lt;/code> メソッドと &lt;code>Write&lt;/code> メソッドを両方とも備えるインタフェースを単純に定義しようとすると、下記のように記述することになります。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-go" data-lang="go">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">type&lt;/span> &lt;span class="nx">ReadWriter&lt;/span> &lt;span class="kd">interface&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">	&lt;span class="nf">Read&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">p&lt;/span> &lt;span class="p">[]&lt;/span>&lt;span class="kt">byte&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="nx">n&lt;/span> &lt;span class="kt">int&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">err&lt;/span> &lt;span class="kt">error&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">	&lt;span class="nf">Write&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">p&lt;/span> &lt;span class="p">[]&lt;/span>&lt;span class="kt">byte&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="nx">n&lt;/span> &lt;span class="kt">int&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">err&lt;/span> &lt;span class="kt">error&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>Go 言語では、このようなケースのために &lt;strong>埋め込み (Embedding)&lt;/strong> の仕組みが提供されており、次のように既存のインタフェースを再利用する形で新しいインタフェースを定義することができます。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-go" data-lang="go">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">type&lt;/span> &lt;span class="nx">ReadWriter&lt;/span> &lt;span class="kd">interface&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">	&lt;span class="nx">Reader&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">	&lt;span class="nx">Writer&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;code>ReadWriter&lt;/code> インタフェースを備えるオブジェクトは、&lt;code>ReadWriter&lt;/code> 型のパラメータを取る関数だけでなく、&lt;code>Reader&lt;/code> 型のパラメータを取る関数や、&lt;code>Writer&lt;/code> 型のパラメータを取る関数にも渡すことができます。
ちなみに、この &lt;code>ReadWriter&lt;/code> インタフェースも標準の &lt;code>io&lt;/code> パッケージで定義されています。&lt;/p>
&lt;h2 id="構造体埋め込み-struct-embedding">構造体埋め込み (Struct Embedding)&lt;/h2>
&lt;p>埋め込み (Embedding) の仕組みは、インタフェースだけでなく、構造体でも同様に使用することができます。
下記の例では、&lt;code>Product&lt;/code> 構造体を埋め込む形で &lt;code>Stock&lt;/code> 構造体を定義しています。
&lt;code>Product&lt;/code> 構造体は、メソッドを１つ実装しています。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-go" data-lang="go">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">type&lt;/span> &lt;span class="nx">Product&lt;/span> &lt;span class="kd">struct&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">	&lt;span class="nx">Model&lt;/span> &lt;span class="kt">string&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">	&lt;span class="nx">Name&lt;/span> &lt;span class="kt">string&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">	&lt;span class="nx">Price&lt;/span> &lt;span class="kt">int&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kd">func&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="nx">p&lt;/span> &lt;span class="o">*&lt;/span>&lt;span class="nx">Product&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="nf">AdLabel&lt;/span>&lt;span class="p">()&lt;/span> &lt;span class="kt">string&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">	&lt;span class="k">return&lt;/span> &lt;span class="nx">fmt&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Sprintf&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;%s (%s)&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">p&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">Model&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">p&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">Name&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kd">type&lt;/span> &lt;span class="nx">Stock&lt;/span> &lt;span class="kd">struct&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">	&lt;span class="o">*&lt;/span>&lt;span class="nx">Product&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">	&lt;span class="nx">Quantity&lt;/span> &lt;span class="kt">int&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;code>Product&lt;/code> 構造体に定義されているフィールドやメソッドは、&lt;code>Stock&lt;/code> オブジェクト経由で直接参照することができます。
&lt;code>Stock&lt;/code> オブジェクトは下記のように生成します。&lt;/p></description></item><item><title>ベンチマークを行う (testing.B)</title><link>https://maku77.github.io/p/29dgjnq/</link><pubDate>Tue, 12 Sep 2017 00:00:00 +0900</pubDate><guid>https://maku77.github.io/p/29dgjnq/</guid><description>&lt;h2 id="go-のベンチマーク機能の基本的な使い方">Go のベンチマーク機能の基本的な使い方&lt;/h2>
&lt;p>Go にはテストフレームワーク（&lt;strong>&lt;code>testing&lt;/code>&lt;/strong> パッケージ）の一機能として、ベンチマークを行う仕組みが搭載されています。
ここでは、下記のような構造体を、「値渡し」した場合と、「ポインタ渡し」した場合のパフォーマンスの違いを調べてみましょう。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-go" data-lang="go">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">type&lt;/span> &lt;span class="nx">Book&lt;/span> &lt;span class="kd">struct&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">	&lt;span class="nx">Title&lt;/span> &lt;span class="kt">string&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">	&lt;span class="nx">Author&lt;/span> &lt;span class="kt">string&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">	&lt;span class="nx">Price&lt;/span> &lt;span class="kt">int&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kd">func&lt;/span> &lt;span class="nf">CallByValue&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">b&lt;/span> &lt;span class="nx">Book&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kd">func&lt;/span> &lt;span class="nf">CallByPointer&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">b&lt;/span> &lt;span class="o">*&lt;/span>&lt;span class="nx">Book&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>ベンチマーク実行用の関数は、下記のように、&lt;strong>&lt;code>Benchmark&lt;/code>&lt;/strong> という名前で始まり、&lt;strong>&lt;code>*testing.B&lt;/code>&lt;/strong> 型のパラメーターを持つ関数として定義します。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-go" data-lang="go">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">func&lt;/span> &lt;span class="nf">BenchmarkXxxYyyZzz&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">b&lt;/span> &lt;span class="o">*&lt;/span>&lt;span class="nx">testing&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">B&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>例えば、次のような感じで実装します。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-go" data-lang="go">&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// CallByValue の実行速度を計測
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="kd">func&lt;/span> &lt;span class="nf">BenchmarkCallByValue&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">b&lt;/span> &lt;span class="o">*&lt;/span>&lt;span class="nx">testing&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">B&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">	&lt;span class="nx">book&lt;/span> &lt;span class="o">:=&lt;/span> &lt;span class="nx">Book&lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="s">&amp;#34;Golang&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s">&amp;#34;Maku&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">1500&lt;/span>&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">	&lt;span class="k">for&lt;/span> &lt;span class="nx">i&lt;/span> &lt;span class="o">:=&lt;/span> &lt;span class="mi">0&lt;/span>&lt;span class="p">;&lt;/span> &lt;span class="nx">i&lt;/span> &lt;span class="p">&amp;lt;&lt;/span> &lt;span class="nx">b&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">N&lt;/span>&lt;span class="p">;&lt;/span> &lt;span class="nx">i&lt;/span>&lt;span class="o">++&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">		&lt;span class="nf">CallByValue&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">book&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">	&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// CallByPointer の実行速度を計測
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="kd">func&lt;/span> &lt;span class="nf">BenchmarkCallByPointer&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">b&lt;/span> &lt;span class="o">*&lt;/span>&lt;span class="nx">testing&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">B&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">	&lt;span class="nx">book&lt;/span> &lt;span class="o">:=&lt;/span> &lt;span class="nx">Book&lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="s">&amp;#34;Golang&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s">&amp;#34;Maku&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">1500&lt;/span>&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">	&lt;span class="k">for&lt;/span> &lt;span class="nx">i&lt;/span> &lt;span class="o">:=&lt;/span> &lt;span class="mi">0&lt;/span>&lt;span class="p">;&lt;/span> &lt;span class="nx">i&lt;/span> &lt;span class="p">&amp;lt;&lt;/span> &lt;span class="nx">b&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">N&lt;/span>&lt;span class="p">;&lt;/span> &lt;span class="nx">i&lt;/span>&lt;span class="o">++&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">		&lt;span class="nf">CallByPointer&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">&amp;amp;&lt;/span>&lt;span class="nx">book&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">	&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>上記のように、ループ回数に &lt;strong>&lt;code>b.N&lt;/code>&lt;/strong> を指定しておくと、有意な実行時間が計測できるまで繰り返し実行してくれるようになります。&lt;/p>
&lt;p>ベンチマーク用の実装ファイルは、ファイル名のサフィックスを &lt;strong>&lt;code>_test.go&lt;/code>&lt;/strong> としておく必要があります（あくまでベンチマークはテストの一部という位置付け）。
下記に全体のコードを示しておきます。&lt;/p>

&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">sample_test.go&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-go" data-lang="go">&lt;span class="line">&lt;span class="cl">&lt;span class="kn">package&lt;/span> &lt;span class="nx">main&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kn">import&lt;/span> &lt;span class="s">&amp;#34;testing&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kd">type&lt;/span> &lt;span class="nx">Book&lt;/span> &lt;span class="kd">struct&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">	&lt;span class="nx">Title&lt;/span> &lt;span class="kt">string&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">	&lt;span class="nx">Author&lt;/span> &lt;span class="kt">string&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">	&lt;span class="nx">Price&lt;/span> &lt;span class="kt">int&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kd">func&lt;/span> &lt;span class="nf">CallByValue&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">b&lt;/span> &lt;span class="nx">Book&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kd">func&lt;/span> &lt;span class="nf">CallByPointer&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">b&lt;/span> &lt;span class="o">*&lt;/span>&lt;span class="nx">Book&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kd">func&lt;/span> &lt;span class="nf">BenchmarkCallByValue&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">b&lt;/span> &lt;span class="o">*&lt;/span>&lt;span class="nx">testing&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">B&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">	&lt;span class="nx">book&lt;/span> &lt;span class="o">:=&lt;/span> &lt;span class="nx">Book&lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="s">&amp;#34;Golang&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s">&amp;#34;Maku&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">1500&lt;/span>&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">	&lt;span class="k">for&lt;/span> &lt;span class="nx">i&lt;/span> &lt;span class="o">:=&lt;/span> &lt;span class="mi">0&lt;/span>&lt;span class="p">;&lt;/span> &lt;span class="nx">i&lt;/span> &lt;span class="p">&amp;lt;&lt;/span> &lt;span class="nx">b&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">N&lt;/span>&lt;span class="p">;&lt;/span> &lt;span class="nx">i&lt;/span>&lt;span class="o">++&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">		&lt;span class="nf">CallByValue&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">book&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">	&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kd">func&lt;/span> &lt;span class="nf">BenchmarkCallByPointer&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">b&lt;/span> &lt;span class="o">*&lt;/span>&lt;span class="nx">testing&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">B&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">	&lt;span class="nx">book&lt;/span> &lt;span class="o">:=&lt;/span> &lt;span class="nx">Book&lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="s">&amp;#34;Golang&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s">&amp;#34;Maku&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">1500&lt;/span>&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">	&lt;span class="k">for&lt;/span> &lt;span class="nx">i&lt;/span> &lt;span class="o">:=&lt;/span> &lt;span class="mi">0&lt;/span>&lt;span class="p">;&lt;/span> &lt;span class="nx">i&lt;/span> &lt;span class="p">&amp;lt;&lt;/span> &lt;span class="nx">b&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">N&lt;/span>&lt;span class="p">;&lt;/span> &lt;span class="nx">i&lt;/span>&lt;span class="o">++&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">		&lt;span class="nf">CallByPointer&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">&amp;amp;&lt;/span>&lt;span class="nx">book&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">	&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>

&lt;p>ベンチマークを実行するときは、&lt;strong>&lt;code>go test&lt;/code>&lt;/strong> コマンドを &lt;strong>&lt;code>-bench&lt;/code>&lt;/strong> オプション付きで実行します。&lt;/p></description></item><item><title>時刻データを扱う (time)</title><link>https://maku77.github.io/p/sy58beh/</link><pubDate>Tue, 12 Sep 2017 00:00:00 +0900</pubDate><guid>https://maku77.github.io/p/sy58beh/</guid><description>&lt;p>Go 言語で日付や時刻の情報を扱うには、組み込みの &lt;strong>&lt;code>time&lt;/code>&lt;/strong> パッケージを使用します。&lt;/p>
&lt;h2 id="時刻データ-timetime-を作成する">時刻データ (time.Time) を作成する&lt;/h2>
&lt;h3 id="現在時刻を取得する">現在時刻を取得する&lt;/h3>
&lt;p>Go 言語で日時を表す型は、&lt;code>time&lt;/code> パッケージで定義されている &lt;strong>&lt;code>time.Time&lt;/code>&lt;/strong> 型です。
現在の時刻を取得するには、&lt;strong>&lt;code>time.Now&lt;/code>&lt;/strong> 関数を使用します。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-go" data-lang="go">&lt;span class="line">&lt;span class="cl">&lt;span class="nx">t&lt;/span> &lt;span class="o">:=&lt;/span> &lt;span class="nx">time&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Now&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nx">fmt&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Printf&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;%v\n&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">t&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="c1">// time.Time が保持する値を表示
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="nx">fmt&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Printf&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;%T\n&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">t&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="c1">// 型名を表示
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>
&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">実行結果&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-plain" data-lang="plain">&lt;span class="line">&lt;span class="cl">2017-09-12 21:23:23.7770078 +0900 JST m=+0.003000200
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">time.Time&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>

&lt;h3 id="日時を指定して作成する">日時を指定して作成する&lt;/h3>
&lt;p>&lt;a href="https://golang.org/pkg/time/#Date">time.Date 関数&lt;/a>を使用して、指定した日時の &lt;code>time.Time&lt;/code> を作成することができます。
パラメータには、年、月、日、時、分、秒、ナノ秒、Location を指定します。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-go" data-lang="go">&lt;span class="line">&lt;span class="cl">&lt;span class="nx">t&lt;/span> &lt;span class="o">:=&lt;/span> &lt;span class="nx">time&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Date&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">2017&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">9&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">12&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">23&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">0&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">0&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">0&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">time&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">Local&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nx">fmt&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Println&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">t&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="c1">// &amp;#34;2017-09-12 23:00:00 +0900 JST&amp;#34;
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>Location には、ローカルタイムで設定することを表す &lt;code>time.Local&lt;/code> や、協定世界時で設定することを表す &lt;code>time.UTC&lt;/code> を指定することができます。&lt;/p>
&lt;h3 id="文字列表現から作成する">文字列表現から作成する&lt;/h3>
&lt;p>&lt;a href="https://golang.org/pkg/time/#Parse">time.Parse 関数&lt;/a> を使用すると、日時を表す文字列から &lt;code>time.Time&lt;/code> オブジェクトを作成することができます。
第 1 パラメータに、日時文字列の形式を表す layout string（後述）、第 2 パラメータに、実際に変換する文字列を渡します。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-go" data-lang="go">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">const&lt;/span> &lt;span class="nx">layout&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="s">&amp;#34;2006-01-02&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nx">t&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">err&lt;/span> &lt;span class="o">:=&lt;/span> &lt;span class="nx">time&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Parse&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">layout&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s">&amp;#34;2017-09-27&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">if&lt;/span> &lt;span class="nx">err&lt;/span> &lt;span class="o">!=&lt;/span> &lt;span class="kc">nil&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">	&lt;span class="nb">panic&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">err&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nx">fmt&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Println&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">t&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="c1">// 2017-09-27 00:00:00 +0000 UTC
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>layout string には、下記のようにいろいろなパターンを指定することができます。&lt;/p></description></item><item><title>Go 言語のインタフェースの扱いを理解する (interface)</title><link>https://maku77.github.io/p/aimpsvz/</link><pubDate>Mon, 11 Sep 2017 00:00:00 +0900</pubDate><guid>https://maku77.github.io/p/aimpsvz/</guid><description>&lt;p>Go 言語で、ある型にインタフェースを実装するときは、Java などとは異なり、&lt;code>implements&lt;/code> キーワードを使ったインタフェースの明示は行いません。
Ruby や Python と同様に、同じシグネチャのメソッドを実装した時点で、そのインタフェースを備えているとみなされます。&lt;/p>
&lt;h2 id="インタフェースを定義する-type--interface">インタフェースを定義する (type &amp;hellip; interface)&lt;/h2>
&lt;p>Go 言語でインタフェースを定義するときは、構造体 (struct) の定義と同様に &lt;strong>&lt;code>type&lt;/code>&lt;/strong> キーワードを使用します。
下記は Go 言語で定義されているインタフェースの例です。&lt;/p>

&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">fmt.Stringer インタフェース&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-go" data-lang="go">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">type&lt;/span> &lt;span class="nx">Stringer&lt;/span> &lt;span class="kd">interface&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">	&lt;span class="nf">String&lt;/span>&lt;span class="p">()&lt;/span> &lt;span class="kt">string&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>


&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">io.Reader インタフェース&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-go" data-lang="go">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">type&lt;/span> &lt;span class="nx">Reader&lt;/span> &lt;span class="kd">interface&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">	&lt;span class="nf">Read&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">p&lt;/span> &lt;span class="p">[]&lt;/span>&lt;span class="kt">byte&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="nx">n&lt;/span> &lt;span class="kt">int&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">err&lt;/span> &lt;span class="kt">error&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>

&lt;p>上記の例からも想像できるように、Go 言語では、1 つのメソッドだけを持つインタフェースの名前は、&lt;strong>&lt;code>メソッド名＋er&lt;/code>&lt;/strong> とする規約となっています。&lt;/p>
&lt;ul>
&lt;li>&lt;code>String&lt;/code> 関数だけを持つ → &lt;code>Stringer&lt;/code> インタフェース&lt;/li>
&lt;li>&lt;code>Read&lt;/code> 関数だけを持つ → &lt;code>Reader&lt;/code> インタフェース&lt;/li>
&lt;li>&lt;code>Write&lt;/code> 関数だけを持つ → &lt;code>Writer&lt;/code> インタフェース&lt;/li>
&lt;li>&lt;code>Format&lt;/code> 関数だけを持つ → &lt;code>Formatter&lt;/code> インタフェース&lt;/li>
&lt;/ul>
&lt;h2 id="インタフェースを使用する">インタフェースを使用する&lt;/h2>
&lt;p>インタフェースを引数として受け取る関数を定義すると、そのインタフェースが定義するメソッドを実装しているオブジェクトだけを渡せるようになります。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-go" data-lang="go">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">func&lt;/span> &lt;span class="nf">PrintSomething&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">s&lt;/span> &lt;span class="nx">fmt&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">Stringer&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">	&lt;span class="c1">// String() メソッドを呼び出せることが保証されている
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>	&lt;span class="nx">fmt&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Println&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">s&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">String&lt;/span>&lt;span class="p">())&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>Java などの言語では、あるクラスがあるインタフェースを実装していることを示すために &lt;code>implements&lt;/code> キーワードを使用しますが、Go 言語では明示的にインタフェース名を指定して実装することはありません。
ただ単純に、インタフェースによって示されているメソッドを実装するだけで、その型はそのインタフェースを備えている（実装している）とみなされます。
このような思想は Ruby や Python でも採用されており、通称 &lt;strong>ダックタイピング&lt;/strong> と言われているものです（アヒルのように歩いて鳴けば、それはアヒルであるという考え方）。
例えば、下記の &lt;code>Book&lt;/code> 構造体は、&lt;code>String()&lt;/code> メソッドを実装しているため、Go コンパイラは &lt;code>fmt.Stringer&lt;/code> インタフェースを備えているとみなします。&lt;/p></description></item><item><title>Golang のパニックによるエラー処理 (panic, recover)</title><link>https://maku77.github.io/p/j47aswy/</link><pubDate>Mon, 11 Sep 2017 00:00:00 +0900</pubDate><guid>https://maku77.github.io/p/j47aswy/</guid><description>&lt;p>Go 言語には &lt;code>try ~ catch&lt;/code> による例外処理の仕組みは存在しませんが、&lt;strong>&lt;code>panic&lt;/code>&lt;/strong> という仕組みが用意されています。&lt;/p>
&lt;h2 id="パニックとは">パニックとは？&lt;/h2>
&lt;p>Go 言語では、関数呼び出し時に発生するエラーは、&lt;code>error&lt;/code> オブジェクトを戻り値として返す方法が採用されています（参考: &lt;a href="../p/kswy47a/">関数を定義する&lt;/a>）。
一方で、実行を継続できないランタイムエラー（スライスの範囲外アクセスなど）が発生した場合には、&lt;strong>パニック (panic)&lt;/strong> を発生させる仕組みになっています。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-go" data-lang="go">&lt;span class="line">&lt;span class="cl">&lt;span class="nx">vals&lt;/span> &lt;span class="o">:=&lt;/span> &lt;span class="p">[]&lt;/span>&lt;span class="kt">int&lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="mi">10&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">20&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">30&lt;/span>&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">println&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">vals&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="mi">3&lt;/span>&lt;span class="p">])&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// panic: runtime error: index out of range [3] with length 3
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>パニックが発生すると、デフォルトでは &lt;strong>プログラム全体が終了します&lt;/strong>。
一般的なアプリケーションではパニックは発生させるべきではなく、関数内でエラーが発生したときは &lt;code>error&lt;/code> オブジェクトを返すことが推奨されています。&lt;/p>
&lt;h2 id="パニックを発生させる-panic">パニックを発生させる (panic)&lt;/h2>
&lt;p>関数の中から明示的にパニックを発生させるには、&lt;strong>&lt;code>panic&lt;/code>&lt;/strong> 関数を呼び出します。
&lt;code>panic&lt;/code> 関数には、エラーの内容を示す &lt;code>error&lt;/code> オブジェクトを渡すことができます。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-go" data-lang="go">&lt;span class="line">&lt;span class="cl">&lt;span class="kn">import&lt;/span> &lt;span class="s">&amp;#34;errors&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kd">func&lt;/span> &lt;span class="nf">dumpBook&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">b&lt;/span> &lt;span class="o">*&lt;/span>&lt;span class="nx">Book&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">	&lt;span class="k">if&lt;/span> &lt;span class="nx">b&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="kc">nil&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">		&lt;span class="nb">panic&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">errors&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">New&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;Book cannot be nil&amp;#34;&lt;/span>&lt;span class="p">))&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">	&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">	&lt;span class="c1">// ...
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>このようにパニックの仕組みは簡単に使えてしまいますが、実行を継続できないケースに限って使用すべきです。
通常シーケンスで発生するエラーに関しては、戻り値として &lt;code>error&lt;/code> オブジェクトを返すようにし、呼び出し側で簡単にハンドルできるようにしておきましょう。&lt;/p>
&lt;p>&lt;code>panic&lt;/code> 関数の代わりに、&lt;code>log&lt;/code> パッケージの &lt;strong>&lt;code>log.Panicln&lt;/code>&lt;/strong> 関数や &lt;strong>&lt;code>log.Panicf&lt;/code>&lt;/strong> 関数を使用すると、時刻付きのログを出力したあとで、パニックを発生させてくれます。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-go" data-lang="go">&lt;span class="line">&lt;span class="cl">&lt;span class="kn">import&lt;/span> &lt;span class="s">&amp;#34;log&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kd">func&lt;/span> &lt;span class="nf">foo&lt;/span>&lt;span class="p">()&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">	&lt;span class="nx">log&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Panicln&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;Something wrong happened&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="パニックから復帰する-recover">パニックから復帰する (recover)&lt;/h2>
&lt;p>関数内の処理で、何らかのパニックが発生したとしても、あらかじめ &lt;code>defer&lt;/code> 登録された処理は、関数を抜ける前に実行されます。
この &lt;code>defer&lt;/code> 処理の中で &lt;strong>&lt;code>recover&lt;/code>&lt;/strong> 関数を呼び出すと、パニック発生時に &lt;code>panic&lt;/code> 関数に渡されたオブジェクト（通常は &lt;code>error&lt;/code> オブジェクト）を取得することができます。
パニック発生時には、通常はプログラム全体が終了しますが、&lt;code>defer&lt;/code> 処理の中で &lt;code>recover&lt;/code> を呼び出すように実装した場合、プログラムの実行は継続されます。&lt;/p></description></item><item><title>型キャストと型アサーションによる型変換</title><link>https://maku77.github.io/p/jruz369/</link><pubDate>Mon, 11 Sep 2017 00:00:00 +0900</pubDate><guid>https://maku77.github.io/p/jruz369/</guid><description>&lt;p>Go 言語では暗黙的な型キャストは許されていません。明示的な型変換関数を使用するか、Type Assertion という仕組みを使用して型の変換を行う必要があります。&lt;/p>
&lt;h2 id="型キャスト">型キャスト&lt;/h2>
&lt;p>Go 言語では暗黙的な型変換は許されていないため、下記のような異なる型の変数への代入はコンパイルエラーになります。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-go" data-lang="go">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">var&lt;/span> &lt;span class="nx">i&lt;/span> &lt;span class="kt">int&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="mi">100&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kd">var&lt;/span> &lt;span class="nx">f&lt;/span> &lt;span class="kt">float64&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="nx">i&lt;/span> &lt;span class="c1">// cannot use i (type int) as type float64
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>このようなケースでは、&lt;strong>&lt;code>型名(値)&lt;/code>&lt;/strong> という形で明示的な &lt;strong>型キャスト&lt;/strong> を行います。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-go" data-lang="go">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">var&lt;/span> &lt;span class="nx">i&lt;/span> &lt;span class="kt">int&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="mi">100&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kd">var&lt;/span> &lt;span class="nx">f&lt;/span> &lt;span class="kt">float64&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="nb">float64&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">i&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="c1">// OK
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>下記は様々な型変換の例です。&lt;/p>

&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">int8 → int32&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-go" data-lang="go">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">var&lt;/span> &lt;span class="nx">a&lt;/span> &lt;span class="kt">uint8&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="mi">100&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kd">var&lt;/span> &lt;span class="nx">b&lt;/span> &lt;span class="kt">uint32&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="nb">uint32&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">a&lt;/span>&lt;span class="p">)&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>


&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">int32 → int8&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-go" data-lang="go">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">var&lt;/span> &lt;span class="nx">a&lt;/span> &lt;span class="kt">uint32&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="mi">1234567890&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kd">var&lt;/span> &lt;span class="nx">b&lt;/span> &lt;span class="kt">uint8&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="nb">uint8&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">a&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nx">fmt&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Println&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">b&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="c1">// 210（情報が欠落する）
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>


&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">string → []byte&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-go" data-lang="go">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">var&lt;/span> &lt;span class="nx">str&lt;/span> &lt;span class="kt">string&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="s">&amp;#34;ABC&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kd">var&lt;/span> &lt;span class="nx">bytes&lt;/span> &lt;span class="p">[]&lt;/span>&lt;span class="kt">byte&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="p">[]&lt;/span>&lt;span class="nb">byte&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">str&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nx">fmt&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Println&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">bytes&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="c1">// [65 66 67]
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>


&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">[]byte → string&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-go" data-lang="go">&lt;span class="line">&lt;span class="cl">&lt;span class="nx">bytes&lt;/span> &lt;span class="o">:=&lt;/span> &lt;span class="p">[]&lt;/span>&lt;span class="kt">byte&lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="mi">65&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">66&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">67&lt;/span>&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nx">str&lt;/span> &lt;span class="o">:=&lt;/span> &lt;span class="nb">string&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">bytes&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nx">fmt&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Println&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">str&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="c1">// &amp;#34;ABC&amp;#34;
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>

&lt;h2 id="型アサーション-type-assertion-による型変換">型アサーション (Type Assertion) による型変換&lt;/h2>
&lt;p>Go 言語で任意の型の変数（型の定まっていない変数）は、空インタフェース型 (&lt;strong>&lt;code>interface{}&lt;/code>&lt;/strong>) として表現されます。
このような値を、特定の型 &lt;code>T&lt;/code> の変数に代入するには、&lt;strong>型アサーション (Type Assertion)&lt;/strong> という仕組みを使用する必要があります。
型アサーションは、下記のような構文で実行します。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-go" data-lang="go">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">var&lt;/span> &lt;span class="nx">x&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="nx">i&lt;/span>&lt;span class="p">.(&lt;/span>&lt;span class="nx">T&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nx">x&lt;/span> &lt;span class="o">:=&lt;/span> &lt;span class="nx">i&lt;/span>&lt;span class="p">.(&lt;/span>&lt;span class="nx">T&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="c1">// 関数内であればこの省略形で OK
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>これにより、空インタフェース型 (&lt;code>interface{}&lt;/code>) の変数 &lt;code>i&lt;/code> が、型 &lt;code>T&lt;/code> の変数 &lt;code>x&lt;/code> に代入されます。
空インタフェース型の &lt;code>i&lt;/code> を、型 &lt;code>T&lt;/code> に変換できない場合は &lt;a href="../p/j47aswy/">パニック&lt;/a> が発生します。&lt;/p></description></item><item><title>テンプレート機能を使用する (text/template, html/template)</title><link>https://maku77.github.io/p/z8behko/</link><pubDate>Sun, 10 Sep 2017 00:00:00 +0900</pubDate><guid>https://maku77.github.io/p/z8behko/</guid><description>&lt;p>Go には標準パッケージとしてテンプレート機能が用意されています。
テンプレート機能は、定型の Web ページ作成などに活用できます。&lt;/p>
&lt;h2 id="２つのテンプレートパッケージ">２つのテンプレートパッケージ&lt;/h2>
&lt;p>Go 言語には、組込みのテンプレート・パッケージとして、&lt;code>text/template&lt;/code> と &lt;code>html/template&lt;/code> パッケージが搭載されています。
Web ページの構築に使用する場合は、パラメータを HTML エスケープ処理してくれる &lt;code>html/template&lt;/code> パッケージの方を利用します。&lt;/p>
&lt;ul>
&lt;li>&lt;a href="https://golang.org/pkg/text/template/">text/template Package&lt;/a>&lt;/li>
&lt;li>&lt;a href="https://golang.org/pkg/html/template/">html/template Package&lt;/a>&lt;/li>
&lt;/ul>
&lt;h2 id="テンプレート機能の基本的な使い方">テンプレート機能の基本的な使い方&lt;/h2>
&lt;h3 id="template-オブジェクトの生成">Template オブジェクトの生成&lt;/h3>
&lt;p>テンプレート機能を使用するには、まずは &lt;strong>&lt;code>Template&lt;/code>&lt;/strong> オブジェクトを生成します。
テンプレートファイルを使用する場合は &lt;strong>&lt;code>template.ParseFiles&lt;/code>&lt;/strong> 関数、文字列データをテンプレートとして使用する場合は &lt;strong>&lt;code>template.Parse&lt;/code>&lt;/strong> 関数を使用します。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-go" data-lang="go">&lt;span class="line">&lt;span class="cl">&lt;span class="nx">t&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">err&lt;/span> &lt;span class="o">:=&lt;/span> &lt;span class="nx">template&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">ParseFiles&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;./template.html&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">if&lt;/span> &lt;span class="nx">err&lt;/span> &lt;span class="o">!=&lt;/span> &lt;span class="kc">nil&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">	&lt;span class="nx">log&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Fatal&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">err&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>テンプレートファイルのパース処理が成功することが分かっている場合は、次のように &lt;strong>&lt;code>template.Must&lt;/code>&lt;/strong> 関数を組み合わせて使用することで、エラー処理の記述を省略することができます（エラーになった場合は panic が発生します）。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-go" data-lang="go">&lt;span class="line">&lt;span class="cl">&lt;span class="nx">t&lt;/span> &lt;span class="o">:=&lt;/span> &lt;span class="nx">template&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Must&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">template&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">ParseFiles&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;./template.html&amp;#34;&lt;/span>&lt;span class="p">))&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="テンプレートへの値の埋め込み">テンプレートへの値の埋め込み&lt;/h3>
&lt;p>テンプレートへの値の埋め込みは、&lt;code>Template&lt;/code> オブジェクトの &lt;strong>&lt;code>Execute&lt;/code>&lt;/strong> メソッドによって行います。
第一引数には出力先、第二引数には埋め込むデータを渡します。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-go" data-lang="go">&lt;span class="line">&lt;span class="cl">&lt;span class="nx">data&lt;/span> &lt;span class="o">:=&lt;/span> &lt;span class="s">&amp;#34;Hello World&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">if&lt;/span> &lt;span class="nx">err&lt;/span> &lt;span class="o">:=&lt;/span> &lt;span class="nx">t&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Execute&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">os&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">Stdout&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">data&lt;/span>&lt;span class="p">);&lt;/span> &lt;span class="nx">err&lt;/span> &lt;span class="o">!=&lt;/span> &lt;span class="kc">nil&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">	&lt;span class="nx">log&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Fatal&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">err&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>渡されたデータは、テンプレートファイル内の、&lt;strong>&lt;code>{{ . }}&lt;/code>&lt;/strong> という部分に展開されます。
この構文は、&lt;a href="../hugo/">Hugo&lt;/a> という静的サイトジェネレーターを使っている場合はおなじみかもしれません。&lt;/p>
&lt;p>下記はシンプルなテンプレートファイルの例です。&lt;/p>

&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">template.html&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-html" data-lang="html">&lt;span class="line">&lt;span class="cl">&lt;span class="p">&amp;lt;&lt;/span>&lt;span class="nt">h1&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>{{ . }}&lt;span class="p">&amp;lt;/&lt;/span>&lt;span class="nt">h1&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>


&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">出力結果&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-html" data-lang="html">&lt;span class="line">&lt;span class="cl">&lt;span class="p">&amp;lt;&lt;/span>&lt;span class="nt">h1&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>Hello World&lt;span class="p">&amp;lt;/&lt;/span>&lt;span class="nt">h1&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>

&lt;h3 id="全体のコード">全体のコード&lt;/h3>

&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">sample.go&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-go" data-lang="go">&lt;span class="line">&lt;span class="cl">&lt;span class="kn">package&lt;/span> &lt;span class="nx">main&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kn">import&lt;/span> &lt;span class="p">(&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">	&lt;span class="s">&amp;#34;html/template&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">	&lt;span class="s">&amp;#34;log&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">	&lt;span class="s">&amp;#34;os&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kd">func&lt;/span> &lt;span class="nf">main&lt;/span>&lt;span class="p">()&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">	&lt;span class="c1">// テンプレートの読み込み
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>	&lt;span class="nx">t&lt;/span> &lt;span class="o">:=&lt;/span> &lt;span class="nx">template&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Must&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">template&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">ParseFiles&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;./template.html&amp;#34;&lt;/span>&lt;span class="p">))&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">	&lt;span class="c1">// 値の埋め込み
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>	&lt;span class="nx">data&lt;/span> &lt;span class="o">:=&lt;/span> &lt;span class="s">&amp;#34;Hello World&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">	&lt;span class="k">if&lt;/span> &lt;span class="nx">err&lt;/span> &lt;span class="o">:=&lt;/span> &lt;span class="nx">t&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Execute&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">os&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">Stdout&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">data&lt;/span>&lt;span class="p">);&lt;/span> &lt;span class="nx">err&lt;/span> &lt;span class="o">!=&lt;/span> &lt;span class="kc">nil&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">		&lt;span class="nx">log&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Fatal&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">err&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">	&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>

&lt;h2 id="テンプレートへの入力データとしてマップや構造体を使用する">テンプレートへの入力データとしてマップや構造体を使用する&lt;/h2>
&lt;p>&lt;code>Template&lt;/code> オブジェクトの &lt;code>Execute&lt;/code> メソッドには、単純な文字列だけではなく、マップや構造体を渡すこともできます（こちらの方が一般的）。
下記のコードでは、３つのキーを持つマップを渡しています。&lt;/p></description></item><item><title>Golang でファイルを読み書きする (os, io)</title><link>https://maku77.github.io/p/6eimpsv/</link><pubDate>Fri, 08 Sep 2017 00:00:00 +0900</pubDate><guid>https://maku77.github.io/p/6eimpsv/</guid><description>&lt;p>Go 言語でファイルの読み書きを行うには、&lt;strong>&lt;code>os&lt;/code>&lt;/strong> パッケージや &lt;strong>&lt;code>io&lt;/code>&lt;/strong> パッケージを使用します。&lt;/p>
&lt;h2 id="ファイルからバイトデータを読み出すioreader">ファイルからバイトデータを読み出す（io.Reader）&lt;/h2>
&lt;p>既存のファイルを読み込み用にオープンするには、&lt;strong>&lt;code>os.Open&lt;/code>&lt;/strong> 関数を使用して下記のようにします。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-go" data-lang="go">&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// ファイルを読み取りオープン
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="nx">file&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">err&lt;/span> &lt;span class="o">:=&lt;/span> &lt;span class="nx">os&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Open&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;./input.txt&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="c1">// *os.File
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="k">if&lt;/span> &lt;span class="nx">err&lt;/span> &lt;span class="o">!=&lt;/span> &lt;span class="kc">nil&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">	&lt;span class="nx">log&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Fatal&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">err&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">defer&lt;/span> &lt;span class="nx">file&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Close&lt;/span>&lt;span class="p">()&lt;/span> &lt;span class="c1">// 関数を抜けるときに自動実行
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;strong>&lt;code>defer&lt;/code>&lt;/strong> キーワードでクローズ処理を登録しておくことで、関数から抜けるときに自動的にファイルクローズを実行してくれるようになります。
ファイルを扱うときは、常にこのように記述しておくことで、関数の途中で &lt;code>return&lt;/code> したときなどのクローズ忘れを防ぐことができます。
ファイルを開いてすぐに実行すべきイディオムとして覚えておきましょう。&lt;/p>
&lt;p>ファイルのオープンに失敗すると、２番目の戻り値として &lt;code>error&lt;/code> オブジェクトが返され、下記のようなエラーメッセージを表示して終了 (&lt;code>log.Fatal&lt;/code>) します。&lt;/p>
&lt;pre tabindex="0">&lt;code>2017/09/08 23:43:40 open ./input.txt: The system cannot find the file specified.
&lt;/code>&lt;/pre>&lt;p>ファイルのオープンに成功したら、取得した &lt;code>os.File&lt;/code> オブジェクトの &lt;strong>&lt;code>Read&lt;/code>&lt;/strong> メソッドを使用して読み出し処理を行います（&lt;code>Read&lt;/code> は &lt;code>io.Reader&lt;/code> インタフェースで定義されているメソッドです）。
&lt;code>Read&lt;/code> メソッドは、引数で渡した &lt;code>[]byte&lt;/code> スライスにファイルの内容を読み込みます。
一度に読み込むサイズは、パラメータとして渡すスライスの長さ (&lt;code>len(s)&lt;/code>) になるため、あらかじめ &lt;code>make&lt;/code> 関数などを使ってスライス長を確保しておく必要があります。
&lt;code>Read&lt;/code> 関数は、ファイルの末尾まで読み込み終わると、&lt;strong>&lt;code>0, io.EOF&lt;/code>&lt;/strong> を返します。
２番目の戻り値が &lt;code>io.EOF&lt;/code> になるまで繰り返し &lt;code>Read&lt;/code> を実行するようにすれば、すべてのデータを読み出すことができます。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-go" data-lang="go">&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// 10 バイト分のバッファを用意
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="nx">buf&lt;/span> &lt;span class="o">:=&lt;/span> &lt;span class="nb">make&lt;/span>&lt;span class="p">([]&lt;/span>&lt;span class="kt">byte&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">10&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// ファイルから読み出し
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="k">for&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">	&lt;span class="nx">count&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">err&lt;/span> &lt;span class="o">:=&lt;/span> &lt;span class="nx">file&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Read&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">buf&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">	&lt;span class="k">if&lt;/span> &lt;span class="nx">err&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="nx">io&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">EOF&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">		&lt;span class="k">break&lt;/span> &lt;span class="c1">// Reached to EOF
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>	&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">	&lt;span class="k">if&lt;/span> &lt;span class="nx">err&lt;/span> &lt;span class="o">!=&lt;/span> &lt;span class="kc">nil&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">		&lt;span class="nx">log&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Fatal&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">err&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">	&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">	&lt;span class="nx">fmt&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Printf&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;%q\n&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">buf&lt;/span>&lt;span class="p">[:&lt;/span>&lt;span class="nx">count&lt;/span>&lt;span class="p">])&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>下記は、サンプルの入力ファイルと、実行可能な全体のコード、実行結果です。
ここでは、分かりやすさのために入力ファイルとしてテキストファイル (&lt;code>input.txt&lt;/code>) を使用していますが、&lt;code>Read&lt;/code> メソッドによる読み出しは、通常はバイナリファイルを扱うことを想定しています。&lt;/p></description></item><item><title>マップを扱う (map)</title><link>https://maku77.github.io/p/5cgjnqt/</link><pubDate>Tue, 05 Sep 2017 00:00:00 +0900</pubDate><guid>https://maku77.github.io/p/5cgjnqt/</guid><description>&lt;p>Go 言語でマップを定義するには、&lt;strong>&lt;code>map&lt;/code>&lt;/strong> キーワードを使用します。&lt;/p>
&lt;h2 id="マップを定義する-map">マップを定義する (map)&lt;/h2>
&lt;p>Go 言語のマップ型は、&lt;strong>&lt;code>map[キーの型]値の型&lt;/code>&lt;/strong> のように表現します。
どこにもスペースをいれないことに注意してください（&lt;code>go fmt&lt;/code> コマンドで自動的にこのようにフォーマットされます）。&lt;/p>
&lt;p>例えば、キーの型を &lt;code>string&lt;/code>、値の型を &lt;code>int&lt;/code> とするマップは次のように作成できます。&lt;/p>

&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">空のマップを作る方法&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-go" data-lang="go">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">var&lt;/span> &lt;span class="nx">m&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="kd">map&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="kt">string&lt;/span>&lt;span class="p">]&lt;/span>&lt;span class="kt">int&lt;/span>&lt;span class="p">{}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nx">m&lt;/span> &lt;span class="o">:=&lt;/span> &lt;span class="kd">map&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="kt">string&lt;/span>&lt;span class="p">]&lt;/span>&lt;span class="kt">int&lt;/span>&lt;span class="p">{}&lt;/span> &lt;span class="c1">// 関数内ではこの省略形が使える
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="nx">m&lt;/span> &lt;span class="o">:=&lt;/span> &lt;span class="nb">make&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="kd">map&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="kt">string&lt;/span>&lt;span class="p">]&lt;/span>&lt;span class="kt">int&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="c1">// make を使う方法
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>

&lt;p>次のように初期値を指定せずにマップを作成するとゼロ値 (nil) になります。
要素数ゼロのマップとして参照はできますが、要素を追加しようとすると panic が発生します。&lt;/p>

&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">あまり意味のない nil マップの作成方法&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-go" data-lang="go">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">var&lt;/span> &lt;span class="nx">m&lt;/span> &lt;span class="kd">map&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="kt">string&lt;/span>&lt;span class="p">]&lt;/span>&lt;span class="kt">int&lt;/span> &lt;span class="c1">// これはゼロ値 (nil) になる
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="nb">println&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nb">len&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">m&lt;/span>&lt;span class="p">))&lt;/span> &lt;span class="c1">// 0
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="nx">m&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="s">&amp;#34;maku&amp;#34;&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="mi">14&lt;/span> &lt;span class="c1">// panic
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>

&lt;p>&lt;a href="../p/cjosvz3/">配列やスライス&lt;/a> と同様、初期値を同時に設定してしまうこともできます（前述の例では初期値を空っぽ &lt;code>{}&lt;/code> にしています）。
下記のように複数行に分けて初期値を記述する場合、最後の要素の後ろのカンマは省略できないことに注意してください。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-go" data-lang="go">&lt;span class="line">&lt;span class="cl">&lt;span class="nx">m&lt;/span> &lt;span class="o">:=&lt;/span> &lt;span class="kd">map&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="kt">string&lt;/span>&lt;span class="p">]&lt;/span>&lt;span class="kt">int&lt;/span>&lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">	&lt;span class="s">&amp;#34;maku&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mi">14&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">	&lt;span class="s">&amp;#34;puni&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mi">7&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">	&lt;span class="s">&amp;#34;hemu&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mi">10&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nx">fmt&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Printf&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;%v\n&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">m&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="c1">//=&amp;gt; map[maku:14 puni:7 hemu:10]
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>マップ要素を参照するときは、配列やスライスと同様に &lt;code>[]&lt;/code> を使用してキーを指定します。
存在しないキーを指定して新しい値を設定することもできます。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-go" data-lang="go">&lt;span class="line">&lt;span class="cl">&lt;span class="nx">i&lt;/span> &lt;span class="o">:=&lt;/span> &lt;span class="nx">m&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="s">&amp;#34;maku&amp;#34;&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="c1">// 既存の要素の取得
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="nx">m&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="s">&amp;#34;panyo&amp;#34;&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="mi">20&lt;/span> &lt;span class="c1">// 新しい要素を追加
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="マップの要素を-for-ループで処理する-range">マップの要素を for ループで処理する (range)&lt;/h2>
&lt;p>マップの要素は、配列やスライスと同様に for ループと &lt;strong>&lt;code>range&lt;/code>&lt;/strong> を使ってひとつずつ取得することができます。&lt;/p></description></item><item><title>メソッドを定義する（レシーバ付き関数）</title><link>https://maku77.github.io/p/4behkor/</link><pubDate>Tue, 05 Sep 2017 00:00:00 +0900</pubDate><guid>https://maku77.github.io/p/4behkor/</guid><description>&lt;p>Go 言語にはクラスは存在しませんが、構造体型にメソッドを追加するという方法で同様のことを実現することができます。
メソッドは次のような文法で定義します。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-go" data-lang="go">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">func&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="nx">レシーバ&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="nx">関数名&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">パラメータ&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="nx">戻り値&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">...&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>通常の関数定義の関数名の前に、&lt;code>(レシーバ)&lt;/code> という部分が追加されただけです。
例えば、下記の &lt;code>raisePrice&lt;/code> メソッドは、レシーバとして &lt;code>Book&lt;/code> オブジェクトを受け取り、そのフィールド値を書き換えます。
パラメータと戻り値はありません。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-go" data-lang="go">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">func&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="nx">b&lt;/span> &lt;span class="o">*&lt;/span>&lt;span class="nx">Book&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="nf">raisePrice&lt;/span>&lt;span class="p">()&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">	&lt;span class="nx">b&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">Price&lt;/span> &lt;span class="o">*=&lt;/span> &lt;span class="mi">2&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>フィールド値を書き換える場合は、このようにレシーバをポインタ型で指定する必要があります。
このメソッドを呼び出すには、次のようにレシーバとして渡すオブジェクトにドットを付けて呼び出します。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-go" data-lang="go">&lt;span class="line">&lt;span class="cl">&lt;span class="nx">b&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">raisePrice&lt;/span>&lt;span class="p">()&lt;/span> &lt;span class="c1">// raisePrice メソッドの呼び出し
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>下記は、完全に動作するサンプルコードです。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-go" data-lang="go">&lt;span class="line">&lt;span class="cl">&lt;span class="kn">package&lt;/span> &lt;span class="nx">main&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// Book 構造体を定義
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="kd">type&lt;/span> &lt;span class="nx">Book&lt;/span> &lt;span class="kd">struct&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">	&lt;span class="nx">Title&lt;/span> &lt;span class="kt">string&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">	&lt;span class="nx">Price&lt;/span> &lt;span class="kt">int&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// Book 構造体にメソッドを追加
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="kd">func&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="nx">b&lt;/span> &lt;span class="o">*&lt;/span>&lt;span class="nx">Book&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="nf">raisePrice&lt;/span>&lt;span class="p">()&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">	&lt;span class="nx">b&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">Price&lt;/span> &lt;span class="o">*=&lt;/span> &lt;span class="mi">2&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kd">func&lt;/span> &lt;span class="nf">main&lt;/span>&lt;span class="p">()&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">	&lt;span class="nx">b&lt;/span> &lt;span class="o">:=&lt;/span> &lt;span class="nx">Book&lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="nx">Title&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s">&amp;#34;Golang&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">Price&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mi">2500&lt;/span>&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">	&lt;span class="nb">println&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">b&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">Price&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="c1">// 2500
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>	&lt;span class="nx">b&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">raisePrice&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">	&lt;span class="nb">println&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">b&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">Price&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="c1">// 5000
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div></description></item><item><title>構造体を定義する (struct)</title><link>https://maku77.github.io/p/8z2o63r/</link><pubDate>Tue, 05 Sep 2017 00:00:00 +0900</pubDate><guid>https://maku77.github.io/p/8z2o63r/</guid><description>&lt;p>Go 言語の構造体は、&lt;strong>&lt;code>struct&lt;/code>&lt;/strong> というキーワードを使って定義します。&lt;/p>
&lt;h2 id="構造体の基本">構造体の基本&lt;/h2>
&lt;p>構造体は、複数のデータをまとめて扱うためのデータ構造です。
下記の例では、書籍のタイトルと著者、値段をフィールドとして持つ &lt;code>Book&lt;/code> という構造体を定義しています。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-go" data-lang="go">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">type&lt;/span> &lt;span class="nx">Book&lt;/span> &lt;span class="kd">struct&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">	&lt;span class="nx">Title&lt;/span> &lt;span class="kt">string&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">	&lt;span class="nx">Authors&lt;/span> &lt;span class="p">[]&lt;/span>&lt;span class="kt">string&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">	&lt;span class="nx">Price&lt;/span> &lt;span class="kt">int&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;a href="../p/cuxyj8c">組込み型に別名を付ける&lt;/a> ときには &lt;code>type Age int&lt;/code> のように記述しますが、この後ろの &lt;code>int&lt;/code> の部分が &lt;code>struct {...}&lt;/code> という記述に置き換わったと考えればよいでしょう。&lt;/p>
&lt;p>定義した構造体は下記のように使用することができます。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-go" data-lang="go">&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// Book 構造体を定義する
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="kd">type&lt;/span> &lt;span class="nx">Book&lt;/span> &lt;span class="kd">struct&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">	&lt;span class="nx">Title&lt;/span> &lt;span class="kt">string&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">	&lt;span class="nx">Authors&lt;/span> &lt;span class="p">[]&lt;/span>&lt;span class="kt">string&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">	&lt;span class="nx">Price&lt;/span> &lt;span class="kt">int&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kd">func&lt;/span> &lt;span class="nf">main&lt;/span>&lt;span class="p">()&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">	&lt;span class="c1">// Book オブジェクトを生成する
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>	&lt;span class="nx">b&lt;/span> &lt;span class="o">:=&lt;/span> &lt;span class="nx">Book&lt;/span>&lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">		&lt;span class="nx">Title&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s">&amp;#34;Golang ABC&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">		&lt;span class="nx">Authors&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">[]&lt;/span>&lt;span class="kt">string&lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="s">&amp;#34;Maku&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s">&amp;#34;Moja&amp;#34;&lt;/span>&lt;span class="p">},&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">		&lt;span class="nx">Price&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mi">2500&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">	&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">	&lt;span class="c1">// 各フィールドの値を参照する
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>	&lt;span class="nx">fmt&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Println&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">b&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">Title&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="c1">// Golang ABC
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>	&lt;span class="nx">fmt&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Println&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">b&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">Authors&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="c1">// [Maku Moja]
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>	&lt;span class="nx">fmt&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Println&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">b&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">Price&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="c1">// 2500
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>この例では、各フィールドの &lt;strong>名前を大文字で始めている&lt;/strong>（例えば &lt;code>Title&lt;/code>）ので、そのフィールドは別のパッケージからも参照可能なフィールドとして公開されます。
逆に小文字で始める（例えば &lt;code>title&lt;/code>）ように定義すると、そのフィールドは同じパッケージ内のコードからのみ参照できるようになります（≒ 同じディレクトリ内の .go ファイルであれば参照できる）。&lt;/p>
&lt;p>ちなみに、オブジェクトを生成するときに、下記のようにフィールド名を省略して初期値を設定することもできます。
その場合は、構造体定義時と同じ順序で、すべてのフィールドの初期値を指定する必要があります。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-go" data-lang="go">&lt;span class="line">&lt;span class="cl">&lt;span class="nx">b&lt;/span> &lt;span class="o">:=&lt;/span> &lt;span class="nx">Book&lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="s">&amp;#34;Golang ABC&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="p">[]&lt;/span>&lt;span class="kt">string&lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="s">&amp;#34;Maku&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s">&amp;#34;Moja&amp;#34;&lt;/span>&lt;span class="p">},&lt;/span> &lt;span class="mi">2500&lt;/span>&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>フィールド名を指定する方法であれば、任意のフィールドの初期値を省略してオブジェクトを生成することができます。
省略したフィールドの値は、その型の &lt;a href="../p/5dhkoru/">ゼロ値&lt;/a> となります。&lt;/p></description></item><item><title>組込み型に独自の型名を付ける (type)</title><link>https://maku77.github.io/p/cuxyj8c/</link><pubDate>Tue, 05 Sep 2017 00:00:00 +0900</pubDate><guid>https://maku77.github.io/p/cuxyj8c/</guid><description>&lt;h2 id="独自型を定義する">独自型を定義する&lt;/h2>
&lt;p>Go 言語で &lt;strong>&lt;code>type&lt;/code>&lt;/strong> キーワードを使用すると、組込み型に新しい名前を付けることができます。
これは単なるエイリアスではなく新しい型として認識されるので、コンパイル時の型チェックの対象となり、コーディングミスを減らすことができます。
また、自身の値を操作対象とするメソッドを追加することができます。&lt;/p>
&lt;p>次のような構文で、既存の組込み型をベースにして、新しい型を定義することができます。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-go" data-lang="go">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">type&lt;/span> &lt;span class="nx">型名&lt;/span> &lt;span class="nx">既存の型&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>下記の例では、&lt;code>string&lt;/code> 型と同じように使用できる &lt;code>Title&lt;/code> 型と &lt;code>Author&lt;/code> 型を定義しています。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-go" data-lang="go">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">type&lt;/span> &lt;span class="nx">Title&lt;/span> &lt;span class="kt">string&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kd">type&lt;/span> &lt;span class="nx">Author&lt;/span> &lt;span class="kt">string&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="独自型で型安全なコードを記述する">独自型で型安全なコードを記述する&lt;/h2>
&lt;p>独自に定義した型を関数のパラメータの型として使うことで、コンパイル時に正しい型のデータが渡されているかをチェックしてくれるようになります。&lt;/p>

&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">独自型を使った型安全なコード&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-go" data-lang="go">&lt;span class="line">&lt;span class="cl">&lt;span class="kn">package&lt;/span> &lt;span class="nx">main&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kn">import&lt;/span> &lt;span class="s">&amp;#34;fmt&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kd">type&lt;/span> &lt;span class="nx">Title&lt;/span> &lt;span class="kt">string&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kd">type&lt;/span> &lt;span class="nx">Author&lt;/span> &lt;span class="kt">string&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kd">func&lt;/span> &lt;span class="nf">printBook&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">title&lt;/span> &lt;span class="nx">Title&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">author&lt;/span> &lt;span class="nx">Author&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">	&lt;span class="nx">fmt&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Printf&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;Title:&amp;#39;%s&amp;#39;, Author:&amp;#39;%s&amp;#39;\n&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">title&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">author&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kd">func&lt;/span> &lt;span class="nf">main&lt;/span>&lt;span class="p">()&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">	&lt;span class="nx">t&lt;/span> &lt;span class="o">:=&lt;/span> &lt;span class="nf">Title&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;Golang ABC&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="c1">// var t Title = &amp;#34;Golang ABC&amp;#34; でも OK
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>	&lt;span class="nx">a&lt;/span> &lt;span class="o">:=&lt;/span> &lt;span class="nf">Author&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;Maku&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="c1">// var a Author = &amp;#34;Maku&amp;#34; でも OK
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>	&lt;span class="nf">printBook&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">t&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">a&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>

&lt;p>上記の &lt;code>printBook&lt;/code> 関数は、パラメータとして &lt;code>Title&lt;/code>、&lt;code>Author&lt;/code> 型の値を受け取るように定義しているため、組み込み型の &lt;code>string&lt;/code> 変数を渡そうとするとコンパイルエラーになります。&lt;/p>

&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">エラーになる例&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-go" data-lang="go">&lt;span class="line">&lt;span class="cl">&lt;span class="nx">t&lt;/span> &lt;span class="o">:=&lt;/span> &lt;span class="s">&amp;#34;Golang ABC&amp;#34;&lt;/span> &lt;span class="c1">// これは標準の string 型
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="nx">a&lt;/span> &lt;span class="o">:=&lt;/span> &lt;span class="s">&amp;#34;Maku&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nf">printBook&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">t&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">a&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="c1">// Error: cannot use t (type string) as type Title
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>

&lt;p>このチェックのおかげで、&lt;code>Title&lt;/code> と &lt;code>Author&lt;/code> の順番を間違えて渡してしまうといったコーディングミスを防ぐことができます。
ただし、下記のように文字列リテラルを直接渡してしまうと、コンパイルエラーとしては検出してくれないので注意してください。&lt;/p></description></item><item><title>ポインタを扱う (＊)</title><link>https://maku77.github.io/p/vpz8fnv/</link><pubDate>Mon, 04 Sep 2017 00:00:00 +0900</pubDate><guid>https://maku77.github.io/p/vpz8fnv/</guid><description>&lt;p>Go 言語には、C/C++ と同様にポインタが存在します。構文もかなり似ていますが、簡潔に記述できるような工夫がされています。&lt;/p>
&lt;h2 id="go-言語のポインタの基本">Go 言語のポインタの基本&lt;/h2>
&lt;p>Go 言語では、変数の型のプレフィックスとしてアスタリスク (&lt;strong>&lt;code>*&lt;/code>&lt;/strong>) を付けると、ポインタ型の変数になります。
ポインタ変数は、その型の値が格納されているメモリアドレスを保持します。
ポインタ変数のゼロ値（初期値）は &lt;strong>&lt;code>nil&lt;/code>&lt;/strong> です。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-go" data-lang="go">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">var&lt;/span> &lt;span class="nx">p&lt;/span> &lt;span class="o">*&lt;/span>&lt;span class="kt">int&lt;/span> &lt;span class="c1">// p is a pointer to int
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="nx">fmt&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Printf&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;%v\n&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">p&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="c1">// &amp;lt;nil&amp;gt;
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>既存の変数のアドレスは &lt;strong>&lt;code>&amp;amp;&lt;/code>&lt;/strong> プレフィックスをつけて取得できます。
次の例では、&lt;code>int&lt;/code> 型変数 &lt;code>i&lt;/code> のアドレスを &lt;code>p&lt;/code> に格納しています。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-go" data-lang="go">&lt;span class="line">&lt;span class="cl">&lt;span class="nx">i&lt;/span> &lt;span class="o">:=&lt;/span> &lt;span class="mi">100&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nx">p&lt;/span> &lt;span class="o">:=&lt;/span> &lt;span class="o">&amp;amp;&lt;/span>&lt;span class="nx">i&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nx">fmt&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Printf&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;%v (%T)\n&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">i&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">i&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="c1">// 100 (int)
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="nx">fmt&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Printf&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;%v (%T)\n&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">p&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">p&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="c1">// 0xc00018a000 (*int)
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>逆にポインタが指し示す値にアクセスするには、ポインタ変数の前に &lt;strong>&lt;code>*&lt;/code>&lt;/strong> を付けて参照します。
下記の例では、ポインタ経由で参照先の値を書き換えています。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-go" data-lang="go">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">var&lt;/span> &lt;span class="nx">i&lt;/span> &lt;span class="kt">int&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="mi">100&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kd">var&lt;/span> &lt;span class="nx">p&lt;/span> &lt;span class="o">*&lt;/span>&lt;span class="kt">int&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="o">&amp;amp;&lt;/span>&lt;span class="nx">i&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nx">fmt&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Println&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">i&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="c1">//=&amp;gt; 100
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="nx">fmt&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Println&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">*&lt;/span>&lt;span class="nx">p&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="c1">//=&amp;gt; 100
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="o">*&lt;/span>&lt;span class="nx">p&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="mi">200&lt;/span> &lt;span class="c1">// ポインタ経由で値を書き換える
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="nx">fmt&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Println&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">i&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="c1">//=&amp;gt; 200
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="nx">fmt&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Println&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">*&lt;/span>&lt;span class="nx">p&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="c1">//=&amp;gt; 200
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>このあたりのポインタの文法は、C/C++ 言語とほとんど同じです。
ただし、Go 言語ではポインタ演算（アドレスの足し算など）を行うことはできません。
そういったアクセスを禁止することで、不正なメモリアドレスへアクセスしてしまう危険性を排除しています。&lt;/p>
&lt;h2 id="関数内から呼び出し元の変数の値を書き換える">関数内から呼び出し元の変数の値を書き換える&lt;/h2>
&lt;p>Go 言語の関数のパラメーターは、通常は値渡し（値のコピーが渡される）となるため、下記のような関数を実行しても呼び出し側の数値を変更することはできません。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-go" data-lang="go">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">func&lt;/span> &lt;span class="nf">add100&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">n&lt;/span> &lt;span class="kt">int&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">	&lt;span class="nx">n&lt;/span> &lt;span class="o">+=&lt;/span> &lt;span class="mi">100&lt;/span> &lt;span class="c1">// 呼び出し側の値は変更されない
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>関数のパラメーターをポインタ型にすると、呼び出し元の変数が格納されているメモリアドレスを受け取ることができます。
そのメモリアドレスに格納されている値を、関数内から直接書き換えることができるようになるため、結果的に呼び出し側でパラメーターとして渡した変数の値を書き換えることができます。
下記のコードでは、&lt;code>int&lt;/code> のポインタを受け取り、呼び出し側の &lt;code>int&lt;/code> 変数の値を変更しています。&lt;/p></description></item><item><title>Go 言語の組込み型一覧</title><link>https://maku77.github.io/p/as29hpw/</link><pubDate>Fri, 01 Sep 2017 00:00:00 +0900</pubDate><guid>https://maku77.github.io/p/as29hpw/</guid><description>&lt;p>Go 言語には次のような組込み型が定義されています。&lt;/p>
&lt;ul>
&lt;li>真偽値
&lt;ul>
&lt;li>&lt;strong>&lt;code>bool&lt;/code>&lt;/strong> &amp;hellip; &lt;code>true&lt;/code> or &lt;code>false&lt;/code>&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>文字列
&lt;ul>
&lt;li>&lt;strong>&lt;code>string&lt;/code>&lt;/strong> &amp;hellip; 文字列。文字列リテラルは、&lt;code>&amp;quot;あいうえお&amp;quot;&lt;/code> のようにダブルクォートで囲んで表現する。文字列は immutable（不変）であり、文字列の内容を部分的に書き換えることはできない（1 文字でも違う場合は、必ず別の文字列を作成する必要がある）。空文字列 (&lt;code>&amp;quot;&amp;quot;&lt;/code>) は格納できるが、&lt;code>nil&lt;/code> は格納できない。&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>数値
&lt;ul>
&lt;li>整数
&lt;ul>
&lt;li>&lt;strong>&lt;code>int&lt;/code>&lt;/strong> &amp;hellip; システム依存サイズの符号あり整数（ただし、少なくとも 32 ビット以上）&lt;/li>
&lt;li>&lt;strong>&lt;code>int8&lt;/code>&lt;/strong> &amp;hellip; 8 ビット符号あり整数&lt;/li>
&lt;li>&lt;strong>&lt;code>int16&lt;/code>&lt;/strong> &amp;hellip; 16 ビット符号あり整数&lt;/li>
&lt;li>&lt;strong>&lt;code>int32&lt;/code>&lt;/strong> &amp;hellip; 32 ビット符号あり整数&lt;/li>
&lt;li>&lt;strong>&lt;code>int64&lt;/code>&lt;/strong> &amp;hellip; 64 ビット符号あり整数&lt;/li>
&lt;li>&lt;strong>&lt;code>uint&lt;/code>&lt;/strong> &amp;hellip; システム依存サイズの符号なし整数（ただし、少なくとも 32 ビット以上）&lt;/li>
&lt;li>&lt;strong>&lt;code>uint8&lt;/code>&lt;/strong> &amp;hellip; 8 ビット符号なし整数&lt;/li>
&lt;li>&lt;strong>&lt;code>uint16&lt;/code>&lt;/strong> &amp;hellip; 16 ビット符号なし整数&lt;/li>
&lt;li>&lt;strong>&lt;code>uint32&lt;/code>&lt;/strong> &amp;hellip; 32 ビット符号なし整数&lt;/li>
&lt;li>&lt;strong>&lt;code>uint64&lt;/code>&lt;/strong> &amp;hellip; 64 ビット符号なし整数&lt;/li>
&lt;li>&lt;strong>&lt;code>byte&lt;/code>&lt;/strong> &amp;hellip; &lt;code>uint8&lt;/code> のエイリアス&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>浮動小数点数
&lt;ul>
&lt;li>&lt;strong>&lt;code>float32&lt;/code>&lt;/strong> &amp;hellip; 32 ビット浮動小数点数&lt;/li>
&lt;li>&lt;strong>&lt;code>float64&lt;/code>&lt;/strong> &amp;hellip; 64 ビット浮動小数点数&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>複素数
&lt;ul>
&lt;li>&lt;strong>&lt;code>complex64&lt;/code>&lt;/strong> &amp;hellip; 64 ビット複素数&lt;/li>
&lt;li>&lt;strong>&lt;code>complex128&lt;/code>&lt;/strong> &amp;hellip; 128 ビット複素数&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>ポインタ
&lt;ul>
&lt;li>&lt;strong>&lt;code>uintptr&lt;/code>&lt;/strong> &amp;hellip; ポインタ値（アドレス）を格納する、システム依存サイズの符号なし整数&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>文字
&lt;ul>
&lt;li>&lt;strong>&lt;code>rune&lt;/code>&lt;/strong> &amp;hellip; １文字を表す（Unicode のコードポイント）。&lt;code>int32&lt;/code> のエイリアス。文字リテラルは、&lt;code>'あ'&lt;/code> のようにシングルクォートで囲んで表現する。&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>エラー用インタフェース
&lt;ul>
&lt;li>&lt;strong>&lt;code>error&lt;/code>&lt;/strong>&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul></description></item><item><title>変数を定義する (var)／ゼロ値について</title><link>https://maku77.github.io/p/5dhkoru/</link><pubDate>Fri, 01 Sep 2017 00:00:00 +0900</pubDate><guid>https://maku77.github.io/p/5dhkoru/</guid><description>&lt;p>Go 言語では明示的に型を指定した変数定義と、コンパイラによる型推論を利用した変数定義を行うことができます。&lt;/p>
&lt;h2 id="変数定義の基本">変数定義の基本&lt;/h2>
&lt;p>Go 言語では、&lt;strong>&lt;code>var&lt;/code>&lt;/strong> キーワードを使用して、&lt;code>var 変数名 型名&lt;/code> というフォーマットで変数定義します。
Pascal や Ada のように、型名を後ろに指定することに注意してください。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-go" data-lang="go">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">var&lt;/span> &lt;span class="nx">x&lt;/span> &lt;span class="kt">int&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>同じ型の変数を複数定義するときは、下記のように型名を一度だけ記述するだけで済みます（逆に、&lt;code>var x int, y int, z int&lt;/code> のように冗長に記述することはできません）。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-go" data-lang="go">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">var&lt;/span> &lt;span class="nx">x&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">y&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">z&lt;/span> &lt;span class="kt">int&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>括弧を使用して複数行に分けて変数定義することもできます。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-go" data-lang="go">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">var&lt;/span> &lt;span class="p">(&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">	&lt;span class="nx">name&lt;/span> &lt;span class="kt">string&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">	&lt;span class="nx">age&lt;/span> &lt;span class="kt">int&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="変数の初期値を指定する">変数の初期値を指定する&lt;/h2>
&lt;p>&lt;strong>&lt;code>=&lt;/code>&lt;/strong> キーワードを使用して、変数の初期値を指定することができます。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-go" data-lang="go">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">var&lt;/span> &lt;span class="nx">x&lt;/span> &lt;span class="kt">int&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="mi">100&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kd">var&lt;/span> &lt;span class="nx">a&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">b&lt;/span> &lt;span class="kt">int&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="mi">100&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">200&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kd">var&lt;/span> &lt;span class="p">(&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">	&lt;span class="nx">name&lt;/span> &lt;span class="kt">string&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="s">&amp;#34;Rei Ayanami&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">	&lt;span class="nx">age&lt;/span> &lt;span class="kt">int&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="mi">14&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>Go には型推論の仕組みが備わっているため、変数の初期値を指定する場合は、型の記述を省略することができます。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-go" data-lang="go">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">var&lt;/span> &lt;span class="nx">x&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="mi">100&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kd">var&lt;/span> &lt;span class="nx">a&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">b&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="mi">100&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">200&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kd">var&lt;/span> &lt;span class="p">(&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">	&lt;span class="nx">name&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="s">&amp;#34;Rei Ayanami&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">	&lt;span class="nx">age&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="mi">14&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>関数の中で変数を定義するときは、&lt;strong>&lt;code>:=&lt;/code>&lt;/strong> を使用することで &lt;code>var&lt;/code> と型の記述を両方とも省略することができます。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-go" data-lang="go">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">func&lt;/span> &lt;span class="nf">hello&lt;/span>&lt;span class="p">()&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">	&lt;span class="nx">s&lt;/span> &lt;span class="o">:=&lt;/span> &lt;span class="s">&amp;#34;yatta-ne&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">	&lt;span class="nx">x&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">y&lt;/span> &lt;span class="o">:=&lt;/span> &lt;span class="mi">100&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">200&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">	&lt;span class="c1">// ...
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>ちなみに、変数の型は &lt;code>fmt.Printf&lt;/code> 関数のフォーマット文字列で &lt;strong>&lt;code>%T&lt;/code>&lt;/strong> を指定して確認することができます。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-go" data-lang="go">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">func&lt;/span> &lt;span class="nf">main&lt;/span>&lt;span class="p">()&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">	&lt;span class="nx">x&lt;/span> &lt;span class="o">:=&lt;/span> &lt;span class="mi">100&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">	&lt;span class="nx">fmt&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Printf&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;%T\n&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">x&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="c1">//=&amp;gt; int
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="変数のグルーピング">変数のグルーピング&lt;/h2>
&lt;p>&lt;code>var ( ... )&lt;/code> というシンタックスは、変数のグルーピングのために利用することもできます。
下記は、本家の &lt;a href="https://golang.org/doc/effective_go.html#commentary">Effective Go (Commentary)&lt;/a> からの抜粋ですが、エラー情報を表す変数を &lt;code>var ( ... )&lt;/code> でグループ化して定義し、グループに対してコメントを付加しています。&lt;/p></description></item><item><title>構造体のコンストラクタ（ファクトリ関数）を定義する</title><link>https://maku77.github.io/p/6dhkoru/</link><pubDate>Fri, 01 Sep 2017 00:00:00 +0900</pubDate><guid>https://maku77.github.io/p/6dhkoru/</guid><description>&lt;p>Go 言語には構造体のコンストラクタ用の文法は用意されていません。
通常の関数の形で構造体のファクトリ関数を実装します。
ただ、簡単なプログラムであれば、下記のような初期化リストを使ったオブジェクト生成で間に合ってしまいます。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-go" data-lang="go">&lt;span class="line">&lt;span class="cl">&lt;span class="nx">b&lt;/span> &lt;span class="o">:=&lt;/span> &lt;span class="nx">Book&lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="nx">Title&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s">&amp;#34;Title&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">Price&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mi">2500&lt;/span>&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>任意のパラメータからオブジェクトを生成できるようにしたい場合は、&lt;strong>&lt;code>New&lt;/code> で始まる名前のファクトリ関数を作成し、構造体のポインタを返す&lt;/strong> のが慣例となっています。&lt;/p>

&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">book/book.go&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-go" data-lang="go">&lt;span class="line">&lt;span class="cl">&lt;span class="kn">package&lt;/span> &lt;span class="nx">book&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kd">type&lt;/span> &lt;span class="nx">Book&lt;/span> &lt;span class="kd">struct&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">	&lt;span class="nx">Title&lt;/span> &lt;span class="kt">string&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">	&lt;span class="nx">Author&lt;/span> &lt;span class="kt">string&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">	&lt;span class="nx">Price&lt;/span> &lt;span class="kt">int&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kd">func&lt;/span> &lt;span class="nf">NewAuthorlessBook&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">title&lt;/span> &lt;span class="kt">string&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="o">*&lt;/span>&lt;span class="nx">Book&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">	&lt;span class="k">return&lt;/span> &lt;span class="o">&amp;amp;&lt;/span>&lt;span class="nx">Book&lt;/span>&lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">		&lt;span class="nx">Title&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="nx">title&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">		&lt;span class="nx">Author&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s">&amp;#34;Unknown Author&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">		&lt;span class="nx">Price&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mi">100&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">	&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>

&lt;p>上記では、&lt;code>book&lt;/code> パッケージの中で &lt;code>Book&lt;/code> 構造体とそのファクトリ関数を定義してみました。
外部の &lt;code>main&lt;/code> パッケージから使用する場合は、下記のような感じのコードになります。&lt;/p>

&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">main.go&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-go" data-lang="go">&lt;span class="line">&lt;span class="cl">&lt;span class="kn">package&lt;/span> &lt;span class="nx">main&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kn">import&lt;/span> &lt;span class="s">&amp;#34;fmt&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kn">import&lt;/span> &lt;span class="s">&amp;#34;local.packages/book&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kd">func&lt;/span> &lt;span class="nf">main&lt;/span>&lt;span class="p">()&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">	&lt;span class="nx">b&lt;/span> &lt;span class="o">:=&lt;/span> &lt;span class="nx">book&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">NewAuthorlessBook&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;The World&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">	&lt;span class="nx">fmt&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Printf&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;%+v\n&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">b&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>


&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">実行結果&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-console" data-lang="console">&lt;span class="line">&lt;span class="cl">&lt;span class="gp">$&lt;/span> go run main.go
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">&amp;amp;{Title:The World Author:Unknown Author Price:100}
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure></description></item><item><title>配列とスライスを扱う</title><link>https://maku77.github.io/p/cjosvz3/</link><pubDate>Fri, 01 Sep 2017 00:00:00 +0900</pubDate><guid>https://maku77.github.io/p/cjosvz3/</guid><description>&lt;p>Go 言語の配列は固定長ですが、スライスを組み合わせて使用することで、可変長配列のように扱うことができます。&lt;/p>
&lt;h2 id="配列定義の基本-n-">配列定義の基本 ([n], [&amp;hellip;])&lt;/h2>
&lt;p>Go で配列を定義するときは、変数の型名の前に &lt;strong>&lt;code>[サイズ]&lt;/code>&lt;/strong> プレフィックスを付けて定義します。
例えば、サイズ 3 の &lt;code>int&lt;/code> 配列を定義するには次のようにします。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-go" data-lang="go">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">var&lt;/span> &lt;span class="nx">arr&lt;/span> &lt;span class="p">[&lt;/span>&lt;span class="mi">3&lt;/span>&lt;span class="p">]&lt;/span>&lt;span class="kt">int&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;strong>variable arr is array 3 of int.&lt;/strong> と自然な英文として読めるような文法になっています。
配列の各要素には、Java や C/C++ のように 0 から始まるインデックスを指定してアクセスすることができます。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-go" data-lang="go">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">var&lt;/span> &lt;span class="nx">arr&lt;/span> &lt;span class="p">[&lt;/span>&lt;span class="mi">3&lt;/span>&lt;span class="p">]&lt;/span>&lt;span class="kt">int&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nx">arr&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="mi">100&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nx">arr&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="mi">200&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nx">arr&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="mi">2&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="mi">300&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nx">fmt&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Println&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">arr&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="c1">//=&amp;gt; [100 200 300]
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// 下記はビルドエラー (invalid argument: array index 3 out of bounds [0:3])
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// arr[3] = 400
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>次のようにすれば、配列定義と同時に &lt;strong>初期値&lt;/strong> を設定することができます。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-go" data-lang="go">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">var&lt;/span> &lt;span class="nx">arr&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="p">[&lt;/span>&lt;span class="mi">3&lt;/span>&lt;span class="p">]&lt;/span>&lt;span class="kt">int&lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="mi">100&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">200&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">300&lt;/span>&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// 関数内であれば次のように書ける
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="nx">arr&lt;/span> &lt;span class="o">:=&lt;/span> &lt;span class="p">[&lt;/span>&lt;span class="mi">3&lt;/span>&lt;span class="p">]&lt;/span>&lt;span class="kt">int&lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="mi">100&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">200&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">300&lt;/span>&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>初期値と指定する要素の数と同じサイズの配列を定義するのであれば、配列サイズを下記のように &lt;strong>&lt;code>...&lt;/code>&lt;/strong> と指定することができます。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-go" data-lang="go">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">var&lt;/span> &lt;span class="nx">arr&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="p">[&lt;/span>&lt;span class="o">...&lt;/span>&lt;span class="p">]&lt;/span>&lt;span class="kt">int&lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="mi">100&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">200&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">300&lt;/span>&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// 関数内であれば次のように書ける
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="nx">arr&lt;/span> &lt;span class="o">:=&lt;/span> &lt;span class="p">[&lt;/span>&lt;span class="o">...&lt;/span>&lt;span class="p">]&lt;/span>&lt;span class="kt">int&lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="mi">100&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">200&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">300&lt;/span>&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>Go では、サイズの異なる配列は、型が異なるとみなします。
固定サイズの配列をパラメータにとる関数は、同じサイズの配列のみ受け取ることができます。&lt;/p></description></item><item><title>Golang で関数を定義する (func)</title><link>https://maku77.github.io/p/kswy47a/</link><pubDate>Fri, 01 Sep 2017 00:00:00 +0900</pubDate><guid>https://maku77.github.io/p/kswy47a/</guid><description>&lt;p>Go 言語の関数定義はシンプルでありながら、複数の値を返すことができるなど、十分な機能を備えています。&lt;/p>
&lt;h2 id="関数定義の基本">関数定義の基本&lt;/h2>
&lt;p>Go 言語で関数を定義するときは、&lt;strong>&lt;code>func&lt;/code>&lt;/strong> キーワードを使用します。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-go" data-lang="go">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">func&lt;/span> &lt;span class="nx">関数名&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">パラメータ&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="nx">戻り値の型&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">	&lt;span class="c1">// ...
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>パラメータや、戻り値を持たない場合は、それぞれ省略することができます。
次の例は、メッセージを出力するだけの単純な関数の実装例です。&lt;/p>

&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">パラメータも戻り値もない関数&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-go" data-lang="go">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">func&lt;/span> &lt;span class="nf">hello&lt;/span>&lt;span class="p">()&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">	&lt;span class="nx">fmt&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Println&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;Hello&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>

&lt;p>次の関数は、２つの &lt;code>int&lt;/code> 型パラメータを受け取り、足し合わせた結果を返します。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-go" data-lang="go">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">func&lt;/span> &lt;span class="nf">add&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">a&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">b&lt;/span> &lt;span class="kt">int&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="kt">int&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">	&lt;span class="k">return&lt;/span> &lt;span class="nx">a&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="nx">b&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="複数の戻り値を持つ関数を定義する多値関数">複数の戻り値を持つ関数を定義する（多値関数）&lt;/h2>
&lt;p>Go 言語の関数は、複数の戻り値を返すことができます。
その場合、戻り値の型をカンマで区切って並べ、括弧で囲みます。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-go" data-lang="go">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">func&lt;/span> &lt;span class="nf">swap&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">a&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">b&lt;/span> &lt;span class="kt">int&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="kt">int&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="kt">int&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">	&lt;span class="k">return&lt;/span> &lt;span class="nx">b&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">a&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kd">func&lt;/span> &lt;span class="nf">main&lt;/span>&lt;span class="p">()&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">	&lt;span class="nx">x&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">y&lt;/span> &lt;span class="o">:=&lt;/span> &lt;span class="nf">swap&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">10&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">20&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">	&lt;span class="nx">fmt&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Println&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">x&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">y&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="c1">//=&amp;gt; 20, 10
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>複数の戻り値をひとつの変数で受け取ろうとすると、コンパイルエラーになります。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-go" data-lang="go">&lt;span class="line">&lt;span class="cl">&lt;span class="nx">x&lt;/span> &lt;span class="o">:=&lt;/span> &lt;span class="nf">swap&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">10&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">20&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="c1">// Error: multiple-value swap() in single-value context
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>必要のない戻り値がある場合は、アンダースコア (&lt;strong>&lt;code>_&lt;/code>&lt;/strong>) を使って受け取ります。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-go" data-lang="go">&lt;span class="line">&lt;span class="cl">&lt;span class="nx">x&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">_&lt;/span> &lt;span class="o">:=&lt;/span> &lt;span class="nf">swap&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">10&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">20&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="c1">// 1 つ目の戻り値のみ欲しい場合
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="nx">_&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">y&lt;/span> &lt;span class="o">:=&lt;/span> &lt;span class="nf">swap&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">10&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">20&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="c1">// 2 つ目の戻り値のみ欲しい場合
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>ちなみに、Go 言語で変数値をスワップするときは次のように簡単に書けます。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-go" data-lang="go">&lt;span class="line">&lt;span class="cl">&lt;span class="nx">x&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">y&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="nx">y&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">x&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="名前付き戻り値">名前付き戻り値&lt;/h2>
&lt;p>関数の戻り値に名前をつけておくと、その名前の変数に代入した値を戻り値として返すことができます。
次の例では、２つの &lt;code>int&lt;/code> 型の戻り値に、それぞれ &lt;code>index&lt;/code> と &lt;code>value&lt;/code> という名前を付けています。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-go" data-lang="go">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">func&lt;/span> &lt;span class="nf">findMax&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">arr&lt;/span> &lt;span class="p">[]&lt;/span>&lt;span class="kt">int&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="nx">index&lt;/span> &lt;span class="kt">int&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">value&lt;/span> &lt;span class="kt">int&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span> &lt;span class="o">...&lt;/span> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>関数から &lt;code>return&lt;/code> するときに、その時点で変数 &lt;code>index&lt;/code> と変数 &lt;code>value&lt;/code> に格納されている値が戻り値として扱われます。
それぞれの変数の初期値は、その型のゼロ値になります（例えば &lt;code>int&lt;/code> であれば 0）。&lt;/p></description></item><item><title>（旧）GitHub 上のパッケージを参照する／GitHub にパッケージを公開する</title><link>https://maku77.github.io/p/xs3ahpw/</link><pubDate>Thu, 31 Aug 2017 00:00:00 +0900</pubDate><guid>https://maku77.github.io/p/xs3ahpw/</guid><description>&lt;p>主要なプログラミング言語には、インターネット上のセントラルリポジトリでパッケージを配布する仕組みが提供されていることが多いのですが（Ruby の &lt;a href="https://rubygems.org/">RubyGems&lt;/a> など）、Go 言語では、Git リポジトリ上（主に GitHub）に公開されたソースコードを直接取得 (&lt;code>go get&lt;/code>) してインポートする方法を採用しています。&lt;/p>
&lt;h2 id="github-上のパッケージをインポートする">GitHub 上のパッケージをインポートする&lt;/h2>
&lt;p>&lt;code>go get&lt;/code> コマンドで、GitHub リポジトリのパスを下記のように指定すると、GitHub 上で公開されている Go パッケージ（ここでは &lt;code>github.com/maku77/gosample&lt;/code>）のコードを、&lt;code>$GOPATH/src&lt;/code> ディレクトリに取得することができます（&lt;code>$GOPATH&lt;/code> については&lt;a href="../p/u48bfim">こちらを参照&lt;/a>）。&lt;/p>

&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">github.com/maku77/gosample パッケージを取得する&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-console" data-lang="console">&lt;span class="line">&lt;span class="cl">&lt;span class="gp">$&lt;/span> go get github.com/maku77/gosample
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>

&lt;p>取得したパッケージは、標準パッケージと同じようにインポートして使用することができます。&lt;/p>

&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">sample.go&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-go" data-lang="go">&lt;span class="line">&lt;span class="cl">&lt;span class="kn">package&lt;/span> &lt;span class="nx">main&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kn">import&lt;/span> &lt;span class="s">&amp;#34;github.com/maku77/gosample&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kd">func&lt;/span> &lt;span class="nf">main&lt;/span>&lt;span class="p">()&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">	&lt;span class="nx">gosample&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Hello&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;Maku&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>


&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">ビルド＆実行&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-console" data-lang="console">&lt;span class="line">&lt;span class="cl">&lt;span class="gp">$&lt;/span> go run sample.run
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">Hello, Maku!
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>

&lt;p>&lt;code>go get&lt;/code> コマンドの面白いところは、GitHub 上で公開されているリポジトリ名そのものではなく、そのサブディレクトリで公開されている Go パッケージ名を指定してコードを取得できるところです（&lt;code>git clone&lt;/code> コマンドではこのようなことはできませんね）。
例えば、代表的な Pretty Print 系のパッケージである &lt;code>github.com/davecgh/go-spew/spew&lt;/code> パッケージは、GitHub 上でのリポジトリ名は &lt;code>https://github.com/davecgh/go-spew.git&lt;/code> ですが、そのサブディレクトリとして公開されているパッケージ名を指定して取得することができます。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-console" data-lang="console">&lt;span class="line">&lt;span class="cl">&lt;span class="gp">$&lt;/span> go get github.com/davecgh/go-spew/spew
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>実際には、&lt;code>go-spew.git&lt;/code> リポジトリ以下のファイルがすべて取得されますが、その配下のパッケージを使用するユーザが特に意識する必要はありません。&lt;/p>
&lt;p>下記は &lt;code>spew&lt;/code> パッケージの使用例です。&lt;/p>

&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">sample.go&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-go" data-lang="go">&lt;span class="line">&lt;span class="cl">&lt;span class="kn">package&lt;/span> &lt;span class="nx">main&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kn">import&lt;/span> &lt;span class="p">(&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">	&lt;span class="s">&amp;#34;github.com/davecgh/go-spew/spew&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kd">type&lt;/span> &lt;span class="nx">Book&lt;/span> &lt;span class="kd">struct&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">	&lt;span class="nx">Title&lt;/span> &lt;span class="kt">string&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">	&lt;span class="nx">Author&lt;/span> &lt;span class="kt">string&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kd">func&lt;/span> &lt;span class="nf">main&lt;/span>&lt;span class="p">()&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">	&lt;span class="nx">a&lt;/span> &lt;span class="o">:=&lt;/span> &lt;span class="nx">Book&lt;/span>&lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">		&lt;span class="nx">Title&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s">&amp;#34;Golang ABC&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">		&lt;span class="nx">Author&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s">&amp;#34;Maku&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">	&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">	&lt;span class="nx">spew&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Dump&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">a&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>


&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">ビルド＆実行&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-console" data-lang="console">&lt;span class="line">&lt;span class="cl">&lt;span class="gp">$&lt;/span> go run sample.go
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">(main.Book) {
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go"> Title: (string) (len=10) &amp;#34;Golang ABC&amp;#34;,
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go"> Author: (string) (len=4) &amp;#34;Maku&amp;#34;
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">}
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>

&lt;h2 id="github-にパッケージを公開する">GitHub にパッケージを公開する&lt;/h2>
&lt;p>自作のパッケージを GitHub に公開したいときは、単純に、Go で作成したソースコードを自分のアカウントで作成した GitHub リポジトリにコミットするだけで OK です。&lt;/p></description></item><item><title>（旧）GOPATH によるコードの一元管理</title><link>https://maku77.github.io/p/u48bfim/</link><pubDate>Thu, 31 Aug 2017 00:00:00 +0900</pubDate><guid>https://maku77.github.io/p/u48bfim/</guid><description>&lt;p>Go 言語を用いた開発では、他のプログラミング言語とは異なり、1 つのワークスペース内ですべてのコードを管理するという慣習があります。&lt;/p>
&lt;p>&lt;strong>（追記）Go 1.11 以降は Go modules の仕組みで、任意のディレクトリでプロジェクト（モジュール）を作成できるようになりました。&lt;/strong>&lt;/p>
&lt;h2 id="ワークスペースの構成">ワークスペースの構成&lt;/h2>
&lt;p>Go のワークスペースは下記のように、&lt;code>bin&lt;/code>、&lt;code>pkg&lt;/code>、&lt;code>src&lt;/code> という３つのディレクトリで構成することが決められています。
このルールに従ってファイルを配置することで、&lt;code>Makefile&lt;/code> のようなビルド設定ファイルを用意しなくても、ビルドコマンド (&lt;code>go build&lt;/code>) は構造化されたディレクトリ構成のプロジェクトを認識できるようになっています。&lt;/p>
&lt;pre tabindex="0">&lt;code>~/gowork/
 +-- bin/ # 作成したバイナリファイル（go install したときの保存先）
 +-- pkg/ # 依存パッケージのオブジェクトファイル（.a ファイルなど）
 +-- src/ # ソースコード（実行対象のファイルやインポートするファイルを配置）
&lt;/code>&lt;/pre>&lt;p>Go による開発では、ひとつのシステム内（PC 内）に、ひとつのワークスペースだけを用意して、その中ですべての作業を完結させる方法が主流となっています。
自分で作成しているパッケージも、&lt;code>go get&lt;/code> コマンドでインターネット上から取得したパッケージも、PC で唯一のワークスペース内の &lt;code>src/&lt;/code> ディレクトリの中に格納します。
Go のプログラム内から外部パッケージをインポートするときは、まず &lt;code>pkg/&lt;/code> ディレクトリ内のバイナリ版が検索され、次に &lt;code>src/&lt;/code> ディレクトリが参照されるようになっています。&lt;/p>
&lt;p>他の言語と比べると、特殊な管理方法（ほとんどルールベースで動作する）なので最初は戸惑うかもしれませんが、一度分かってしまえばそれほど複雑な仕組みではありません（こういった１ワークスペースでの開発が、Google 社内の開発ルールに適していたのかもしれませんね）。&lt;/p>
&lt;h2 id="gopath-によるワークスペースの指定">GOPATH によるワークスペースの指定&lt;/h2>
&lt;p>Go 言語用のワークスペースとして扱うディレクトリ（上記の例では &lt;code>gowork&lt;/code> ディレクトリ）は、&lt;strong>&lt;code>GOPATH&lt;/code>&lt;/strong> 環境変数であらかじめ指定しておく必要があります。
Go 1.8 以上では、&lt;code>GOPATH&lt;/code> を明示的に指定しなかった場合のデフォルトパスは &lt;strong>&lt;code>$HOME/go&lt;/code>&lt;/strong> となります（Windows の場合は &lt;strong>&lt;code>%USERPROFILE%\go&lt;/code>&lt;/strong> です）。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-console" data-lang="console">&lt;span class="line">&lt;span class="cl">&lt;span class="gp">$&lt;/span> &lt;span class="nb">export&lt;/span> &lt;span class="nv">GOPATH&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="nv">$HOME&lt;/span>/gowork
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>Go が認識している &lt;code>GOPATH&lt;/code> の値は、&lt;code>go env GOPATH&lt;/code> コマンドで確認することができます。&lt;/p></description></item><item><title>Go ツアーを起動して Go 言語の基本を勉強する</title><link>https://maku77.github.io/p/dkpsvz3/</link><pubDate>Thu, 31 Aug 2017 00:00:00 +0900</pubDate><guid>https://maku77.github.io/p/dkpsvz3/</guid><description>&lt;h2 id="go-ツアーの-web-サイトで学ぶ">Go ツアーの Web サイトで学ぶ&lt;/h2>
&lt;p>Go には、Go ツアーという Go 言語勉強用のツールが用意されています。まずはこれで Go の基本を一通り学んでみるのがよいです。&lt;/p>


&lt;figure class="xImage">
 &lt;img style="" width="840" height="467" src="../p/dkpsvz3/img-001.png" alt="/p/dkpsvz3/img-001.png" />
&lt;/figure>

&lt;p>下記の Web サイトでは、ブラウザ上で Go 言語のコードを記述、実行しながら Go 言語の基本を学んでいくことができます。&lt;/p>
&lt;ul>
&lt;li>&lt;a href="https://go.dev/tour/">A Tour of Go (https://go.dev/tour/)&lt;/a>&lt;/li>
&lt;/ul>
&lt;h2 id="ローカルで-go-ツアーを起動する方法">ローカルで Go ツアーを起動する方法&lt;/h2>
&lt;p>A Tour of Go は、次のようにローカルの Web サーバーとして立ち上げることができます。
サーバーが立ち上がると、自動的に Web ブラウザが開きます。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-console" data-lang="console">&lt;span class="line">&lt;span class="cl">&lt;span class="gp">$&lt;/span> go run golang.org/x/website/tour@latest
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>次のようにして、&lt;strong>&lt;code>tour&lt;/code>&lt;/strong> コマンドとしてインストールすることもできます。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-console" data-lang="console">&lt;span class="line">&lt;span class="cl">&lt;span class="gp">$&lt;/span> go install golang.org/x/website/tour@latest
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>デフォルトでは &lt;code>$HOME/go/bin&lt;/code> 以下に &lt;code>tour&lt;/code> コマンドがインストールされるので、次のように起動できます。&lt;/p>
&lt;pre tabindex="0">&lt;code>$ ~/go/bin/tour
&lt;/code>&lt;/pre>&lt;p>&lt;code>GOBIN&lt;/code> 環境変数や &lt;code>GOPATH&lt;/code> 環境変数を設定している場合は、&lt;code>go install&lt;/code> によるコマンドのインストール先が変わるので注意してください。&lt;/p>
&lt;ul>
&lt;li>参考: &lt;a href="../p/s258beh">go install のコマンドインストール先にパスを通す (GOBIN, GOPATH/bin)&lt;/a>&lt;/li>
&lt;/ul></description></item><item><title>Golang の if による条件分岐</title><link>https://maku77.github.io/p/pw258be/</link><pubDate>Thu, 31 Aug 2017 00:00:00 +0900</pubDate><guid>https://maku77.github.io/p/pw258be/</guid><description>&lt;p>Go 言語の &lt;code>if&lt;/code> 文の構文は、Java や C++ とほぼ同じですが、括弧の使用ルールが微妙に異なります。&lt;/p>
&lt;h2 id="if-文の構文">if 文の構文&lt;/h2>
&lt;p>Go 言語の &lt;code>if&lt;/code> 文は、条件部を括弧で囲みません。
一方で、実行部分のブロックを囲む中括弧（&lt;code>{&lt;/code> と &lt;code>}&lt;/code>）は省略することができません。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-go" data-lang="go">&lt;span class="line">&lt;span class="cl">&lt;span class="nx">x&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">y&lt;/span> &lt;span class="o">:=&lt;/span> &lt;span class="mi">100&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">200&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">if&lt;/span> &lt;span class="nx">x&lt;/span> &lt;span class="p">&amp;gt;&lt;/span> &lt;span class="nx">y&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">	&lt;span class="nx">fmt&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Println&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;x is larger than y&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span> &lt;span class="k">else&lt;/span> &lt;span class="k">if&lt;/span> &lt;span class="nx">x&lt;/span> &lt;span class="p">&amp;lt;&lt;/span> &lt;span class="nx">y&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">	&lt;span class="nx">fmt&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Println&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;x is smaller than y&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span> &lt;span class="k">else&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">	&lt;span class="nx">fmt&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Println&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;x is equal to y&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>比較演算子としては、Java や C++ と同様の &lt;code>==&lt;/code>、&lt;code>!=&lt;/code>、&lt;code>&amp;lt;&lt;/code>、&lt;code>&amp;lt;=&lt;/code>、&lt;code>&amp;gt;&lt;/code>、&lt;code>&amp;gt;=&lt;/code> が使用できます。
文字列の比較も &lt;code>==&lt;/code> 演算子で行えます。
論理演算子も同様に、&lt;code>||&lt;/code>、&lt;code>&amp;amp;&amp;amp;&lt;/code>、&lt;code>!&lt;/code> を使用できます。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-go" data-lang="go">&lt;span class="line">&lt;span class="cl">&lt;span class="nx">s&lt;/span> &lt;span class="o">:=&lt;/span> &lt;span class="s">&amp;#34;hemu&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nx">x&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">y&lt;/span> &lt;span class="o">:=&lt;/span> &lt;span class="mi">100&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">200&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">if&lt;/span> &lt;span class="nx">s&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="s">&amp;#34;hemu&amp;#34;&lt;/span> &lt;span class="o">&amp;amp;&amp;amp;&lt;/span> &lt;span class="nx">x&lt;/span> &lt;span class="p">&amp;lt;&lt;/span> &lt;span class="nx">y&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">	&lt;span class="c1">// ...
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>ちなみに Go 言語には Java や C++ のような三項演算子 (&lt;code>a ? b : c&lt;/code>) は用意されていません。
言語として三項演算子や &lt;code>if&lt;/code> 式を採用してしまうと、複雑なコードが書かれやすいというのが理由っぽいです（適度に使えば便利なんですけどね^^;）。&lt;/p>
&lt;ul>
&lt;li>参考: &lt;a href="https://go.dev/doc/faq#Control_flow">Why does Go not have the ?: operator?&lt;/a>&lt;/li>
&lt;/ul>
&lt;h2 id="if-スコープの変数">if スコープの変数&lt;/h2>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-go" data-lang="go">&lt;span class="line">&lt;span class="cl">&lt;span class="k">if&lt;/span> &lt;span class="nx">変数定義&lt;/span>&lt;span class="p">;&lt;/span> &lt;span class="nx">条件式&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">	&lt;span class="c1">// ...
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>という形で変数定義を行うと、その変数のスコープを &lt;code>if&lt;/code> あるいは、&lt;code>else&lt;/code> のブロック内に制限することができます。
例えば、下記のように記述すると、&lt;code>err&lt;/code> 変数は &lt;code>if&lt;/code> の条件式と処理ブロックの中でのみ参照できるようになります。&lt;/p></description></item><item><title>Golang の switch 条件分岐（switch の基本、便利な使い方、型スイッチ）</title><link>https://maku77.github.io/p/x6adgjn/</link><pubDate>Thu, 31 Aug 2017 00:00:00 +0900</pubDate><guid>https://maku77.github.io/p/x6adgjn/</guid><description>&lt;p>Go 言語の &lt;strong>&lt;code>switch&lt;/code>&lt;/strong> 文は、Java や C++ に比べて簡潔に記述できるようになっています。&lt;/p>
&lt;h2 id="switch-文の基本">switch 文の基本&lt;/h2>
&lt;p>Go 言語の &lt;strong>&lt;code>switch&lt;/code>&lt;/strong> 文では、&lt;strong>&lt;code>case&lt;/code>&lt;/strong> に複数の値をカンマで区切って指定することができます。
１つの &lt;code>case&lt;/code> が実行されると自動的に &lt;code>switch&lt;/code> 文を終了するため、C 言語のように &lt;code>case&lt;/code> ごとに &lt;code>break&lt;/code> と記述する必要はありません。
逆に、次の &lt;code>case&lt;/code> を続けて実行したい場合は、明示的に &lt;strong>&lt;code>fallthrough&lt;/code>&lt;/strong> と記述する必要があります。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-go" data-lang="go">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">func&lt;/span> &lt;span class="nf">checkNumber&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">i&lt;/span> &lt;span class="kt">int&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">	&lt;span class="k">switch&lt;/span> &lt;span class="nx">i&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">	&lt;span class="k">case&lt;/span> &lt;span class="mi">0&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">		&lt;span class="nx">fmt&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Println&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;zero&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">	&lt;span class="k">case&lt;/span> &lt;span class="mi">2&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">3&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">5&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">7&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">		&lt;span class="nx">fmt&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Println&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;primary number&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">		&lt;span class="k">fallthrough&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">	&lt;span class="k">default&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">		&lt;span class="nx">fmt&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Println&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;good number&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">	&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;code>if&lt;/code> 文の代わりに &lt;code>switch&lt;/code> 文を使うことでコードを簡潔にできることがあります。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-go" data-lang="go">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">func&lt;/span> &lt;span class="nf">shouldEscape&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">c&lt;/span> &lt;span class="kt">byte&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="kt">bool&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">	&lt;span class="k">switch&lt;/span> &lt;span class="nx">c&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">	&lt;span class="k">case&lt;/span> &lt;span class="sc">&amp;#39; &amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="sc">&amp;#39;?&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="sc">&amp;#39;&amp;amp;&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="sc">&amp;#39;=&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="sc">&amp;#39;#&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="sc">&amp;#39;+&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="sc">&amp;#39;%&amp;#39;&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">		&lt;span class="k">return&lt;/span> &lt;span class="kc">true&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">	&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">	&lt;span class="k">return&lt;/span> &lt;span class="kc">false&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;code>if&lt;/code> 文と同様に、&lt;code>switch&lt;/code> 文でも変数のスコープをブロック内に絞った変数定義を行うことができます。
次の &lt;code>os&lt;/code> 変数は、&lt;code>switch&lt;/code> 文の中でのみ参照できます。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-go" data-lang="go">&lt;span class="line">&lt;span class="cl">&lt;span class="k">switch&lt;/span> &lt;span class="nx">os&lt;/span> &lt;span class="o">:=&lt;/span> &lt;span class="nx">runtime&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">GOOS&lt;/span>&lt;span class="p">;&lt;/span> &lt;span class="nx">os&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">case&lt;/span> &lt;span class="s">&amp;#34;darwin&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">	&lt;span class="nx">fmt&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Println&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;OS = OS X&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">case&lt;/span> &lt;span class="s">&amp;#34;linux&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">	&lt;span class="nx">fmt&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Println&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;OS = Linux&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">default&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">	&lt;span class="c1">// freebsd, openbsd, plan9, windows...
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>	&lt;span class="nx">fmt&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Printf&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;OS = %s\n&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">os&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="連続する-if-else-の代わりとして-switch-文を使用する">連続する if else の代わりとして switch 文を使用する&lt;/h2>
&lt;p>&lt;strong>&lt;code>switch&lt;/code> 文の条件部分を省略&lt;/strong> すると、&lt;code>switch true&lt;/code> と記述するのと同様の振る舞いをします。
この記述方法は、連続した &lt;code>if else&lt;/code> を簡潔に記述するために使用することができます。
典型的なのは、ある変数の値を大小比較したいケースです。&lt;/p></description></item><item><title>パッケージの作成とインポート (import)</title><link>https://maku77.github.io/p/t269cgj/</link><pubDate>Thu, 31 Aug 2017 00:00:00 +0900</pubDate><guid>https://maku77.github.io/p/t269cgj/</guid><description>&lt;p>Go 言語でパッケージを作る方法と、他のパッケージを参照する色々な方法を紹介します。&lt;/p>
&lt;h2 id="パッケージとモジュール">パッケージとモジュール&lt;/h2>
&lt;h3 id="パッケージ">パッケージ&lt;/h3>
&lt;p>Go 言語のパッケージは、1 つのディレクトリ内にまとめられたソースコードの集まりです。
下記のディレクトリ構成では、&lt;code>mymodule&lt;/code> というモジュール（後述）に、&lt;code>pkg1&lt;/code> と &lt;code>pkg2&lt;/code> という名前の 2 つのパッケージが含まれています。&lt;/p>
&lt;pre tabindex="0">&lt;code>- mymodule/
 - pkg1/
 - auth.go (package pkg1)
 - user.go (package pkg1)
 - pkg2/
 - hoge.go (package pkg2)
&lt;/code>&lt;/pre>&lt;p>パッケージ内のファイルの分割粒度は自由で、あるコードがパッケージ内のどの Go ファイルに記述されているかで違いはありません。
パッケージのインポート時にはパッケージ名しか指定しないので、パッケージの利用者は、パッケージを構成する各々の Go ファイルの存在を意識する必要はありません。
パッケージの実装者は、パッケージ内のファイルを都合のいいように分割できます。&lt;/p>
&lt;p>Go 言語のソースコードは、必ず 1 つのパッケージに所属している必要があり、ソースコードの先頭の &lt;strong>&lt;code>package&lt;/code>&lt;/strong> ディレクティブでパッケージ名（＝親ディレクトリ名）を指定します。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-go" data-lang="go">&lt;span class="line">&lt;span class="cl">&lt;span class="kn">package&lt;/span> &lt;span class="nx">pkg1&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>特に、プログラムのエントリポイントとなる &lt;code>main&lt;/code> 関数は、&lt;code>main&lt;/code> パッケージに存在している必要があり、典型的にはモジュールルートを &lt;code>main&lt;/code> パッケージとして扱います。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-go" data-lang="go">&lt;span class="line">&lt;span class="cl">&lt;span class="kn">package&lt;/span> &lt;span class="nx">main&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nx">function&lt;/span> &lt;span class="nf">main&lt;/span>&lt;span class="p">()&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">	&lt;span class="c1">// ...
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="モジュール">モジュール&lt;/h3>
&lt;p>Go 1.11 以降は &lt;strong>モジュール&lt;/strong> という考え方が導入され、Go 1.10 以前の &lt;a href="../p/u48bfim/">GOPATH によるコードの一元管理&lt;/a> からの移行が進みました。
簡単に言うと、プロジェクト単位でディレクトリを自由な場所に置けるようになりました（以前はすべてのプロジェクトを &lt;code>$GOPATH&lt;/code> 以下に置かなければいけませんでした）。
モジュールは単一あるいは複数のパッケージを集めたもので、GitHub などで管理するときののリリース単位として用いられます。&lt;/p></description></item><item><title>Golang のループ処理（for ループ）</title><link>https://maku77.github.io/p/v58cfik/</link><pubDate>Thu, 31 Aug 2017 00:00:00 +0900</pubDate><guid>https://maku77.github.io/p/v58cfik/</guid><description>&lt;p>Go 言語では、&lt;strong>&lt;code>for&lt;/code>&lt;/strong> キーワード 1 つだけで &lt;code>while&lt;/code> ループや無限ループを表現することができます。&lt;/p>
&lt;h2 id="cc-言語風の-for-ループ">C/C++ 言語風の for ループ&lt;/h2>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-go" data-lang="go">&lt;span class="line">&lt;span class="cl">&lt;span class="k">for&lt;/span> &lt;span class="nx">初期化&lt;/span>&lt;span class="p">;&lt;/span> &lt;span class="nx">条件式&lt;/span>&lt;span class="p">;&lt;/span> &lt;span class="nx">後処理&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">	&lt;span class="c1">// ...
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>Go 言語の &lt;code>for&lt;/code> ループは、C/C++ 言語に似た構文を使用しますが、&lt;code>for&lt;/code> の直後は括弧で囲みません。
ただし、実行部分の括弧は必ず記述する必要があります。
このあたりのルールは、&lt;code>if&lt;/code> 文と同じですね。&lt;/p>

&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">記述例&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-go" data-lang="go">&lt;span class="line">&lt;span class="cl">&lt;span class="k">for&lt;/span> &lt;span class="nx">i&lt;/span> &lt;span class="o">:=&lt;/span> &lt;span class="mi">0&lt;/span>&lt;span class="p">;&lt;/span> &lt;span class="nx">i&lt;/span> &lt;span class="p">&amp;lt;&lt;/span> &lt;span class="mi">3&lt;/span>&lt;span class="p">;&lt;/span> &lt;span class="nx">i&lt;/span>&lt;span class="o">++&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">	&lt;span class="nx">fmt&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Println&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">i&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>


&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">実行結果&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-plain" data-lang="plain">&lt;span class="line">&lt;span class="cl">0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">2&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>

&lt;p>ちなみに、&lt;code>i++&lt;/code> という部分を、&lt;code>++i&lt;/code> という前置インクリメントに置き換えることはできません。
Go 言語では、&lt;code>i++&lt;/code> という後置インクリメントは文として扱われる（評価後の値を得られない）ため、式の中に埋め込むことができないようになっています。
そのため、前置インクリメントと後置インクリメントを区別する必要がそもそもなく、文法として後置インクリメントの形に統一するようになっています。&lt;/p>
&lt;h2 id="while-ループとしての-for-ループ">while ループ（としての for ループ）&lt;/h2>
&lt;p>Go 言語には &lt;code>while&lt;/code> ループ（条件に一致する限り繰り返し）は存在しませんが、&lt;code>for&lt;/code> ループで代用できます。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-go" data-lang="go">&lt;span class="line">&lt;span class="cl">&lt;span class="nx">i&lt;/span> &lt;span class="o">:=&lt;/span> &lt;span class="mi">0&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// i が 3 より小さい間、繰り返す
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="k">for&lt;/span> &lt;span class="nx">i&lt;/span> &lt;span class="p">&amp;lt;&lt;/span> &lt;span class="mi">3&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">	&lt;span class="nx">fmt&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Println&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">i&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">	&lt;span class="nx">i&lt;/span>&lt;span class="o">++&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;code>for&lt;/code> ループの初期化ステートメントや条件式、後処理ステートメントはそれぞれ省略することができるので、上記の &lt;code>for&lt;/code> ループは、実は下記のような記述の省略形です（上記のように省略して記述すべきです）。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-go" data-lang="go">&lt;span class="line">&lt;span class="cl">&lt;span class="k">for&lt;/span> &lt;span class="p">;&lt;/span> &lt;span class="nx">i&lt;/span> &lt;span class="p">&amp;lt;&lt;/span> &lt;span class="mi">3&lt;/span>&lt;span class="p">;&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">	&lt;span class="c1">// ...
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="無限ループとしての-for-ループ">無限ループ（としての for ループ）&lt;/h2>
&lt;p>Go 言語では、無限ループも &lt;code>for&lt;/code> を使用して記述するよう統一されています。&lt;/p></description></item><item><title>定数を定義する (const, iota)</title><link>https://maku77.github.io/p/qqy9gok/</link><pubDate>Thu, 31 Aug 2017 00:00:00 +0900</pubDate><guid>https://maku77.github.io/p/qqy9gok/</guid><description>&lt;p>Go 言語の定数は、変数を定義するのと同じ感覚で定義することができます。&lt;/p>
&lt;h2 id="定数定義の基本-const">定数定義の基本 (const)&lt;/h2>
&lt;p>Go 言語の定数は、&lt;strong>&lt;code>const&lt;/code>&lt;/strong> キーワードを使用して定義します。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-go" data-lang="go">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">func&lt;/span> &lt;span class="nf">main&lt;/span>&lt;span class="p">()&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">	&lt;span class="kd">const&lt;/span> &lt;span class="nx">foo&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="mi">100&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">	&lt;span class="nx">fmt&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Println&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">foo&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>次のように複数の定数をまとめて定義することもできます。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-go" data-lang="go">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">const&lt;/span> &lt;span class="p">(&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">	&lt;span class="nx">hoge&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="mi">100&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">	&lt;span class="nx">fuga&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="mi">200&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="定数値をパッケージ外に公開する">定数値をパッケージ外に公開する&lt;/h2>
&lt;p>パッケージ外に公開する定数値は、名前を大文字で始めます（関数や変数と同様です）。
逆に、小文字で始まる定数値は、同じパッケージ内からのみ参照可能です。&lt;/p>

&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">mypkg/mypkg.go&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-go" data-lang="go">&lt;span class="line">&lt;span class="cl">&lt;span class="kn">package&lt;/span> &lt;span class="nx">mypkg&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kd">const&lt;/span> &lt;span class="nx">PublicConst&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="mi">100&lt;/span> &lt;span class="c1">// 別のパッケージから mypkg.PublicConst で参照可能
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="kd">const&lt;/span> &lt;span class="nx">privateConst&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="mi">200&lt;/span> &lt;span class="c1">// mypkg 内からのみ参照可能
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>


&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">main.go&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-go" data-lang="go">&lt;span class="line">&lt;span class="cl">&lt;span class="kn">package&lt;/span> &lt;span class="nx">main&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kn">import&lt;/span> &lt;span class="s">&amp;#34;fmt&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kn">import&lt;/span> &lt;span class="s">&amp;#34;mypkg&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kd">func&lt;/span> &lt;span class="nf">main&lt;/span>&lt;span class="p">()&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">	&lt;span class="nx">fmt&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Println&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">mypkg&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">PublicConst&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="c1">//=&amp;gt; 100
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="p">}&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>

&lt;p>標準パッケージの &lt;code>math&lt;/code> パッケージも、円周率πを &lt;code>math.Pi&lt;/code> という大文字で始まる定数名で公開しています。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-go" data-lang="go">&lt;span class="line">&lt;span class="cl">&lt;span class="kn">package&lt;/span> &lt;span class="nx">main&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kn">import&lt;/span> &lt;span class="s">&amp;#34;fmt&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kn">import&lt;/span> &lt;span class="s">&amp;#34;math&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kd">func&lt;/span> &lt;span class="nf">main&lt;/span>&lt;span class="p">()&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">	&lt;span class="nx">fmt&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Println&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">math&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">Pi&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="c1">//=&amp;gt; 3.141592653589793
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="定数には型を指定しない">定数には型を指定しない&lt;/h2>
&lt;p>Go 言語で定数を定義するときは、&lt;code>const Foo int = 100&lt;/code> のように型を明示することもできますが、通常は型を指定せずに &lt;code>const Foo = 100&lt;/code> とだけ記述します。
こうして untyped なままで定義しておくことで、実際にその定数値を使用するときに適切な型の値として扱ってくれるようになります。
例えば、定数 &lt;code>Foo&lt;/code> を &lt;code>int&lt;/code> 型と明示して定義すると、下記の 3 行目で型のミスマッチが発生してエラーになってしまいます。&lt;/p></description></item><item><title>Go 言語で Hello World をコンパイル、実行する</title><link>https://maku77.github.io/p/nuz369c/</link><pubDate>Wed, 30 Aug 2017 00:00:00 +0900</pubDate><guid>https://maku77.github.io/p/nuz369c/</guid><description>&lt;p>ここでは、Go 言語を使用して簡単な Hello World プログラムを作成し、コンパイル＆実行してみます。&lt;/p>
&lt;h2 id="go-言語で-hello-world-を実装する">Go 言語で Hello World を実装する&lt;/h2>
&lt;p>Go 言語のソースコードファイルの拡張子は、&lt;strong>&lt;code>.go&lt;/code>&lt;/strong> を使用します。&lt;/p>

&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">hello.go&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-go" data-lang="go">&lt;span class="line">&lt;span class="cl">&lt;span class="kn">package&lt;/span> &lt;span class="nx">main&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kn">import&lt;/span> &lt;span class="s">&amp;#34;fmt&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kd">func&lt;/span> &lt;span class="nf">main&lt;/span>&lt;span class="p">()&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">	&lt;span class="nx">fmt&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Println&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;Hello Go&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>

&lt;p>エントリポイントとなる Go プログラムは、&lt;strong>&lt;code>main&lt;/code>&lt;/strong> パッケージとして作成し、&lt;strong>&lt;code>main&lt;/code>&lt;/strong> 関数を含んでいる必要があります（&lt;code>main.main&lt;/code> と表現します）。
ファイル名は何でも構いません。&lt;/p>
&lt;h2 id="hello-world-を実行する">Hello World を実行する&lt;/h2>
&lt;p>Go 言語はコンパイル型の言語ですが、&lt;strong>&lt;code>go run&lt;/code>&lt;/strong> コマンドを使用すると、ソースコードファイルを指定してそのまま実行することができます。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-console" data-lang="console">&lt;span class="line">&lt;span class="cl">&lt;span class="gp">$&lt;/span> go run hello.go
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">Hello Go
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>ビルドして実行ファイル（Windows なら &lt;code>hello.exe&lt;/code>）を作成するには、&lt;strong>&lt;code>go build&lt;/code>&lt;/strong> コマンドを使用します。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-console" data-lang="console">&lt;span class="line">&lt;span class="cl">&lt;span class="gp">$&lt;/span> go build hello.go
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="gp">$&lt;/span> ./hello
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">Hello Go
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>作成された実行ファイルは、同じ環境（OS、アーキテクチャ）であれば、Go の処理系がインストールされていなくてもそのまま実行することができます。
別の OS 用にビルドする場合は、クロスコンパイルの機能を使用します。
Go のクロスコンパイルがサポートしている OS と CPU アーキテクチャは、&lt;a href="https://golang.org/doc/install/source#environment">こちらのドキュメント&lt;/a> に記述されています。&lt;/p>
&lt;h2 id="応用モジュール対応モードでアプリを作成する">（応用）モジュール対応モードでアプリを作成する&lt;/h2>
&lt;p>いろいろな外部パッケージを活用して Go アプリを作る場合、モジュールとしてアプリを初期化します（&lt;strong>module-aware mode&lt;/strong> と呼びます）。
モジュールを初期化するには、モジュールルートにしたいディレクトリの下で &lt;strong>&lt;code>go mod init &amp;lt;モジュールパス名&amp;gt;&lt;/code>&lt;/strong> を実行します。
Node.js アプリの開発経験があるなら、&lt;code>npm init&lt;/code> のようなものだと考えると分かりやすいです。&lt;/p></description></item><item><title>Go 言語とは？／Go をインストールする</title><link>https://maku77.github.io/p/wxhzfvc/</link><pubDate>Wed, 30 Aug 2017 00:00:00 +0900</pubDate><guid>https://maku77.github.io/p/wxhzfvc/</guid><description>&lt;p>Go 言語 (Golang) は、Google が 2009 年に発表したオープンソースのプログラミング言語です。
コンパクトな実行ファイルを生成できるため、サーバーレス環境やコンテナ化されたアプリケーションとの相性がよく、多くのプロジェクトでメイン言語として採用されることが増えてきています。
ここでは Go 言語の特徴と、インストール方法を紹介します。&lt;/p>
&lt;h2 id="go-言語の特徴">Go 言語の特徴&lt;/h2>
&lt;p>Go 言語は下記のような特徴を持っています。&lt;/p>
&lt;ul>
&lt;li>&lt;strong>マスコットキャラクター（Gopher: ホリネズミ）が &lt;del>気持ち悪い&lt;/del> かわいい&lt;/strong>&lt;/li>
&lt;li>開発者
&lt;ul>
&lt;li>Ken Thompson（ケン・トンプソン）（C 言語の開発者）&lt;/li>
&lt;li>Rob Pike（ロブ・パイク）（UTF-8 の開発者）&lt;/li>
&lt;li>Brad Fitzpatrick（ブラッド・フィッツパトリック）（memcached の開発者）&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>コンパイル型の言語
&lt;ul>
&lt;li>コンパイルが非常に高速&lt;/li>
&lt;li>コンパイルせずにソースコードを指定して実行することも可能（&lt;code>go run sample.go&lt;/code>)&lt;/li>
&lt;li>クロスコンパイルをサポートしており、Windows、Linux、macOS 用の実行ファイルを容易に生成できる&lt;/li>
&lt;li>今まで C/C++ で行っていたシステムレイヤのプログラミングをより効率的に行う目的で作成された（ミドルウェアなどの実装に最適）&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>シンプルな言語仕様のため習得が用意で、大規模開発にも耐えられる
&lt;ul>
&lt;li>最小限の構文により、コーディングのミスを防ぎ、コンパイルを最適化している&lt;/li>
&lt;li>例えば、ループ構文は for ループしかない、三項演算子もない&lt;/li>
&lt;li>行末のセミコロンは必要ない&lt;/li>
&lt;li>マクロなどのプリプロセッサ構文はない（コンパイルの低速化の原因のため）&lt;/li>
&lt;li>暗黙の型変換はない&lt;/li>
&lt;li>ポインタはあるが、危険なポインタ演算はない&lt;/li>
&lt;li>GC による自動メモリ解放（C 言語と Java のいいとこ取り）&lt;/li>
&lt;li>継承、ジェネリックプログラミング、アサーション、オーバーロードなども存在しない
&lt;ul>
&lt;li>2022-03-15 の &lt;a href="https://go.dev/doc/go1.18">Go 1.18 リリース&lt;/a> でジェネリクスがサポートされました&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>不要なインポートがあるとコンパイルエラーになる（警告ではなくエラー）&lt;/li>
&lt;li>try-catch による例外の仕組みがない（関数が多値を返すことでカバー）（panic と recover という仕組みがある）&lt;/li>
&lt;li>クラスはないが、構造体＋レシーバ付き関数でカバー&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>豊富な標準パッケージを同梱（暗号化、圧縮、RDB、JSON、テスト用のライブラリなど）&lt;/li>
&lt;li>並行処理もネイティブにサポート（ゴルーチンという軽量スレッド、チャネルによるスレッド間通信）&lt;/li>
&lt;li>テスト実行 (&lt;code>go test&lt;/code>) やドキュメント生成 (&lt;code>godoc&lt;/code>) のコマンドを標準搭載&lt;/li>
&lt;li>バージョン 1.5 以降は Go 言語自体が Go 言語で記述されている（一部アセンブラ）&lt;/li>
&lt;/ul>
&lt;p>Go 言語は、静的サイトジェネレータ Hugo や、コンテナ型仮想環境ツール Docker のベースとなる言語としても使用されており、これらのツールの高速な動作は、Go 言語によって支えられています。&lt;/p></description></item><item><title>Go 言語のコーディングスタイル（コーディング規約）</title><link>https://maku77.github.io/p/rz47adg/</link><pubDate>Wed, 30 Aug 2017 00:00:00 +0900</pubDate><guid>https://maku77.github.io/p/rz47adg/</guid><description>&lt;p>Go 言語には、標準のコーディング規約が用意されており、それに合わせた組み込みのコードフォーマッター (&lt;code>go fmt&lt;/code>) も提供されています。&lt;/p>
&lt;h2 id="go-言語のコーディング規約">Go 言語のコーディング規約&lt;/h2>
&lt;p>Go 言語におけるコーディングスタイルは、下記のドキュメントが参考になるでしょう。&lt;/p>
&lt;ul>
&lt;li>&lt;a href="https://golang.org/doc/effective_go.html#formatting">Effective Go - The Go Programming Language&lt;/a>&lt;/li>
&lt;/ul>
&lt;p>ポイントを簡単にまとめておきます。&lt;/p>
&lt;ul>
&lt;li>&lt;strong>インデントにはハードタブ（タブ文字）を使用&lt;/strong> し、ソフトタブ（半角スペース）を使用しない。&lt;/li>
&lt;li>１行あたりの文字数に制限はない。もちろん、長すぎる場合は改行してもよい。&lt;/li>
&lt;li>連続した変数定義やコメントは縦に揃える
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-go" data-lang="go">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">type&lt;/span> &lt;span class="nx">T&lt;/span> &lt;span class="kd">struct&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">name&lt;/span> &lt;span class="kt">string&lt;/span> &lt;span class="c1">// name of the object
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="nx">value&lt;/span> &lt;span class="kt">int&lt;/span> &lt;span class="c1">// its value
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;li>演算子の前後にスペースを入れない。演算子の優先順位を明確にするときのみスペースを入れる。その代わり余計な括弧を使わない。
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-go" data-lang="go">&lt;span class="line">&lt;span class="cl">&lt;span class="nx">x&lt;/span>&lt;span class="o">&amp;lt;&amp;lt;&lt;/span>&lt;span class="mi">8&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="nx">y&lt;/span>&lt;span class="o">&amp;lt;&amp;lt;&lt;/span>&lt;span class="mi">16&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nx">x&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">y&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="nx">y&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">x&lt;/span>&lt;span class="o">+&lt;/span>&lt;span class="nx">y&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;li>命名規則
&lt;ul>
&lt;li>公開メソッド、フィールド: &lt;code>MexedCaps&lt;/code>（大文字で始める）&lt;/li>
&lt;li>非公開メソッド、フィールド: &lt;code>mixedCaps&lt;/code>（小文字で始める）&lt;/li>
&lt;li>コンストラクタ: &lt;code>NewBook&lt;/code>（New + 生成対象の構造体名）&lt;/li>
&lt;li>１つのメソッドを持つインタフェース: &lt;code>Reader&lt;/code>（Read メソッドだけを持つインタフェース）&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;p>というように、いくつかのフォーマットルールがあるのですが、Go には下記のような自動整形ツールが付属しているので、これを実行して自動で整形してしまうのが手っ取り早いです。&lt;/p>
&lt;h2 id="コードを自動整形する-go-fmt-と-gofmt">コードを自動整形する (go fmt と gofmt)&lt;/h2>
&lt;p>Go 言語には、コーディング規約に従ってコードを自動整形するためのツール (&lt;strong>&lt;code>go fmt&lt;/code>&lt;/strong>) が標準で搭載されています。&lt;/p>

&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">例: hello.go ファイルを直接フォーマットする&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-console" data-lang="console">&lt;span class="line">&lt;span class="cl">&lt;span class="gp">$&lt;/span> go fmt hello.go
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>

&lt;p>上記のように実行すると、&lt;code>hello.go&lt;/code> ファイルの内容が整形されて書き換えられます。
&lt;strong>指定したソースコードが直接変更される&lt;/strong> ことに注意してください。
次のように実行すれば、プロジェクト内のすべての &lt;code>.go&lt;/code> ファイルをフォーマットできます。&lt;/p></description></item></channel></rss>