<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>Node.js on 天才まくまくノート</title><link>https://maku77.github.io/nodejs/</link><description>Recent content in Node.js on 天才まくまくノート</description><generator>Hugo -- gohugo.io</generator><language>ja-jp</language><lastBuildDate>Thu, 25 Jan 2024 00:00:00 +0900</lastBuildDate><atom:link href="https://maku77.github.io/nodejs/index.xml" rel="self" type="application/rss+xml"/><item><title>corepack を使ってプロジェクト内で使用する pnpm/yarn のバージョンを管理する</title><link>https://maku77.github.io/p/tzwio3y/</link><pubDate>Thu, 25 Jan 2024 00:00:00 +0900</pubDate><guid>https://maku77.github.io/p/tzwio3y/</guid><description>corepack とは Node.js の実行環境には、パッケージマネージャーとして標準で npm コマンドが搭載されていますが、npm の代わりに yarn や pnpm などを導入しているプロジェクトが多くあります。 従来は、これらのコマンドを npm install -g pnpm のように別途インストールする必要がありましたが、Node.js に標準搭載された corepack の仕組みを使用すると、初めからインストールされているかのようにyarn や pnpm コマンドを実行できるようになります。
corepack が使用するパッケージマネージャーは、package.json の packageManager プロパティで宣言しておくことができるので、プロジェクト内で使用するパッケージマネージャーとそのバージョンを統一できます。
☝️ ワンポイント package.json の packageManager フィールドはプロジェクトが使うパッケージマネージャーとそのバージョンを宣言しているだけで、このフィールドは corepack 専用のフィールドというわけではありません。 あくまで、システムの Node.js 環境で corepack が有効化されている場合に、このフィールドの内容に基づいて yarn や pnpm のバージョンが自動制御される、ということです。 最初の準備（既存の yarn/pnpm の削除と corepack の有効化） もし、npm install や brew でグローバルインストールした yarn や pnpm がある場合は、もう必要ないのでアンインストールしておきましょう。
不要な yarn や pnpm はアンインストール $ npm uninstall -g yarn $ npm uninstall -g pnpm $ brew uninstall yarn $ brew uninstall pnpm corepack コマンドは Node.</description></item><item><title>nvm で複数の Node.js バージョンを切り替えて使用する (Node Version Manager)</title><link>https://maku77.github.io/p/3x95seb/</link><pubDate>Sun, 13 Mar 2022 00:00:00 +0900</pubDate><guid>https://maku77.github.io/p/3x95seb/</guid><description>nvm (Node Version Manager) とは？ nvm というコマンドラインツールを使うと、システム内に複数バージョンの Node.js 実行環境をインストールして、切り替えて使うことができるようになります。 nvm 実行のために、あらかじめ Node.js をインストールしておく必要はありません。
$ nvm use 16 # node コマンドを version 16.x.x に切り替え（必要に応じてインストール） $ nvm use 14 # node コマンドを version 14.x.x に切り替え（必要に応じてインストール） 上記のように node コマンドのバージョンを簡単に切り替えることができるため、新しいバージョンの Node.js を試してみたいときや、複数バージョンでテストを行いたい場合に便利です。 nvm はスタンドアローン版の Node.js とも共存できるので、安心してインストールすることができます。 nvm を使わずにインストールされた Node.js は、system という名前で参照できるようになっています。
$ nvm use system # node コマンドをスタンドアローン版に切り替え nvm のインストール nvm コマンドは次のように簡単にインストールできます。
macOS や Linux の場合 $ curl -o- https://raw.githubusercontent.com/nvm-sh/nvm/v0.39.1/install.sh | bash 最新バージョンのインストール方法は nvm-sh/nvm - GitHub の公式サイトで確認してください。 インストール後は、ターミナル（bash など）を再起動するか、source ~/.</description></item><item><title>Node.jsメモ: nodemon で Node.js サーバの再起動を自動化する</title><link>https://maku77.github.io/p/rvghobv/</link><pubDate>Fri, 07 Jun 2019 00:00:00 +0900</pubDate><guid>https://maku77.github.io/p/rvghobv/</guid><description>nodemon とは？ Express や Restify で Web サーバの実装をしていると、ソースコードを修正するたびに Ctrl + C でサーバを強制終了し、node app.js で再起動するという操作が必要になります。 node コマンドの代わりに nodemon コマンドを使用すると、ソースコードの変更を監視し、自動的に node コマンドを再起動してくれます。
$ nodemon app.js node の代わりに nodemon とタイプするだけで、快適な実装生活を送ることができます。 Node.js でサーバ系のコーディングを行うときは nodemon を使うようにしましょう！
nodemon のインストール nodemon コマンドは、Node.js 付属の npm コマンドで簡単にインストールすることができます。
$ npm install -g nodemon システム全体で使用可能なコマンドとしてインストールしたいので、-g オプションを付けて実行してください。
nodemon を使ってみる ここでは、Node.js の標準モジュールである http を使って簡単な Web サーバを作り、それを nodemon で起動してみます。 下記は、Hello という返答を返すだけの簡単な Web サーバプログラムです。
app.js var server = require(&amp;#39;http&amp;#39;).createServer(); server.on(&amp;#39;request&amp;#39;, function(req, res) { res.writeHead(200, {&amp;#39;Content-Type&amp;#39;: &amp;#39;text/plain&amp;#39;}); res.</description></item><item><title>Node.jsメモ: 環境変数の代わりに .env ファイルを使用する (dotenv)</title><link>https://maku77.github.io/p/6kruhwy/</link><pubDate>Tue, 26 Mar 2019 00:00:00 +0900</pubDate><guid>https://maku77.github.io/p/6kruhwy/</guid><description>dotenv モジュールとは Node.js のプログラムから環境変数を参照するには process.env を参照します。
参考: Node.js で環境変数を参照する (process.env) ユーザー設定を環境変数で行うようにしているアプリはよくあるのですが、たかが 1 つのアプリのために環境変数を設定するのは面倒だというユーザーは少なくありません（設定がどこで行われているのかわかりにくいという理由もあります）。
dotenv モジュールを使用すると、カレントディレクトリに置かれた .env ファイルを読み込み、そこに記述されたキーと値のペアを process.env 経由で参照できるようになります。
dotenv - npm つまり、ユーザーはアプリの設定を、従来通り環境変数で行うこともできるし、.env ファイルでも行うことができるようになります。 環境変数を使ってアプリの挙動を変えるような実装をしている場合は、.env ファイルによる設定もサポートしておくと親切です。 クラウドサービスと連携するアプリケーションなどは、接続キー などの情報を .env ファイルで指定できるようにしているものがよくあります。
dotenv モジュールのインストール dotenv モジュールは npm コマンドで下記のようにインストールすることができます。 インストールされたモジュールは node_modules ディレクトリに格納されます。
$ npm install dotenv dotenv モジュールの基本的な使い方 まず、サンプルの設定ファイルとして、プロジェクトのルートディレクトリに、下記のような .env ファイルを作成します。
.env # これはコメント行 KEY1=VALUE1 KEY2=VALUE2 KEY3=VALUE3 .env ファイルの内容を読み込んで、process.env オブジェクトのプロパティとして参照できるようにするには、アプリの最初の方で下記のように実行します。
sample.js require(&amp;#39;dotenv&amp;#39;).config(); 基本的にはやることはこれだけです。 仮に、.env ファイルが見つからない場合は、単純に無視されるだけなので、上記のコードは安心して入れておくことができます。
後は、通常の環境変数と同様に process.env オブジェクト経由で値を参照するだけです。
require(&amp;#39;dotenv&amp;#39;).config(); console.log(process.env.KEY1); //=&amp;gt; VALUE1 console.log(process.env.KEY2); //=&amp;gt; VALUE2 console.</description></item><item><title>Node.jsメモ: モジュール自身のコードにテストコードを記述する (require.main)</title><link>https://maku77.github.io/p/3b52x28/</link><pubDate>Mon, 10 Dec 2018 00:00:00 +0900</pubDate><guid>https://maku77.github.io/p/3b52x28/</guid><description>Node.js で実行中のプログラムから require.main を参照すると、エントリポイントとして起動した module インスタンスを参照することができます。 つまり、下記のようにして、エントリポイントとして起動された JavaScript ファイルかどうかを判別することができます。
if (require.main === module) { // このモジュールを node で直接起動した場合のみ実行される } あるいは、下記のように判定することもできます。
if (require.main.filename === __filename) { // ... } この仕組みを利用して、あるモジュールのテストコードを、そのモジュールのコード内に埋め込むことができます。 下記は、add 関数と subtract 関数を提供する簡単なモジュールのサンプルです。
mymath.js function add(a, b) { return a + b; } function subtract(a, b) { return a - b; } module.exports = { add: add, subtract: subtract }; // このモジュール自身のテストコード if (require.main === module) { let assert = require(&amp;#39;assert&amp;#39;); assert.</description></item><item><title>Node.jsメモ: 外部の JSON ファイルを読み込む (require)</title><link>https://maku77.github.io/p/uf6zrk6/</link><pubDate>Mon, 10 Dec 2018 00:00:00 +0900</pubDate><guid>https://maku77.github.io/p/uf6zrk6/</guid><description>Node.js の require は、外部の JSON ファイルを読み込むのにも使用することができます。 下記は、設定情報を settings.json というファイルに記述しておき、その情報を読み込む例です。
settings.json { &amp;#34;srcDir&amp;#34;: &amp;#34;src/main/js&amp;#34;, &amp;#34;testDir&amp;#34;: &amp;#34;src/test/js&amp;#34; } main.js var settings = require(&amp;#39;./settings.json&amp;#39;); // 拡張子は省略可能 console.log(settings.srcDir); //=&amp;gt; &amp;#39;src/main/js&amp;#39; console.log(settings.testDir); //=&amp;gt; &amp;#39;src/test/js&amp;#39; 上記では require に渡すファイル名として ./settings.json と拡張子まで指定していますが、./settings のように拡張子を省略することもできます。 ただし、同じディレクトリに ./settings.js があると、そちらが優先的に読み込まれてしまうので注意してください（拡張子だけ異なるファイルは作らない方がよいです）。</description></item><item><title>Node.jsメモ: Node.js がどのバージョンの V8 エンジンで動作しているか調べる</title><link>https://maku77.github.io/p/cf7eoyo/</link><pubDate>Mon, 08 Aug 2016 00:00:00 +0900</pubDate><guid>https://maku77.github.io/p/cf7eoyo/</guid><description>node コマンドを実行したときにどのバージョンの V8 エンジンで動作するかを調べるには下記のようにします。
$ node -p process.versions.v8 5.0.71.52</description></item><item><title>Node.jsメモ: Node.js 用モジュールの作り方（require でロード可能な Node モジュールを作成する）</title><link>https://maku77.github.io/p/9fapzbb/</link><pubDate>Tue, 19 Jul 2016 00:00:00 +0900</pubDate><guid>https://maku77.github.io/p/9fapzbb/</guid><description>Node モジュール作成の基本 Node.js では、.js ファイルをモジュールとして扱うことができます（配布用に package.json が用意されたものは、特に「パッケージ」と呼ばれます）。 作成したモジュールは下記のように require() を使用して読み込むことができます。
var mod = require(&amp;#39;./mymodule.js&amp;#39;); // .js は省略可能 mod.foo(1, 2); Node モジュールで公開するプロパティや関数は、以下のいずれかの方法で設定します。
exports の各プロパティに設定する方法 module.exports 自体に任意のオブジェクトを代入する方法 (1) exports のプロパティとして公開プロパティを設定する方法 exportsオブジェクト（実際は module.exports のエイリアス）のプロパティとして設定したものが require したクライアント側からアクセスできるようになります。 逆に、exports のプロパティに設定されていない変数や関数は、ファイル内にスコープが限定されます。
下記の例では、exports のプロパティ経由で、name 変数、add 関数を公開しています。
mymodule.js（Node モジュール） // 公開される変数や関数 exports.name = &amp;#39;magu&amp;#39;; exports.add = function(a, b) { return privFunc(a, b); } // 非公開の変数や関数 var secret = 100; function privFunc(a, b) { return a + b + secret; } この Node モジュールは、以下のように require() 関数でロードして使用します。 同じディレクトリに置いたモジュールは、プレフィックスに .</description></item><item><title>Node.jsメモ: Node.js が require() で検索するパスのまとめ</title><link>https://maku77.github.io/p/ysmmmia/</link><pubDate>Mon, 22 Sep 2014 00:00:00 +0900</pubDate><guid>https://maku77.github.io/p/ysmmmia/</guid><description>require() によって Node.js がどのようにロードするモジュールを検索するかは、Node.js の Modules のドキュメント に詳しく説明されていますが、若干複雑なのでここでまとめておきます。
require の使い分け require でモジュールをロードするとき、多くは下記の 3 パターンのロード方法に分類できます。
// コアモジュール、あるいは node_modules にインストールしたパッケージのロード const crypto = require(&amp;#39;crypto&amp;#39;); // ローカルモジュールのロード const myLocalModule = require(&amp;#39;./path/to/myLocalModule&amp;#39;); // JSON ファイルのロード const jsonData = require(&amp;#39;./path/to/data.json&amp;#39;); 簡単にまとめると、
組み込みモジュールや、外部パッケージを使うときは名前そのものを指定する。 自分で作成したローカルモジュールや JSON ファイルは ./ で始まるパスで指定する。 と理解しておけばよいでしょう。
require がどのようにモジュールを検索するか？ require によってどのパスに置かれたファイルがロードされるかは、下記のようなアルゴリズムで決められます。
require(&amp;rsquo;name&amp;rsquo;) としたとき require のパラメータでモジュール名そのもの（express など）を指定した場合は、下記のようなアルゴリズムでロードするモジュールが決められます。
name というコアモジュールを探す。 同じディレクトリの node_modules/name というパッケージを探す。 より上位のディレクトリの node_modules/name というパッケージを探していく。 見つからなければ not found エラーを投げる。 例えば、/aaa/bbb/main.js 内で require('express') とすると、下記のように検索されていきます。
コアモジュール（Node の組み込みモジュール）の express /aaa/bbb/node_modules/express /aaa/node_modules/express /node_modules/express ちなみに、name というモジュール名の部分に、path/to/name のようにディレクトリパスが含まれていれば、そのような階層でインストールされた name モジュールがロードされます（node_modules/path/to/name などが検索される）。</description></item><item><title>Node.js スクリプトにシェバング (#!` を付けてコマンドとして起動できるようにする</title><link>https://maku77.github.io/p/ptactsj/</link><pubDate>Tue, 19 Nov 2013 00:00:00 +0900</pubDate><guid>https://maku77.github.io/p/ptactsj/</guid><description>一般的なスクリプト言語と同様に、Node.js で動作させるアプリもシェバング (#!) で node コマンドを指定しておくことができます。
app.js #!/usr/bin/env node console.log(&amp;#39;Hello&amp;#39;); あとは、.js ファイルに実行権限を付けてやれば、コマンドとして扱うことができるようになります。
実行方法 $ chmod +x app.js $ ./app.js Hello</description></item><item><title>Node.jsメモ: 環境変数を参照する (process.env)</title><link>https://maku77.github.io/p/e44uun8/</link><pubDate>Fri, 07 Dec 2012 00:00:00 +0900</pubDate><guid>https://maku77.github.io/p/e44uun8/</guid><description>Node.js で環境変数を扱いたいときは、process.env オブジェクトを参照します。 process モジュールはデフォルトで参照できるようになっているので、require でモジュールを読み込む必要はありません。
指定した環境変数を取得する process.env.環境変数名 とすれば、任意の環境変数を参照できます。
$ node &amp;gt; console.log(process.env.HOME); D:\x\home 下記は、環境変数 HTTP_PROXY の設定の有無に応じて処理を振り分ける例です。
if (process.env.HTTP_PROXY != undefined) { // Proxy 環境で動作している場合 } else { // Proxy 環境ではない場合 } 環境変数が指定されていない場合のデフォルト値 環境変数が設定されていない場合（undefined の場合）にデフォルト値を設定したいのであれば、下記のように ??（Null 合体演算子）を使います。
const port = process.env.MYSERVER_PORT ?? 50000; ?? 演算子は ES2020 で導入された Nullish Coalescing という仕組みで、ある変数の値を参照しつつ、その値が undefined あるいは null の場合に、右側に指定した値を代わりに返してくれます。 上の例の場合は、環境変数 MYSERVER_PORT が設定されていないときに、デフォルトのポート番号として 50000 が使用されます。
?? 演算子が導入される前は、次のように undefined 判定を行う必要がありました。
let port = process.env.MYSERVER_PORT; if (typeof port === &amp;#39;undefined&amp;#39;) port = 50000; // 簡易的に if (port !</description></item><item><title>Node.js をインストールする</title><link>https://maku77.github.io/p/z5ap5bf/</link><pubDate>Sun, 25 Nov 2012 00:00:00 +0900</pubDate><guid>https://maku77.github.io/p/z5ap5bf/</guid><description>Node.js とは Node.js は、JavaScript によって記述されたプログラム（スクリプト）を実行するための実行環境です。 JavaScript は、元々は Web ブラウザ内のコンテキストで実行されるスクリプト言語として開発されたものですが、Node.js のランタイム (Windows の場合は node.exe) を使用すると、ネイティブな実行環境で、JavaScript のプログラムを実行することができます。 Python や Ruby のような実行環境が、JavaScript 言語にも提供されたと考えると分かりやすいです。 例えば、Python によるプログラムは以下のように実行しますが、
$ python sample.py 同様に JavaScript で記述したプログラムを、下記のように実行できます。
$ node sample.js Node.js は、内部的には下記のような構成要素で成り立っています。
V8 — Google 製の JavaScript 実行エンジン。 libuv — 非同期イベントライブラリ。Node.js の作者の Ryan Dahl によって作成された。 Node.js では、libuv をベースとする非同期 I/O の仕組みによって、シングルスレッドながらも多くの接続を処理することができるようになっており、サーバサイドのプログラミング言語としても注目を集めています。
Node.js のインストール 各 OS 用の Node.js インストーラが提供されています。 下記のサイトからダウンロードして実行するだけで簡単にインストールできます。 複数バージョンの Node.js 実行環境をインストールしたい場合は、nvm というコマンドラインツールを使って Node.js をインストール してください。
Node.js - https://nodejs.org/ Node.js の実行環境は、デフォルトで下記のようなディレクトリにインストールされます。</description></item></channel></rss>