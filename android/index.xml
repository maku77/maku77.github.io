<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>Android on 天才まくまくノート</title><link>https://maku77.github.io/android/</link><description>Recent content in Android on 天才まくまくノート</description><generator>Hugo</generator><language>ja-jp</language><lastBuildDate>Thu, 19 Feb 2026 00:00:00 +0900</lastBuildDate><atom:link href="https://maku77.github.io/android/index.xml" rel="self" type="application/rss+xml"/><item><title>Androidトラブルシューティング: JDK のバージョンが原因でビルドが失敗する場合</title><link>https://maku77.github.io/p/jhsiowu/</link><pubDate>Fri, 10 Oct 2025 00:00:00 +0900</pubDate><guid>https://maku77.github.io/p/jhsiowu/</guid><description>&lt;p>Android プロジェクト内で特定の JDK バージョンによるビルドが要求されている場合、Android Studio 内の JBR (JetBrains Runtime) ではバージョンが合わず、ビルドが失敗することがあります。
そのような場合は、次のように JDK を追加することで解決できます。&lt;/p>
&lt;ol>
&lt;li>&lt;strong>&lt;code>Ctrl + Shift + A&lt;/code>&lt;/strong> で &amp;ldquo;Find Action&amp;rdquo; を開く&lt;/li>
&lt;li>&lt;strong>&lt;code>Download JDK...&lt;/code>&lt;/strong> を選択&lt;/li>
&lt;li>下のような画面が表示されるので JDK の Version などを指定してダウンロード&lt;/li>
&lt;/ol>


&lt;figure class="xImage">
 &lt;img style="" width="444" height="240" src="../p/jhsiowu/img-001.png" alt="/p/jhsiowu/img-001.png" />
 &lt;figcaption>図: JDK の追加ダウンロード&lt;/figcaption>
&lt;/figure>


&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">エラーメッセージの例&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-plain" data-lang="plain">&lt;span class="line">&lt;span class="cl">A problem occurred configuring project &amp;#39;:app&amp;#39;.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&amp;gt; Failed to calculate the value of task &amp;#39;:app:compileDebugJavaWithJavac&amp;#39; property &amp;#39;javaCompiler&amp;#39;.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;gt; Cannot find a Java installation on your machine matching this tasks requirements: {languageVersion=17, vendor=any, implementation=vendor-specific} for WINDOWS on x86_64.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;gt; No locally installed toolchains match and toolchain download repositories have not been configured.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">* Try:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&amp;gt; Learn more about toolchain auto-detection at https://docs.gradle.org/8.8/userguide/toolchains.html#sec:auto_detection.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&amp;gt; Learn more about toolchain repositories at https://docs.gradle.org/8.8/userguide/toolchains.html#sub:download_repositories.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&amp;gt; Run with --info or --debug option to get more log output.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&amp;gt; Run with --scan to get full insights.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&amp;gt; Get more help at https://help.gradle.org.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">* Exception is:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">org.gradle.api.ProjectConfigurationException: A problem occurred configuring project &amp;#39;:app&amp;#39;.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">	at org.gradle.configuration.project.LifecycleProjectEvaluator.wrapException(LifecycleProjectEvaluator.java:84)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">	at org.gradle.configuration.project.LifecycleProjectEvaluator.addConfigurationFailure(LifecycleProjectEvaluator.java:77)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">	at org.gradle.configuration.project.LifecycleProjectEvaluator.access$500(LifecycleProjectEvaluator.java:55)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Caused by: org.gradle.jvm.toolchain.internal.ToolchainDownloadFailedException: No locally installed toolchains match and toolchain download repositories have not been configured.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">	at org.gradle.jvm.toolchain.internal.install.DefaultJavaToolchainProvisioningService.tryInstall(DefaultJavaToolchainProvisioningService.java:118)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">	at org.gradle.jvm.toolchain.internal.JavaToolchainQueryService.downloadToolchain(JavaToolchainQueryService.java:178)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">	... 243 more&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure></description></item><item><title>Android エミュレーターをコマンドラインから操作する (emulator, adb emu)</title><link>https://maku77.github.io/p/zgyhygw/</link><pubDate>Tue, 08 Nov 2022 00:00:00 +0900</pubDate><guid>https://maku77.github.io/p/zgyhygw/</guid><description>&lt;h2 id="emulator-コマンドと-adb-コマンド">emulator コマンドと adb コマンド&lt;/h2>
&lt;p>Android SDK に付属している &lt;strong>&lt;code>emulator&lt;/code>&lt;/strong> コマンドや &lt;strong>&lt;code>adb&lt;/code>&lt;/strong> コマンドを使うことで、Android のエミュレーターを操作することができます。&lt;/p>
&lt;dl>
&lt;dt>emulator コマンド&lt;/dt>
&lt;dd>エミュレーター端末 (= AVD: Android Virtual Device) の一覧を表示したり、エミュレーター端末を起動したりするのに使うコマンドです。&lt;/dd>
&lt;dt>adb コマンド&lt;/dt>
&lt;dd>エミュレーター端末が起動した後に、コマンドを送り込んで各種操作を行います。&lt;code>adb&lt;/code> はエミュレーター専用のコマンドではありませんが、&lt;strong>&lt;code>adb emu&lt;/code>&lt;/strong> のようなエミュレーターに特化したサブコマンドがあります。&lt;/dd>
&lt;/dl>
&lt;p>&lt;code>emulator&lt;/code> コマンドは、Android SDK をインストールしたディレクトリの &lt;code>emulator&lt;/code> ディレクトリに格納されています。
例えば次のようなパスにあります（ユーザー名が &lt;code>maku&lt;/code> の場合）。&lt;/p>
&lt;ul>
&lt;li>Windows の場合: &lt;code>C:\Users\maku\AppData\Local\Android\Sdk\emulator\emulator.exe&lt;/code>&lt;/li>
&lt;li>macOS の場合: &lt;code>/Users/maku/Library/Android/sdk/emulator/emulator&lt;/code>&lt;/li>
&lt;/ul>
&lt;p>次のような感じで OS のパスを通しておくと、どこからでもコマンドを実行できるようになります。&lt;/p>

&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">~/.zlogin（macOS で zsh の場合）&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">&lt;span class="nb">export&lt;/span> &lt;span class="nv">ANDROID_HOME&lt;/span>&lt;span class="o">=&lt;/span>~/Library/Android/sdk
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">export&lt;/span> &lt;span class="nv">PATH&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="nv">$PATH&lt;/span>:&lt;span class="nv">$ANDROID_HOME&lt;/span>/cmdline-tools/latest/bin
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">export&lt;/span> &lt;span class="nv">PATH&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="nv">$PATH&lt;/span>:&lt;span class="nv">$ANDROID_HOME&lt;/span>/platform-tools
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">export&lt;/span> &lt;span class="nv">PATH&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="nv">$PATH&lt;/span>:&lt;span class="nv">$ANDROID_HOME&lt;/span>/emulator
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">export&lt;/span> &lt;span class="nv">PATH&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="nv">$PATH&lt;/span>:&lt;span class="nv">$ANDROID_HOME&lt;/span>/tools&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>

&lt;div class="xNote">
 &lt;span class="xNote_title">☝️ emulator/emulator と tools/emulator&lt;/span>
 &lt;span class="xNote_body">&lt;code>tools&lt;/code> ディレクトリにも同名の &lt;code>emulator&lt;/code> コマンドがあったりしますが、こちらではなく、&lt;code>emuator&lt;/code> ディレクトリの方にあるコマンドを使うのが正解のようです。
なので、パスを通すときは、&lt;code>emulator&lt;/code> ディレクトリが先に来るように指定しておく必要があります。&lt;/span>
&lt;/div>
&lt;h2 id="emulator-コマンドの使用例">emulator コマンドの使用例&lt;/h2>

&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">AVD（エミュレーター端末）のリストを表示する (emulator -list-avds)&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-console" data-lang="console">&lt;span class="line">&lt;span class="cl">&lt;span class="gp">$&lt;/span> emulator -list-avds
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">phone-s
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">phone-t
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">tv-s
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">tv-t
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>

&lt;p>AVD 名には、上記のようなシンプルな名前を付けておくのがおすすめです。
エミュレーターを起動するときに AVD を指定するのが楽になります。&lt;/p></description></item><item><title>Android エミュレーター内のサーバーに外部からアクセスする (adb forward)</title><link>https://maku77.github.io/p/q6r98p8/</link><pubDate>Fri, 21 Oct 2022 00:00:00 +0900</pubDate><guid>https://maku77.github.io/p/q6r98p8/</guid><description>&lt;h2 id="android-エミュレーターへのポート転送-adb-forward">Android エミュレーターへのポート転送 (adb forward)&lt;/h2>
&lt;p>サーバー機能を持つ Android アプリをエミュレーターで動作させているときに、ホスト PC の外からエミュレーター内のサーバーにアクセスするには、&lt;strong>&lt;code>adb forward&lt;/code>&lt;/strong> コマンドによるポート転送の設定が必要です。
例えば、次のようにフォワード設定すると、ホスト PC の &lt;code>9080&lt;/code> 番ポートへのアクセスが、エミュレーターの &lt;code>8080&lt;/code> 番ポートへ転送されるようになります。&lt;/p>

&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">PC の 9080 ポートをエミュレーターの 8080 ポートへ転送&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-console" data-lang="console">&lt;span class="line">&lt;span class="cl">&lt;span class="gp">$&lt;/span> adb forward tcp:9080 tcp:8080
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">9080
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>

&lt;p>次の図は、Android エミュレーターを動かしている開発用 PC (&lt;code>192.168.1.1&lt;/code>) を経由して、エミュレーター内の Web サーバーにアクセスする構成を示しています。&lt;/p>


&lt;figure class="xImage">
 &lt;img style="" width="700" height="auto" src="../p/q6r98p8/img-001.drawio.svg" alt="/p/q6r98p8/img-001.drawio.svg" />
 &lt;figcaption>図: adb forward によるポート転送&lt;/figcaption>
&lt;/figure>

&lt;p>外部の端末（PC やスマホ）から見ると、開発 PC (&lt;code>192.168.1.1&lt;/code>) 上で Web サーバーが動いているかのように見えます。
Web ブラウザーで &lt;code>http://192.168.1.1:9080&lt;/code> という URL を開けば、エミュレーター内の Web サーバーに繋がります。
開発 PC 上で Web ブラウザーを開いてアクセスする場合は、自分自身にアクセスする形になるので、&lt;code>http://localhost:9080&lt;/code> や &lt;code>http://127.0.0.1:9080&lt;/code> のようなループバックアドレスを指定します。
この構成は、Android アプリ内のサーバープログラムを、PC 上のツールを使ってデバッグしたいときに便利です。&lt;/p>
&lt;p>正確に言うと、&lt;code>adb forward&lt;/code> によるポート転送はエミュレーター専用というわけではないので、USB で接続されている Android 端末への転送も可能です。
ただ、通常、物理スマホなどは直接 LAN に繋がっていることが多いので、ポート転送が必要になるケースは少ないでしょう（&lt;code>adb shell ip addr&lt;/code> で端末のアドレスを確認して直接アクセスした方が早い）。&lt;/p></description></item><item><title>Golang で Android 上で動く CLI コマンドを作成する (go build)</title><link>https://maku77.github.io/p/ftducta/</link><pubDate>Fri, 21 Oct 2022 00:00:00 +0900</pubDate><guid>https://maku77.github.io/p/ftducta/</guid><description>&lt;h2 id="何をするか">何をするか？&lt;/h2>
&lt;p>Golang（Go 言語）のクロスコンパイル機能を使うと、Android 上で動作するコマンドラインツール (CLI) を簡単に作成することができます。
Android 端末上で何らかの解析をするときに、Android 組み込みの Linux コマンドだとちょっと足りないな、といったときに便利です。
ここでは、Golang で簡単な Hello World アプリをビルドして、Android 端末上で動かしてみます。&lt;/p>
&lt;ul>
&lt;li>Go 言語全般に関してはこちらを参照 → &lt;a href="../go/">まくまく Golang ノート&lt;/a>&lt;/li>
&lt;/ul>
&lt;h2 id="android-端末の-cpu-アーキテクチャを確認しておく">Android 端末の CPU アーキテクチャを確認しておく&lt;/h2>
&lt;p>Golang でのクロスコンパイル時に CPU アーキテクチャを指定する必要があるので、対象の Anrdoid 端末のアーキテクチャを先に確認しておきます。
&lt;code>adb shell&lt;/code> で Android 端末にシェル接続して、&lt;strong>&lt;code>uname -a&lt;/code>&lt;/strong> コマンドの末尾あたりで確認してしまうのが手っ取り早いです。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-console" data-lang="console">&lt;span class="line">&lt;span class="cl">&lt;span class="gp">$&lt;/span> adb shell uname -a
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">Linux localhost 5.10.100 #1 SMP PREEMPT Thu Mar 17 17:10:36 UTC 2022 aarch64
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;code>arm&lt;/code> や &lt;code>aarch&lt;/code> という文字列が入っていたら、&lt;strong>ARM&lt;/strong> アーキテクチャの CPU だと思ってよいです。&lt;/p>
&lt;h2 id="golang-プログラムをビルドする">Golang プログラムをビルドする&lt;/h2>
&lt;p>下記は、Golang の Hello World プログラムです。&lt;/p></description></item><item><title>ADB で Android 端末にインストールされているパッケージの一覧を取得する (pm list packages)</title><link>https://maku77.github.io/p/uh84kfj/</link><pubDate>Thu, 21 Apr 2022 00:00:00 +0900</pubDate><guid>https://maku77.github.io/p/uh84kfj/</guid><description>&lt;p>（確認バージョン: Android 12 (S)）&lt;/p>
&lt;h2 id="pm-list-packages-コマンド">pm list packages コマンド&lt;/h2>
&lt;p>&lt;strong>&lt;code>adb shell pm list packages&lt;/code>&lt;/strong> コマンドを使用すると、Android デバイスにインストールされているパッケージ (APK) の一覧を取得できます。
パッケージ名は順不同で表示されるので、出力をパイプで &lt;code>sort&lt;/code> につなぐと見やすくなります。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-console" data-lang="console">&lt;span class="line">&lt;span class="cl">&lt;span class="gp">$&lt;/span> adb shell pm list packages &lt;span class="p">|&lt;/span> sort
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">...
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">package:com.google.android.apps.maps
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">package:com.google.android.apps.messaging
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">package:com.google.android.apps.nexuslauncher
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">package:com.google.android.apps.photos
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">package:com.google.android.apps.restore
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">package:com.google.android.apps.wallpaper
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">...
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;strong>&lt;code>-f&lt;/code>&lt;/strong> オプションを付けて実行すると、各 APK の &lt;strong>インストール先のパス&lt;/strong> を調べることができます。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-console" data-lang="console">&lt;span class="line">&lt;span class="cl">&lt;span class="gp">$&lt;/span> adb shell pm list packages -f &lt;span class="p">|&lt;/span> sort
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">...
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">package:/system/priv-app/UserDictionaryProvider/UserDictionaryProvider.apk=com.android.providers.userdictionary
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">package:/system/priv-app/VpnDialogs/VpnDialogs.apk=com.android.vpndialogs
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">package:/system_ext/priv-app/CarrierConfig/CarrierConfig.apk=com.android.carrierconfig
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">package:/system_ext/priv-app/EmergencyInfo/EmergencyInfo.apk=com.android.emergency
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">...
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;strong>&lt;code>-3&lt;/code>&lt;/strong> オプションを付けて実行すると、&lt;strong>サードパーティ製のパッケージ&lt;/strong> の一覧を表示できます。
つまり、Google Play ストアからインストールしたアプリや、自分で作ってインストールしたアプリの一覧を確認できます。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-console" data-lang="console">&lt;span class="line">&lt;span class="cl">&lt;span class="gp">$&lt;/span> adb shell pm list packages -3
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">package:com.example.myapp
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">package:com.example.myapp2
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="おまけpm-help-のヘルプ表示抜粋">（おまけ）pm help のヘルプ表示抜粋&lt;/h2>
&lt;p>&lt;code>adb shell pm help&lt;/code> のヘルプ表示のうち、&lt;code>pm list packages&lt;/code> コマンドに相当する部分の抜粋です。&lt;/p></description></item><item><title>ADB で Android 端末のバージョンや API レベルを調べる (getprop)</title><link>https://maku77.github.io/p/bg2g4bu/</link><pubDate>Thu, 21 Apr 2022 00:00:00 +0900</pubDate><guid>https://maku77.github.io/p/bg2g4bu/</guid><description>&lt;p>ADB 経由で &lt;strong>&lt;code>adb shell getprop&lt;/code>&lt;/strong> コマンドを実行すると、Android 端末に設定されたシステムプロパティの一覧を取得することができます。
この中には、Android バージョンの情報も含まれています。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-console" data-lang="console">&lt;span class="line">&lt;span class="cl">&lt;span class="gp">$&lt;/span> adb shell getprop &lt;span class="p">|&lt;/span> grep &lt;span class="s2">&amp;#34;ro.product.build.version&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">[ro.product.build.version.incremental]: [8015633]
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">[ro.product.build.version.release]: [12]
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">[ro.product.build.version.release_or_codename]: [12]
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">[ro.product.build.version.sdk]: [32]
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>この出力から次のようなことがわかります。&lt;/p>
&lt;ul>
&lt;li>&lt;code>8015633&lt;/code> &amp;hellip; ビルドナンバー&lt;/li>
&lt;li>&lt;code>12&lt;/code> &amp;hellip; Android のバージョン（この場合は Android S(12) を示す）&lt;/li>
&lt;li>&lt;code>32&lt;/code> &amp;hellip; SDK バージョン&lt;/li>
&lt;/ul></description></item><item><title>Androidメモ: Jetpack Compose の宣言型 (declarative) の UI 定義とは？</title><link>https://maku77.github.io/p/4kdso44/</link><pubDate>Wed, 07 Jul 2021 00:00:00 +0900</pubDate><guid>https://maku77.github.io/p/4kdso44/</guid><description>&lt;h2 id="jetpack-compose-の宣言型プログラミングとは">Jetpack Compose の宣言型プログラミングとは？&lt;/h2>
&lt;p>2021 年の Google I/O で、&lt;a href="https://developer.android.com/jetpack/compose?hl=ja">Jetpack Compose&lt;/a> が正式リリース (v1.0.0) されることが発表されました。
Compose は Android の新しい UI フレームワークで、&lt;strong>declarative（宣言的）&lt;/strong> に UI を定義することができるのが特徴的です。
正確には、Compose のトップページでは declarative ではなく、&lt;strong>intuitive（直感的）&lt;/strong> という表現がされているのですが、ソフトウェア開発の世界では declarative（宣言的）といった方が伝わりやすいと思います。&lt;/p>
&lt;p>宣言型（宣言的）な UI 定義を一言で説明すると、「&lt;strong>最終的に実現したいことを記述する&lt;/strong>」というアプローチです。
Jetpack のトップページには、次のようなサンプルコードが掲載されています。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-kotlin" data-lang="kotlin">&lt;span class="line">&lt;span class="cl">&lt;span class="nd">@Composable&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">fun&lt;/span> &lt;span class="nf">JetpackCompose&lt;/span>&lt;span class="p">()&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">Card&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">var&lt;/span> &lt;span class="py">expanded&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="k">by&lt;/span> &lt;span class="n">remember&lt;/span> &lt;span class="p">{&lt;/span> &lt;span class="n">mutableStateOf&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="k">false&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">Column&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nc">Modifier&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">clickable&lt;/span> &lt;span class="p">{&lt;/span> &lt;span class="n">expanded&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="p">!&lt;/span>&lt;span class="n">expanded&lt;/span> &lt;span class="p">})&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">Image&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">painterResource&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nc">R&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">drawable&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">jetpack_compose&lt;/span>&lt;span class="p">))&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">AnimatedVisibility&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">expanded&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">Text&lt;/span>&lt;span class="p">(&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">text&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="s2">&amp;#34;Jetpack Compose&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">style&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="nc">MaterialTheme&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">typography&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">h2&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>これは、ひとつのカード (Card) を表示するためのコードですが、多くの人がこのコードをパッと見たときの感想は、「ナニコレ？オイシイノ？」だと思います。
ポイントは、「こういった状態であれば、こう表示するよ」とだけ記述しているところです。&lt;/p>
&lt;p>これでもまだ伝わらないかもしれないので、もう少し具体的な例で説明します。
例えば、あるアプリの「状態 A」では「ボタンを 3 つ表示する」とします。
declarative（宣言的）なコードと、従来の imperative（命令的）なコードでは、実装が次のように変ってきます。&lt;/p>
&lt;ul>
&lt;li>declarative（宣言的）なコード
&lt;ul>
&lt;li>状態 A なので、ボタンを 3 つ表示する。&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>imperative（命令的）なコード
&lt;ul>
&lt;li>状態 A なので、ボタンを 3 つ表示する必要がある。ただし、すでに中央のボタンを表示しているので、その左右にひとつずつボタンを追加する。&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;p>従来の、XML のレイアウトファイルを使って Kotlin コードでゴリゴリ制御するというやり方は、後者の imperative（命令的）な実装です。
実装者が、現在のアプリ状態と、UI の表示状態をうまく整合性が取れるように制御してやる必要がありました。
Compose を使うと、最終的な表示結果を意識すればよいので、実装者の負担が減り、コードの見通しもよくなります。&lt;/p></description></item><item><title>dumpsys gfxinfo でジャンクフレームの発生率を調べる（60FPSの確認）</title><link>https://maku77.github.io/p/26hr2bk/</link><pubDate>Tue, 09 Mar 2021 00:00:00 +0900</pubDate><guid>https://maku77.github.io/p/26hr2bk/</guid><description>&lt;h2 id="janky-frames-情報を取得する">Janky frames 情報を取得する&lt;/h2>
&lt;p>Android デバイス上で実行可能なコマンド &lt;strong>&lt;code>dumpsys gfxinfo&lt;/code>&lt;/strong> を使用すると、指定したアプリにおける Janky frames（ジャンクフレーム）の発生率を調べることができます。
Janky frame の説明は「dropped frame」と書かれていたりしますが、60FPS 出ていないフレーム（16.6ミリ秒以上かかったフレーム）だと考えればよいと思います。
アプリの UI が、どの程度ぬるぬるさくさくなアニメーション (60FPS) を達成できているかを定量的に調べたいときに使えるかもしれません。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-console" data-lang="console">&lt;span class="line">&lt;span class="cl">&lt;span class="gp">$&lt;/span> adb shell dumpsys gfxinfo com.example.myapp &lt;span class="p">|&lt;/span> grep frames
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">Total frames rendered: 544
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">Janky frames: 242 (44.56%)
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>本来 &lt;code>dumpsys gfxinfo&lt;/code> の出力はもっと長いのですが、上記では &lt;code>frames&lt;/code> という単語で grep してフィルタしちゃってます（Windows なら &lt;code>findstr&lt;/code> を使えば OK）。
Janky frames の発生率を確認したいのであれば、これが手っ取り早いです。
&lt;code>dumpsys gfxinfo&lt;/code> の詳細は下記ドキュメントが参考になります。&lt;/p>
&lt;ul>
&lt;li>参考: &lt;a href="https://developer.android.com/training/testing/performance?hl=ja">UI パフォーマンスをテストする｜Android デベロッパー&lt;/a>&lt;/li>
&lt;/ul>
&lt;h2 id="フレームの計測単位">フレームの計測単位&lt;/h2>
&lt;p>&lt;strong>&lt;code>Total frames rendered&lt;/code>&lt;/strong> は、アプリを起動してからの総フレーム数を表しています。
ただし、この数はフレームメトリクスとして計測されたフレームのみが対象で、アニメーションが発生していないときは増加しません。
これは、開発者オプションの &lt;a href="https://developer.android.com/topic/performance/rendering/inspect-gpu-rendering?hl=ja">Profile HWUI rendering&lt;/a> を有効にしたときに、画面上にバーが増えていく速度と同じです。&lt;/p>


&lt;figure class="xImage">
 &lt;img style="border: solid #ccc 2px;" width="637" height="326" src="../p/26hr2bk/img-001.png" alt="/p/26hr2bk/img-001.png" />
 &lt;figcaption>図: Profile HWUI rendering&lt;/figcaption>
&lt;/figure>

&lt;p>Janky frames としてカウントされているのは、このバーが緑色のライン（16.6ミリ秒）を超えているもののようです（太くて濃いバーになっているもの）。
上の図の場合は、最初の30％くらいが緑色の水平ラインを超えているので、Janky frames は約30％ということです。&lt;/p></description></item><item><title>Perfetto でシステム全体のパフォーマンスを計測する</title><link>https://maku77.github.io/p/ehu5eox/</link><pubDate>Tue, 09 Mar 2021 00:00:00 +0900</pubDate><guid>https://maku77.github.io/p/ehu5eox/</guid><description>&lt;h2 id="perfetto-とは">Perfetto とは&lt;/h2>
&lt;p>Android 端末のシステム全体のプロファイリングを行うには、&lt;strong>Perfetto&lt;/strong> というツールを使用します。
システム全体の動作を調査する場合、従来は Systrace を使っていましたが、Android 10 (Q) 以降は、より洗練された Perfetto で分析を行うことができます。&lt;/p>
&lt;ul>
&lt;li>&lt;a href="https://perfetto.dev/">Perfetto - System profiling, app tracing and trace analysis - Perfetto Tracing Docs&lt;/a>&lt;/li>
&lt;/ul>
&lt;p>Android には Perfetto 用のトレースデーモンと、トレースデータを取得するための &lt;strong>&lt;code>perfetto&lt;/code>&lt;/strong> コマンドが標準搭載されています。&lt;/p>
&lt;p>取得したトレースデータは、&lt;a href="https://ui.perfetto.dev/">Perfetto の Web アプリ (Perfetto UI)&lt;/a> から読み込んで、グラフィカルな UI で分析を行うことができます。
開発 PC と Android 端末が Bluetooth や USB 接続されていれば、Perfetto UI から直接トレースデータを取得することができます。&lt;/p>
&lt;h2 id="perfetto-デーモンの有効化">Perfetto デーモンの有効化&lt;/h2>
&lt;p>（この設定は、Android 10 (Q) の端末でのみ必要です。Android 11 (R) 以降は必要ありません）&lt;/p>
&lt;p>&lt;code>perfetto&lt;/code> コマンドでトレースを開始するには、Android 端末上で Perfetto デーモンを起動しておく必要があります。
次のようにシステムプロパティを設定すれば、Perfetto デーモンが起動します。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-console" data-lang="console">&lt;span class="line">&lt;span class="cl">&lt;span class="gp">$&lt;/span> adb shell setprop persist.traced.enable &lt;span class="m">1&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>これは &lt;code>persist&lt;/code> プレフィックスの付いたプロパティなので、設定が不揮発メモリに保存されます。
Android 端末を再起動したときに設定しなおす必要はありません。&lt;/p></description></item><item><title>Android アプリのパフォーマンス改善のためのチェックリスト</title><link>https://maku77.github.io/p/sfqyajt/</link><pubDate>Mon, 08 Mar 2021 00:00:00 +0900</pubDate><guid>https://maku77.github.io/p/sfqyajt/</guid><description>&lt;h2 id="はじめに">はじめに&lt;/h2>
&lt;p>パフォーマンスの最適化を行うには、&lt;strong>フレームワーク特有の知識と、プロファイラによる計測&lt;/strong> の両面から攻めていく必要があります。
アプリケーションを 60FPS の描画性能で動作させるには、1フレームあたりわずか 16.6 ミリ秒で処理を終えなければいけません。
複雑な計算処理や描画を行うアプリケーションにおいて、常に 60FPS を達成するのは非常に大変で、考えるべきことがたくさんあります。
ここでは、Android アプリのパフォーマンス改善のヒントをまとめておきます。&lt;/p>
&lt;h2 id="パフォーマンス可視化自動化のススメ">パフォーマンス可視化自動化のススメ&lt;/h2>
&lt;p>定期的にパフォーマンスに関するプロファイリングを行うのはよいことですが、もっといい方法は、&lt;strong>パフォーマンスに関する計測を自動化＆見える化&lt;/strong> することです。
例えば次のような仕組みを作り、普段の開発では常に有効化しておきます。&lt;/p>
&lt;ol>
&lt;li>各フェーズの実行にかかった時間を、画面上に自動で表示する&lt;/li>
&lt;li>画面上に FPS を表示する&lt;/li>
&lt;li>各端末のパフォーマンス（メトリクス情報）を自動でサーバーに送り、統計をグラフ化する&lt;/li>
&lt;/ol>
&lt;p>このような仕組みを作り込んでおけば、&lt;strong>チームメンバー全員が普段からパフォーマンスを意識&lt;/strong> して開発できるようになります。
アーキテクトだけにプロファイリング作業を任せたり、プロジェクト終盤になってからパフォーマンス計測をはじめたりするのはやめましょう。
コードを作り込んでからデータ構造やスレッド戦略を変更するのはとても大変で、手遅れになることが多いです。&lt;/p>
&lt;p>上記の仕組みによって表示された結果は、製品リリースのためのパフォーマンスクライテリアを満たしているかの指標にもなります。&lt;/p>
&lt;h2 id="まずは計測">まずは計測&lt;/h2>
&lt;ol>
&lt;li>FPS の確認（1 フレームあたり何ミリ秒かかっているか）
&lt;ul>
&lt;li>開発者オプションから GPU バー表示を ON にして確認
&lt;ul>
&lt;li>&lt;a href="https://developer.android.com/topic/performance/rendering/inspect-gpu-rendering?hl=ja">GPU レンダリング速度のプロファイリング&lt;/a>&lt;/li>
&lt;li>&lt;a href="../p/bn8q8o6/">Profile HWUI rendering の設定は ADB で OFF/ON する&lt;/a> と素早く切り替えられる&lt;/li>
&lt;li>何らかの操作をしているときに、&lt;strong>赤色のライン (16.6ms) を上回ることがないか&lt;/strong> を調べる&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>&lt;a href="https://developer.android.com/reference/kotlin/android/view/Window.OnFrameMetricsAvailableListener?hl=ja">Window.OnFrameMetricsAvailableListener&lt;/a> でフレームごとのメトリクス情報を取得できる&lt;/li>
&lt;li>&lt;a href="https://firebase.google.com/">Firebase&lt;/a> などを使えるのであれば、メトリクス情報をサーバー集計することが可能&lt;/li>
&lt;li>&lt;a href="../p/imx8hr2/">Choreographer を使ってプログラム内で FPS を確認する&lt;/a> 方法もあり&lt;/li>
&lt;li>&lt;code>adb shell dumpsys gfxinfo PKG名 | grep frames&lt;/code> で &lt;a href="../p/26hr2bk/">ジャンクフレーム発生率を調べる&lt;/a>&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>オーバードローの確認（Debug GPU overdraw で何度も重ねて描画している部分がないか確認）&lt;/li>
&lt;li>レイアウトの確認（&lt;a href="https://developer.android.com/studio/debug/layout-inspector?hl=ja">Layout Inspector&lt;/a> で無駄なネストを確認）&lt;/li>
&lt;li>全般的なボトルネックの確認
&lt;ul>
&lt;li>&lt;a href="https://developer.android.com/studio/profile/cpu-profiler?hl=ja">CPU Profiler&lt;/a> でアプリ内のボトルネックを調査（Traceview はサポート終了）
&lt;ul>
&lt;li>各スレッドのビジー状態や、&lt;strong>どのメソッドに時間がかかっているか&lt;/strong> を調べる → メソッド単位の最適化&lt;/li>
&lt;li>&lt;strong>GC (Garbage Collection) が頻繁に発生していないか&lt;/strong> を調べる (Perfeto/SystraceAllocation Tracker)。&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>&lt;a href="../p/ehu5eox/">Perfetto でシステム全体のボトルネックを調査&lt;/a>
&lt;ul>
&lt;li>他のプロセスとの Binder 通信などがボトルネックになっていなかを調べる&lt;/li>
&lt;li>&lt;code>adb shell perfetto&lt;/code> で計測開始するか、Perfetto の Web アプリから直接データ取得可能（要 Bluetooth/USB 接続）&lt;/li>
&lt;li>昔は &lt;a href="https://developer.android.com/topic/performance/tracing/command-line?hl=ja">Systrace&lt;/a> だったけど、Android 10 以降は Perfetto で。&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ol>
&lt;h2 id="改善ポイント">改善ポイント&lt;/h2>
&lt;ol>
&lt;li>背景色描画の削減
&lt;ul>
&lt;li>背景色は、テーマ、Activity、Fragment、View のいずれかのレイヤで一回のみ指定する&lt;/li>
&lt;li>テーマの背景色が余計なときは、テーマの定義で &lt;code>android:windowbackground=&amp;quot;null&amp;quot;&lt;/code> するか、Activity で &lt;strong>&lt;code>window.setBackgroundDrawable(null)&lt;/code>&lt;/strong> する&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>カスタムビュー内のオーバードローをチェック
&lt;ul>
&lt;li>&lt;code>onDraw&lt;/code> 内の描画で重なって見えない部分は &lt;strong>&lt;code>clipRect&lt;/code>&lt;/strong> でマスクする。カスタムビューの描画内容は Android フレームワークが最適化することができない&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>レイアウトをフラット化
&lt;ul>
&lt;li>ListView → ConstraintLayout / RelativeLayout&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>レイアウトリソースの Inflate 時間短縮
&lt;ul>
&lt;li>Layout XML の Inflate 処理時間が短縮したいなら、&lt;strong>レイアウト情報をハードコード&lt;/strong> する手もあり&lt;/li>
&lt;li>カスタムビューにして &lt;code>onDraw&lt;/code> を実装&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>スレッド戦略
&lt;ul>
&lt;li>各種処理をどのようなスレッド上で実行するか設計する。各メソッドに &lt;a href="https://developer.android.com/studio/write/annotations?hl=ja#thread-annotations">スレッドアノテーション&lt;/a> を付けてみる（Main/UI、Worker スレッド間の呼び出しで警告してくれる）&lt;/li>
&lt;li>Kotlin のコルーチンで実行スレッドを分ける。
&lt;ul>
&lt;li>&lt;code>Dispatcher.Main&lt;/code> &amp;hellip; メインスレッド（ここの処理は最小限に）&lt;/li>
&lt;li>&lt;strong>&lt;code>Dispatcher.Default&lt;/code>&lt;/strong> &amp;hellip; ワーカースレッド（&lt;strong>ほとんどの処理はここで実行する&lt;/strong>）&lt;/li>
&lt;li>&lt;code>Dispatcher.IO&lt;/code> &amp;hellip; I/O アクセス、ネットワーク処理など&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>メインスレッドの処理を極小化
&lt;ul>
&lt;li>例えば、Android のユーザー入力イベントはメインスレッドでハンドルされるので、ViewModel のメソッドをトリガにコルーチン起動 (&lt;code>viewModelScope.launch&lt;/code>) し、その中から戻り値なしの別コンテキスト（スレッド）処理を呼び出し (&lt;code>withContext(Dispatcher.Default)&lt;/code>) て、メインスレッドはそのまま抜けるようにする。画面反映は LiveData からの更新通知のタイミングで行えばよい。&lt;strong>ViewModel クラスには戻り値を持つ public メソッド (getter) を作らないということ&lt;/strong>（それは同期処理を意味する）。&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>並列化できる処理を見極める
&lt;ul>
&lt;li>&lt;strong>順序依存のない処理は同時に開始する&lt;/strong> ように書き換える（とくに画面遷移後の初期化処理など）&lt;/li>
&lt;li>最後に Join の必要な並列処理は &lt;code>coroutineScope { ... async { ... }}&lt;/code> など&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>スレッドのキャンセル、間引き処理
&lt;ul>
&lt;li>キー連打や同種のイベントが連続発生する可能性がある場合は、要求をコマンド化してキューイングして間引く（Command パターン）&lt;/li>
&lt;li>あえてシングルスレッドでキュー処理して (&lt;code>SingleThreadExecutor&lt;/code>)、新しい要求が来たらキューを空にするとか（最新要求だけ処理）&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>排他制御のデザインパターン
&lt;ul>
&lt;li>排他制御によるロック時間を最小化するパターンを学ぶ。例えば、Read-Write Lock パターンでは、Read スレッド同士は排他制御する必要がないことを示している（Java の標準クラスにも &lt;code>ReadWriteLock&lt;/code> がある）。&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>頻繁な GC の抑制
&lt;ul>
&lt;li>&lt;code>onDraw&lt;/code> 内でオブジェクト生成しないようにする（アニメーション中の GC 発生を抑制）&lt;/li>
&lt;li>ループ内で一時オブジェクトを生成しないようにする&lt;/li>
&lt;li>Flyweight パターンでオブジェクトを共有する&lt;/li>
&lt;li>オブジェクトプールでオブジェクトを使いまわす（Android の &lt;a href="https://developer.android.com/reference/android/os/Message">Message クラス&lt;/a> が参考になる (&lt;code>Message.obtain()&lt;/code> でプールから取得 → &lt;code>recycle()&lt;/code> でプールに戻す)）&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>その他
&lt;ul>
&lt;li>キャッシュ関連処理は全般的に難しいが重要
&lt;ul>
&lt;li>時間のかかる関数呼び出し結果はメモ化&lt;/li>
&lt;li>キャッシュコントロール（いつ消すかなど）は、基本的には HTTP の Cache-Control レスポンスヘッダの stale-while-revalidate 拡張 (&lt;a href="https://datatracker.ietf.org/doc/html/rfc5861">RFC 5861&lt;/a>) を参考にするとよい。簡単にいうと、キャッシュで高速に描画しつつ、背後でキャッシュの更新処理を走らせるという考え方。&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>シーケンシャルサーチ (&lt;code>indexOf&lt;/code>) 処理はマップ処理に置き換える（&lt;code>O(n) → O(1)&lt;/code>）&lt;/li>
&lt;li>ログ出力用のオブジェクト生成（主にテキスト構築）を削除（&lt;code>if (DEBUG)&lt;/code> で引数生成部分ごと囲む）&lt;/li>
&lt;li>画像ファイルに PNG ではなく WebP フォーマットを使用する&lt;/li>
&lt;li>起動時 (&lt;code>onCreate&lt;/code>) での初期化コードは最低限にする（各種処理の遅延化）
&lt;ul>
&lt;li>&lt;code>onResume&lt;/code> へ遅らせる&lt;/li>
&lt;li>スレッド起動するだけにする&lt;/li>
&lt;li>レイアウトの Inflate 処理を遅らせる (&lt;a href="https://developer.android.com/reference/android/view/ViewStub">ViewStub&lt;/a> で次のフレームへ遅らせる）&lt;/li>
&lt;li>DI による依存注入処理を Dagger/Hilt で遅延させる&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>コールバックオブジェクトの共通化&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ol>
&lt;h2 id="補足メモ">補足メモ&lt;/h2>
&lt;h3 id="android-profiler-で関数レベルのボトルネックを探る">Android Profiler で関数レベルのボトルネックを探る&lt;/h3>
&lt;ul>
&lt;li>Android Studio の Android Profiler から CPU ペーンを開き、&lt;code>Record&lt;/code> ボタンを押してレコード開始 → 何らかの操作をしてレコード停止&lt;/li>
&lt;li>レコード中は動作が重くなるので、トレース結果は実時間で速度を見るのでなく、全体時間に対してどの程度の割合で時間がかかっているかで見る&lt;/li>
&lt;li>正確に呼び出し情報をトレースするために、プロファイルモードで &lt;code>Trace Java Methods&lt;/code> を選択しておく。&lt;code>Sample Java Methods&lt;/code> は一定間隔でサンプリングするだけなので、動作は軽いけど正確な呼び出し情報が取れない&lt;/li>
&lt;li>Android Profiler でデバイスを認識しない時は、デバイス側の開発者オプションで USB デバッグが有効になっているかを確かめる&lt;/li>
&lt;li>本質的に遅いメソッドを見つけるには、&lt;strong>&lt;code>Bottom Up&lt;/code>&lt;/strong> タブを選択 → &lt;strong>&lt;code>Self&lt;/code>&lt;/strong> 時間でソートする&lt;/li>
&lt;li>先に main スレッドのチャート上でメソッドを選択しておくと、右側の分析ペーンの結果をフィルタできる&lt;/li>
&lt;/ul>


&lt;figure class="xImage">
 &lt;img style="" width="1044" height="530" src="../p/sfqyajt/img-001.png" alt="/p/sfqyajt/img-001.png" />
 &lt;figcaption>図: Android Studio の Profiler 機能&lt;/figcaption>
&lt;/figure>

&lt;h3 id="layout-inspector-で無駄なレイアウト構成を見つける">Layout Inspector で無駄なレイアウト構成を見つける&lt;/h3>
&lt;p>アプリ動作中に &lt;a href="https://developer.android.com/studio/debug/layout-inspector?hl=ja">Layout Inspector&lt;/a> を起動すると、リアルタイムに現在のレイアウト構造を確認することができます（Hierarchy Viewer はサポート終了）。
パフォーマンスへの影響を見るときは、主にレイアウトが &lt;strong>深いネスト構造になっていないか&lt;/strong> を調べます。
Layout Inspector は 3D 表示にして角度をずらして、Layer spacing スライダーを調整すると、どれだけ重なっているかがよく分かかります。&lt;/p></description></item><item><title>ADB で描画パフォーマンス計測のデバッグ機能を有効にする</title><link>https://maku77.github.io/p/bn8q8o6/</link><pubDate>Fri, 29 Jan 2021 00:00:00 +0900</pubDate><guid>https://maku77.github.io/p/bn8q8o6/</guid><description>&lt;p>&lt;strong>Android の開発者向けオプション (Developer options)&lt;/strong> には、描画パフォーマンスなどを測定するための便利なツールが揃っています。
特に、GPU オーバードロー領域の表示や、レンダリングプロファイル（画面上にバー表示）は、描画パフォーマンス 60 FPS を達成するために必須のツールです。&lt;/p>
&lt;p>でも、これらの設定項目は設定メニューの深いところにあって、&lt;strong>ホーム画面に戻って毎回切り替えるのは手間がかかります&lt;/strong>。
実はこれらのオプション設定は、&lt;code>adb shell&lt;/code> から &lt;code>setprop&lt;/code> コマンドを実行することで簡単に切り替えることができます。
コマンドからこれらの設定を変更した場合は、すぐに設定が有効にならないことがあるので注意してください。
その場合は、アプリの再起動や、アプリ内での画面遷移などを発生させると有効になるようです。&lt;/p>
&lt;h2 id="各種デバッグ項目の-adb-からの設定方法">各種デバッグ項目の ADB からの設定方法&lt;/h2>
&lt;h3 id="show-view-updatesgpu表示の更新を表示">Show view updates（GPU表示の更新を表示）&lt;/h3>
&lt;p>ON にすると、GPU での描画時にウィンドウ内の表示を点滅させます。
(Flash views inside windows when drawn)&lt;/p>
&lt;table>
 &lt;thead>
 &lt;tr>
 &lt;th>設定方法&lt;/th>
 &lt;th>意味&lt;/th>
 &lt;/tr>
 &lt;/thead>
 &lt;tbody>
 &lt;tr>
 &lt;td>&lt;code>adb shell setprop debug.hwui.show_dirty_regions false&lt;/code>&lt;/td>
 &lt;td>GPU描画点滅を OFF&lt;/td>
 &lt;/tr>
 &lt;tr>
 &lt;td>&lt;code>adb shell setprop debug.hwui.show_dirty_regions false&lt;/code>&lt;/td>
 &lt;td>GPU描画点滅を ON&lt;/td>
 &lt;/tr>
 &lt;/tbody>
&lt;/table>
&lt;h3 id="show-hardware-layers-updatesハードウェア層情報を表示">Show hardware layers updates（ハードウェア層情報を表示）&lt;/h3>
&lt;p>ON にすると、ハードウェア層が更新されると緑を表示します。
(Flash hardware layers green when they update)&lt;/p>
&lt;p>GPU を活用した描画が行えているのであれば、GPU 層での更新は頻繁に発生するものではありません。
新しいビューが生成されたときのみ緑色のフラッシュが発生していれば OK です。&lt;/p>
&lt;table>
 &lt;thead>
 &lt;tr>
 &lt;th>設定方法&lt;/th>
 &lt;th>意味&lt;/th>
 &lt;/tr>
 &lt;/thead>
 &lt;tbody>
 &lt;tr>
 &lt;td>&lt;code>adb shell setprop debug.hwui.show_layers_updates false&lt;/code>&lt;/td>
 &lt;td>HW層更新表示を OFF&lt;/td>
 &lt;/tr>
 &lt;tr>
 &lt;td>&lt;code>adb shell setprop debug.hwui.show_layers_updates true&lt;/code>&lt;/td>
 &lt;td>HW層更新表示を ON&lt;/td>
 &lt;/tr>
 &lt;/tbody>
&lt;/table>
&lt;h3 id="debug-gpu-overdrawgpu-オーバードローをデバッグ">Debug GPU overdraw（GPU オーバードローをデバッグ）&lt;/h3>
&lt;p>ON にすると、何度も重ねて描画されてしまっている部分を色付きで表示します。
緑色や赤色の矩形がたくさん出てきたら、レイアウトの階層構造や、描画まわりの実装を見直す必要があります。&lt;/p></description></item><item><title>Androidメモ: 数値をある範囲内［min, max］に丸める (MathUtils.clamp)</title><link>https://maku77.github.io/p/qyh8496/</link><pubDate>Mon, 31 Aug 2020 00:00:00 +0900</pubDate><guid>https://maku77.github.io/p/qyh8496/</guid><description>&lt;p>Android アプリの実装で、ある数字を指定した範囲 ［min, max］に収まるように調整したいときは、&lt;strong>&lt;code>MathUtils.clamp()&lt;/code>&lt;/strong> というユーティリティ関数を使用できます。&lt;/p>

&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">例: x の値を [-100, 100] の範囲に収める&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-kotlin" data-lang="kotlin">&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// import androidx.core.math.MathUtils
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">var&lt;/span> &lt;span class="py">x&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="p">-&lt;/span>&lt;span class="m">150&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">x&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="nc">MathUtils&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">clamp&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">x&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="p">-&lt;/span>&lt;span class="m">100&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="m">100&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="c1">//=&amp;gt; -100&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>

&lt;p>&lt;code>clamp()&lt;/code> のような関数は Java のコアライブラリとして提供されていてもよさそうなのですが、現状は存在しないので Android がライブラリとして提供してくれています。
とはいっても、中身は下記のような簡単な実装です。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// MathUtils class&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="kd">public&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kd">static&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kt">int&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nf">clamp&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="kt">int&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">value&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kt">int&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">min&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kt">int&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">max&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">if&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">value&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">min&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">return&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">min&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">else&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">if&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">value&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">max&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">return&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">max&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">return&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">value&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>ちなみに上記の代わりに、次のように書けば同じことができると思うかもしれませんが、&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-kotlin" data-lang="kotlin">&lt;span class="line">&lt;span class="cl">&lt;span class="n">x&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="n">max&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">min&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">x&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="m">100&lt;/span>&lt;span class="p">),&lt;/span> &lt;span class="p">-&lt;/span>&lt;span class="m">100&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>このようにすると、&lt;code>else-if&lt;/code> ではなく全て &lt;code>if&lt;/code> 分岐になってしまい効率が悪いです。&lt;/p></description></item><item><title>Androidメモ: カスタムビューの子ビューがフォーカスを得たことを検出する</title><link>https://maku77.github.io/p/7rhpaxa/</link><pubDate>Wed, 11 Mar 2020 00:00:00 +0900</pubDate><guid>https://maku77.github.io/p/7rhpaxa/</guid><description>&lt;p>Android の &lt;code>View&lt;/code> に対して &lt;code>setOnFocusChangeListener()&lt;/code> でリスナを登録しておくと、その &lt;code>View&lt;/code> がフォーカスを得たり、失ったりしたタイミングを検出することができます。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-kotlin" data-lang="kotlin">&lt;span class="line">&lt;span class="cl">&lt;span class="n">myView&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">setOnFocusChangeListener&lt;/span> &lt;span class="p">{&lt;/span> &lt;span class="n">v&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">hasFocus&lt;/span> &lt;span class="o">-&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// ...
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>しかし、この通知はフォーカス対象となる末端の &lt;code>View&lt;/code> に対してしか送られないため、複数の &lt;code>View&lt;/code> を束ねるカスタムビュー単位でフォーカスが移動したことを判別したい場合は少し工夫が必要です。&lt;/p>
&lt;p>ここでは、次のように 2 つのボタンを持つカスタムビューを縦方向に 3 つ配置し、カスタムビュー間でフォーカスを移動させた場合に、カスタムビュー全体の背景色を変更することを考えてみます（うっすらとフォーカスされたカスタムビューの背景色を緑色にしています）。&lt;/p>


&lt;figure class="xImage">
 &lt;img style="" width="258" height="249" src="../p/7rhpaxa/img-001.gif" alt="/p/7rhpaxa/img-001.gif" />
&lt;/figure>

&lt;p>次のコードはカスタムビューの実装例です。&lt;/p>

&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">MyCustomView.kt&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-kotlin" data-lang="kotlin">&lt;span class="line">&lt;span class="cl">&lt;span class="k">package&lt;/span> &lt;span class="nn">com.example.myapp&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">import&lt;/span> &lt;span class="nn">android.content.Context&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">import&lt;/span> &lt;span class="nn">android.graphics.Color&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">import&lt;/span> &lt;span class="nn">android.util.AttributeSet&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">import&lt;/span> &lt;span class="nn">android.view.LayoutInflater&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">import&lt;/span> &lt;span class="nn">android.view.ViewTreeObserver.OnGlobalFocusChangeListener&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">import&lt;/span> &lt;span class="nn">androidx.constraintlayout.widget.ConstraintLayout&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">class&lt;/span> &lt;span class="nc">MyCustomView&lt;/span> &lt;span class="nd">@JvmOverloads&lt;/span> &lt;span class="k">constructor&lt;/span>&lt;span class="p">(&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">context&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">Context&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">attrs&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">AttributeSet&lt;/span>&lt;span class="p">?&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="k">null&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">defStyleAttr&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">Int&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="m">0&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">)&lt;/span> &lt;span class="p">:&lt;/span> &lt;span class="n">ConstraintLayout&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">context&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">attrs&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">defStyleAttr&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">private&lt;/span> &lt;span class="k">val&lt;/span> &lt;span class="py">focusListener&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="n">OnGlobalFocusChangeListener&lt;/span> &lt;span class="p">{&lt;/span> &lt;span class="n">_&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">_&lt;/span> &lt;span class="o">-&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">findFocus&lt;/span>&lt;span class="p">()&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="k">null&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// このカスタムビュー内からフォーカスが失われた
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="n">setBackgroundColor&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nc">Color&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">DKGRAY&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span> &lt;span class="k">else&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// このカスタムビュー内のいずれかのビューがフォーカスを得た
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="n">setBackgroundColor&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nc">Color&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">rgb&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="m">68&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="m">92&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="m">68&lt;/span>&lt;span class="p">))&lt;/span> &lt;span class="c1">// DKGRAYより少し緑
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">init&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nc">LayoutInflater&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">from&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">context&lt;/span>&lt;span class="p">).&lt;/span>&lt;span class="n">inflate&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nc">R&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">layout&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">my_custom_view&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="k">this&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">viewTreeObserver&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">addOnGlobalFocusChangeListener&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">focusListener&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>

&lt;p>実際にフォーカスが当たるのは、カスタムビュー内の子ビュー (&lt;code>Button&lt;/code>) なので、このカスタムビュー自体の &lt;code>onFocusChanged()&lt;/code> ではフォーカスの移動を検出できません。
そこで、ここでは &lt;strong>&lt;code>ViewTreeObserver.OnGlobalFocusChangeListener&lt;/code>&lt;/strong> を登録して、ビューツリー全体のフォーカス移動タイミングをハンドルするようにしています。&lt;/p>
&lt;p>&lt;code>onGlobalFocusChanged()&lt;/code> が発火したタイミングで &lt;code>ViewGroup.findFocus()&lt;/code> を呼び出し、カスタムビュー内の子ビューがフォーカスを得たのか（あるいは失ったのか）を判定しています。
&lt;code>ViewGroup.findFocus()&lt;/code> は、そのビューツリー以下のビューがフォーカスを持っているときにその参照を返し、持たないときは &lt;code>null&lt;/code> を返すため、何らかの &lt;code>View&lt;/code> 参照が返された場合は、カスタムビュー内の子ビューがフォーカスを持っているのだと判断できます。&lt;/p></description></item><item><title>Androidメモ: Emulator での開発時にキーボードによるキー入力が長押しかどうかを判別する</title><link>https://maku77.github.io/p/2imy2j9/</link><pubDate>Thu, 13 Feb 2020 00:00:00 +0900</pubDate><guid>https://maku77.github.io/p/2imy2j9/</guid><description>&lt;p>Android アプリの開発をエミュレーターで行っているとき、キーボードの Enter キー (&lt;code>KEYCODE_ENTER&lt;/code>) の長押しを **&lt;code>KeyEvent.isLongPress&lt;/code> で判定しようとしてもうまくいきません（&lt;code>true&lt;/code> になりません）。
なぜなら、キーボードのハードウェア的なキーリピート（正確には OS によるキーリピート）が働いてしまい、長押しではなくキー連打だと判定されてしまうからです。&lt;/p>
&lt;div class="xNote">
 &lt;span class="xNote_title">☝️ Android TV における D-Pad 操作の場合&lt;/span>
 &lt;span class="xNote_body">Android TV 用のアプリを開発している場合は、リモコンの決定キー (&lt;code>KEYCODE_DPAD_ENTER&lt;/code>) を長押しすると、&lt;code>KeyEvent.isLongPress&lt;/code> が正しく &lt;code>true&lt;/code> になります。
エミュレーターでの開発時に、&lt;code>KEYCODE_DPAD_ENTER&lt;/code> の代わりにキーボードの Enter キー (&lt;code>KEYCODE_ENTER&lt;/code>) で代替しようとすると、長押しが判定できないという罠にはまります。&lt;/span>
&lt;/div>

&lt;p>下記の &lt;code>LongKeyPressChecker&lt;/code> クラスは、キーボードからのキー入力であっても、そのキーが長押しされているかどうかを判別できるようにするためのユーティリティクラスです。&lt;/p>

&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">LongKeyPressChecker.kt&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-kotlin" data-lang="kotlin">&lt;span class="line">&lt;span class="cl">&lt;span class="k">import&lt;/span> &lt;span class="nn">android.view.KeyEvent&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cm">/**
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cm"> * キーボードによるキー入力が長押しかどうかを判別します。
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cm"> */&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">class&lt;/span> &lt;span class="nc">LongKeyPressChecker&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">companion&lt;/span> &lt;span class="k">object&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// この時間以内に連続してキー入力があったら、そのキーは押しっぱなしだと判断する
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="k">const&lt;/span> &lt;span class="k">val&lt;/span> &lt;span class="py">REPEAT&lt;/span>&lt;span class="n">_INTERVAL_MILLIS&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="m">200&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// 間髪いれずにこの回数だけキー入力があったら長押しされたと判断する
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="k">const&lt;/span> &lt;span class="k">val&lt;/span> &lt;span class="py">LONG&lt;/span>&lt;span class="n">_PRESSED_COUNT&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="m">3&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// 各キーが最後に押された時間と連打回数
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="k">private&lt;/span> &lt;span class="k">val&lt;/span> &lt;span class="py">timeAndCount&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="n">mutableMapOf&lt;/span>&lt;span class="p">&amp;lt;&lt;/span>&lt;span class="n">Int&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">Pair&lt;/span>&lt;span class="p">&amp;lt;&lt;/span>&lt;span class="n">Long&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">Int&lt;/span>&lt;span class="p">&amp;gt;&amp;gt;()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="cm">/**
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cm"> * キーが長押しされたかどうかを判別します。
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cm"> * 下記のいずれか関数の中で毎回呼び出す必要があります。
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cm"> * - onKeyDown
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cm"> * - dispatchKeyEvent
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cm"> * - onUnhandledKeyEvent
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cm"> */&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">fun&lt;/span> &lt;span class="nf">isLongPressed&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">event&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">KeyEvent&lt;/span>&lt;span class="p">):&lt;/span> &lt;span class="n">Boolean&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">event&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">action&lt;/span> &lt;span class="o">!=&lt;/span> &lt;span class="nc">KeyEvent&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">ACTION_DOWN&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="k">false&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// KeyEvent.repeatCount 対応のキーでは KeyEvent.isLongPress を信用する
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="k">if&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">event&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">repeatCount&lt;/span> &lt;span class="p">&amp;gt;&lt;/span> &lt;span class="m">0&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="n">event&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">isLongPress&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">val&lt;/span> &lt;span class="py">key&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">Int&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="n">event&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">keyCode&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">val&lt;/span> &lt;span class="py">time&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">Long&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="n">event&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">downTime&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">val&lt;/span> &lt;span class="py">timeAndCount&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="n">timeAndCount&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">getOrDefault&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">key&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">Pair&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">time&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="m">0&lt;/span>&lt;span class="p">))&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="p">((&lt;/span>&lt;span class="n">time&lt;/span> &lt;span class="p">-&lt;/span> &lt;span class="n">timeAndCount&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">first&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">&amp;lt;&lt;/span> &lt;span class="n">REPEAT_INTERVAL_MILLIS&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// 間髪入れずにキー入力があればカウントアップ
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">timeAndCount&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="n">key&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="n">Pair&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">time&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">timeAndCount&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">second&lt;/span> &lt;span class="p">+&lt;/span> &lt;span class="m">1&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">timeAndCount&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">second&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="n">LONG_PRESSED_COUNT&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// 短時間でのキー入力が一定回数に達したら長押しされたと判断
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="k">return&lt;/span> &lt;span class="k">true&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span> &lt;span class="k">else&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// 前回のキープレスから一定時間が経過していたらそこからカウント開始
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">timeAndCount&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="n">key&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="n">Pair&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">time&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="m">1&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="k">false&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>

&lt;p>使い方は簡単で、&lt;code>View.onKeyDown&lt;/code> などの先頭で &lt;code>isLongPressed&lt;/code> メソッドを呼び出すだけです。
次のようにすれば、キーボードの Enter キー (&lt;code>KEYCODE_ENTER&lt;/code>) が長押しされたかどうかを判別できます。&lt;/p></description></item><item><title>Androidメモ: RecyclerView の基本</title><link>https://maku77.github.io/p/cdtcqag/</link><pubDate>Tue, 12 Nov 2019 00:00:00 +0900</pubDate><guid>https://maku77.github.io/p/cdtcqag/</guid><description>&lt;h2 id="recyclerview-とは">RecyclerView とは&lt;/h2>
&lt;p>Android アプリで多数のコンテンツのリストを表示したいケースでは、&lt;a href="https://developer.android.com/reference/kotlin/androidx/recyclerview/widget/RecyclerView.html">RecyclerView&lt;/a> という UI コンポーネントを使用すると、個々のアイテムの描画用インスタンスを使いまわしながら効率的な描画を行えます。
&lt;code>RecyclerView&lt;/code> によって表示された描画領域をスクロールし、表示されているコンテンツが画面外に消えていくと、その描画用インスタンスが、新たに画面内に入ってきたコンテンツのために使いまわされます。&lt;/p>


&lt;figure class="xImage">
 &lt;img style="" width="600" height="232" src="../p/cdtcqag/img-001_hu9149328495708574086.png" alt="/p/cdtcqag/img-001.png" />
&lt;/figure>

&lt;p>このとき使いまわされる描画用インスタンスを、view holder オブジェクトといい、&lt;a href="https://developer.android.com/reference/kotlin/androidx/recyclerview/widget/RecyclerView.ViewHolder.html">RecyclerView.ViewHolder&lt;/a> を継承して、任意の View を保持するように実装します。&lt;/p>
&lt;p>&lt;code>ListView&lt;/code> などでも複数のコンテンツを並べることはできますが、&lt;code>ListView&lt;/code> は一度にすべてのコンテンツを表示しきってしまえるような場合に使用します。
何十、何百というコンテンツを並べたいときは、&lt;code>RecyclerView&lt;/code> を使用します。&lt;/p>
&lt;h2 id="recyclerview-の構成">RecyclerView の構成&lt;/h2>
&lt;p>RecyclerView は次のような構成要素から成り立っています。&lt;/p>


&lt;figure class="xImage">
 &lt;img style="" width="800" height="287" src="../p/cdtcqag/img-002_hu3635573642306215469.png" alt="/p/cdtcqag/img-002.png" />
&lt;/figure>

&lt;dl>
&lt;dt>RecyclerView&lt;/dt>
&lt;dd>Android アプリ上に表示する View コンポーネントです。&lt;/dd>
&lt;dt>RecyclerView.LayoutManager&lt;/dt>
&lt;dd>&lt;code>RecyclerView&lt;/code> 上の各要素をどのように配置するかのアルゴリズムを実装します。標準のレイアウトマネージャーとして、&lt;a href="https://developer.android.com/reference/kotlin/androidx/recyclerview/widget/LinearLayoutManager.html">LinearLayoutManager&lt;/a> や &lt;a href="https://developer.android.com/reference/kotlin/androidx/recyclerview/widget/GridLayoutManager.html">GridLayoutManager&lt;/a> が用意されていますが、&lt;a href="https://developer.android.com/reference/kotlin/androidx/recyclerview/widget/RecyclerView.LayoutManager.html">LayoutManager&lt;/a> を拡張して独自のレイアウトマネージャーを作成することもできます。&lt;/dd>
&lt;dt>RecyclerView.ViewHolder&lt;/dt>
&lt;dd>&lt;code>RecyclerView&lt;/code> 上の各要素を描画するための &lt;code>View&lt;/code> を保持します。この &lt;code>ViewHolder&lt;/code> インスタンスは、画面外にスクロールアウトしたときに、別の項目を表示するために再利用されます。&lt;/dd>
&lt;dt>RecyclerView.Adapter&lt;/dt>
&lt;dd>&lt;code>RecyclerView&lt;/code> と実際のデータを結びつけ、適切なタイミングで &lt;code>ViewHolder&lt;/code> オブジェクトの生成 (&lt;code>onCreateViewHolder()&lt;/code>) や、表示内容の入れ替え (&lt;code>onBindViewHolder()&lt;/code>) を行います（&lt;code>LayoutManager&lt;/code> から自動的に呼び出されます）。つまり、アプリの開発者は、&lt;code>onCreateViewHolder()&lt;/code> で &lt;code>ViewHolder&lt;/code> インスタンスを生成し、&lt;code>onBindViewHolder()&lt;/code> でその表示内容を更新するように実装するだけでよいことになります。&lt;/dd>
&lt;/dl>
&lt;h2 id="recyclerview-を使った実装">RecyclerView を使った実装&lt;/h2>


&lt;figure class="xImage">
 &lt;img style="border: solid #ccc 2px;" width="240" height="400" src="../p/cdtcqag/img-003_hu5435194188420026368.png" alt="/p/cdtcqag/img-003.png" />
 &lt;figcaption>図: RecyclerViewの表示例&lt;/figcaption>
&lt;/figure>

&lt;p>まず、&lt;code>RecyclerView&lt;/code> を配置したレイアウトファイルを用意します。
&lt;code>LinearLayout&lt;/code> などの &lt;code>ViewGroup&lt;/code> を挟んでもよいのですが、ここではルートに &lt;code>RecyclerView&lt;/code> を配置して、直接 &lt;code>MainActivity.setContentView()&lt;/code> でセットしてしまうことにします。&lt;/p></description></item><item><title>Androidメモ: StrictMode の違反メッセージを Toast で表示する (StrictModeToaster)</title><link>https://maku77.github.io/p/gv2dqi3/</link><pubDate>Wed, 16 Oct 2019 00:00:00 +0900</pubDate><guid>https://maku77.github.io/p/gv2dqi3/</guid><description>&lt;p>Android アプリの実装内で &lt;a href="../p/yvit8zb/">StrictMode の設定&lt;/a>をしておくと、メインスレッドから I/O アクセスなどを行った場合に違反 (violation) 通知を受けることができます。
例えば StrictMode の設定時に、&lt;code>ThreadPolicy.Builder.penaltyLog()&lt;/code> を呼び出しておくと、violation 発生時に Logcat に警告メッセージを出力してくれるようになります。
ここではさらに Toast で発生した violation の名称を表示するようにしてみます。
violation 発生時に Toast 表示を行うことで、violation の見逃しを防ぎやすくなります。&lt;/p>
&lt;h2 id="strictmodetoaster-クラスで-violation-をトースト表示する">StrictModeToaster クラスで violation をトースト表示する&lt;/h2>
&lt;p>下記の &lt;strong>&lt;code>StrictModeToaster&lt;/code>&lt;/strong> クラスを使用すると、StrictMode の violation が発生したときに、violation 名を Toast で表示することができます。
同時に、violation の詳細内容（コールスタック）が Logcat に出力されます。
使い方は、Application クラスなどの先頭で &lt;code>StrictModeToaster.setup()&lt;/code> を呼び出すだけです。&lt;/p>

&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">App.kt&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-kotlin" data-lang="kotlin">&lt;span class="line">&lt;span class="cl">&lt;span class="k">class&lt;/span> &lt;span class="nc">App&lt;/span> &lt;span class="p">:&lt;/span> &lt;span class="n">Application&lt;/span>&lt;span class="p">()&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">override&lt;/span> &lt;span class="k">fun&lt;/span> &lt;span class="nf">onCreate&lt;/span>&lt;span class="p">()&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">super&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">onCreate&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nc">StrictModeToaster&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">setup&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">applicationContext&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>


&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">StrictModeToaster.kt&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-kotlin" data-lang="kotlin">&lt;span class="line">&lt;span class="cl">&lt;span class="k">package&lt;/span> &lt;span class="nn">com.example.myapp&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">import&lt;/span> &lt;span class="nn">android.content.Context&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">import&lt;/span> &lt;span class="nn">android.content.pm.ApplicationInfo&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">import&lt;/span> &lt;span class="nn">android.os.Handler&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">import&lt;/span> &lt;span class="nn">android.os.Looper&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">import&lt;/span> &lt;span class="nn">android.os.StrictMode&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">import&lt;/span> &lt;span class="nn">android.os.strictmode.Violation&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">import&lt;/span> &lt;span class="nn">android.widget.Toast&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">import&lt;/span> &lt;span class="nn">java.util.concurrent.ExecutorService&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">import&lt;/span> &lt;span class="nn">java.util.concurrent.Executors&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cm">/**
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cm"> * StrictMode utility to show a violation message as a toast.
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cm"> * To enable the StrictMode, just call [setup] at the beginning of the application.
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cm"> */&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">object&lt;/span> &lt;span class="nc">StrictModeToaster&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// To show a toast
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="k">private&lt;/span> &lt;span class="k">val&lt;/span> &lt;span class="py">mainThreadHandler&lt;/span> &lt;span class="k">by&lt;/span> &lt;span class="n">lazy&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">Handler&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nc">Looper&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">getMainLooper&lt;/span>&lt;span class="p">())&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">private&lt;/span> &lt;span class="k">lateinit&lt;/span> &lt;span class="k">var&lt;/span> &lt;span class="py">appContext&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">Context&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// To handle violation messages
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="k">private&lt;/span> &lt;span class="k">val&lt;/span> &lt;span class="py">workerThreadExecutor&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">ExecutorService&lt;/span> &lt;span class="k">by&lt;/span> &lt;span class="n">lazy&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nc">Executors&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">newSingleThreadExecutor&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">private&lt;/span> &lt;span class="k">val&lt;/span> &lt;span class="py">vmViolationListener&lt;/span> &lt;span class="k">by&lt;/span> &lt;span class="n">lazy&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nc">StrictMode&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">OnVmViolationListener&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">::&lt;/span>&lt;span class="n">showViolationName&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">private&lt;/span> &lt;span class="k">val&lt;/span> &lt;span class="py">threadViolationListener&lt;/span> &lt;span class="k">by&lt;/span> &lt;span class="n">lazy&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nc">StrictMode&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">OnThreadViolationListener&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">::&lt;/span>&lt;span class="n">showViolationName&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="cm">/**
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cm"> * Starts handling strict mode violation messages.
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cm"> * This method must be called as soon as possible after launching the app.
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cm"> */&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">fun&lt;/span> &lt;span class="nf">setup&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">context&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">Context&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// Enable the strict mode only when the debuggable flag is true
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="k">if&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">context&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">applicationInfo&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">flags&lt;/span> &lt;span class="n">and&lt;/span> &lt;span class="nc">ApplicationInfo&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">FLAG_DEBUGGABLE&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="m">0&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">appContext&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="n">context&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">applicationContext&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nc">StrictMode&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">setThreadPolicy&lt;/span>&lt;span class="p">(&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nc">StrictMode&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nc">ThreadPolicy&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">Builder&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">.&lt;/span>&lt;span class="n">detectAll&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">.&lt;/span>&lt;span class="n">penaltyLog&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">.&lt;/span>&lt;span class="n">penaltyListener&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">workerThreadExecutor&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">threadViolationListener&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">.&lt;/span>&lt;span class="n">build&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nc">StrictMode&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">setVmPolicy&lt;/span>&lt;span class="p">(&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nc">StrictMode&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nc">VmPolicy&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">Builder&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">.&lt;/span>&lt;span class="n">detectAll&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">.&lt;/span>&lt;span class="n">penaltyLog&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">.&lt;/span>&lt;span class="n">penaltyListener&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">workerThreadExecutor&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">vmViolationListener&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">.&lt;/span>&lt;span class="n">build&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="cm">/**
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cm"> * Shows the [violation] name with a Toast.
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cm"> */&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">private&lt;/span> &lt;span class="k">fun&lt;/span> &lt;span class="nf">showViolationName&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">violation&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">Violation&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">val&lt;/span> &lt;span class="py">message&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">String&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="n">violation&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">javaClass&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">simpleName&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">mainThreadHandler&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">post&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nc">Toast&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">makeText&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">appContext&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">message&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nc">Toast&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">LENGTH_LONG&lt;/span>&lt;span class="p">).&lt;/span>&lt;span class="n">show&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>

&lt;h2 id="strictmodetoaster-クラスの説明">StrictModeToaster クラスの説明&lt;/h2>
&lt;h3 id="デバッグビルドの判断">デバッグビルドの判断&lt;/h3>
&lt;p>&lt;code>StrictModeToaster.setup()&lt;/code> を実行すると、DEBUG ビルドのときのみ StrictMode に関する設定が行われるようになっています。
デバッグビルドかのチェックには、よく &lt;code>BuildConfig.DEBUG&lt;/code> に設定されている Boolean フラグを見たりするのですが、このクラスはビルド時にアプリパッケージ以下に自動生成されるクラスなので、汎用的なライブラリの実装からは参照できません。
ここでは、&lt;code>ApplicationInfo.flags&lt;/code> を見て、デバッグビルドかどうかの判別を行うようにしています。
&lt;code>build.gradle&lt;/code> や &lt;code>AndroidManifest.xml&lt;/code> で余計な設定をしていない限り、デバッグビルド時に &lt;code>FLAG_DEBUGGABLE&lt;/code> のビットが 1 になります。&lt;/p></description></item><item><title>Choreographer で FPS を計測する（Fps クラスの実装）</title><link>https://maku77.github.io/p/imx8hr2/</link><pubDate>Wed, 18 Sep 2019 00:00:00 +0900</pubDate><guid>https://maku77.github.io/p/imx8hr2/</guid><description>&lt;h2 id="choreographer-クラスによる-fps-計測">Choreographer クラスによる FPS 計測&lt;/h2>
&lt;p>Android の &lt;a href="https://developer.android.com/reference/kotlin/android/view/Choreographer">Choreographer&lt;/a> クラスを使用すると、フレームの描画開始のタイミングで呼び出されるコールバック (&lt;a href="https://developer.android.com/reference/kotlin/android/view/Choreographer.FrameCallback.html">Choreographer.FrameCallback&lt;/a>) を登録することができます。&lt;/p>
&lt;pre tabindex="0">&lt;code>Choreographer#postFrameCallback(callback: Choreographer.FrameCallback!)
&lt;/code>&lt;/pre>&lt;p>上記のメソッドでコールバックを登録すると、次のフレーム描画のタイミングで &lt;code>doFrame(long frameTimeNanos)&lt;/code> メソッドが呼び出されます。&lt;/p>
&lt;pre tabindex="0">&lt;code>Choreographer.FrameCallback#doFrame(frameTimeNanos: Long)
&lt;/code>&lt;/pre>&lt;p>パラメータとして描画開始時刻（ナノ秒単位）が渡されるため、前回のコールバック時の描画開始時刻からの差分を取れば、1 フレームの描画にかかった時間を求めることができます。
この値を使えば、FPS (Frame per second) は下記のように計算できます。&lt;/p>
&lt;pre tabindex="0">&lt;code>FPS = 1秒あたりのナノ秒 / 描画にかかった時間（ナノ秒）
&lt;/code>&lt;/pre>&lt;h2 id="サンプルコード">サンプルコード&lt;/h2>
&lt;h3 id="fps-クラスの実装">Fps クラスの実装&lt;/h3>
&lt;p>下記の &lt;code>Fps&lt;/code> クラスは、FPS を簡単に計測するためのクラスです。
内部で Android の &lt;code>Choreographer&lt;/code> を使っています。&lt;/p>

&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">Fps.kt&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-kotlin" data-lang="kotlin">&lt;span class="line">&lt;span class="cl">&lt;span class="k">import&lt;/span> &lt;span class="nn">android.view.Choreographer&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">import&lt;/span> &lt;span class="nn">java.util.concurrent.TimeUnit&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">class&lt;/span> &lt;span class="nc">Fps&lt;/span> &lt;span class="p">:&lt;/span> &lt;span class="nc">Choreographer&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">FrameCallback&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">interface&lt;/span> &lt;span class="nc">FpsCallback&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="cm">/** Called when the latest FPS is calculated. */&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">fun&lt;/span> &lt;span class="nf">onFpsUpdated&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">fps&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">Float&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">private&lt;/span> &lt;span class="k">val&lt;/span> &lt;span class="py">choreographer&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="nc">Choreographer&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">getInstance&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">private&lt;/span> &lt;span class="k">var&lt;/span> &lt;span class="py">fpsCallback&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">FpsCallback&lt;/span>&lt;span class="p">?&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="k">null&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">private&lt;/span> &lt;span class="k">var&lt;/span> &lt;span class="py">prevFrameTimeNanos&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">Long&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="m">0&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="cm">/**
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cm"> * Starts observing the FPS.
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cm"> * [fpsCallback] is invoked continuously after calling this method.
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cm"> */&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">fun&lt;/span> &lt;span class="nf">startObserving&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">fpsCallback&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">FpsCallback&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">fpsCallback&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="n">fpsCallback&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">prevFrameTimeNanos&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="m">0&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">choreographer&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">postFrameCallback&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="k">this&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="cm">/**
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cm"> * Starts observing the FPS.
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cm"> * [fpsCallback] is invoked continuously after calling this method.
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cm"> */&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">fun&lt;/span> &lt;span class="nf">startObserving&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">fpsCallback&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">Float&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="o">-&amp;gt;&lt;/span> &lt;span class="n">Unit&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">startObserving&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="k">object&lt;/span> &lt;span class="err">: &lt;/span>&lt;span class="nc">FpsCallback&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">override&lt;/span> &lt;span class="k">fun&lt;/span> &lt;span class="nf">onFpsUpdated&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">fps&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">Float&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="n">fpsCallback&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">fps&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">})&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="cm">/**
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cm"> * Stops observing the FPS.
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cm"> */&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">fun&lt;/span> &lt;span class="nf">stopObserving&lt;/span>&lt;span class="p">()&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">choreographer&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">removeFrameCallback&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="k">this&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="cm">/**
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cm"> * Implementation for [Choreographer.FrameCallback].
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cm"> */&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">override&lt;/span> &lt;span class="k">fun&lt;/span> &lt;span class="nf">doFrame&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">frameTimeNanos&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">Long&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// Register the same callback again to be called continuously
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="n">choreographer&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">postFrameCallback&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="k">this&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// At first, just store the frame time for later calculation
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="k">if&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">prevFrameTimeNanos&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="m">0L&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">prevFrameTimeNanos&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="n">frameTimeNanos&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// Calculate FPS and pass it to the callback function
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="k">val&lt;/span> &lt;span class="py">elapsed&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="n">frameTimeNanos&lt;/span> &lt;span class="p">-&lt;/span> &lt;span class="n">prevFrameTimeNanos&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">val&lt;/span> &lt;span class="py">fps&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="nc">TimeUnit&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nc">SECONDS&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">toNanos&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="m">1&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">/&lt;/span> &lt;span class="n">elapsed&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">toFloat&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">checkNotNull&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">fpsCallback&lt;/span>&lt;span class="p">).&lt;/span>&lt;span class="n">onFpsUpdated&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">fps&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">prevFrameTimeNanos&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="n">frameTimeNanos&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>

&lt;p>&lt;code>Choreographer#postFrameCallback()&lt;/code> で登録したコールバックは、一度しか呼び出されないことに注意してください。
連続してフレーム描画のタイミングを取得するには、毎回同じコールバックを登録し直す必要があります（上記では、&lt;code>doFrame()&lt;/code> メソッドの先頭で登録しています）。&lt;/p></description></item><item><title>Androidメモ: Preference フレームワークを使って設定画面を簡単に作成する</title><link>https://maku77.github.io/p/b9ij3zq/</link><pubDate>Mon, 19 Aug 2019 00:00:00 +0900</pubDate><guid>https://maku77.github.io/p/b9ij3zq/</guid><description>&lt;figure class="xImage">
 &lt;img style="border: solid #ccc 2px;" width="240" height="400" src="../p/b9ij3zq/img-001.png" alt="/p/b9ij3zq/img-001.png" />
 &lt;figcaption>図: Preference フレームワークを使った設定画面&lt;/figcaption>
&lt;/figure>

&lt;h2 id="preferences-フレームワーク">Preferences フレームワーク&lt;/h2>
&lt;p>Android が提供する Preferences フレームワークを使用すると、&lt;code>SharedPreferences&lt;/code> による設定リソースをベースにした設定画面を簡単に作成することができます。
設定画面の表示は Android が用意している &lt;strong>&lt;code>PreferenceFragmentCompat&lt;/code>&lt;/strong> クラスにより行われるため、ユーザーが使い慣れた UI で設定画面を表示することができます。
設定画面に表示する項目は、&lt;strong>&lt;code>PreferenceScreen&lt;/code>&lt;/strong> 要素をルートにした XML ファイルを作成することで定義できます（コード内で動的に &lt;code>PreferenceScreen&lt;/code> オブジェクトを構築することもできます）。&lt;/p>
&lt;ul>
&lt;li>&lt;a href="https://developer.android.com/reference/androidx/preference/PreferenceFragmentCompat.html">PreferenceFragmentCompat クラス&lt;/a>
&lt;ul>
&lt;li>設定画面を表示するためのベースとなる Fragment クラスです。&lt;/li>
&lt;li>（コラム）API level 28 以前は、設定画面用のクラスとして &lt;code>PreferenceActivity&lt;/code> が使われていましたが、今は &lt;code>PreferenceFragmentCompat&lt;/code> クラスを使用します。&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>&lt;code>PreferenceScreen&lt;/code> レイアウトファイル
&lt;ul>
&lt;li>&lt;code>PreferenceActivity&lt;/code> で表示する設定項目の階層構造を定義した XML ファイルです。ユーザーが選択できる項目のリストを管理したり、&lt;code>SharedPreferences&lt;/code> のキーを関連付けたりすることができます。&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;h2 id="ライブラリの依存関係の追加">ライブラリの依存関係の追加&lt;/h2>
&lt;p>&lt;code>PreferenceFragmentCompat&lt;/code> クラスを使用するには、&lt;code>androidx.preference:preference&lt;/code> ライブラリへの依存を追加しておく必要があります。
ライブラリのバージョン番号は &lt;a href="https://developer.android.com/jetpack/androidx/releases/preference?hl=ja">こちらのリリースページ&lt;/a> で確認できます（2020年4月15日のリリースは &lt;code>1.1.1&lt;/code>）。&lt;/p>

&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">app/build.gradle&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-groovy" data-lang="groovy">&lt;span class="line">&lt;span class="cl">&lt;span class="n">dependencies&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">implementation&lt;/span> &lt;span class="s1">&amp;#39;androidx.preference:preference:1.1.1&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">}&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>

&lt;p>（コラム）Preferences 系のクラスは、以前は support ライブラリとして提供されており、名前空間は &lt;code>android.preference&lt;/code> でした。現在は &lt;code>androidx.preference&lt;/code> という名前空間で提供されている Jetpack ライブラリ (AndroidX) の方を使用する必要があります。&lt;/p>
&lt;h2 id="設定項目を定義する">設定項目を定義する&lt;/h2>
&lt;p>Android アプリのレイアウトファイルは通常 &lt;code>res/layout&lt;/code> ディレクトリに配置しますが、Preferences フレームワークを使って設定画面を表示する場合は、&lt;strong>&lt;code>res/xml&lt;/code>&lt;/strong> ディレクトリに XML ファイルを配置します。&lt;/p></description></item><item><title>Androidメモ: Kotlin で OpenGL ES を使って 3D 表示するアプリを作る</title><link>https://maku77.github.io/p/j4eyu47/</link><pubDate>Fri, 02 Aug 2019 00:00:00 +0900</pubDate><guid>https://maku77.github.io/p/j4eyu47/</guid><description>&lt;figure class="xImage">
 &lt;img style="" width="240" height="400" src="../p/j4eyu47/img-001.png" alt="/p/j4eyu47/img-001.png" />
&lt;/figure>

&lt;p>Android では、組み込み向けの OpenGL インタフェースである OpenGL ES を使用して 3D の描画を行うことができます。
Kotlin でも Java でも利用方法は変わらないのですが、今はもう Kotlin が主流になってきてますので、ここでは Kotlin で書いてみます。&lt;/p>
&lt;p>Android で OpenGL ES を使った描画を行うには、下記のような手順を踏みます。&lt;/p>
&lt;ol>
&lt;li>描画用のビューとして &lt;a href="https://developer.android.com/reference/android/opengl/GLSurfaceView">GLSurfaceView&lt;/a> を作成する&lt;/li>
&lt;li>描画処理を実装した &lt;code>GLSurfaceView.Renderer&lt;/code> インスタンスを &lt;code>GLSurfaceView&lt;/code> にセットする&lt;/li>
&lt;/ol>
&lt;h2 id="描画用のビュー-glsurfaceview-の作成">描画用のビュー (GLSurfaceView) の作成&lt;/h2>
&lt;p>下記は、&lt;code>MainActivity&lt;/code> の実装です。
ここでは、OpenGL ES によって描画するためのビューとして、&lt;strong>&lt;code>GLSurfaceView&lt;/code>&lt;/strong> を生成し、そこに &lt;strong>&lt;code>GLSurfaceView.Renderer&lt;/code>&lt;/strong> インスタンスを設定します。&lt;/p>

&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">MainActivity.kt&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-kotlin" data-lang="kotlin">&lt;span class="line">&lt;span class="cl">&lt;span class="k">package&lt;/span> &lt;span class="nn">com.example.openglsample&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">import&lt;/span> &lt;span class="nn">android.opengl.GLSurfaceView&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">import&lt;/span> &lt;span class="nn">androidx.appcompat.app.AppCompatActivity&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">import&lt;/span> &lt;span class="nn">android.os.Bundle&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">class&lt;/span> &lt;span class="nc">MainActivity&lt;/span> &lt;span class="p">:&lt;/span> &lt;span class="n">AppCompatActivity&lt;/span>&lt;span class="p">()&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">override&lt;/span> &lt;span class="k">fun&lt;/span> &lt;span class="nf">onCreate&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">savedInstanceState&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">Bundle&lt;/span>&lt;span class="p">?)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">super&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">onCreate&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">savedInstanceState&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">val&lt;/span> &lt;span class="py">view&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="n">GLSurfaceView&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="k">this&lt;/span>&lt;span class="p">).&lt;/span>&lt;span class="n">apply&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">setRenderer&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">MyRenderer&lt;/span>&lt;span class="p">())&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">setContentView&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">view&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>

&lt;p>これが OpenGL ES を使用する場合の、最低限のビュー構成になります。&lt;/p>
&lt;h2 id="レンダラー-glsurfaceviewrenderer-の実装">レンダラー (GLSurfaceView.Renderer) の実装&lt;/h2>
&lt;p>次に、実際に OpenGL ES の API を使って描画処理を行うレンダラークラスを実装します。
レンダラークラスを作成するには、Android の &lt;a href="https://developer.android.com/reference/android/opengl/GLSurfaceView.Renderer">GLSurfaceView.Renderer インタフェース&lt;/a> が提供する下記のメソッドを実装します。&lt;/p></description></item><item><title>Androidメモ: 常に画面の最前面に表示されたままになる View を作る (TYPE_APPLICATION_OVERLAY)</title><link>https://maku77.github.io/p/7kkqw4q/</link><pubDate>Tue, 09 Jul 2019 00:00:00 +0900</pubDate><guid>https://maku77.github.io/p/7kkqw4q/</guid><description>&lt;p>

&lt;figure class="xImage">
 &lt;img style="border: solid #ccc 2px;" width="240" height="400" src="../p/7kkqw4q/img-001.png" alt="/p/7kkqw4q/img-001.png" />
&lt;/figure>



&lt;figure class="xImage">
 &lt;img style="border: solid #ccc 2px;" width="240" height="400" src="../p/7kkqw4q/img-002.png" alt="/p/7kkqw4q/img-002.png" />
&lt;/figure>
&lt;/p>
&lt;p>ここでは、任意のビュー（上の図では猫）をどのアプリよりも最前面に表示し、ずっとそこに表示し続けるようにする方法を説明します。
表示の ON/OFF は、メインアクティビティに配置したトグルボタンから行えるようにしています。
この猫が、下に表示されているアプリの操作を邪魔することはありません（猫の部分をタップすると、下に表示されているアプリの画面をタッチしたことになります）。&lt;/p>
&lt;h2 id="アプリのビューを最前面にオーバーレイ表示する方法">アプリのビューを最前面にオーバーレイ表示する方法&lt;/h2>
&lt;p>Android で画面の最前面に張り付くウィジェットのようなものを作る場合、かつて (API Level 25 以前、Android 7 Nougat まで）はビューを &lt;code>TYPE_SYSTEM_OVERLAY&lt;/code> や &lt;code>TYPE_SYSTEM_SYSTEM_ALERT_WINDOW&lt;/code> などのレイヤーに表示することで実現していました。
API Level 26 以降（Android 8 Oreo 以降）はこのような特殊なレイヤーの使用は制限されており、代わりに &lt;strong>&lt;code>TYPE_APPLICATION_OVERLAY&lt;/code>&lt;/strong> レイヤーを使う必要があります。&lt;/p>
&lt;ul>
&lt;li>&lt;a href="https://developer.android.com/reference/android/view/WindowManager.LayoutParams.html#TYPE_APPLICATION_OVERLAY">TYPE_APPLICATION_OVERLAY&lt;/a>&lt;/li>
&lt;li>&lt;a href="https://developer.android.com/reference/android/view/WindowManager.LayoutParams.html#TYPE_SYSTEM_OVERLAY">TYPE_SYSTEM_OVERLAY (deprecated)&lt;/a>&lt;/li>
&lt;li>&lt;a href="https://developer.android.com/reference/android/view/WindowManager.LayoutParams.html#TYPE_SYSTEM_ALERT">TYPE_SYSTEM_ALERT (deprecated)&lt;/a>&lt;/li>
&lt;/ul>
&lt;p>&lt;code>TYPE_APPLICATION_OVERLAY&lt;/code> を使うことにより、すべての Activity よりも上位に表示しつつも、ステータスバーや IME などの重要な UI よりは下に表示されるようになります。&lt;/p>
&lt;p>&lt;code>TYPE_APPLICATION_OVERLAY&lt;/code> のレイヤーに表示を行うには、AndroidManifest.xml に &lt;a href="https://developer.android.com/reference/android/Manifest.permission.html#SYSTEM_ALERT_WINDOW">SYSTEM_ALERT_WINDOW パーミッション&lt;/a> の使用を宣言し、さらにアプリケーション実行中にユーザーからの許可（ランタイムパーミッション）を得る必要があります。&lt;/p>
&lt;p>View を最前面にオーバーレイ表示する流れは下記のようになります。&lt;/p>
&lt;ol>
&lt;li>AndroidManifest.xml に &lt;code>SYSTEM_ALERT_WINDOW&lt;/code> の uses-permission を追加&lt;/li>
&lt;li>アプリ起動時やボタンを押したときなどにダイアログ表示してオーバーレイ表示の許可を得る
&lt;ul>
&lt;li>すでにパーミッションが付加されているかは &lt;code>Settings.canDrawOverlays()&lt;/code> で確認できる&lt;/li>
&lt;li>ダイアログの表示は &lt;code>Settings.ACTION_MANAGE_OVERLAY_PERMISSION&lt;/code> アクションで &lt;code>startActivity&lt;/code> すればよい&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>パーミッションが得られたら &lt;code>WindowManager&lt;/code> で対象ビューのレイヤーを移動させる&lt;/li>
&lt;/ol>
&lt;h2 id="実装例">実装例&lt;/h2>
&lt;h3 id="androidmanifestxml-に-uses-permission-を追加">AndroidManifest.xml に uses-permission を追加&lt;/h3>
&lt;p>View のオーバーレイ表示を行うには、&lt;code>SYSTEM_ALERT_WINDOW&lt;/code> パーミッションが必要です。
まず、マニフェストの uses-permission 要素で、&lt;strong>&lt;code>android.permission.SYSTEM_ALERT_WINDOW&lt;/code>&lt;/strong> を使用することを宣言しておきます。&lt;/p></description></item><item><title>Androidメモ: リソース ID を示す変数やパラメータにアノテーションを付ける</title><link>https://maku77.github.io/p/33jn7zy/</link><pubDate>Mon, 18 Feb 2019 00:00:00 +0900</pubDate><guid>https://maku77.github.io/p/33jn7zy/</guid><description>&lt;h2 id="リソース-id-を表す-int-変数に付けるアノテーション">リソース ID を表す int 変数に付けるアノテーション&lt;/h2>
&lt;p>Android の各種リソースの ID は int 型で管理されています。
この値を変数に格納したり、メソッドのパラメータとして受け取るように実装した場合、不正な int 値が渡されて実行時に落ちてしまうリスクがあります。&lt;/p>
&lt;p>このようなことをできるだけ防ぐため、Android Support ライブラリには下記のようなアノテーションが用意されており、これらを付加した int 型変数には、指定した種類のリソースの ID しか格納できなくなります（AndroidStudio で警告が表示されるようになります）。&lt;/p>
&lt;table>
 &lt;thead>
 &lt;tr>
 &lt;th>アノテーション&lt;/th>
 &lt;th>リソース ID の種類&lt;/th>
 &lt;/tr>
 &lt;/thead>
 &lt;tbody>
 &lt;tr>
 &lt;td>&lt;a href="https://developer.android.com/reference/android/support/annotation/AnimatorRes">@AnimatorRes&lt;/a>&lt;/td>
 &lt;td>&lt;code>R.animator.xxx&lt;/code> で参照するリソース ID&lt;/td>
 &lt;/tr>
 &lt;tr>
 &lt;td>&lt;a href="https://developer.android.com/reference/android/support/annotation/AnimRes">@AnimRes&lt;/a>&lt;/td>
 &lt;td>&lt;code>R.anim.xxx&lt;/code> で参照するリソース ID&lt;/td>
 &lt;/tr>
 &lt;tr>
 &lt;td>&lt;a href="https://developer.android.com/reference/android/support/annotation/AnyRes">@AnyRes&lt;/a>&lt;/td>
 &lt;td>いずれかの種類のリソースの ID（他の具体的なアノテーションを使用することを推奨）&lt;/td>
 &lt;/tr>
 &lt;tr>
 &lt;td>&lt;a href="https://developer.android.com/reference/android/support/annotation/ArrayRes">@ArrayRes&lt;/a>&lt;/td>
 &lt;td>&lt;code>R.array.xxx&lt;/code> で参照するリソース ID&lt;/td>
 &lt;/tr>
 &lt;tr>
 &lt;td>&lt;a href="https://developer.android.com/reference/android/support/annotation/AttrRes">@AttrRes&lt;/a>&lt;/td>
 &lt;td>&lt;code>R.attr.xxx&lt;/code> で参照するリソース ID&lt;/td>
 &lt;/tr>
 &lt;tr>
 &lt;td>&lt;a href="https://developer.android.com/reference/android/support/annotation/ColorRes">@ColorRes&lt;/a>&lt;/td>
 &lt;td>&lt;code>R.color.xxx&lt;/code> で参照するリソース ID&lt;/td>
 &lt;/tr>
 &lt;tr>
 &lt;td>&lt;a href="https://developer.android.com/reference/android/support/annotation/DimenRes">@DimenRes&lt;/a>&lt;/td>
 &lt;td>&lt;code>R.dimen.xxx&lt;/code> で参照するリソース ID&lt;/td>
 &lt;/tr>
 &lt;tr>
 &lt;td>&lt;a href="https://developer.android.com/reference/android/support/annotation/DrawableRes">@DrawableRes&lt;/a>&lt;/td>
 &lt;td>&lt;code>R.drawable.xxx&lt;/code> で参照するリソース ID&lt;/td>
 &lt;/tr>
 &lt;tr>
 &lt;td>&lt;a href="https://developer.android.com/reference/android/support/annotation/FontRes">@FontRes&lt;/a>&lt;/td>
 &lt;td>&lt;code>R.font.xxx&lt;/code> で参照するリソース ID&lt;/td>
 &lt;/tr>
 &lt;tr>
 &lt;td>&lt;a href="https://developer.android.com/reference/android/support/annotation/IdRes">@IdRes&lt;/a>&lt;/td>
 &lt;td>&lt;code>R.id.xxx&lt;/code> で参照するリソース ID&lt;/td>
 &lt;/tr>
 &lt;tr>
 &lt;td>&lt;a href="https://developer.android.com/reference/android/support/annotation/IntegerRes">@IntegerRes&lt;/a>&lt;/td>
 &lt;td>&lt;code>R.interger.xxx&lt;/code> で参照するリソース ID&lt;/td>
 &lt;/tr>
 &lt;tr>
 &lt;td>&lt;a href="https://developer.android.com/reference/android/support/annotation/InterpolatorRes">@InterpolatorRes&lt;/a>&lt;/td>
 &lt;td>&lt;code>R.interpolator.xxx&lt;/code> で参照するリソース ID&lt;/td>
 &lt;/tr>
 &lt;tr>
 &lt;td>&lt;a href="https://developer.android.com/reference/android/support/annotation/LayoutRes">@LayoutRes&lt;/a>&lt;/td>
 &lt;td>&lt;code>R.layout.xxx&lt;/code> で参照するリソース ID&lt;/td>
 &lt;/tr>
 &lt;tr>
 &lt;td>&lt;a href="https://developer.android.com/reference/android/support/annotation/NavigationRes">@NavigationRes&lt;/a>&lt;/td>
 &lt;td>&lt;code>R.navigation.xxx&lt;/code> で参照するリソース ID&lt;/td>
 &lt;/tr>
 &lt;tr>
 &lt;td>&lt;a href="https://developer.android.com/reference/android/support/annotation/RawRes">@RawRes&lt;/a>&lt;/td>
 &lt;td>&lt;code>R.raw.xxx&lt;/code> で参照するリソース ID&lt;/td>
 &lt;/tr>
 &lt;tr>
 &lt;td>&lt;a href="https://developer.android.com/reference/android/support/annotation/StringRes">@StringRes&lt;/a>&lt;/td>
 &lt;td>&lt;code>R.string.xxx&lt;/code> で参照するリソース ID&lt;/td>
 &lt;/tr>
 &lt;tr>
 &lt;td>&lt;a href="https://developer.android.com/reference/android/support/annotation/StyleableRes">@StyleableRes&lt;/a>&lt;/td>
 &lt;td>&lt;code>R.styleable.xxx&lt;/code> で参照するリソース ID&lt;/td>
 &lt;/tr>
 &lt;tr>
 &lt;td>&lt;a href="https://developer.android.com/reference/android/support/annotation/StyleRes">@StyleRes&lt;/a>&lt;/td>
 &lt;td>&lt;code>R.style.xxx&lt;/code> で参照するリソース ID&lt;/td>
 &lt;/tr>
 &lt;tr>
 &lt;td>&lt;a href="https://developer.android.com/reference/android/support/annotation/TransitionRes">@TransitionRes&lt;/a>&lt;/td>
 &lt;td>&lt;code>R.transition.xxx&lt;/code> で参照するリソース ID&lt;/td>
 &lt;/tr>
 &lt;/tbody>
&lt;/table>
&lt;h2 id="int-変数用アノテーションの使用例">int 変数用アノテーションの使用例&lt;/h2>
&lt;p>上記のようなアノテーションは Annotation Support Library で提供されているため、&lt;code>build.gradle&lt;/code> に下記のような依存を追加しておく必要があります（参考: &lt;a href="https://developer.android.com/topic/libraries/support-library/features?hl=ja#annotations">本家ドキュメント&lt;/a>）。&lt;/p></description></item><item><title>Android Gradleメモ: Android アプリが使用している依存ライブラリをツリー構造で表示する（dependencies/androidDependencies タスク）</title><link>https://maku77.github.io/p/kma3bsu/</link><pubDate>Thu, 26 Jul 2018 00:00:00 +0900</pubDate><guid>https://maku77.github.io/p/kma3bsu/</guid><description>&lt;p>Gradle の &lt;strong>&lt;code>dependencies&lt;/code>&lt;/strong> タスクを実行すると、あるプロジェクトが依存するライブラリ（およびサブモジュール）の一覧を、ツリー構造で表示することができます。
一般的な Android アプリの構成では &lt;code>app&lt;/code> が最上位のモジュールになるので、&lt;code>:app:dependencies&lt;/code> というタスクを実行すれば、アプリ全体（APK 全体）のライブラリ依存関係を調べることができます（&lt;code>:app&lt;/code> 部分を省略するとエラーになるので注意してください）。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-console" data-lang="console">&lt;span class="line">&lt;span class="cl">&lt;span class="gp">$&lt;/span> gradlew -q :app:dependencies
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>デフォルトではすべてのコンフィギュレーションにおける依存関係が表示される（テストビルド時の依存関係なども表示される）ので、大量のテキストが出力されます。
出力対象を絞り込むために、&lt;code>--configuration&lt;/code> オプションを指定して次のように実行します。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-console" data-lang="console">&lt;span class="line">&lt;span class="cl">&lt;span class="gp">$&lt;/span> gradlew -q :app:dependencies --configuration releaseCompileClasspath &amp;gt; deps-tree-compile.txt
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="gp">$&lt;/span> gradlew -q :app:dependencies --configuration releaseRuntimeClasspath &amp;gt; deps-tree-runtime.txt
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>コンフィギュレーション名のプレフィックス部分 (上記の場合は &lt;code>release&lt;/code>) はビルドバリアント名であり、アプリごとに異なることに注意してください。
&lt;code>prodRelease&lt;/code> であったり、&lt;code>hogehogeDebug&lt;/code> だったりします。
下記は、出力結果の例です。&lt;/p>

&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">deps-tree-runtime.txt&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-plain" data-lang="plain">&lt;span class="line">&lt;span class="cl">------------------------------------------------------------
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Project :app
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">------------------------------------------------------------
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">releaseRuntimeClasspath - Resolved configuration for runtime for variant: release
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">+--- com.android.support:support-annotations:27.1.1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">+--- com.android.support:support-core-utils:27.1.1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">| +--- com.android.support:support-annotations:27.1.1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">| \--- com.android.support:support-compat:27.1.1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">| +--- com.android.support:support-annotations:27.1.1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">| \--- android.arch.lifecycle:runtime:1.1.0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">| +--- android.arch.lifecycle:common:1.1.0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">| \--- android.arch.core:common:1.1.0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">+--- project :common:hoge
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">| \--- project :common:mylib
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">| +--- com.android.support:support-annotations:27.1.1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">| +--- com.fasterxml.jackson.core:jackson-databind:2.4.2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">| | +--- com.fasterxml.jackson.core:jackson-annotations:2.4.0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">| | \--- com.fasterxml.jackson.core:jackson-core:2.4.2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">| +--- com.example.lib:property:1.18.0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">| +--- com.example.lib:network:1.0.0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">| \--- com.example.lib:upgrade:1.0.1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">+--- project :common:mylib (*)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">|
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">...省略...
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">|
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">\--- project :feature:recommend
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> +--- com.android.support:support-annotations:27.1.1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> +--- com.android.support:support-core-utils:27.1.1 (*)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> +--- project :common:hoge (*)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> \--- project :common:mylib
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">(*) - dependencies omitted (listed previously)&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>

&lt;p>依存関係は上記のように再帰的に検索されてツリー形式で表示されます。
サブモジュール名の末尾に &lt;code>(*)&lt;/code> が付いているものは、それよりも前の行ですでに依存情報が出力されているため、出力が省略されたことを示しています。&lt;/p></description></item><item><title>ADB で Activity や Service を起動するインテントを投げる (am start/start-service/broadcast)</title><link>https://maku77.github.io/p/eezeq4g/</link><pubDate>Mon, 03 Oct 2016 00:00:00 +0900</pubDate><guid>https://maku77.github.io/p/eezeq4g/</guid><description>&lt;p>以下のコマンドは、&lt;code>adb shell&lt;/code> でデバイスに接続した状態から実行することを想定しています。
接続と同時に実行するには、&lt;code>adb shell&lt;/code> を先頭に追加して実行してください（例: &lt;code>adb shell am start ...&lt;/code>）。&lt;/p>
&lt;h2 id="activityアクティビティを起動する">Activity（アクティビティ）を起動する&lt;/h2>
&lt;p>シェル上で &lt;strong>&lt;code>am start&lt;/code>&lt;/strong> コマンドを実行すると、Intent を発生させて Activity を起動することができます。&lt;/p>
&lt;pre tabindex="0">&lt;code>am start &amp;lt;INTENT&amp;gt;
&lt;/code>&lt;/pre>&lt;p>Intent 引数（&lt;code>&amp;lt;INTENT&amp;gt;&lt;/code> の部分）の指定方法は、&lt;a href="https://developer.android.com/studio/command-line/shell.html#IntentSpec">Specification for INTENT arguments&lt;/a> のページに詳しく記載されています。
具体的には、次のようなオプションの組み合わせで Intent を構成します。&lt;/p>
&lt;dl>
&lt;dt>&lt;code>-a &amp;lt;ACTION&amp;gt;&lt;/code>&lt;/dt>
&lt;dd>例: &lt;code>-a android.intent.action.VIEW&lt;/code>&lt;/dd>
&lt;dt>&lt;code>-d &amp;lt;DATA_URI&amp;gt;&lt;/code>&lt;/dt>
&lt;dd>例: &lt;code>-d content://contacts/people/1&lt;/code>&lt;/dd>
&lt;dt>&lt;code>-t &amp;lt;MIME_TYPE&amp;gt;&lt;/code>&lt;/dt>
&lt;dd>例: &lt;code>-t image/png&lt;/code>&lt;/dd>
&lt;dt>&lt;code>-c &amp;lt;CATEGORY&amp;gt;&lt;/code>&lt;/dt>
&lt;dd>例: &lt;code>-c android.intent.category.APP_CONTACTS&lt;/code>&lt;/dd>
&lt;dt>&lt;code>-n &amp;lt;COMPONENT&amp;gt;&lt;/code>&lt;/dt>
&lt;dd>例: &lt;code>-n com.example.app/.ExampleActivity&lt;/code>&lt;/dd>
&lt;/dl>
&lt;p>必要に応じて、Bundle データを渡すこともできます。&lt;/p>
&lt;ul>
&lt;li>&lt;code>--esn &amp;lt;EXTRA_KEY&amp;gt;&lt;/code> （キーのみ）&lt;/li>
&lt;li>&lt;code>-e|--es &amp;lt;EXTRA_KEY&amp;gt; &amp;lt;EXTRA_STRING_VALUE&amp;gt;&lt;/code>&lt;/li>
&lt;li>&lt;code>--ez &amp;lt;EXTRA_KEY&amp;gt; &amp;lt;EXTRA_BOOLEAN_VALUE&amp;gt;&lt;/code>&lt;/li>
&lt;li>&lt;code>--ei &amp;lt;EXTRA_KEY&amp;gt; &amp;lt;EXTRA_INT_VALUE&amp;gt;&lt;/code>&lt;/li>
&lt;li>&lt;code>--el &amp;lt;EXTRA_KEY&amp;gt; &amp;lt;EXTRA_LONG_VALUE&amp;gt;&lt;/code>&lt;/li>
&lt;li>&lt;code>--ef &amp;lt;EXTRA_KEY&amp;gt; &amp;lt;EXTRA_FLOAT_VALUE&amp;gt;&lt;/code>&lt;/li>
&lt;li>&lt;code>--eu &amp;lt;EXTRA_KEY&amp;gt; &amp;lt;EXTRA_URI_VALUE&amp;gt;&lt;/code>&lt;/li>
&lt;li>&lt;code>--ecn &amp;lt;EXTRA_KEY&amp;gt; &amp;lt;EXTRA_COMPONENT_NAME_VALUE&amp;gt;&lt;/code>&lt;/li>
&lt;li>&lt;code>--eia &amp;lt;EXTRA_KEY&amp;gt; &amp;lt;EXTRA_INT_VALUE&amp;gt;[,&amp;lt;EXTRA_INT_VALUE...]&lt;/code>&lt;/li>
&lt;li>&lt;code>--ela &amp;lt;EXTRA_KEY&amp;gt; &amp;lt;EXTRA_LONG_VALUE&amp;gt;[,&amp;lt;EXTRA_LONG_VALUE...]&lt;/code>&lt;/li>
&lt;li>&lt;code>--efa &amp;lt;EXTRA_KEY&amp;gt; &amp;lt;EXTRA_FLOAT_VALUE&amp;gt;[,&amp;lt;EXTRA_FLOAT_VALUE...]&lt;/code>&lt;/li>
&lt;/ul>
&lt;p>下記は、&lt;code>am start&lt;/code> コマンドによる Activity の起動例です。&lt;/p></description></item><item><title>Android Gradleメモ: Lint エラーが発生した場合もビルドを継続する (abortOnError)</title><link>https://maku77.github.io/p/o46hp5y/</link><pubDate>Wed, 07 Sep 2016 00:00:00 +0900</pubDate><guid>https://maku77.github.io/p/o46hp5y/</guid><description>&lt;p>Android Lint による静的解析がエラーになった場合でも、Gradle によるビルド処理を継続するには、対象プロジェクトの &lt;code>build.gradle&lt;/code> で下記のように設定します。&lt;/p>

&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">build.gradle&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-groovy" data-lang="groovy">&lt;span class="line">&lt;span class="cl">&lt;span class="n">android&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">lintOptions&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">abortOnError&lt;/span> &lt;span class="kc">false&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">}&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>

&lt;p>マルチプロジェクト構成になっている場合は、トップレベルの &lt;code>build.gradle&lt;/code> ファイルの中で、下記のように記述しておけば、サブプロジェクトすべてに対して設定を行うことができます。&lt;/p>

&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">build.gradle（トップレベル）&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-groovy" data-lang="groovy">&lt;span class="line">&lt;span class="cl">&lt;span class="n">subprojects&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">afterEvaluate&lt;/span> &lt;span class="o">{&lt;/span> &lt;span class="n">project&lt;/span> &lt;span class="o">-&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="n">project&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">hasProperty&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="s1">&amp;#39;android&amp;#39;&lt;/span>&lt;span class="o">))&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">project&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">android&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">lintOptions&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">abortOnError&lt;/span> &lt;span class="kc">false&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">}&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure></description></item><item><title>APK のパッケージ依存関係やクラス依存関係を調べる</title><link>https://maku77.github.io/p/w6ste5j/</link><pubDate>Wed, 17 Aug 2016 00:00:00 +0900</pubDate><guid>https://maku77.github.io/p/w6ste5j/</guid><description>&lt;p>ここでは、&lt;code>jdeps&lt;/code> と &lt;code>dex2jar&lt;/code> を使って、APK ファイル内の依存関係を調査する方法を示します。&lt;/p>
&lt;h2 id="jdeps-と-dex2jar">jdeps と dex2jar&lt;/h2>
&lt;p>JDK 8 にはパッケージ依存関係やクラス依存関係を調べるための &lt;strong>&lt;code>jdeps&lt;/code>&lt;/strong> コマンドが標準搭載されました。&lt;/p>
&lt;ul>
&lt;li>&lt;a href="https://docs.oracle.com/javase/jp/8/docs/technotes/tools/unix/jdeps.html">jdeps コマンド - Oracle Java Documentation&lt;/a>&lt;/li>
&lt;/ul>
&lt;p>これを使用すると、&lt;code>.class&lt;/code> ファイル（あるいは &lt;code>.jar&lt;/code> ファイル）を入力情報として、そこから参照しているクラスやパッケージの情報を調べることができるのですが、Android の APK としてビルドされたコードは &lt;code>.dex&lt;/code> ファイルになっていますので、まずはこれを通常の &lt;code>.class&lt;/code> 形式に変更してやる必要があります。
APK ファイル内の &lt;code>.dex&lt;/code> を &lt;code>.class&lt;/code> 形式に変換するには、&lt;strong>&lt;code>dex2jar&lt;/code>&lt;/strong> というツールを使用します。&lt;/p>
&lt;ul>
&lt;li>&lt;a href="https://github.com/pxb1988/dex2jar/releases">dex2jar のダウンロード&lt;/a>&lt;/li>
&lt;/ul>
&lt;p>上記から、たとえば &lt;code>dex-tools-2.1-20150601.060031-26.zip&lt;/code> をダウンロードし、パスの通ったディレクトリに展開すればインストール完了です。&lt;/p>
&lt;h2 id="apk-ファイルのパッケージ依存クラス依存情報を調べる">APK ファイルのパッケージ依存、クラス依存情報を調べる&lt;/h2>
&lt;p>まず、&lt;code>d2j-dex2jar&lt;/code> コマンドを使用して、APK ファイル内の &lt;code>.dex&lt;/code> を &lt;code>.class&lt;/code> 形式に変換します。
APK ファイルを unzip して取り出した &lt;code>.dex&lt;/code> ファイルを変換することもできますが、下記のように直接 APK ファイルを &lt;code>.jar&lt;/code> に変換してしまうのが手っ取り早いです。&lt;/p>

&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">apk から jar への変換&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-console" data-lang="console">&lt;span class="line">&lt;span class="cl">&lt;span class="gp">$&lt;/span> d2j-dex2jar app/build/outputs/apk/app-debug.apk -o app.jar
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">dex2jar app/build/outputs/apk/app-debug.apk -&amp;gt; app.jar
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>

&lt;p>これで &lt;code>.class&lt;/code> ファイルの含まれた &lt;code>.jar&lt;/code> ファイルが生成されるので、晴れて &lt;code>jdeps&lt;/code> コマンドで依存関係を調べられるようになります。&lt;/p></description></item><item><title>Android Gradleメモ: APK ファイル名のサフィックスにバージョンを追加する</title><link>https://maku77.github.io/p/pneeb8x/</link><pubDate>Mon, 15 Aug 2016 00:00:00 +0900</pubDate><guid>https://maku77.github.io/p/pneeb8x/</guid><description>&lt;p>Android の Application プロジェクトの &lt;code>build.gradle&lt;/code> で、下記のように設定しておくと、&lt;code>build/outputs/apk&lt;/code> 以下に生成される APK ファイルにバージョン番号を付けてくれるようになります（例: &lt;code>app-debug-1.0.0.apk&lt;/code>）。&lt;/p>

&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">build.gradle&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-groovy" data-lang="groovy">&lt;span class="line">&lt;span class="cl">&lt;span class="n">apply&lt;/span> &lt;span class="nl">plugin:&lt;/span> &lt;span class="s1">&amp;#39;com.android.application&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">android&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">...&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">applicationVariants&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">all&lt;/span> &lt;span class="o">{&lt;/span> &lt;span class="n">variant&lt;/span> &lt;span class="o">-&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">variant&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">outputs&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">each&lt;/span> &lt;span class="o">{&lt;/span> &lt;span class="n">output&lt;/span> &lt;span class="o">-&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kt">def&lt;/span> &lt;span class="n">file&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">output&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">outputFile&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">output&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">outputFile&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="k">new&lt;/span> &lt;span class="n">File&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">file&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">parent&lt;/span>&lt;span class="o">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">file&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">name&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">replace&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="s1">&amp;#39;.apk&amp;#39;&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="s2">&amp;#34;-${variant.versionName}.apk&amp;#34;&lt;/span>&lt;span class="o">))&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">}&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure></description></item><item><title>Android Gradleメモ: 外部から提供された AAR ファイルを利用する</title><link>https://maku77.github.io/p/9giv5yz/</link><pubDate>Thu, 04 Aug 2016 00:00:00 +0900</pubDate><guid>https://maku77.github.io/p/9giv5yz/</guid><description>&lt;p>Android のライブラリプロジェクトをビルドすると、&lt;code>build/output/aar&lt;/code> ディレクトリに AAR ファイルが作成されます。
この AAR ファイルを配布すれば、複数のアプリケーションからライブラリとして再利用することができます。&lt;/p>
&lt;p>配布された AAR ファイルを利用してプロジェクトをビルドするためには、&lt;code>build.gradle&lt;/code> に下記のように記述しておきます。
ここでは、&lt;code>aars&lt;/code> ディレクトリに配布された &lt;code>mylib.aar&lt;/code> ファイルを格納していると仮定します。&lt;/p>

&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">build.gradle&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-groovy" data-lang="groovy">&lt;span class="line">&lt;span class="cl">&lt;span class="n">repositories&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">flatDir&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">dir&lt;/span> &lt;span class="s1">&amp;#39;aars&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">dependencies&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">compile&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="nl">name:&lt;/span> &lt;span class="s1">&amp;#39;mylib&amp;#39;&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="nl">ext:&lt;/span> &lt;span class="s1">&amp;#39;aar&amp;#39;&lt;/span>&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">}&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure></description></item><item><title>Android Gradleメモ: サブモジュールで使用する SDK バージョンを統一する</title><link>https://maku77.github.io/p/52e5rvv/</link><pubDate>Tue, 02 Aug 2016 00:00:00 +0900</pubDate><guid>https://maku77.github.io/p/52e5rvv/</guid><description>&lt;h2 id="問題">問題&lt;/h2>
&lt;p>Android の Gradle ビルドスクリプト内では、最低限下記のように &lt;code>compileSdkVersion&lt;/code> と &lt;code>buildToolsVersion&lt;/code> を指定しておく必要があります。&lt;/p>

&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">build.gradle&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-groovy" data-lang="groovy">&lt;span class="line">&lt;span class="cl">&lt;span class="n">apply&lt;/span> &lt;span class="nl">plugin:&lt;/span> &lt;span class="s1">&amp;#39;com.android.application&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">android&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">compileSdkVersion&lt;/span> &lt;span class="mi">23&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">buildToolsVersion&lt;/span> &lt;span class="s1">&amp;#39;23.0.2&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">}&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>

&lt;p>単一のプロジェクト構成であればこの定義は一か所だけで済むのですが、複数のライブラリプロジェクト（サブモジュール）を含んだマルチプロジェクト構成になると、上記のようなバージョン指定を各サブプロジェクト内の &lt;code>build.gradle&lt;/code> で行わなければいけません。
バージョンの指定が複数ファイルに散らばっていると、使用する SDK のバージョンを更新する場合に複数のファイルを更新しなければいけません。
多くの場合は、バージョンを統一したいと思いますので、このようにバラバラにバージョンを指定する方法は避けたいところです。&lt;/p>
&lt;h2 id="方法-1-トップレベルの-buildgradle-の拡張パラメータで定義する">方法 (1) トップレベルの build.gradle の拡張パラメータで定義する&lt;/h2>
&lt;p>Gradle スクリプトの中で、&lt;code>ext&lt;/code> ブロックを使用すると、カスタムフィールドを定義することができます。
簡単に言えば、プロジェクトに対して設定できるグローバル変数のようなものです。
例えば、トップレベルの &lt;code>build.gradle&lt;/code> の中で下記のように定義することができます。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-groovy" data-lang="groovy">&lt;span class="line">&lt;span class="cl">&lt;span class="n">ext&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">COMPILE_SDK_VERSION&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="mi">23&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">BUILD_TOOLS_VERSION&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s1">&amp;#39;23.0.2&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>そして、このプロパティを各サブプロジェクトの &lt;code>build.gradle&lt;/code> から参照するようにします。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-groovy" data-lang="groovy">&lt;span class="line">&lt;span class="cl">&lt;span class="n">android&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">compileSdkVersion&lt;/span> &lt;span class="n">rootProject&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">ext&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">COMPILE_SDK_VERSION&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">buildToolsVersion&lt;/span> &lt;span class="n">rootProject&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">ext&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">BUILD_TOOLS_VERSION&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>こうしておけば、トップレベルの &lt;code>build.gradle&lt;/code> の中で SDK バージョンを更新すれば、すべてのサブプロジェクトに反映されます。&lt;/p>
&lt;h2 id="方法-2-トップレベルの-buildgradle-の中でサブプロジェクトの設定を行う">方法 (2) トップレベルの build.gradle の中でサブプロジェクトの設定を行う&lt;/h2>
&lt;p>もう少しがんばれば、トップレベルの &lt;code>build.gradle&lt;/code> の中から、すべてのサブプロジェクトで使用する SDK バージョンを指定してしまうこともできます。
こうすれば、サブプロジェクトの &lt;code>build.gradle&lt;/code> の中では SDK バージョンを指定する必要がなくなります。&lt;/p>

&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">build.gradle（トップレベル）&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-groovy" data-lang="groovy">&lt;span class="line">&lt;span class="cl">&lt;span class="n">subprojects&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">afterEvaluate&lt;/span> &lt;span class="o">{&lt;/span> &lt;span class="n">project&lt;/span> &lt;span class="o">-&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="n">project&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">hasProperty&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="s1">&amp;#39;android&amp;#39;&lt;/span>&lt;span class="o">))&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">project&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">android&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">compileSdkVersion&lt;/span> &lt;span class="mi">23&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">project&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">android&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">buildToolsVersion&lt;/span> &lt;span class="s1">&amp;#39;23.0.2&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">}&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>

&lt;p>上記の例では、すべてのサブプロジェクトをループで処理しながら、Android 関連のモジュールであると判断できたときに SDK バージョンを設定するようにしています。
Android 関連のモジュールだと判断する基準としては、そのサブプロジェクトが &lt;code>android&lt;/code> ブロックを持っているかで判断しています。
そのプロジェクトがプラグインとして &lt;code>com.android.application&lt;/code> あるいは &lt;code>com.android.library&lt;/code> を適用していれば、&lt;code>android&lt;/code> ブロックが自動的に定義されているはずなので、その有無を確認すれば Android 関連のプロジェクトだと判断できるわけです。&lt;/p></description></item><item><title>Android Gradleメモ: Android アプリ用の Gradle スクリプトの基本</title><link>https://maku77.github.io/p/ams6xga/</link><pubDate>Mon, 01 Aug 2016 00:00:00 +0900</pubDate><guid>https://maku77.github.io/p/ams6xga/</guid><description>&lt;p>Android アプリケーションのビルドには Gradle が採用されています（2016 年現在、Ant によるビルドはサポート外となりました）。
Google が Gradle 用の Android プラグインを提供しており、このプラグインを各 Android プロジェクトの Gradle スクリプトから利用することで Android モジュールのビルドを行えるようになります。&lt;/p>
&lt;h2 id="android-アプリのディレクトリ構造">Android アプリのディレクトリ構造&lt;/h2>
&lt;p>Android プロジェクトのディレクトリ構成は、およそ下記のような感じになります。
Android Studio によって新規作成する場合も、このようなディレクトリ構成で自動生成されます（正確には &lt;code>library1&lt;/code> や &lt;code>library2&lt;/code> といったサブプロジェクトのディレクトリは生成されませんが、ここではマルチプロジェクト構成の説明のために追加しています）。&lt;/p>
&lt;pre tabindex="0">&lt;code>MyApp/
 +-- build.gradle（トップレベルのビルドスクリプト）
 +-- settings.gradle（ビルドすべきサブプロジェクトの一覧）
 +-- app/ （Application サブプロジェクト）
 | +-- build.gradle（サブプロジェクトのビルドスクリプト）
 | +-- build/（ビルド後の成果物）
 | +-- src/
 | +-- main/（main ソースセット）
 | +-- AndroidManifest.xml
 | +-- java/
 | +-- res/
 +-- library1/（Library サブプロジェクト）
 | +-- build.gradle（サブプロジェクトのビルドスクリプト）
 +-- library2/（Library サブプロジェクト）
 +-- build.gradle（サブプロジェクトのビルドスクリプト）
&lt;/code>&lt;/pre>&lt;p>この例では、３つのサブプロジェクト (app, library1, library2) によって全体のビルドが構成されています。&lt;/p></description></item><item><title>Android Gradleメモ: BuildConfig クラスでアプリの動作を切り替える</title><link>https://maku77.github.io/p/xtzsj3m/</link><pubDate>Mon, 01 Aug 2016 00:00:00 +0900</pubDate><guid>https://maku77.github.io/p/xtzsj3m/</guid><description>&lt;p>Android SDK のバージョン 17 以降では、ビルド時に自動的に &lt;code>BuildConfig&lt;/code> というクラスが生成されるようになっています。
このクラスはビルド設定に応じた定数フィールドを提供しており、これを利用すると、ビルドタイプが &lt;code>debug&lt;/code> のときのみデバッグログを出力するといったことが行えます 。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="k">if&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">BuildConfig&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">DEBUG&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">Log&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">d&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">TAG&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s">&amp;#34;Important data is missing!&amp;#34;&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>Gradle のビルドスクリプトで、この &lt;code>BuildConfig&lt;/code> クラスに独自の定数フィールドを追加することも可能です。
下記の例では、ビルドタイプごとに &lt;code>BuildConfig.ACCESS_LOG&lt;/code> 定数と、&lt;code>BuildConfig.WEBAPI_URL&lt;/code> 定数を定義しています（ここではビルドタイプごとに設定していますが、Product Flavor を含むすべての Build Variants で自由に設定することができます）。&lt;/p>

&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">build.gradle&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-build.gradle" data-lang="build.gradle">&lt;span class="line">&lt;span class="cl">&lt;span class="n">android&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">...&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">buildTypes&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">debug&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">buildConfigField&lt;/span> &lt;span class="s1">&amp;#39;boolean&amp;#39;&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="s1">&amp;#39;ACCESS_LOG&amp;#39;&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="s1">&amp;#39;false&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">buildConfigField&lt;/span> &lt;span class="s1">&amp;#39;String&amp;#39;&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="s1">&amp;#39;WEBAPI_URL&amp;#39;&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="s1">&amp;#39;&amp;#34;http://dev.example.com/api/&amp;#34;&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">release&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">buildConfigField&lt;/span> &lt;span class="s1">&amp;#39;boolean&amp;#39;&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="s1">&amp;#39;ACCESS_LOG&amp;#39;&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="s1">&amp;#39;true&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">buildConfigField&lt;/span> &lt;span class="s1">&amp;#39;String&amp;#39;&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="s1">&amp;#39;WEBAPI_URL&amp;#39;&lt;/span>&lt;span class="o">,&lt;/span> &lt;span class="s1">&amp;#39;&amp;#34;http://example.com/api/&amp;#34;&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">}&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure></description></item><item><title>ADB で特定のブロードキャストインテントをレシーブするアプリを列挙する (dumpsys activity broadcasts)</title><link>https://maku77.github.io/p/jfqtfyn/</link><pubDate>Fri, 15 Jul 2016 00:00:00 +0900</pubDate><guid>https://maku77.github.io/p/jfqtfyn/</guid><description>&lt;p>&lt;strong>&lt;code>dumpsys&lt;/code>&lt;/strong> コマンドの &lt;strong>&lt;code>activity broadcast&lt;/code>&lt;/strong> サブコマンドを実行すると、ブロードキャストインテントをハンドルするように登録しているレシーバーの一覧を確認することができます。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-console" data-lang="console">&lt;span class="line">&lt;span class="cl">&lt;span class="gp">$&lt;/span> adb shell dumpsys activity broadcasts
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>
&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">実行結果（抜粋）&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-plain" data-lang="plain">&lt;span class="line">&lt;span class="cl">ACTIVITY MANAGER BROADCAST STATE (dumpsys activity broadcasts)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Registered Receivers:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ...
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> * ReceiverList{82bcce 603 com.android.systemui/10019/u0 remote:83b3dc9}
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> app=603:com.android.systemui/u0a19 pid=603 uid=10019 user=0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Filter #0: BroadcastFilter{28557ef}
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Action: &amp;#34;android.intent.action.TIME_TICK&amp;#34;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Action: &amp;#34;android.intent.action.TIME_SET&amp;#34;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Action: &amp;#34;android.intent.action.BATTERY_CHANGED&amp;#34;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ...
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> AutoVerify=false
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Filter #1: BroadcastFilter{56b72fc}
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Action: &amp;#34;android.intent.action.BOOT_COMPLETED&amp;#34;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> mPriority=1000, mHasPartialTypes=false
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> AutoVerify=false
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ...&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>

&lt;p>&lt;strong>&lt;code>Registered Receivers&lt;/code>&lt;/strong> のセクションには、アプリごとにどのようなフィルタでインテントを監視しているかが表示されます。
上記の例では、&lt;code>com.android.systemui&lt;/code> アプリが、&lt;code>android.intent.action.TIME_TICK&lt;/code> インテントなどのブロードキャストを監視していること示しています。&lt;/p></description></item><item><title>ADB からキー入力やテキスト入力を行う (input text, input keyevent)</title><link>https://maku77.github.io/p/gorux24/</link><pubDate>Thu, 14 Jul 2016 00:00:00 +0900</pubDate><guid>https://maku77.github.io/p/gorux24/</guid><description>&lt;p>ADB shell 上で &lt;strong>&lt;code>input&lt;/code>&lt;/strong> コマンドを使用すると、任意のキー入力やテキスト入力をエミュレートすることができます。&lt;/p>
&lt;h2 id="キー入力の例-input-keyevent">キー入力の例 (input keyevent)&lt;/h2>
&lt;p>&lt;code>input keyevent&lt;/code> コマンドを使用することで、単一のキー入力をエミュレートできます。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-console" data-lang="console">&lt;span class="line">&lt;span class="cl">&lt;span class="gp">$&lt;/span> adb shell input keyevent ENTER &lt;span class="c1"># Enter キー&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="gp">$&lt;/span> adb shell input keyevent DPAD_CENTER &lt;span class="c1"># D-pad 上の決定キー&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="gp">$&lt;/span> adb shell input keyevent DPAD_RIGHT &lt;span class="c1"># 右キー&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="gp">$&lt;/span> adb shell input keyevent POWER &lt;span class="c1"># 電源キー&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="gp">$&lt;/span> adb shell input keyevent A &lt;span class="c1"># キーボードの A キー&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="gp">$&lt;/span> adb shell input keyevent TV &lt;span class="c1"># TV キー（Android TV 用）&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="gp">$&lt;/span> adb shell input keyevent NUMBER_ENTRY &lt;span class="c1"># 10-key キー（Android TV 用）&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="gp">$&lt;/span> adb shell input keyevent TV_TERRESTRIAL_DIGITAL &lt;span class="c1"># 地デジキー（Android TV 用）&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>パラメータに指定できるキー名は、&lt;code>android.view.KeyEvent&lt;/code> クラスに定義されている &lt;code>KEYCODE_XXX&lt;/code> という定数の、&lt;code>KEYCODE_&lt;/code> というプレフィックスを除いたものです（参考: &lt;a href="https://developer.android.com/reference/android/view/KeyEvent.html#constants">KeyEvent クラスの定数一覧&lt;/a>）。&lt;/p></description></item><item><title>Systrace をコマンド化して簡単に実行できるようにする (systrace.cmd)</title><link>https://maku77.github.io/p/ycwfweu/</link><pubDate>Wed, 13 Jul 2016 00:00:00 +0900</pubDate><guid>https://maku77.github.io/p/ycwfweu/</guid><description>&lt;p>&lt;strong>（追記）&lt;/strong> Android 10 (Q) 以降では、より洗練された &lt;a href="../p/ehu5eox/">Perfetto&lt;/a> を使ってパフォーマンス解析できます。&lt;/p>
&lt;h2 id="systrace-コマンドの基本">systrace コマンドの基本&lt;/h2>
&lt;ul>
&lt;li>&lt;a href="https://developer.android.com/studio/profile/systrace-commandline.html">Android - Systrace&lt;/a>&lt;/li>
&lt;li>&lt;a href="https://developer.android.com/studio/profile/systrace.html">Android - Analyzing UI Performance with Systrace&lt;/a>&lt;/li>
&lt;/ul>
&lt;p>Android SDK に付属している &lt;code>systrace.py&lt;/code> スクリプトを使用すると、Android デバイス全体のプロセスに関するプロファイリングを行うことができます（I/O アクセスや UI スレッドの状況など）。
&lt;code>systrace&lt;/code> は Python スクリプトとして提供されているため、実行するときは下記のような感じでパラメータを指定して実行します。&lt;/p>

&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">例: 10 秒間の systrace 実行する&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-console" data-lang="console">&lt;span class="line">&lt;span class="cl">&lt;span class="gp">$&lt;/span> &lt;span class="nb">cd&lt;/span> android-sdk/platform-tools/systrace
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="gp">$&lt;/span> python systrace.py --time&lt;span class="o">=&lt;/span>&lt;span class="m">10&lt;/span> -o trace.html sched gfx view wm
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>

&lt;p>プロファイルの取得が完了すると、プロファイル結果を表示するための HTML ファイルがカレントディレクトリに作成されます。&lt;/p>
&lt;pre tabindex="0">&lt;code>Capturing trace......................................................Done.
Downloading trace....Done.

 wrote file://C:\trace.html
&lt;/code>&lt;/pre>&lt;p>この HTML を Web ブラウザで開いてボトルネックの分析を行うことができます。
Web ブラウザ上で &lt;code>?&lt;/code> キーを押すと、使用できるショートカットキーの一覧を確認できます。&lt;/p>
&lt;h2 id="バッチファイル化">バッチファイル化&lt;/h2>
&lt;p>&lt;code>systrace&lt;/code> コマンドを実行するときに、同じようなパラメータを毎回指定するのは面倒ですし、Windows 環境ですと PATH を通したりするのも若干面倒ですので、下記のようなバッチファイルを作成しておくと便利です。&lt;/p></description></item><item><title>Androidメモ: ADB で WakeLock を強制的に外す</title><link>https://maku77.github.io/p/xx3mb8e/</link><pubDate>Thu, 07 Jul 2016 00:00:00 +0900</pubDate><guid>https://maku77.github.io/p/xx3mb8e/</guid><description>&lt;p>&lt;strong>&lt;code>/sys/power/wake_unlock&lt;/code>&lt;/strong> に対して WakeLock 名を書き込むことで、その WakeLock を強制キャンセルすることができます。&lt;/p>
&lt;p>現在取得されている WakeLock（カーネル・ウェイクロック）の一覧は下記のようにして調べることができます。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-console" data-lang="console">&lt;span class="line">&lt;span class="cl">&lt;span class="gp">$&lt;/span> adb shell cat /sys/power/wake_lock
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">PowerManagerService PowerManagerService.Display PowerManagerService.WakeLocks
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>上記で表示された WakeLock 名を参考にして、下記のように &lt;code>wake_unlock&lt;/code> に書き込みます。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-console" data-lang="console">&lt;span class="line">&lt;span class="cl">&lt;span class="gp">$&lt;/span> adb shell &lt;span class="s2">&amp;#34;echo PowerManagerService &amp;gt; /sys/power/wake_unlock&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div></description></item><item><title>Ruby で adb コマンドの出力結果を処理する</title><link>https://maku77.github.io/p/w6vao2e/</link><pubDate>Wed, 06 Jul 2016 00:00:00 +0900</pubDate><guid>https://maku77.github.io/p/w6vao2e/</guid><description>&lt;p>下記は、Ruby スクリプトの中から &lt;code>adb shell&lt;/code> コマンドを呼び出して、その出力をハンドルするサンプルです。&lt;/p>
&lt;p>ここで定義している &lt;code>adb_shell&lt;/code> メソッドは、受け取ったコマンド文字列を &lt;code>adb shell&lt;/code> の後ろにくっつけた形のコマンドを実行します（&lt;code>adb_shell('pm list packages')&lt;/code> とすると、&lt;code>adb shell pm list packages&lt;/code> が実行される）。&lt;/p>

&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">sample.rb&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-ruby" data-lang="ruby">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Executes the command via &amp;#39;adb shell&amp;#39;.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Obtained result will be passed to the specified block line by line.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">def&lt;/span> &lt;span class="nf">adb_shell&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">command&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">result&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="sb">`adb shell &lt;/span>&lt;span class="si">#{&lt;/span>&lt;span class="n">command&lt;/span>&lt;span class="si">}&lt;/span>&lt;span class="sb">`&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">result&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">gsub!&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;&lt;/span>&lt;span class="se">\n\n&lt;/span>&lt;span class="s2">&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s2">&amp;#34;&lt;/span>&lt;span class="se">\n&lt;/span>&lt;span class="s2">&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="c1"># for Windows&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">result&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">lines&lt;/span> &lt;span class="p">{&lt;/span> &lt;span class="o">|&lt;/span>&lt;span class="n">line&lt;/span>&lt;span class="o">|&lt;/span> &lt;span class="k">yield&lt;/span> &lt;span class="n">line&lt;/span> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">end&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Test&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">if&lt;/span> &lt;span class="vg">$0&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="bp">__FILE__&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">adb_shell&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;pm list packages&amp;#39;&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="k">do&lt;/span> &lt;span class="o">|&lt;/span>&lt;span class="n">line&lt;/span>&lt;span class="o">|&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nb">puts&lt;/span> &lt;span class="s1">&amp;#39;==&amp;gt; &amp;#39;&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="n">line&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">end&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">end&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>


&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">実行結果&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-console" data-lang="console">&lt;span class="line">&lt;span class="cl">&lt;span class="gp">$&lt;/span> ruby sample.rb
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">==&amp;gt; package:android
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">==&amp;gt; package:android.autoinstalls.config.google.fugu
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">==&amp;gt; package:com.android.backupconfirm
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">==&amp;gt; package:com.android.bluetooth
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">==&amp;gt; package:com.android.certinstaller
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">==&amp;gt; package:com.android.defcontainer
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">==&amp;gt; package:com.android.dreams.basic
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">...
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>

&lt;p>応用として、パッケージ名部分だけを取り出したいのであれば、下記のように正規表現でフィルタしてしまうこともできますね。&lt;/p></description></item><item><title>APK のパッケージ名から APK ファイルのパスを調べる (pm path, pm list packages)</title><link>https://maku77.github.io/p/ghtgxgw/</link><pubDate>Mon, 27 Jun 2016 00:00:00 +0900</pubDate><guid>https://maku77.github.io/p/ghtgxgw/</guid><description>&lt;h2 id="指定したパッケージの-apk-のファイルパスを調べる">指定したパッケージの APK のファイルパスを調べる&lt;/h2>
&lt;p>Android デバイスに &lt;code>adb shell&lt;/code> で接続し、&lt;strong>&lt;code>pm path &amp;lt;パッケージ名&amp;gt;&lt;/code>&lt;/strong> コマンドを実行すると、指定したパッケージ名の APK ファイルが、デバイス上のどのパスに置かれているかを調べることができます。&lt;/p>

&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">com.example.myapp パッケージがどの APK ファイルか調べる&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-console" data-lang="console">&lt;span class="line">&lt;span class="cl">&lt;span class="gp">$&lt;/span> adb shell pm path com.example.myapp
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">package:/system/app/MyApp/MyApp.apk
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>

&lt;h2 id="インストールされているすべての-apk-のファイルパスとパッケージ名を調べる">インストールされているすべての APK のファイルパスとパッケージ名を調べる&lt;/h2>
&lt;p>インストールされている APK パッケージの一覧は、&lt;strong>&lt;code>pm list packages&lt;/code>&lt;/strong> コマンドで調べることができます。&lt;/p>

&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">インストール済みパッケージの一覧を表示&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-console" data-lang="console">&lt;span class="line">&lt;span class="cl">&lt;span class="gp">$&lt;/span> adb shell pm list packages
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">package:com.google.android.apps.mediashell
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">package:com.google.android.katniss
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">package:com.android.providers.calendar
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">package:com.android.tv.settings
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">package:com.android.providers.media
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">...
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>

&lt;p>さらに、&lt;strong>&lt;code>-f&lt;/code>&lt;/strong> オプションを指定して実行すると、すべての APK に関するファイルパスとパッケージ名の対応情報を調べることができます。
&lt;code>sort&lt;/code> コマンドと組み合わせて使用すると見やすくなります。&lt;/p>

&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">APK 名とパッケージ名の対応リスト&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-console" data-lang="console">&lt;span class="line">&lt;span class="cl">&lt;span class="gp">$&lt;/span> adb shell pm list packages -f &lt;span class="p">|&lt;/span> sort
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">package:/system/app/Backdrop/Backdrop.apk=com.google.android.backdrop
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">package:/system/app/BasicDreams/BasicDreams.apk=com.android.dreams.basic
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">package:/system/app/Bluetooth/Bluetooth.apk=com.android.bluetooth
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">package:/system/app/KeyChain/KeyChain.apk=com.android.keychain
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">...
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>

&lt;p>システムにプリインストールされているアプリケーションだけを列挙したい場合は、&lt;strong>&lt;code>-s&lt;/code>&lt;/strong> オプションも同時に指定します。&lt;/p>

&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">プリインアプリのみ表示&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-console" data-lang="console">&lt;span class="line">&lt;span class="cl">&lt;span class="gp">$&lt;/span> adb shell pm list packages -f -s
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>

&lt;p>逆に、ユーザがインストールしたサードパーティ製のアプリだけを列挙したい場合は、&lt;strong>&lt;code>-3&lt;/code>&lt;/strong> オプションを指定します（&lt;code>/data/app&lt;/code> 以下に格納されているのが分かります）。&lt;/p></description></item><item><title>Androidメモ: Android Studio の便利なショートカット (2) ブックマーク</title><link>https://maku77.github.io/p/6qqdsxw/</link><pubDate>Mon, 20 Jun 2016 00:00:00 +0900</pubDate><guid>https://maku77.github.io/p/6qqdsxw/</guid><description>&lt;p>Android Studio には、任意の行をブックマークしておく機能が備わっています。
巨大なプログラムを読む場合や、複数ファイルにまたがる編集を行う場合に、ブックマーク機能を使いこなすと効率的に作業できます。&lt;/p>
&lt;table>
 &lt;thead>
 &lt;tr>
 &lt;th>キー操作&lt;/th>
 &lt;th>説明&lt;/th>
 &lt;/tr>
 &lt;/thead>
 &lt;tbody>
 &lt;tr>
 &lt;td>&lt;code>F11&lt;/code>&lt;/td>
 &lt;td>カーソル行をブックマークに追加／削除&lt;/td>
 &lt;/tr>
 &lt;tr>
 &lt;td>&lt;code>Ctrl + F11&lt;/code>&lt;/td>
 &lt;td>カーソル行をブックマークに追加／削除（任意のキーに割り当てる）&lt;b>※&lt;/b>&lt;/td>
 &lt;/tr>
 &lt;tr>
 &lt;td>&lt;code>Shift + F11&lt;/code>&lt;/td>
 &lt;td>ブックマークの一覧を表示&lt;/td>
 &lt;/tr>
 &lt;/tbody>
&lt;/table>
&lt;p>&lt;b>※&lt;/b>カーソル行をブックマークに追加するときに、&lt;code>Ctrl + F11&lt;/code> を使用すると、任意の英数字キーにそのブックマークを割り当てることができます。
例えば数字キー (&lt;code>0&lt;/code>～&lt;code>9&lt;/code>) に割り当てておくと、&lt;code>Ctrl + 0～9&lt;/code> というキー入力でその行にジャンプできるようになります（&lt;code>Shift + F11&lt;/code> で一覧を表示する必要がありません）。&lt;/p></description></item><item><title>Systrace の画面が真っ白になるときの対応方法</title><link>https://maku77.github.io/p/u3n5m3j/</link><pubDate>Wed, 08 Jun 2016 00:00:00 +0900</pubDate><guid>https://maku77.github.io/p/u3n5m3j/</guid><description>&lt;p>&lt;strong>追記 (2021-04): 現在は Systrace は deprecated になっており、Perfetto という新しいトレースツールを使うことができます&lt;/strong>（参考: &lt;a href="../p/ehu5eox/">Perfetto でシステム全体のパフォーマンスを計測する&lt;/a>。
過去に systrace で取得したトレースファイルを開きたいときは、&lt;a href="https://ui.perfetto.dev/">Perfetto UI&lt;/a> のサイト上で &lt;code>Open with Legacy UI&lt;/code> から開くことができます。&lt;/p>
&lt;hr>
&lt;p>Android の DDMS などで利用可能な systrace を実行すると、&lt;code>trace.html&lt;/code> ファイルが生成されますが、この中で非推奨になった JavaScript API(Object.observe) を使用しているため、最新の Chrome では表示できない問題が出ています。&lt;/p>
&lt;ul>
&lt;li>参考: &lt;a href="http://stackoverflow.com/questions/36865899/react-native-android-systrace-html-is-blank-in-ubuntu-14-04/37008945">http://stackoverflow.com/questions/36865899/react-native-android-systrace-html-is-blank-in-ubuntu-14-04/37008945&lt;/a>&lt;/li>
&lt;/ul>
&lt;p>上記サイトでの回避策としては、生成された HTML のヘッダに下記を追加することがあげられています。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-html" data-lang="html">&lt;span class="line">&lt;span class="cl">&lt;span class="p">&amp;lt;&lt;/span>&lt;span class="nt">script&lt;/span> &lt;span class="na">src&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s">&amp;#34;https://rawgit.com/MaxArt2501/object-observe/master/dist/object-observe.min.js&amp;#34;&lt;/span>&lt;span class="p">&amp;gt;&amp;lt;/&lt;/span>&lt;span class="nt">script&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>生成される HTML ファイルを毎回修正するのが面倒な場合は、Android SDK のディレクトリにある下記のファイルを編集するという方法もあります。
このファイルに追記した内容は、生成される HTML にも反映されるようになります。&lt;/p>

&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">$ANDROID_SDK/platform-tools/systrace/prefix.html&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-html" data-lang="html">&lt;span class="line">&lt;span class="cl">&lt;span class="cp">&amp;lt;!DOCTYPE HTML&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">&amp;lt;&lt;/span>&lt;span class="nt">html&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">&amp;lt;&lt;/span>&lt;span class="nt">head&lt;/span> &lt;span class="na">i18n-values&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s">&amp;#34;dir:textdirection;&amp;#34;&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">&amp;lt;&lt;/span>&lt;span class="nt">meta&lt;/span> &lt;span class="na">http-equiv&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s">&amp;#34;Content-Type&amp;#34;&lt;/span> &lt;span class="na">content&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s">&amp;#34;text/html; charset=utf-8&amp;#34;&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">&amp;lt;&lt;/span>&lt;span class="nt">meta&lt;/span> &lt;span class="na">charset&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s">&amp;#34;utf-8&amp;#34;&lt;/span>&lt;span class="p">/&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">&amp;lt;&lt;/span>&lt;span class="nt">script&lt;/span> &lt;span class="na">src&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s">&amp;#34;https://rawgit.com/MaxArt2501/object-observe/master/dist/object-observe.min.js&amp;#34;&lt;/span>&lt;span class="p">&amp;gt;&amp;lt;/&lt;/span>&lt;span class="nt">script&lt;/span>&lt;span class="p">&amp;gt;&lt;/span> ★これを追加&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure></description></item><item><title>Android アプリのパフォーマンス改善に使用できるツール</title><link>https://maku77.github.io/p/39cfimo/</link><pubDate>Tue, 07 Jun 2016 00:00:00 +0900</pubDate><guid>https://maku77.github.io/p/39cfimo/</guid><description>&lt;h2 id="systrace--perfetto-システム全体の負荷状況などを調べる">systrace / perfetto: システム全体の負荷状況などを調べる&lt;/h2>
&lt;p>&lt;a href="https://developer.android.com/studio/profile/systrace.html">systrace&lt;/a> を使用すると、カーネルレベルでの CPU 負荷状況などを調べられるため、システム全体で重くなっている場合などの一次分析に使用できます。
DDMS ツール (monitor.bat) から任意のタイミングでプロファイル取得できます。&lt;/p>
&lt;p>&lt;strong>（追記）&lt;/strong> Android 10 (Q) 以降は、より洗練された &lt;a href="https://perfetto.dev/">Perfetto&lt;/a> を使用してください。&lt;/p>
&lt;ul>
&lt;li>参考: &lt;a href="../p/ehu5eox/">Perfetto でシステム全体のパフォーマンスを計測する&lt;/a>&lt;/li>
&lt;/ul>
&lt;h2 id="traceview-アプリ内のメソッド呼び出し数などを調べる">traceview: アプリ内のメソッド呼び出し数などを調べる&lt;/h2>
&lt;p>&lt;a href="https://developer.android.com/studio/profile/traceview.html">traceview&lt;/a> を使用すると、特定のアプリ内のメソッド単位のプロファイル情報を取得することができます。
メソッド呼び出し回数が想定よりも多くなっているとか、処理に時間がかかりすぎているメソッドなどを発見できます。&lt;/p>
&lt;p>DDMS ツールから任意のタイミングでプロファイル取得できます。あるいは、コードに開始／終了タイミングを明示することで、ピンポイントで特定の区間のプロファイルを取得することもできます。&lt;/p>
&lt;h2 id="show-gpu-overdraw-同じ領域を何度も描画しないか調べる">Show GPU overdraw: 同じ領域を何度も描画しないか調べる&lt;/h2>
&lt;p>開発者オプションで &lt;a href="https://developer.android.com/studio/profile/dev-options-overdraw.html">Show GPU overdraw&lt;/a> の機能を有効にすると、画面上に重ねて描画される領域があったときに、その領域が描画回数に応じた色で矩形表示されるようになります。
例えば、赤色で矩形表示された場合は、その領域が 3 回以上重複して描画されていることを示しており、プログラム内の描画シーケンスを見直すべきだと分かります。&lt;/p>
&lt;p>Show GPU overdraw の機能は、Android の開発者オプションから有効にできます (&lt;code>Settings&lt;/code> → &lt;code>Developer options&lt;/code> → &lt;code>Drawing&lt;/code> → &lt;code>Show GPU overdraw&lt;/code>)。&lt;/p>
&lt;h2 id="profile-gpu-rendering-60fps-で描画できている調べる">Profile GPU rendering: 60FPS で描画できている調べる&lt;/h2>
&lt;p>開発者オプションで &lt;a href="https://developer.android.com/studio/profile/dev-options-rendering.html">Profile GPU rendering&lt;/a> の機能を有効にすると、描画フレームごとに UI スレッドでかかった時間を画面上にバー表示することができます。
緑色のラインは 16.6ms を示しており、このラインを超えるということは 60 FPS で描画できていないということです。メインスレッド上で描画以外の処理を行っていないか見直す必要があります。&lt;/p></description></item><item><title>ADB で指定したアプリを強制終了する (am force-stop)</title><link>https://maku77.github.io/p/9yse3iz/</link><pubDate>Mon, 06 Jun 2016 00:00:00 +0900</pubDate><guid>https://maku77.github.io/p/9yse3iz/</guid><description>&lt;p>Android 端末に ADB 接続された状態で &lt;strong>&lt;code>adb shell am force-stop&lt;/code>&lt;/strong> コマンドを実行すると、任意のアプリケーションを強制終了することができます。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-console" data-lang="console">&lt;span class="line">&lt;span class="cl">&lt;span class="gp">$&lt;/span> adb shell am force-stop com.example.myapp
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;code>adb shell&lt;/code> 接続されている状態であれば、&lt;code>adb shell&lt;/code> の部分は省略して実行します。&lt;/p>
&lt;pre tabindex="0">&lt;code>generic_x86:/ $ am force-stop com.example.myapp
&lt;/code>&lt;/pre>&lt;p>ちなみに、インストールされているアプリのパッケージ名一覧は &lt;code>adb shell pm list packages&lt;/code> で調べることができます（こちらは &lt;code>am&lt;/code> じゃなくて &lt;strong>&lt;code>pm&lt;/code>&lt;/strong> コマンドであることに注意してください）。&lt;/p>
&lt;ul>
&lt;li>参考: &lt;a href="../p/uh84kfj/">ADB で Android 端末にインストールされているパッケージの一覧を取得する (pm list packages)&lt;/a>&lt;/li>
&lt;/ul></description></item><item><title>Androidメモ: Android Studio の便利なショートカット (1) コードの調査／メソッド間のジャンプ</title><link>https://maku77.github.io/p/3vejawn/</link><pubDate>Tue, 12 Apr 2016 00:00:00 +0900</pubDate><guid>https://maku77.github.io/p/3vejawn/</guid><description>&lt;style>
.local-focus {
 background: pink;
}
th.local-key-column {
 width: 13em;
}
&lt;/style>
&lt;h2 id="コード探索に便利なショートカットキー一覧">コード探索に便利なショートカットキー一覧&lt;/h2>
&lt;p>ショートカットキーの組み合わせはたくさんあってややこしいですが、&lt;strong>&lt;kbd>B&lt;/kbd> キー系のショートカットは定義へのジャンプ&lt;/strong>、&lt;strong>&lt;kbd>F7&lt;/kbd> キー系のショートカットは参照箇所へのジャンプ&lt;/strong>と覚えれば迷わずに使用できるようになります。
&lt;kbd>B&lt;/kbd> キーに関しては、マウスの&lt;kbd>左クリック&lt;/kbd>で置き換えられるようになっています。&lt;/p>
&lt;p>ひとまず、下記を使いこなせばほとんどのケースはカバーできるはずです。&lt;/p>
&lt;ul>
&lt;li>&lt;kbd>Ctrl-Alt-B&lt;/kbd> &amp;ndash; クラス実装、メソッド実装、変数定義へのジャンプ&lt;/li>
&lt;li>&lt;kbd>Ctrl-Shift-B&lt;/kbd> &amp;ndash; 変数の型（クラス）へのジャンプ&lt;/li>
&lt;li>&lt;kbd>Alt-F7&lt;/kbd> &amp;ndash; 参照箇所へのジャンプ&lt;/li>
&lt;li>&lt;kbd>Ctrl-Alt-左&lt;/kbd> &amp;ndash; ジャンプ元へ戻る&lt;/li>
&lt;/ul>
&lt;p>下記はコードを調査するときに便利なショートカットキーの一覧です。
特に使いこなしたいキーに関しては、★マークを付けてあります。&lt;/p>
&lt;h3 id="b-キー系実装定義へのジャンプ">B キー系（実装、定義へのジャンプ）&lt;/h3>
&lt;table>
 &lt;tr>
 &lt;th>&lt;/th>&lt;th class="local-key-column">ショートカットキー&lt;/th>&lt;th>説明&lt;/th>
 &lt;/tr>
 &lt;tr>
 &lt;td>&lt;/td>
 &lt;td>&lt;kbd>Ctrl-B&lt;/kbd>&lt;br>&lt;kbd>Ctrl-クリック&lt;/kbd>&lt;br>&lt;kbd>中央ボタンクリック&lt;/kbd>&lt;/td>
 &lt;td>&lt;b>Declaration&lt;/b>&lt;br>コンテキストに応じて振る舞いが変わる。例えばカーソルがメソッド定義にあるときは参照箇所へジャンプ、カーソルが参照箇所にあるときは定義へジャンプする。できればこれに頼らず、より用途のはっきりした別のショートカットを使うとよい（下記2つ）。&lt;/td>
 &lt;/tr>
 &lt;tr>
 &lt;td>★&lt;/td>
 &lt;td>&lt;kbd>Ctrl-Alt-B&lt;/kbd>&lt;br>&lt;kbd>Ctrl-Alt-クリック&lt;/kbd>&lt;/td>
 &lt;td>&lt;b>Implementation(s)&lt;/b>&lt;br>子クラスやインタフェースの実装クラス、メソッド実装へジャンプ。インタフェース→具象クラス、メソッド参照→メソッド実装、というジャンプ。&lt;/td>
 &lt;/tr>
 &lt;tr>
 &lt;td>★&lt;/td>
 &lt;td>&lt;kbd>Ctrl-Shift-B&lt;/kbd>&lt;br>&lt;kbd>Ctrl-Shift-クリック&lt;/kbd>&lt;/td>
 &lt;td>&lt;b>Type Declaration&lt;/b>&lt;br>テキストカーソル下のオブジェクトの実装クラスへジャンプ。あるいは、テキストカーソル下のメソッドの戻り値のオブジェクトの実装クラスへジャンプ（戻り値が void の場合は何も起こらない）。オブジェクト→クラス、というジャンプ。&lt;/td>
 &lt;/tr>
&lt;/table>
&lt;h3 id="f7-キー系参照箇所へのジャンプ">F7 キー系（参照箇所へのジャンプ）&lt;/h3>
&lt;table>
 &lt;tr>
 &lt;th>&lt;/th>&lt;th class="local-key-column">ショートカットキー&lt;/th>&lt;th>説明&lt;/th>
 &lt;/tr>
 &lt;tr>
 &lt;td>★&lt;/td>
 &lt;td>&lt;kbd>Alt-F7&lt;/kbd>&lt;/td>
 &lt;td>&lt;b>Find Usages&lt;/b>&lt;br>メソッドや変数の参照箇所をツリー表示&lt;/td>
 &lt;/tr>
 &lt;tr>
 &lt;td>&lt;/td>
 &lt;td>&lt;kbd>Ctrl-Alt-F7&lt;/kbd>&lt;/td>
 &lt;td>&lt;b>Show Usages&lt;/b>&lt;br>メソッドや変数の参照箇所をリスト表示（1か所だけなら即ジャンプ）&lt;/td>
 &lt;/tr>
 &lt;tr>
 &lt;td>&lt;/td>
 &lt;td>&lt;kbd>Ctrl-F7&lt;/kbd>&lt;/td>
 &lt;td>&lt;b>Find Usages in File&lt;/b>&lt;br>ファイル内の参照箇所へジャンプ。&lt;kbd>F3&lt;/kbd>で次へ移動。&lt;/td>
 &lt;/tr>
 &lt;tr>
 &lt;td>&lt;/td>
 &lt;td>&lt;kbd>Ctrl-Shift-F7&lt;/kbd>&lt;/td>
 &lt;td>&lt;b>Highlight Usages in File&lt;/b>&lt;br>ファイル内の同じキーワードをハイライト、どんどん追加していける。&lt;kbd>Esc&lt;/kbd> ですべてのハイライトをクリア。&lt;/td>
 &lt;/tr>
 &lt;tr>
 &lt;td>&lt;/td>
 &lt;td>&lt;kbd>Ctrl-Alt-Shift-F7&lt;/kbd>&lt;/td>
 &lt;td>&lt;b>Find Usages Settings...&lt;/b>&lt;/td>
 &lt;/tr>
&lt;/table>
&lt;h3 id="f-キー系テキストサーチ">F キー系（テキストサーチ）&lt;/h3>
&lt;table>
 &lt;tr>
 &lt;th>&lt;/th>&lt;th class="local-key-column">ショートカットキー&lt;/th>&lt;th>説明&lt;/th>
 &lt;/tr>
 &lt;tr>
 &lt;td>&lt;/td>
 &lt;td>&lt;kbd>Ctrl-F&lt;/kbd>&lt;/td>
 &lt;td>&lt;b>Find...&lt;/b>&lt;br>ファイル内をテキスト検索&lt;/td>
 &lt;/tr>
 &lt;tr>
 &lt;td>★&lt;/td>
 &lt;td>&lt;kbd>Ctrl-Shift-F&lt;/kbd>&lt;/td>
 &lt;td>&lt;b>Find in Path...&lt;/b>&lt;br>プロジェクト内をテキスト検索&lt;/td>
 &lt;/tr>
 &lt;tr>
 &lt;td>&lt;/td>
 &lt;td>&lt;kbd>Ctrl-Alt-F&lt;/kbd>&lt;/td>
 &lt;td>&lt;b>Field...&lt;/b>&lt;br>フィールドをテキスト検索&lt;/td>
 &lt;/tr>
&lt;/table>
&lt;h3 id="その他">その他&lt;/h3>
&lt;table>
 &lt;tr>
 &lt;th>&lt;/th>&lt;th class="local-key-column">ショートカットキー&lt;/th>&lt;th>説明&lt;/th>
 &lt;/tr>
 &lt;tr>
 &lt;td>★&lt;/td>
 &lt;td>&lt;kbd>Ctrl-Alt-左/右&lt;/kbd>&lt;/td>
 &lt;td>&lt;b>Back/Forward&lt;/b>&lt;br>ジャンプ元へ戻る／進む&lt;/td>
 &lt;/tr>
 &lt;tr>
 &lt;td>★&lt;/td>
 &lt;td>&lt;kbd>Ctrl-N&lt;/kbd>&lt;/td>
 &lt;td>&lt;b>Class...&lt;/b>&lt;br>クラス名を指定してファイルオープン&lt;/td>
 &lt;/tr>
 &lt;tr>
 &lt;td>★&lt;/td>
 &lt;td>&lt;kbd>Ctrl-H&lt;/kbd>&lt;/td>
 &lt;td>&lt;b>Type Hierarchy&lt;/b>&lt;br>クラスやインタフェースの階層構造を表示&lt;/td>
 &lt;/tr>
 &lt;tr>
 &lt;td>&lt;/td>
 &lt;td>&lt;kbd>Ctrl-F12&lt;/kbd>&lt;/td>
 &lt;td>&lt;b>File Structure&lt;/b>&lt;br>クラス内のメンバ、フィールドをリスト表示&lt;/td>
 &lt;/tr>
&lt;/table>
&lt;h2 id="実装へジャンプする-b-キー系ショートカット">実装へジャンプする B キー系ショートカット&lt;/h2>
&lt;p>&lt;kbd>Ctrl-B&lt;/kbd>（&lt;kbd>Ctrl-クリック&lt;/kbd>）はコンテキストによって異なる振る舞いをするため、可能であれば、このショートカットは使わずに、より用途が明確な &lt;kbd>Ctrl-Alt-B&lt;/kbd>、&lt;kbd>Ctrl-Shift-B&lt;/kbd> の方を使えるようになると、スムーズにコード調査を行えるようになります。&lt;/p></description></item><item><title>Androidメモ: Android Studio で新規ファイル作成時に Copyright を自動挿入する</title><link>https://maku77.github.io/p/hv7we2a/</link><pubDate>Tue, 22 Mar 2016 00:00:00 +0900</pubDate><guid>https://maku77.github.io/p/hv7we2a/</guid><description>&lt;p>Android Studio で下記のコピーライト設定を行っておくと、新規ファイルを作成したときに、ファイルの先頭に自動でコピーライト表記を挿入してくれるようになります。&lt;/p>
&lt;ol>
&lt;li>Android Studio のメニューから [File] → [Settings] を選択&lt;/li>
&lt;li>Settings ウィンドウから [Editor] → [Copyright] → [Copyright Profiles] を選択&lt;/li>
&lt;li>[+] ボタンを押して任意のコピーライト設定を行う&lt;/li>
&lt;li>[Editor] → [Copyright] に戻り、上記で作成したコピーライト設定を選択する&lt;/li>
&lt;/ol>
&lt;p>ステップ 3 での Copyright text の設定では、純粋にコピーライト表記用の文言だけを記入すれば OK です。&lt;/p>
&lt;pre tabindex="0">&lt;code>Copyright 2016 MakuMaku Corporation
&lt;/code>&lt;/pre>&lt;p>上記のように記入しておけば、あとは作成するファイルの種類によって、自動的にコメント化されて挿入されるようになります。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="cm">/*
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cm"> * Copyright 2016 MakuMaku Corporation
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cm"> */&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div></description></item><item><title>Androidメモ: Android Studio に割り当てるメモリを増やす</title><link>https://maku77.github.io/p/b5ivaja/</link><pubDate>Tue, 22 Mar 2016 00:00:00 +0900</pubDate><guid>https://maku77.github.io/p/b5ivaja/</guid><description>&lt;p>Android Studio に割り当てられる VM のメモリ容量は、デフォルトで最大 750MB (&lt;code>-Xmx750m&lt;/code>) に設定されています。
物理メモリに余裕のある PC で作業している場合は、この最大サイズを大きくしておくとよいでしょう。&lt;/p>
&lt;p>VM に関する設定は、&lt;code>studio.exe.vmoptions&lt;/code> あるいは &lt;code>studio64.exe.vmoptions&lt;/code> というファイルを作成して変更することができますが、これらのファイルの具体的な置き場所は、プラットフォームごと、Android Studio のバージョンごとに異なっています（下記参照）。&lt;/p>
&lt;ul>
&lt;li>&lt;a href="http://tools.android.com/tech-docs/configuration">Configuring Android Studio: IDE &amp;amp; VM Options, JDK, etc - Android Tools Project Site&lt;/a>&lt;/li>
&lt;/ul>
&lt;p>例えば、Windows で Android Studio Preview 2.0 (64bit) を使用している場合は、下記のようなファイルを作成します。&lt;/p>
&lt;pre tabindex="0">&lt;code>%USERPROFILE%\.AndroidStudioPreview2.0\studio64.exe.vmoptions
&lt;/code>&lt;/pre>&lt;p>Android Studio が使用可能なメモリ容量を増やす（ここでは 4GB に設定する）には、このファイルに下記のように記述しておきます。&lt;/p>

&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">studio64.exe.vmoptions&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-text" data-lang="text">&lt;span class="line">&lt;span class="cl">-Xms1024m
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">-Xmx4096m
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">-Didea.platform.prefix=AndroidStudio
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">-Didea.paths.selector=AndroidStudioPreview2.0&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>

&lt;p>&lt;strong>&lt;code>-Xms&lt;/code>&lt;/strong> の方は最少メモリ容量、&lt;strong>&lt;code>-Xmx&lt;/code>&lt;/strong> の方には最大メモリ容量を指定します。
最後の 2 行の AndroidStudio に関する設定（環境によっては &lt;code>prefix&lt;/code> の方だけで OK かも）を行っておかないと、&lt;code>studio64.exe&lt;/code> を起動しようとしたときに素の IntelliJ が起動しちゃったりします。&lt;/p></description></item><item><title>Android Studio で静的解析プラグインを使用する (CheckStyle, FindBugs)</title><link>https://maku77.github.io/p/web92kb/</link><pubDate>Wed, 09 Dec 2015 00:00:00 +0900</pubDate><guid>https://maku77.github.io/p/web92kb/</guid><description>&lt;p>Gradle で Checkstyle や FindBugs のタスクを実行するのもよいですが、Android Studio に Plugin を入れておくと、警告箇所を簡単に調べられるようになります。&lt;/p>
&lt;h2 id="checkstyle-用のプラグイン-checkstyle-idea">CheckStyle 用のプラグイン (CheckStyle-IDEA)&lt;/h2>
&lt;h3 id="インストール">インストール&lt;/h3>
&lt;ol>
&lt;li>&lt;code>Ctrl + Alt + S&lt;/code> で Settings を開く&lt;/li>
&lt;li>&lt;code>Plugins&lt;/code> の &lt;code>Browse repositories...&lt;/code> ボタンを押す&lt;/li>
&lt;li>&lt;strong>CheckStyle-IDEA&lt;/strong> をインストール&lt;/li>
&lt;li>Android Studio を再起動&lt;/li>
&lt;/ol>
&lt;h3 id="設定プロジェクト用の設定が必要な場合">設定（プロジェクト用の設定が必要な場合）&lt;/h3>
&lt;ol>
&lt;li>&lt;code>Ctrl + Alt + S&lt;/code> で Settings を開く&lt;/li>
&lt;li>&lt;code>Other tools&lt;/code> の &lt;code>CheckStyle&lt;/code> を開く&lt;/li>
&lt;li>プロジェクト用の設定ファイルを追加し、チェックボックスにチェックを入れる&lt;/li>
&lt;/ol>
&lt;h3 id="実行">実行&lt;/h3>
&lt;ol>
&lt;li>&lt;code>Ctrl + Shift + A&lt;/code> で &lt;code>check&lt;/code> と入力&lt;/li>
&lt;/ol>
&lt;ul>
&lt;li>カレントファイルをチェックする場合: &lt;code>Check Current File&lt;/code>&lt;/li>
&lt;li>モジュール全体をチェックする場合: &lt;code>Check Module&lt;/code>&lt;/li>
&lt;li>プロジェクト全体をチェックする場合: &lt;code>Check Project&lt;/code>&lt;/li>
&lt;/ul>
&lt;h2 id="findbugs-用のプラグイン-findbugs-idea">FindBugs 用のプラグイン (FindBugs-IDEA)&lt;/h2>
&lt;h3 id="インストール-1">インストール&lt;/h3>
&lt;ol>
&lt;li>&lt;code>Ctrl + Alt + S&lt;/code> で Settings を開く&lt;/li>
&lt;li>&lt;code>Plugins&lt;/code> の &lt;code>Browse repositories...&lt;/code> ボタンを押す&lt;/li>
&lt;li>&lt;strong>FindBugs-IDEA&lt;/strong> をインストール&lt;/li>
&lt;li>Android Studio を再起動&lt;/li>
&lt;/ol>
&lt;h3 id="設定プロジェクト用の設定が必要な場合-1">設定（プロジェクト用の設定が必要な場合）&lt;/h3>
&lt;ol>
&lt;li>&lt;code>Ctrl + Alt + S&lt;/code> で Settings を開く&lt;/li>
&lt;li>&lt;code>Other tools&lt;/code> の &lt;code>FindBugs-IDEA&lt;/code> を開く&lt;/li>
&lt;li>&lt;code>Filters&lt;/code> タブの &lt;code>Exclude filter files&lt;/code> の &lt;code>Add&lt;/code> ボタンを押し、排他設定ファイルを読み込み。などなど。&lt;/li>
&lt;/ol>
&lt;h3 id="実行-1">実行&lt;/h3>
&lt;ol>
&lt;li>&lt;code>Ctrl + Shift + A&lt;/code> で &lt;code>findbugs&lt;/code> と入力&lt;/li>
&lt;/ol>
&lt;ul>
&lt;li>カレントファイルをチェックする場合: &lt;code>Analyze Current File&lt;/code>&lt;/li>
&lt;li>モジュール全体をチェックする場合: &lt;code>Analyze Module Files&lt;/code>&lt;/li>
&lt;li>プロジェクト全体をチェックする場合: &lt;code>Analyze Project Files&lt;/code>&lt;/li>
&lt;/ul></description></item><item><title>Android Gradleメモ: リソース名に正しくプレフィックスが付いているか確認する (resourcePrefix)</title><link>https://maku77.github.io/p/4zogpen/</link><pubDate>Mon, 30 Nov 2015 00:00:00 +0900</pubDate><guid>https://maku77.github.io/p/4zogpen/</guid><description>&lt;p>マルチプロジェクト構成な Android プロジェクトでは、サブプロジェクトによるリソース名の重複を意識しなければいけません。
リソース名の重複を防ぐには、例えば、サブプロジェクト内で使用するリソース名にプレフィックス名を付けたりします。&lt;/p>
&lt;p>&lt;code>build.gradle&lt;/code> で下記のように &lt;strong>&lt;code>resourcePrefix&lt;/code>&lt;/strong> を指定しておくと、リソース名のプレフィックスが正しく付けられているかチェックしてくれるようになります。
この設定は、Android Studio 0.5.8 以降で使用可能です。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-groovy" data-lang="groovy">&lt;span class="line">&lt;span class="cl">&lt;span class="n">android&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">resourcePrefix&lt;/span> &lt;span class="s1">&amp;#39;mylib_&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>指定したプレフィックスが付いていないリソース名が見つかると、Android Lint による警告が発生します。&lt;/p></description></item><item><title>Androidメモ: AAR 形式のファイルを作成する/使用する</title><link>https://maku77.github.io/p/3m9f8yv/</link><pubDate>Mon, 16 Nov 2015 00:00:00 +0900</pubDate><guid>https://maku77.github.io/p/3m9f8yv/</guid><description>&lt;h2 id="aar-とは">AAR とは&lt;/h2>
&lt;p>Android Studio では、従来の JAR 形式のライブラリファイルに加え、&lt;a href="https://tools.android.com/tech-docs/new-build-system/aar-format">AAR (Android Archive) 形式のライブラリ&lt;/a> を作成することができます。&lt;/p>
&lt;p>JAR ライブラリとは違い、AAR ライブラリは Android 固有のアセット、リソース、&lt;code>AndroidManifest.xml&lt;/code> などを含めることができます。
AAR ライブラリには &lt;code>AndroidManifest.xml&lt;/code> を含めることができるので、&lt;code>uses-library&lt;/code> 宣言をライブラリ内で完結させるといったことが可能になります。&lt;/p>
&lt;h2 id="aar-ライブラリを作成する">AAR ライブラリを作成する&lt;/h2>
&lt;h3 id="通常のアプリプロジェクトの下に-aar-ライブラリ用のサブプロジェクトを作成する方法">通常のアプリプロジェクトの下に AAR ライブラリ用のサブプロジェクトを作成する方法&lt;/h3>
&lt;p>現状の Android Studio (version 1.5) では、AAR ライブラリ専用の新規プロジェクトを作成することができません（後述の方法で、ごにょごにょすれば AAR 専用のプロジェクトとして扱うことはできます）。
なので、通常はアプリケーションプロジェクトの下に、サブプロジェクトとして AAR ライブラリのプロジェクトを作成することになります。
AAR ライブラリを作成する場合は、その使用例などを示すサンプルプロジェクトなども用意する必要がありますから、この構成で作成しておいても特に問題ないでしょう。&lt;/p>
&lt;p>まずは下記のように親プロジェクトとなるアプリプロジェクトを作成します。
Android Phone 用の UI ライブラリを作るつもりであれば、それを前提とした構成で作成しておけばよいでしょう。&lt;/p>
&lt;ol>
&lt;li>メニューから &lt;code>File&lt;/code> =&amp;gt; &lt;code>New&lt;/code> =&amp;gt; &lt;code>New Project...&lt;/code> を選択&lt;/li>
&lt;/ol>
&lt;p>次に、そのサブプロジェクトとして、AAR ライブラリ作成用のプロジェクトを作成します。&lt;/p>
&lt;ol>
&lt;li>メニューから &lt;code>File&lt;/code> =&amp;gt; &lt;code>New&lt;/code> =&amp;gt; &lt;code>New Module...&lt;/code> を選択&lt;/li>
&lt;li>&lt;code>Android Library&lt;/code> を選択し、&lt;strong>Module name&lt;/strong> に AAR ライブラリのファイル名、&lt;strong>Package name&lt;/strong> にライブラリの Java パッケージ名を入力&lt;/li>
&lt;/ol>
&lt;p>AAR ライブラリ用のサブプロジェクトが作成されたら、そこに Java のクラスやリソース、&lt;code>AndroidManifest.xml&lt;/code> などを追加していきます。
最後に、メニューから &lt;code>Build&lt;/code> =&amp;gt; &lt;code>Make Module&lt;/code> としてビルドすれば、下記のディレクトリに AAR ライブラリが生成されます。&lt;/p></description></item><item><title>Android Gradleメモ: Android の Gradle 関連ファイルまとめ</title><link>https://maku77.github.io/p/8f3pcke/</link><pubDate>Thu, 12 Nov 2015 00:00:00 +0900</pubDate><guid>https://maku77.github.io/p/8f3pcke/</guid><description>&lt;p>Android Studio を使ったり、Gradle でマルチプロジェクトを扱っていたりすると、Gradle 関連のプロパティファイル (&lt;code>.properties&lt;/code>) やビルドスクリプト (&lt;code>.gradle&lt;/code>) が増えてきます。
混乱しやすいのでまとめておきます。&lt;/p>
&lt;table>
 &lt;thead>
 &lt;tr>
 &lt;th>ファイル名&lt;/th>
 &lt;th>自動生成される？&lt;/th>
 &lt;th>Gitにコミットする？&lt;/th>
 &lt;th>説明&lt;/th>
 &lt;/tr>
 &lt;/thead>
 &lt;tbody>
 &lt;tr>
 &lt;td>build.gradle&lt;/td>
 &lt;td>手動で編集&lt;/td>
 &lt;td>する&lt;/td>
 &lt;td>プロジェクトごとのビルドスクリプト&lt;/td>
 &lt;/tr>
 &lt;tr>
 &lt;td>settings.gradle&lt;/td>
 &lt;td>手動で編集&lt;/td>
 &lt;td>する&lt;/td>
 &lt;td>マルチプロジェクト構成のプロジェクトにおいて、サブプロジェクトなどのリストを管理&lt;/td>
 &lt;/tr>
 &lt;tr>
 &lt;td>gradle.properties&lt;/td>
 &lt;td>Android Studio が自動生成&lt;/td>
 &lt;td>しない&lt;/td>
 &lt;td>Gradle 実行のプロキシ設定やメモリ容量設定&lt;/td>
 &lt;/tr>
 &lt;tr>
 &lt;td>local.properties&lt;/td>
 &lt;td>Android Studio が自動生成&lt;/td>
 &lt;td>しない&lt;/td>
 &lt;td>Android SDK のパスなど、個人環境に依存する設定が格納される&lt;/td>
 &lt;/tr>
 &lt;tr>
 &lt;td>その他.properties&lt;/td>
 &lt;td>手動で編集&lt;/td>
 &lt;td>する&lt;/td>
 &lt;td>独自に作成したプロパティファイル（ビルドスクリプト内で読み込んだりしているはず）&lt;/td>
 &lt;/tr>
 &lt;/tbody>
&lt;/table></description></item><item><title>ダウンロード可能な Android SDK コンポーネントの一覧を取得する (android list sdk)</title><link>https://maku77.github.io/p/8k5m4k2/</link><pubDate>Fri, 09 Oct 2015 00:00:00 +0900</pubDate><guid>https://maku77.github.io/p/8k5m4k2/</guid><description>&lt;p>Android SDK に付属している &lt;strong>&lt;code>android&lt;/code>&lt;/strong> コマンドの &lt;strong>&lt;code>list sdk&lt;/code>&lt;/strong> サブコマンドを使用すると、追加でインストール可能な SDK コンポーネントの一覧を取得することができます。&lt;/p>

&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">インストール可能な SDK コンポーネント&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-console" data-lang="console">&lt;span class="line">&lt;span class="cl">&lt;span class="gp">$&lt;/span> android list sdk --no-ui --all --extended
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">...
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">----------
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">id: 157 or &amp;#34;extra-google-usb_driver&amp;#34;
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go"> Type: Extra
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go"> Desc: Google USB Driver, revision 11
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go"> By Google Inc.
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go"> USB Driver for Windows, revision 11
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go"> Install path: extras\google\usb_driver
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">----------
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">id: 158 or &amp;#34;extra-google-webdriver&amp;#34;
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go"> Type: Extra
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go"> Desc: Google Web Driver, revision 2
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go"> By Google Inc.
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go"> WebDriver
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go"> Install path: extras\google\webdriver
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">----------
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">id: 159 or &amp;#34;extra-intel-Hardware_Accelerated_Execution_Manager&amp;#34;
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go"> Type: Extra
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go"> Desc: Intel x86 Emulator Accelerator (HAXM installer), revision 5.5
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go"> By Intel Corporation
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go"> Emulation speedup using Intel? VT processor technology. Read more
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go"> at www.intel.com/software/android
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go"> Install path: extras\intel\Hardware_Accelerated_Execution_Manager
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>

&lt;p>例えば、以下のようなコンポーネントがリストアップされます。&lt;/p></description></item><item><title>protection レベルが dangerous なパーミッションの一覧を表示する (pm list permissions)</title><link>https://maku77.github.io/p/8x8qmy3/</link><pubDate>Tue, 04 Aug 2015 00:00:00 +0900</pubDate><guid>https://maku77.github.io/p/8x8qmy3/</guid><description>&lt;p>&lt;code>pm list permissions&lt;/code> コマンドに &lt;strong>&lt;code>-d&lt;/code>&lt;/strong> オプションを付けて実行すると、&lt;strong>protectionLevel が dangerous&lt;/strong> に設定されたパーミッションのみを一覧表示してくれます。
Android M からは、dangerous なパーミッションはユーザが個別に On/Off することができるようになったため、どのようなパーミッションが存在しているのかを把握することがより重要になりました。&lt;/p>
&lt;pre tabindex="0">&lt;code>shell@xxx:/ $ pm list permissions -d
Dangerous Permissions:

permission:com.android.providers.tv.permission.READ_EPG_DATA
permission:com.android.providers.tv.permission.WRITE_EPG_DATA
&lt;/code>&lt;/pre>&lt;p>&lt;code>adb shell&lt;/code> で接続する前に実行する場合は、上記のコマンドの先頭に &lt;code>adb shell&lt;/code> を付けて実行してください。&lt;/p></description></item><item><title>パーミッショングループの一覧を表示する (pm list permission-groups)</title><link>https://maku77.github.io/p/viry8fo/</link><pubDate>Tue, 04 Aug 2015 00:00:00 +0900</pubDate><guid>https://maku77.github.io/p/viry8fo/</guid><description>&lt;h2 id="パーミッショングループの一覧">パーミッショングループの一覧&lt;/h2>
&lt;p>Android 端末内にどのようなパーミッショングループが存在しているかを調べるには、&lt;code>adb shell&lt;/code> で接続した後に &lt;strong>&lt;code>pm list permission-groups&lt;/code>&lt;/strong> コマンドを使用します。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">shell@xxx:/ $ pm list permission-groups
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">permission group:android.permission-group.PHONE_CALLS
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">permission group:android.permission-group.WALLPAPER
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">permission group:android.permission-group.MESSAGES
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">permission group:android.permission-group.USER_DICTIONARY
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">permission group:android.permission-group.CALENDAR
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">permission group:android.permission-group.BLUETOOTH_NETWORK
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">...
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;code>adb shell&lt;/code> で接続前に実行したい場合は、下記のように &lt;code>adb shell&lt;/code> に続けてコマンド入力しても OK です。
ホスト側の PC で出力を &lt;code>sort&lt;/code> したい場合などはこちらの方が便利かもしれません。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-console" data-lang="console">&lt;span class="line">&lt;span class="cl">&lt;span class="gp">$&lt;/span> adb shell pm list permission-groups &lt;span class="p">|&lt;/span> sort
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">permission group:android.permission-group.ACCESSIBILITY_FEATURES
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">permission group:android.permission-group.ACCOUNTS
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">permission group:android.permission-group.AFFECTS_BATTERY
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">permission group:android.permission-group.APP_INFO
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">permission group:android.permission-group.AUDIO_SETTINGS
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">permission group:android.permission-group.BLUETOOTH_NETWORK
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">...
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="パーミッショングループに属するパーミッションの一覧">パーミッショングループに属するパーミッションの一覧&lt;/h2>
&lt;p>それぞれのパーミッショングループが、どのようなパーミッションから構成されているかを調べるには、&lt;strong>&lt;code>pm list permissions -g&lt;/code>&lt;/strong> コマンドを使用します。&lt;/p>
&lt;pre tabindex="0">&lt;code>shell@xxx:/ $ pm list permissions -g
All Permissions:

group:android.permission-group.PHONE_CALLS
 permission:android.permission.BIND_INCALL_SERVICE
 permission:android.permission.READ_PRECISE_PHONE_STATE
 permission:android.permission.BIND_CONNECTION_SERVICE
 ...

group:android.permission-group.WALLPAPER
 permission:android.permission.SET_WALLPAPER
 permission:android.permission.SET_WALLPAPER_HINTS
 ...
&lt;/code>&lt;/pre></description></item><item><title>Androidメモ: ADB 経由でスクリーンキャプチャを取得する (screencap)</title><link>https://maku77.github.io/p/kp3ubcu/</link><pubDate>Wed, 01 Apr 2015 00:00:00 +0900</pubDate><guid>https://maku77.github.io/p/kp3ubcu/</guid><description>&lt;h2 id="android-デバイスの-screencap-コマンド">Android デバイスの screencap コマンド&lt;/h2>
&lt;p>Android デバイス上で &lt;strong>&lt;code>screencap&lt;/code>&lt;/strong> コマンドを使うと、スクリーンキャプチャを取得できます。
PC から ADB 接続ができている状態であれば、下記のように実行することで PC 側のカレントディレクトリに &lt;code>capture.png&lt;/code> ファイルを取得できます。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-console" data-lang="console">&lt;span class="line">&lt;span class="cl">&lt;span class="gp">$&lt;/span> adb shell screencap -p /sdcard/capture.png
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="gp">$&lt;/span> adb pull /sdcard/capture.png
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="gp">$&lt;/span> adb shell rm /sdcard/capture.png
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>Android デバイス内の &lt;code>/sdcard&lt;/code> ディレクトリを指定しているのは、通常のユーザ権限で書き込みが可能な場所だからです。&lt;/p>
&lt;h2 id="バッチファイル化しておく">バッチファイル化しておく&lt;/h2>
&lt;p>Windows 環境であれば、以下のようにバッチファイルを作成してパスの通ったディレクトリに置いておけば、1 コマンドでスクリーンキャプチャを取得できるようになります。
作成される PNG ファイル名には、自動的に日時を付与するようにしています。&lt;/p>

&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">m-adb-screencap.cmd&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-cmd" data-lang="cmd">&lt;span class="line">&lt;span class="cl">&lt;span class="p">@&lt;/span>&lt;span class="k">echo&lt;/span> off
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">setlocal&lt;/span> enabledelayedexpansion
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">if&lt;/span> &lt;span class="s2">&amp;#34;&lt;/span>&lt;span class="nv">%~1&lt;/span>&lt;span class="s2">&amp;#34;&lt;/span>&lt;span class="o">==&lt;/span>&lt;span class="s2">&amp;#34;&amp;#34;&lt;/span> &lt;span class="p">(&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">for&lt;/span> &lt;span class="k">/f&lt;/span> &lt;span class="s2">&amp;#34;tokens=1-6 delims=/-:. &amp;#34;&lt;/span> &lt;span class="se">%%&lt;/span>a &lt;span class="k">in&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;&lt;/span>&lt;span class="nv">%date%&lt;/span>&lt;span class="s2"> &lt;/span>&lt;span class="nv">%time%&lt;/span>&lt;span class="s2">&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="k">do&lt;/span> &lt;span class="p">(&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">set&lt;/span> &lt;span class="nv">YYYY&lt;/span>&lt;span class="p">=&lt;/span>&lt;span class="se">%%&lt;/span>a
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">set&lt;/span> &lt;span class="nv">MM&lt;/span>&lt;span class="p">=&lt;/span>&lt;span class="se">%%&lt;/span>b
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">set&lt;/span> &lt;span class="nv">DD&lt;/span>&lt;span class="p">=&lt;/span>&lt;span class="se">%%&lt;/span>c
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">set&lt;/span> &lt;span class="nv">hh&lt;/span>&lt;span class="p">=&lt;/span>&lt;span class="se">%%&lt;/span>d
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">set&lt;/span> &lt;span class="nv">mm&lt;/span>&lt;span class="p">=&lt;/span>&lt;span class="se">%%&lt;/span>e
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">set&lt;/span> &lt;span class="nv">ss&lt;/span>&lt;span class="p">=&lt;/span>&lt;span class="se">%%&lt;/span>f
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">set&lt;/span> &lt;span class="nv">FILENAME&lt;/span>&lt;span class="p">=&lt;/span>capture-!YYYY!!MM!!DD!T!hh!!mm!!ss!.png
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">)&lt;/span> &lt;span class="k">else&lt;/span> &lt;span class="p">(&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">set&lt;/span> &lt;span class="nv">FILENAME&lt;/span>&lt;span class="p">=&lt;/span>&lt;span class="nv">%~1&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">adb shell screencap -p &lt;span class="s2">&amp;#34;/sdcard/&lt;/span>&lt;span class="nv">%FILENAME%&lt;/span>&lt;span class="s2">&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">adb pull &lt;span class="s2">&amp;#34;/sdcard/&lt;/span>&lt;span class="nv">%FILENAME%&lt;/span>&lt;span class="s2">&amp;#34;&lt;/span> &lt;span class="s2">&amp;#34;&lt;/span>&lt;span class="nv">%FILENAME%&lt;/span>&lt;span class="s2">&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">adb shell rm &lt;span class="s2">&amp;#34;/sdcard/&lt;/span>&lt;span class="nv">%FILENAME%&lt;/span>&lt;span class="s2">&amp;#34;&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>


&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">使用例&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-plain" data-lang="plain">&lt;span class="line">&lt;span class="cl">▼ パラメータ指定せずに実行するとファイル名を自動生成
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">C:\&amp;gt; m-adb-screencap
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">/sdcard/capture-20264719T144706.png: 1 file pulled, 0 skipped. 41.2 MB/s (2486963 bytes in 0.058s)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">▼ ファイル名を指定する場合
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">C:\&amp;gt; m-adb-screencap mycapture.png
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">/sdcard/capture.png: 1 file pulled, 0 skipped. 41.2 MB/s (2486963 bytes in 0.058s)&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure></description></item><item><title>APK ファイルに署名する (keytool, jarsigner)</title><link>https://maku77.github.io/p/3yk3j2i/</link><pubDate>Thu, 19 Mar 2015 00:00:00 +0900</pubDate><guid>https://maku77.github.io/p/3yk3j2i/</guid><description>&lt;p>APK に署名する方法は、従来の Java で行われていた JAR ファイルへの署名方法と同様です。
下記の JAR ファイルへの署名方法を参考にしてください。&lt;/p>
&lt;ul>
&lt;li>参考: &lt;a href="../p/fht5eox/">JAR ファイルの署名について - まくまく Java ノート&lt;/a>&lt;/li>
&lt;/ul>
&lt;h2 id="1-keystore-ファイルを作成する">(1) keystore ファイルを作成する&lt;/h2>
&lt;p>ここでは下記の条件でキーを作成します。&lt;/p>
&lt;ul>
&lt;li>作成するキーストアファイル名: &lt;strong>&lt;code>MyKeyStore.jks&lt;/code>&lt;/strong>&lt;/li>
&lt;li>エイリアス名: &lt;strong>&lt;code>android&lt;/code>&lt;/strong>&lt;/li>
&lt;li>有効期限: &lt;strong>&lt;code>10000日&lt;/code>&lt;/strong>&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-console" data-lang="console">&lt;span class="line">&lt;span class="cl">&lt;span class="gp">$&lt;/span> keytool -genkey -v -keystore MyKeyStore.jks -alias android -keyalg RSA -keysize &lt;span class="m">2048&lt;/span> -validity &lt;span class="m">10000&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">Enter keystore password:（キーストアのパスワードを入力）
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">（名前や組織名などを聞かれるので順番に入力していく）
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="2-keystore-ファイルを使って-apk-に署名する">(2) keystore ファイルを使って APK に署名する&lt;/h2>
&lt;p>上記のように作成した keystore ファイルには、非公開鍵と、それに関連付けられた X.509 証明書が含まれており、このファイルを使用して APK に署名を行うことができます。
ここでは、&lt;code>MyApp.apk&lt;/code> に署名を行います。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-console" data-lang="console">&lt;span class="line">&lt;span class="cl">&lt;span class="gp">$&lt;/span> jarsigner -verbose -sigalg SHA1withRSA -digestalg SHA1 -keystore MyKeyStore.jks MyApp.apk android
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">（キーストアのパスワードを入力）（キーエイリアスのパスワードを入力）
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="3-apk-の署名を確認する">(3) APK の署名を確認する&lt;/h2>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-console" data-lang="console">&lt;span class="line">&lt;span class="cl">&lt;span class="gp">$&lt;/span> jarsigner -verify -verbose -certs MyApp.apk
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;ul>
&lt;li>参考: &lt;a href="../p/2x9it3c/">APK ファイルの署名を確認する&lt;/a>&lt;/li>
&lt;/ul>
&lt;h2 id="4-メモリ使用量を最適化するためのバイトアライメントを実行する">(4) メモリ使用量を最適化するためのバイトアライメントを実行する&lt;/h2>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-console" data-lang="console">&lt;span class="line">&lt;span class="cl">&lt;span class="gp">$&lt;/span> zipalign -v &lt;span class="m">4&lt;/span> input.apk output.apk
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div></description></item><item><title>Androidメモ: ScrollView を一番下までスクロールさせる (fullScroll)</title><link>https://maku77.github.io/p/e6fmtba/</link><pubDate>Sat, 14 Mar 2015 00:00:00 +0900</pubDate><guid>https://maku77.github.io/p/e6fmtba/</guid><description>&lt;p>Android の &lt;code>ScrollView&lt;/code> を一番下までスクロールさせるには、&lt;strong>&lt;code>ScrollView#fullScroll()&lt;/code>&lt;/strong> メソッドを使用します。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// final ScrollView scrollView = ((ScrollView) findViewById(R.id.scrollView));&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">scrollView&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">post&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="k">new&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Runnable&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nd">@Override&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kd">public&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kt">void&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nf">run&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">scrollView&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">fullScroll&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">View&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">FOCUS_DOWN&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">});&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;code>fullScroll()&lt;/code> はメインスレッドから呼び出す必要があるため、&lt;code>post()&lt;/code> メソッドを使用して UI スレッドで実行されるようにします。
&lt;code>fullScroll()&lt;/code> を呼び出した後は、その &lt;code>ScrollView&lt;/code> にフォーカスが当たった状態になります。&lt;/p></description></item><item><title>Androidメモ: 任意の View をフォーカスする (requestFocus)</title><link>https://maku77.github.io/p/fnjj2c7/</link><pubDate>Sat, 14 Mar 2015 00:00:00 +0900</pubDate><guid>https://maku77.github.io/p/fnjj2c7/</guid><description>&lt;p>&lt;code>View#requestFocus()&lt;/code> によって、任意のビューにフォーカスを当てることができます。
メインスレッドから呼び出す必要があることに注意してください。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// Button mButton;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">mButton&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">post&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="k">new&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Runnable&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nd">@Override&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kd">public&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kt">void&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nf">run&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">mButton&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">requestFocus&lt;/span>&lt;span class="p">();&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div></description></item><item><title>Dex 形式の Shared library (JAR) を作成する (dx)</title><link>https://maku77.github.io/p/huevdub/</link><pubDate>Thu, 30 Oct 2014 00:00:00 +0900</pubDate><guid>https://maku77.github.io/p/huevdub/</guid><description>&lt;p>Android デバイスの &lt;code>/system/framework&lt;/code> に以下に格納して使用する Shared JAR ライブラリは、DEX 形式にコンパイルされたクラスを含んでいる必要があります。Eclipse などで単純に JAR ファイルを生成すると、PC 用の JAR ライブラリができてしまうので、DEX 形式に変換してから &lt;code>/system/framework&lt;/code> にインストールする必要があります。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-console" data-lang="console">&lt;span class="line">&lt;span class="cl">&lt;span class="gp">$&lt;/span> dx --dex --output&lt;span class="o">=&lt;/span>output.jar input.jar
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div></description></item><item><title>APK ファイルの署名を確認する (jarsigner, openssl)</title><link>https://maku77.github.io/p/2x9it3c/</link><pubDate>Fri, 22 Aug 2014 00:00:00 +0900</pubDate><guid>https://maku77.github.io/p/2x9it3c/</guid><description>&lt;h2 id="署名情報を確認する方法">署名情報を確認する方法&lt;/h2>
&lt;p>JDK に付属している &lt;strong>&lt;code>jarsigner&lt;/code>&lt;/strong> コマンドを使用して、APK ファイルの署名情報を確認することができます。&lt;/p>

&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">MyApp.apk の署名を確認する&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-console" data-lang="console">&lt;span class="line">&lt;span class="cl">&lt;span class="gp">$&lt;/span> jarsigner -verify -certs -verbose MyApp.apk
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="err">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="err">&lt;/span>&lt;span class="go">...
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">sm 21632 Mon Sep 01 17:08:16 JST 2014 lib/libhoge.so
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">&lt;/span>&lt;span class="err">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="err">&lt;/span>&lt;span class="go"> X.509, CN=Android Debug, O=Android, C=US
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go"> [certificate is valid from 12/08/27 17:19 to 42/08/20 17:19]
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go"> [CertPath not validated: Path does not chain with any of the trust anchors]
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">&lt;/span>&lt;span class="err">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="err">&lt;/span>&lt;span class="go">s 36381 Fri Oct 03 14:10:34 JST 2014 META-INF/MANIFEST.MF
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">&lt;/span>&lt;span class="err">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="err">&lt;/span>&lt;span class="go"> X.509, CN=Android Debug, O=Android, C=US
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go"> [certificate is valid from 12/08/27 17:19 to 42/08/20 17:19]
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go"> [CertPath not validated: Path does not chain with any of the trust anchors]
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go"> 36434 Fri Oct 03 14:10:34 JST 2014 META-INF/CERT.SF
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go"> 1203 Fri Oct 03 14:10:34 JST 2014 META-INF/CERT.RSA
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">&lt;/span>&lt;span class="err">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="err">&lt;/span>&lt;span class="go"> s = signature was verified
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go"> m = entry is listed in manifest
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go"> k = at least one certificate was found in keystore
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go"> i = at least one certificate was found in identity scope
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">&lt;/span>&lt;span class="err">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="err">&lt;/span>&lt;span class="go">jar verified.
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>

&lt;h2 id="証明書の公開鍵-subject-public-key-info-を確認する方法">証明書の公開鍵 (Subject Public Key Info) を確認する方法&lt;/h2>
&lt;p>APK 内の証明書から、公開鍵情報を抽出するには、&lt;strong>&lt;code>openssl&lt;/code>&lt;/strong> ツールを使用して下記のように実行します。&lt;/p></description></item><item><title>Androidメモ: ValueAnimator でアニメーション処理に使用する値を計算する</title><link>https://maku77.github.io/p/xx9qovn/</link><pubDate>Wed, 13 Aug 2014 00:00:00 +0900</pubDate><guid>https://maku77.github.io/p/xx9qovn/</guid><description>&lt;p>Android の &lt;strong>&lt;code>ValueAnimator&lt;/code>&lt;/strong> クラスを使用すると、ある数値からある数値まで、指定した時間で変化する値を取得することができます。
例えば、次の &lt;code>animator&lt;/code> は、1000 ミリ秒の間に 0 から 360 まで変化する値を生成します。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="n">ValueAnimator&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">animator&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">ValueAnimator&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">ofFloat&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">0&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">360&lt;/span>&lt;span class="p">).&lt;/span>&lt;span class="na">setDuration&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">1000&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;code>AnimatorUpdateListener&lt;/code> をセットして &lt;code>ValueAnimator#start()&lt;/code> を呼び出すと、値の変化を検出したときにコールバックされます。
その時点での変化中の値は、&lt;code>getAnimatedValue()&lt;/code> で取得できます。&lt;/p>
&lt;p>次の Java サンプルコードでは、ある &lt;code>View&lt;/code> を 1 秒間かけて 360°回転させます。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// final View view = findViewById(...);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">ValueAnimator&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">animator&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">ValueAnimator&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">ofFloat&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">0&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">360&lt;/span>&lt;span class="p">).&lt;/span>&lt;span class="na">setDuration&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">1000&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">animator&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">addUpdateListener&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="k">new&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">ValueAnimator&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">AnimatorUpdateListener&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nd">@Override&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kd">public&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kt">void&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nf">onAnimationUpdate&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">ValueAnimator&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">anim&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">view&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">setRotation&lt;/span>&lt;span class="p">((&lt;/span>&lt;span class="kt">float&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">anim&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">getAnimatedValue&lt;/span>&lt;span class="p">());&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">});&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">animator&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">start&lt;/span>&lt;span class="p">();&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;code>ValueAnimator&lt;/code> では、数値の変化方法を柔軟に設定することができます。
例えば、次の例では、数値が 0 → 100 → 0 → 200 のように変化します（4 段階ではなく、滑らかに変化します）。&lt;/p></description></item><item><title>Androidメモ: Canvas への描画時にアンチエイリアスを有効にする (Paint#setAntiAlias)</title><link>https://maku77.github.io/p/8wsrauw/</link><pubDate>Mon, 11 Aug 2014 00:00:00 +0900</pubDate><guid>https://maku77.github.io/p/8wsrauw/</guid><description>&lt;p>Android の &lt;code>Canvas&lt;/code> への描画時に使用する &lt;code>Paint&lt;/code> オブジェクトで、&lt;strong>&lt;code>setAntiAlias(true)&lt;/code>&lt;/strong> することで、アンチエイリアスを有効にした描画を行うことができます。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">public&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kd">class&lt;/span> &lt;span class="nc">MyCustomView&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kd">extends&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">View&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kd">private&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kd">final&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Paint&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">mBackgroundPaint&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">new&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Paint&lt;/span>&lt;span class="p">();&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">// ...&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kd">private&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kt">void&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nf">init&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">mBackgroundPaint&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">setColor&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">Color&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">BLUE&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">mBackgroundPaint&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">setAntiAlias&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="kc">true&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c1">// ★アンチエイリアス有効化&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nd">@Override&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kd">protected&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kt">void&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nf">onDraw&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">Canvas&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">canvas&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kd">super&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">onDraw&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">canvas&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kt">int&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">w&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">canvas&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">getWidth&lt;/span>&lt;span class="p">();&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kt">int&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">h&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">canvas&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">getHeight&lt;/span>&lt;span class="p">();&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kt">int&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">radius&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">w&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">h&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">?&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">w&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">2&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">h&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">2&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">canvas&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">drawCircle&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">w&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">2&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">h&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">2&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">radius&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">mBackgroundPaint&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c1">// アンチエイリアス有効にした円を描画&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div></description></item><item><title>Androidメモ: カスタムビューでソフトウェア D-Pad を表示する</title><link>https://maku77.github.io/p/nfguckx/</link><pubDate>Mon, 11 Aug 2014 00:00:00 +0900</pubDate><guid>https://maku77.github.io/p/nfguckx/</guid><description>&lt;p>D-Pad（十字キー）をカスタムビューとして実装するサンプルコードです。
上下左右キーのタッチ入力は、&lt;code>DPadListener&lt;/code> を使って監視できます。&lt;/p>


&lt;figure class="xImage">
 &lt;img style="" width="105" height="105" src="../p/nfguckx/img-001.png" alt="/p/nfguckx/img-001.png" />
&lt;/figure>

&lt;h2 id="カスタムビューの実装例">カスタムビューの実装例&lt;/h2>
&lt;ul>
&lt;li>&lt;a href="./DPadListener.java">DPadListener.java&lt;/a>&lt;/li>
&lt;li>&lt;a href="./DPadView.java">DPadView.java&lt;/a>&lt;/li>
&lt;li>&lt;a href="./DPadEvent.java">DPadEvent.java&lt;/a>&lt;/li>
&lt;/ul>
&lt;h2 id="使用例">使用例&lt;/h2>

&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">res/layout/activity_main.xml（抜粋）&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-xml" data-lang="xml">&lt;span class="line">&lt;span class="cl">&lt;span class="nt">&amp;lt;io.github.maku77.widget.DPadView&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="na">android:id=&lt;/span>&lt;span class="s">&amp;#34;@+id/dpad&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="na">android:layout_width=&lt;/span>&lt;span class="s">&amp;#34;200dp&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="na">android:layout_height=&lt;/span>&lt;span class="s">&amp;#34;200dp&amp;#34;&lt;/span> &lt;span class="nt">/&amp;gt;&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>


&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">MainActivity.java&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">public&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kd">class&lt;/span> &lt;span class="nc">MainActivity&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kd">extends&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Activity&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nd">@Override&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kd">protected&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kt">void&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nf">onCreate&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">Bundle&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">savedInstanceState&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kd">super&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">onCreate&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">savedInstanceState&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">setContentView&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">R&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">layout&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">activity_main&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">DPadView&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">dpad&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">DPadView&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">findViewById&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">R&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">id&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">dpad&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">dpad&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">setDPadListener&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="k">new&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">DPadListener&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nd">@Override&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kd">public&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kt">void&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nf">onCursor&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">DPadEvent&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">event&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">Log&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">d&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;DEBUG&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">event&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">toString&lt;/span>&lt;span class="p">());&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">});&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure></description></item><item><title>Androidメモ: カスタムビューを作成する</title><link>https://maku77.github.io/p/4c5st3s/</link><pubDate>Mon, 11 Aug 2014 00:00:00 +0900</pubDate><guid>https://maku77.github.io/p/4c5st3s/</guid><description>&lt;h2 id="ondraw-で自力で描画するカスタムビューを作る">onDraw で自力で描画するカスタムビューを作る&lt;/h2>
&lt;p>Android では、&lt;code>android.view.View&lt;/code> を継承したビュークラスを作成することで、簡単にカスタムビューを作成することができます。
ここでは、&lt;code>com.example.myapp.MyCustomView&lt;/code> という、丸を描画するだけのカスタムビューを作成します。&lt;/p>


&lt;figure class="xImage">
 &lt;img style="" width="234" height="144" src="../p/4c5st3s/img-001.png" alt="/p/4c5st3s/img-001.png" />
&lt;/figure>

&lt;p>描画処理は &lt;code>onDraw()&lt;/code> メソッドをオーバーライドして記述します。&lt;/p>

&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">MyCustomView.java&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="kn">package&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nn">com.example.myapp&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="kn">import&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nn">android.content.Context&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="kn">import&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nn">android.graphics.Canvas&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="kn">import&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nn">android.graphics.Color&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="kn">import&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nn">android.graphics.Paint&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="kn">import&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nn">android.util.AttributeSet&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="kn">import&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nn">android.view.View&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="kd">public&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kd">class&lt;/span> &lt;span class="nc">MyCustomView&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kd">extends&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">View&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kd">private&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kd">final&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Paint&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">mBackgroundPaint&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">new&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Paint&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">setColor&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">Color&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">YELLOW&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">setAntiAlias&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="kc">true&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">};&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kd">public&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nf">MyCustomView&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">Context&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">context&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kd">super&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">context&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kd">public&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nf">MyCustomView&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">Context&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">context&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">AttributeSet&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">attrs&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kd">super&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">context&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">attrs&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kd">public&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nf">MyCustomView&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">Context&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">context&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">AttributeSet&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">attrs&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kt">int&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">defStyleAttr&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kd">super&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">context&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">attrs&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">defStyleAttr&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nd">@Override&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kd">protected&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kt">void&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nf">onDraw&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">Canvas&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">canvas&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kt">int&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">w&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">canvas&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">getWidth&lt;/span>&lt;span class="p">();&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kt">int&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">h&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">canvas&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">getHeight&lt;/span>&lt;span class="p">();&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kt">int&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">radius&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">w&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">h&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">?&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">w&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">2&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">h&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">2&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">canvas&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">drawCircle&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">w&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">2&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">h&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">2&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">radius&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">mBackgroundPaint&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>

&lt;p>ちなみに、Kotlin では次のように少しだけシンプルに記述できます。&lt;/p></description></item><item><title>Androidメモ: タッチイベントをハンドルする</title><link>https://maku77.github.io/p/35cr5fp/</link><pubDate>Tue, 29 Jul 2014 00:00:00 +0900</pubDate><guid>https://maku77.github.io/p/35cr5fp/</guid><description>&lt;h2 id="ontoucheventontouchlistener-で基本情報を取得する">onTouchEvent/OnTouchListener で基本情報を取得する&lt;/h2>
&lt;p>Android の Activity 実装内で &lt;strong>&lt;code>onTouchEvent(MotionEvent event)&lt;/code>&lt;/strong> メソッドをオーバライドすると、その Activity 上で発生したタッチイベントをハンドルすることができます。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">public&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kd">class&lt;/span> &lt;span class="nc">MainActivity&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kd">extends&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Activity&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">...&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nd">@Override&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kd">public&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kt">boolean&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nf">onTouchEvent&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">MotionEvent&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">event&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">...&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">return&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kd">super&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">onTouchEvent&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">event&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>あるいは、&lt;strong>&lt;code>View#setOnTouchListener()&lt;/code>&lt;/strong> を使って、タッチイベントをハンドルするためのリスナを設定することもできます。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="n">view&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">setOnTouchListener&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="k">new&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">View&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">OnTouchListener&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nd">@Override&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kd">public&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kt">boolean&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nf">onTouch&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">View&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">v&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">MotionEvent&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">event&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">...&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">return&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kc">true&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">});&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>上記のようなメソッドで渡される &lt;code>MotionEvent&lt;/code> オブジェクトを参照すると、どのような内容のイベントが発生したかを調べることができます。
例えば、&lt;code>MotionEvent#getAction()&lt;/code> では、どのような操作を行ったかを取得できます。&lt;/p>
&lt;ul>
&lt;li>&lt;code>MotionEvent.ACTION_DOWN&lt;/code> (0) &amp;hellip; タッチ開始（指で触れた）&lt;/li>
&lt;li>&lt;code>MotionEvent.ACTION_UP&lt;/code> (1) &amp;hellip; タッチ終了（指を離した）&lt;/li>
&lt;li>&lt;code>MotionEvent.ACTION_MOVE&lt;/code> (2) &amp;hellip; ドラッグ中&lt;/li>
&lt;/ul>
&lt;p>参考: &lt;a href="https://developer.android.com/reference/android/view/MotionEvent.html#ACTION_DOWN">MotionEvent - Android Developers&lt;/a>&lt;/p></description></item><item><title>メモリの使用状況を確認する (dumpsys meminfo)</title><link>https://maku77.github.io/p/t6wfxev/</link><pubDate>Tue, 29 Jul 2014 00:00:00 +0900</pubDate><guid>https://maku77.github.io/p/t6wfxev/</guid><description>&lt;h2 id="各プロセスのメモリ使用状況を確認する">各プロセスのメモリ使用状況を確認する&lt;/h2>
&lt;p>&lt;strong>&lt;code>dumpsys&lt;/code>&lt;/strong> コマンドの &lt;strong>&lt;code>meminfo&lt;/code>&lt;/strong> セクションでは、各プロセスのメモリ使用状況を確認することができます。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-console" data-lang="console">&lt;span class="line">&lt;span class="cl">&lt;span class="gp">$&lt;/span> adb shell dumpsys meminfo
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">Applications Memory Usage (kB):
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">Uptime: 169910958 Realtime: 170196415
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">&lt;/span>&lt;span class="err">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="err">&lt;/span>&lt;span class="go">Total PSS by process:
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go"> 96302 kB: system (pid 728)
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go"> 44547 kB: com.android.systemui (pid 965)
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go"> 32601 kB: com.sonyericsson.android.pobox.imecore (pid 1042)
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go"> 29610 kB: com.android.settings (pid 8006)
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go"> 26500 kB: com.sonyericsson.home (pid 1321)
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go"> 23027 kB: com.facebook.katana (pid 7371)
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go"> 17963 kB: com.facebook.katana:dash (pid 7641)
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go"> 13579 kB: com.google.android.gms (pid 5171)
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go"> ...
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="プロセスを指定してメモリ使用状況を確認する">プロセスを指定してメモリ使用状況を確認する&lt;/h2>
&lt;p>上記で表示されたパッケージ名や pid を、&lt;code>dumpsys meminfo&lt;/code> コマンドの後ろに続けて指定することで、そのプロセスにおける詳細なメモリ使用情報を調べられます。&lt;/p></description></item><item><title>Androidメモ: Canvas に複数行のテキストを描画する</title><link>https://maku77.github.io/p/j7yysr5/</link><pubDate>Mon, 28 Jul 2014 00:00:00 +0900</pubDate><guid>https://maku77.github.io/p/j7yysr5/</guid><description>&lt;p>Android の &lt;code>SurfaceView&lt;/code> にテキストを描画するには、&lt;code>Canvas#drawText()&lt;/code> を使用しますが、このメソッドでは一行のテキストのみ描画できます。
特定の幅でテキストを折り返して Canvas に描画するには、折り返し計算と複数行テキストの描画処理を自分で実装する必要があります。&lt;/p>


&lt;figure class="xImage">
 &lt;img style="" width="96" height="112" src="../p/j7yysr5/img-001.png" alt="/p/j7yysr5/img-001.png" />
&lt;/figure>

&lt;ul>
&lt;li>&lt;a href="./TextDrawUtil.java">TextDrawUtil.java&lt;/a>&lt;/li>
&lt;/ul>
&lt;p>上記のユーティリティクラスを使用すると、特定の幅、高さに収まるように改行しながらテキストを描画できます。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// 座標 (0, 0) に、幅 80、高さ 100 に収まるようにテキスト描画&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">TextDrawUtil&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">drawMultilineText&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">canvas&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">text&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">0&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">0&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">80&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">100&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">mPaint&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>同じテキストを繰り返し描画する場合は、描画内容を &lt;code>Bitmap&lt;/code> インスタンスに保持して、&lt;code>Canvas#drawBitmap()&lt;/code> で描画する方が効率的です。
上記のユーティリティには、テキストを描画した &lt;code>Bitmap&lt;/code> インスタンスを生成するメソッドも用意しています。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="n">Bitmap&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">bitmap&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">TextDrawUtil&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">createTextBitmap&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">text&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">80&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">100&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">mPaint&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="c1">// 作ったビットマップは以下のようにして描画&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">canvas&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">drawBitmap&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">bitmap&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">0&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">0&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kc">null&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>以下は、全体的な構成のサンプルです。&lt;/p>

&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">MyView.java&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">public&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kd">class&lt;/span> &lt;span class="nc">MyView&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kd">extends&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">View&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">// ...&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kd">private&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kd">final&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Paint&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">mPaintRect&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">new&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Paint&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">setColor&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">Color&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">BLUE&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">};&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kd">private&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kd">final&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Paint&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">mPaintText&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">new&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Paint&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">setColor&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">Color&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">WHITE&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">setTextSize&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">24&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">setAntiAlias&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="kc">true&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">};&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kd">private&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kd">final&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">RectF&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">mRect&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">new&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">RectF&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">50&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">50&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">130&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">155&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nd">@Override&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kd">protected&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kt">void&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nf">onDraw&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">Canvas&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">canvas&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">// Draw a background of the text.&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">canvas&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">drawRect&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">mRect&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">mPaintRect&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">// Draw a multiline text.&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kd">final&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">String&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">text&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s">&amp;#34;ABCDEFGHIJKLMNOPQRSTUVWXYZ&amp;#34;&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">TextDrawUtil&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">drawMultilineText&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">canvas&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">text&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">mRect&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">mPaintText&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure></description></item><item><title>Androidメモ: キーイベント (KeyEvent) を見やすく出力する</title><link>https://maku77.github.io/p/8nbd6ca/</link><pubDate>Mon, 28 Jul 2014 00:00:00 +0900</pubDate><guid>https://maku77.github.io/p/8nbd6ca/</guid><description>&lt;p>Android の &lt;code>View&lt;/code> に対するキー入力は、&lt;strong>&lt;code>View#dispatchKeyEvent(KeyEvent event)&lt;/code>&lt;/strong> などでハンドルすることができます。
このとき渡される &lt;code>KeyEvent&lt;/code> オブジェクトの詳しい内容は、&lt;code>toString()&lt;/code> メソッドを使ってテキスト形式で取得することができます。
例えば、下記は &lt;code>Shift + A&lt;/code> を入力したときに &lt;code>dispatchKeyEvent()&lt;/code> に渡される &lt;code>KeyEvent&lt;/code> オブジェクトの内容を &lt;code>toString()&lt;/code> を利用して出力した例です。&lt;/p>
&lt;pre tabindex="0">&lt;code>KeyEvent: KeyEvent { action=ACTION_DOWN, keyCode=KEYCODE_SHIFT_LEFT, scanCode=0, metaState=META_SHIFT_ON|META_SHIFT_LEFT_ON, flags=0x0, repeatCount=0, eventTime=14731488, downTime=14731488, deviceId=-1, source=0x101 }
KeyEvent { action=ACTION_DOWN, keyCode=KEYCODE_A, scanCode=0, metaState=META_SHIFT_ON|META_SHIFT_LEFT_ON, flags=0x0, repeatCount=0, eventTime=14731488, downTime=14731488, deviceId=-1, source=0x101 }
KeyEvent { action=ACTION_UP, keyCode=KEYCODE_A, scanCode=0, metaState=META_SHIFT_ON|META_SHIFT_LEFT_ON, flags=0x0, repeatCount=0, eventTime=14731488, downTime=14731488, deviceId=-1, source=0x101 }
KeyEvent { action=ACTION_UP, keyCode=KEYCODE_SHIFT_LEFT, scanCode=0, metaState=0, flags=0x0, repeatCount=0, eventTime=14731488, downTime=14731488, deviceId=-1, source=0x101 }
&lt;/code>&lt;/pre>&lt;p>詳しい情報が出てくるのですが、ここまでの情報は必要ないことがほとんどです。
そのような場合、下記のようにシンプルに整形して出力するとデバッグがはかどります。&lt;/p></description></item><item><title>Androidメモ: ソフトウェアキーボードを常に表示する (setSoftInputMode)</title><link>https://maku77.github.io/p/p4y55j2/</link><pubDate>Mon, 28 Jul 2014 00:00:00 +0900</pubDate><guid>https://maku77.github.io/p/p4y55j2/</guid><description>&lt;p>Android アプリケーションでソフトウェアキーボードを常に表示したいときは次のように実装します。&lt;/p>

&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">方法 1) Activity の onCreate() で設定する&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">public&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kd">class&lt;/span> &lt;span class="nc">MainActivity&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kd">extends&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Activity&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nd">@Override&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kd">public&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kt">void&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nf">onCreate&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">Bundle&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">savedInstanceState&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kd">super&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">onCreate&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">savedInstanceState&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">setContentView&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">R&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">layout&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">main&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">getWindow&lt;/span>&lt;span class="p">().&lt;/span>&lt;span class="na">setSoftInputMode&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">WindowManager&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">LayoutParams&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">SOFT_INPUT_STATE_ALWAYS_VISIBLE&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>


&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">方法 2) Dialog 表示時に設定&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">final&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">AlertDialog&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">dialog&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">...;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">dialog&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">getWindow&lt;/span>&lt;span class="p">().&lt;/span>&lt;span class="na">setSoftInputMode&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">WindowManager&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">LayoutParams&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">SOFT_INPUT_STATE_ALWAYS_VISIBLE&lt;/span>&lt;span class="p">);&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure></description></item><item><title>Androidメモ: Xperia Tablet Z に adb 接続する</title><link>https://maku77.github.io/p/eq3tw6z/</link><pubDate>Fri, 30 May 2014 00:00:00 +0900</pubDate><guid>https://maku77.github.io/p/eq3tw6z/</guid><description>&lt;p>まずは、下記と同様に「開発者向けオプション」を有効にし、「USB デバッグ」を有効にしておきます。&lt;/p>
&lt;ul>
&lt;li>&lt;a href="../p/5b6pmtc/">Nexus7 (2013) に adb 接続する&lt;/a>&lt;/li>
&lt;/ul>
&lt;h2 id="windows-への-adb-ドライバのインストール">Windows への ADB ドライバのインストール&lt;/h2>
&lt;p>Xperia には、端末側に &amp;ldquo;PC Companion software&amp;rdquo; というものが入っていて、USB 経由で PC 側にインストールすることができます。
同時に ADB ドライバもインストールされます。&lt;/p>
&lt;ol>
&lt;li>Xperia の「Settings =&amp;gt; Xperia =&amp;gt; USB Connectivity =&amp;gt; Install PC Companion」にチェックを入れておく。&lt;/li>
&lt;li>USB で PC と接続すると、Xperia 側にインストール確認のダイアログが表示されるので、&amp;ldquo;Install&amp;rdquo; を選択。&lt;/li>
&lt;li>PC 側でインストール用のドライブが開くのでアイコンからインストーラを起動 (&lt;code>Startme.exe&lt;/code>)。&lt;/li>
&lt;/ol>
&lt;p>最初に ADB 接続するときは、端末を MTP (Media transfer mode) から、MSC (Mass storage mode) に変えておかないと &lt;code>adb devices&lt;/code> で認識しないことがあるみたいです。&lt;/p>
&lt;ol>
&lt;li>Xperia の「Settings =&amp;gt; Xperia =&amp;gt; USB Connectivity =&amp;gt; USB connection mode」を選択。&lt;/li>
&lt;li>MSC (Mass storage mode) を選択。&lt;/li>
&lt;/ol>
&lt;p>あとは、以下のように接続を確認できます。&lt;/p></description></item><item><title>Androidメモ: TCP/IP で adb 接続する</title><link>https://maku77.github.io/p/492mmkw/</link><pubDate>Tue, 08 Apr 2014 00:00:00 +0900</pubDate><guid>https://maku77.github.io/p/492mmkw/</guid><description>&lt;h2 id="adb-を-tcpip-接続に切り替える">ADB を TCP/IP 接続に切り替える&lt;/h2>
&lt;p>Android アプリ開発時に、ADB 接続を USB 経由ではなく LAN 経由での接続 (TCP/IP プロトコル）で行うようにする手順です。&lt;/p>


&lt;figure class="xImage">
 &lt;img style="" width="" height="auto" src="../p/492mmkw/img-001.svg" alt="/p/492mmkw/img-001.svg" />
&lt;/figure>

&lt;p>Android 端末側の ADB デーモンを TCP/IP モードに切り替えないといけないので、この設定自体は USB 接続された状態で行う必要があります。
一度設定してしまえば、次回からは USB ケーブルは必要なくなります。&lt;/p>
&lt;ol>
&lt;li>Android 端末側の「開発者向けオプション」を有効にして USB 接続する
&lt;ul>
&lt;li>[設定] &amp;gt; [デバイス情報] に移動して、[ビルド番号] を 7 回タップすると「開発者向けオプション」が有効になります。&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>（USB 接続された状態で）Android 端末側の ADB デーモンを TCP/IP 接続モードにする
&lt;ul>
&lt;li>&lt;code>adb tcpip 5555&lt;/code>&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>Android 端末の LAN 内の IP アドレスを確認しておく
&lt;ul>
&lt;li>&lt;code>adb shell &amp;quot;ip addr | grep inet&amp;quot;&lt;/code>&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>（この時点で USB ケーブルは外して OK）&lt;/li>
&lt;li>PC から Android 端末のアドレスとポート番号を指定して TCP/IP で接続
&lt;ul>
&lt;li>&lt;code>adb connect 192.168.11.6:5555&lt;/code>&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ol>
&lt;p>USB 接続に戻したいときは、&lt;code>adb usb&lt;/code> コマンドを実行します。&lt;/p></description></item><item><title>Androidベンダー向けメモ: libhardware.so が hardware サポートライブラリをロードする仕組み</title><link>https://maku77.github.io/p/6qsndck/</link><pubDate>Wed, 29 Jan 2014 00:00:00 +0900</pubDate><guid>https://maku77.github.io/p/6qsndck/</guid><description>&lt;p>Android の &lt;code>hardware/libhardware/hardware.c&lt;/code> で定義されている、&lt;code>hw_get_modules()&lt;/code> の仕組みの説明です。&lt;/p>
&lt;p>&lt;code>hw_get_module()&lt;/code> が呼び出されると、以下のパスの &lt;code>.so&lt;/code> ファイルを探してロードしようとします。&lt;/p>
&lt;ul>
&lt;li>&lt;code>/vendor/lib/hw/&amp;lt;ライブラリ名&amp;gt;.&amp;lt;プロパティ値&amp;gt;.so&lt;/code>&lt;/li>
&lt;li>&lt;code>/system/lib/hw/&amp;lt;ライブラリ名&amp;gt;.&amp;lt;プロパティ値&amp;gt;.so&lt;/code>&lt;/li>
&lt;/ul>
&lt;p>&lt;code>&amp;lt;ライブラリ名&amp;gt;&lt;/code> は &lt;code>hw_get_module()&lt;/code> で指定した名前です。
&lt;code>&amp;lt;プロパティ値&amp;gt;&lt;/code> は以下のシステムプロパティ値が順番にセットされます（コメントの例は Nexus7 (2013) の場合）。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-python" data-lang="python">&lt;span class="line">&lt;span class="cl">&lt;span class="n">ro&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">hardware&lt;/span> &lt;span class="c1"># 例: &amp;#34;flo&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">ro&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">product&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">board&lt;/span> &lt;span class="c1"># 例: &amp;#34;flo&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">ro&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">board&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">platform&lt;/span> &lt;span class="c1"># 例: &amp;#34;msm8960&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">ro&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">arch&lt;/span> &lt;span class="c1"># 例: &amp;#34;&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>例えば、Nexus7(2013) で、&lt;code>hw_get_module(&amp;quot;power&amp;quot;, ...)&lt;/code> とすると、&lt;code>/system/lib/hw/power.msm8960.so&lt;/code> がロードされます（内部で &lt;code>dlopen()&lt;/code> される）。
どのシステムプロパティ値との組み合わせでもライブラリを見つけられない場合は、以下のデフォルトファイルがロードされます。&lt;/p>
&lt;ul>
&lt;li>&lt;code>/system/lib/hw/&amp;lt;ライブラリ名&amp;gt;.default.so&lt;/code>&lt;/li>
&lt;/ul>
&lt;p>デフォルトファイルも見つからない場合は、&lt;code>hw_get_module()&lt;/code> は単純に &lt;code>-ENOENT&lt;/code> を返して終了します。&lt;/p></description></item><item><title>Androidメモ: SpeechRecognizer で音声入力を実現する</title><link>https://maku77.github.io/p/bcmfu3e/</link><pubDate>Thu, 23 Jan 2014 00:00:00 +0900</pubDate><guid>https://maku77.github.io/p/bcmfu3e/</guid><description>&lt;h2 id="speechrecognizer-の基本">SpeechRecognizer の基本&lt;/h2>
&lt;p>Android 2.2 Froyo (API Level 8) で追加された SpeechRecognizer を使うと、UI を表示せずにバックグラウンドで音声認識を行えます。
以下のような手順で使用します。&lt;/p>
&lt;ol>
&lt;li>&lt;code>SpeechRecognizer.createSpeechRecognizer()&lt;/code> を使ってインスタンス作成。&lt;/li>
&lt;li>&lt;code>SpeechRecognizer#setRecognitionListener()&lt;/code> を使って &lt;code>RecognitionListner&lt;/code> を登録。&lt;/li>
&lt;li>&lt;code>SpeechRecognizer#startListening()&lt;/code> で音声入力の開始。&lt;/li>
&lt;li>あとは &lt;code>RecognitionListener&lt;/code> のコールバックを適宜処理。&lt;/li>
&lt;li>&lt;code>SpeechRecognizer#cancel()&lt;/code> で音声入力を終了。&lt;/li>
&lt;/ol>

&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">SpeechRecognizer の基本的な使い方&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// import android.speech.RecognitionListener;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="c1">// import android.speech.SpeechRecognizer;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="kd">private&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">SpeechRecognizer&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">mRecognizer&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="kd">private&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">RecognitionListener&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">mRecognitionListener&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">new&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">RecognitionListener&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">//...&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">};&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="kd">private&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kt">void&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nf">startSpeechRecognition&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">mRecognizer&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">SpeechRecognizer&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">createSpeechRecognizer&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="k">this&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">mRecognizer&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">setRecognitionListener&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">mRecognitionListener&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">mRecognizer&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">startListening&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="k">new&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Intent&lt;/span>&lt;span class="p">());&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>

&lt;p>SpeechRecognizer を利用するには、&lt;strong>&lt;code>RECORD_AUDIO&lt;/code>&lt;/strong> パーミッションを付加しておく必要があります。
パーミッションが付加されていない場合、&lt;code>SpeechRecognizer#startListening()&lt;/code> 実行時に、&lt;code>RecognitionListener#onError(int error)&lt;/code> で、&lt;code>SpeechRecognizer.ERROR_INSUFFICIENT_PERMISSIONS (9)&lt;/code> が報告されます。&lt;/p></description></item><item><title>Androidベンダー向けメモ: Android デバイスのパーティション構成概要</title><link>https://maku77.github.io/p/ks84q3k/</link><pubDate>Thu, 07 Nov 2013 00:00:00 +0900</pubDate><guid>https://maku77.github.io/p/ks84q3k/</guid><description>&lt;h2 id="パーティション構成">パーティション構成&lt;/h2>
&lt;p>Android のパーティション構成は、およそ下記のようになっています。&lt;/p>
&lt;ul>
&lt;li>&lt;strong>&lt;code>/boot&lt;/code>&lt;/strong> &amp;hellip; Android kernel と ramdisk&lt;/li>
&lt;li>&lt;strong>&lt;code>/system&lt;/code>&lt;/strong> &amp;hellip; Android OS およびプリインアプリなど&lt;/li>
&lt;li>&lt;strong>&lt;code>/recovery&lt;/code>&lt;/strong> &amp;hellip; リカバリ時に &lt;code>/boot&lt;/code> パーティションの代わりに起動されるリカバリ OS&lt;/li>
&lt;li>&lt;strong>&lt;code>/data&lt;/code>&lt;/strong> &amp;hellip; GooglePlay からインストールしたアプリやユーザデータ（書き込み可能）&lt;/li>
&lt;li>&lt;strong>&lt;code>/cache&lt;/code>&lt;/strong> &amp;hellip; アプリ用キャッシュ（リカバリイメージのダウンロードもここに入る）&lt;/li>
&lt;/ul>
&lt;h2 id="nexus7-2013-の情報を見てみる">Nexus7 (2013) の情報を見てみる&lt;/h2>

&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">マウント情報の表示&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-plain" data-lang="plain">&lt;span class="line">&lt;span class="cl">$ mount （あるいは cat /proc/mounts）
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">rootfs / rootfs ro,relatime 0 0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">tmpfs /dev tmpfs rw,seclabel,nosuid,relatime,mode=755 0 0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">devpts /dev/pts devpts rw,seclabel,relatime,mode=600 0 0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">proc /proc proc rw,relatime 0 0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sysfs /sys sysfs rw,seclabel,relatime 0 0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">selinuxfs /sys/fs/selinux selinuxfs rw,relatime 0 0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">debugfs /sys/kernel/debug debugfs rw,relatime 0 0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">none /acct cgroup rw,relatime,cpuacct 0 0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">tmpfs /mnt/secure tmpfs rw,seclabel,relatime,mode=700 0 0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">tmpfs /mnt/asec tmpfs rw,seclabel,relatime,mode=755,gid=1000 0 0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">tmpfs /mnt/obb tmpfs rw,seclabel,relatime,mode=755,gid=1000 0 0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">none /dev/cpuctl cgroup rw,relatime,cpu 0 0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">/dev/block/platform/msm_sdcc.1/by-name/system /system ext4 ro,seclabel,relatime,data=ordered 0 0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">/dev/block/platform/msm_sdcc.1/by-name/cache /cache ext4 rw,seclabel,nosuid,nodev,noatime,nomblk_io_submit,errors=panic,data=ordered 0 0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">/dev/block/platform/msm_sdcc.1/by-name/userdata /data ext4 rw,seclabel,nosuid,nodev,noatime,nomblk_io_submit,errors=panic,data=ordered 0 0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">/dev/block/platform/msm_sdcc.1/by-name/persist /persist ext4 rw,seclabel,nosuid,nodev,relatime,nodelalloc,data=ordered 0 0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">/dev/fuse /mnt/shell/emulated fuse rw,nosuid,nodev,relatime,user_id=1023,group_id=1023,default_permissions,allow_other 0 0&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>


&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">ファイルシステム情報の表示&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-plain" data-lang="plain">&lt;span class="line">&lt;span class="cl">$ df
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Filesystem Size Used Free Blksize
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">/dev 911.4M 48.0K 911.3M 4096
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">/mnt/secure 911.4M 0.0K 911.4M 4096
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">/mnt/asec 911.4M 0.0K 911.4M 4096
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">/mnt/obb 911.4M 0.0K 911.4M 4096
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">/system 827.8M 589.1M 238.7M 4096
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">/cache 551.7M 9.8M 541.9M 4096
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">/data 26.1G 2.7G 23.4G 4096
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">/persist 14.5M 4.2M 10.2M 4096
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">/mnt/shell/emulated 26.1G 2.7G 23.4G 4096&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure></description></item><item><title>Androidメモ: Nexus7 (2013) に adb 接続する</title><link>https://maku77.github.io/p/5b6pmtc/</link><pubDate>Wed, 06 Nov 2013 00:00:00 +0900</pubDate><guid>https://maku77.github.io/p/5b6pmtc/</guid><description>&lt;p>Android タブレットの Nexus7 に、&lt;code>adb&lt;/code> コマンドで接続するまでの手順です。
下記は Android 4.3 で確認しています。&lt;/p>
&lt;h2 id="android-の設定メニューに開発者向けオプションを表示">Android の設定メニューに「開発者向けオプション」を表示&lt;/h2>
&lt;ol>
&lt;li>設定 =&amp;gt; タブレット情報 (About tablet)&lt;/li>
&lt;li>「ビルド番号 (Build number)」を 7 回タップ&lt;/li>
&lt;/ol>
&lt;p>この操作で「デベロッパー」として認識され、設定メニューに「開発者向けオプション (Developer options)」の項目が表示されます。
開発者向けオプションでは、USB による adb 接続を行うために以下のチェックを入れておきます。&lt;/p>
&lt;ul>
&lt;li>USBデバッグ&lt;/li>
&lt;/ul>
&lt;p>この設定を行ってから USB Driver を更新する必要があります。&lt;/p>
&lt;h2 id="windows-7-に-usb-driver-をインストール">Windows 7 に USB Driver をインストール&lt;/h2>
&lt;ul>
&lt;li>&lt;a href="https://developer.android.com/sdk/win-usb.html">https://developer.android.com/sdk/win-usb.html&lt;/a>&lt;/li>
&lt;/ul>
&lt;p>の指示に従ってドライバのダウンロード、インストールをすれば OK です。
簡単に手順をまとめると、&lt;/p>
&lt;ol>
&lt;li>Google USB Driver をダウンロードして展開しておく（SDK Manager で GUI からダウンロードも可能）&lt;/li>
&lt;li>「開発者向けオプション/USBデバッグ」を ON にした状態で Nexus7 を USB で接続&lt;/li>
&lt;li>デバイスマネージャを起動（&amp;ldquo;Computer&amp;rdquo; を右クリック =&amp;gt; &amp;ldquo;Manage&amp;rdquo; =&amp;gt; 左側のペーンから &amp;ldquo;Device Manager&amp;rdquo; を選択）&lt;/li>
&lt;li>&amp;ldquo;Other devices/Nexus 7&amp;rdquo; を右クリック =&amp;gt; &amp;ldquo;Update Driver Software&amp;hellip;&amp;rdquo;
（&amp;ldquo;Portable Devices/Nexus 7&amp;rdquo; の方と間違えないように。&amp;ldquo;Other devices&amp;rdquo; の方が表示されない場合は、USBデバッグが ON になっていない可能性が高いです。）&lt;/li>
&lt;li>ドライバの入っているディレクトリを選択
&lt;ul>
&lt;li>SDK Manager でダウンロードした場合: &lt;code>&amp;lt;android-sdk&amp;gt;/extras/google/usb_driver&lt;/code>&lt;/li>
&lt;li>手動ダウンロードした場合: 展開してできた &lt;code>usb_driver&lt;/code> ディレクトリを選択&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ol>
&lt;h2 id="adb-を最新版に更新">ADB を最新版に更新&lt;/h2>
&lt;ol>
&lt;li>SDK Manager で以下を最新にアップデートしておく（これやらないと adb devices で認識しないことあり）
&lt;ul>
&lt;li>Android SDK Platoform-tools（2013-11-06 時点で rev.19）&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ol>
&lt;h2 id="コマンドラインから-adb-接続">コマンドラインから ADB 接続&lt;/h2>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-console" data-lang="console">&lt;span class="line">&lt;span class="cl">&lt;span class="gp">$&lt;/span> adb kill-server
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="gp">$&lt;/span> adb devices
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>ここで Nexus7 の画面に「USBデバッグを許可しますか？」のダイアログが出るので「OK」を選択。
これで Nexus7 に ADB 接続できるようになります。&lt;/p></description></item><item><title>Androidメモ: SHARP IS03 に adb 接続する</title><link>https://maku77.github.io/p/4hhc7ba/</link><pubDate>Tue, 09 Oct 2012 00:00:00 +0900</pubDate><guid>https://maku77.github.io/p/4hhc7ba/</guid><description>&lt;p>SHARP のスマホ IS03 を &lt;code>adb devices&lt;/code> コマンドで認識させるまでの手順です。
Android SDK のインストールは済んでいて、&lt;code>adb&lt;/code> コマンドは実行できる状態になっているとします。&lt;/p>
&lt;ol>
&lt;li>IS03 用 USB ドライバをダウンロード＆インストール
&lt;ul>
&lt;li>&lt;a href="https://k-tai.sharp.co.jp/support/a/is03/download.html#usb_driver">https://k-tai.sharp.co.jp/support/a/is03/download.html#usb_driver&lt;/a>&lt;/li>
&lt;li>ドライバをインストールする前に USB でつないでいた場合は、正しく認識できなくなってしまうことがあるようです。
その場合は、「プログラムの追加と削除」から一度、「au IS03 USB Software」をアンインストールしてから、USB 接続を外した状態で、再度インストールします。&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>Sharp 共通の ADB USBドライバをダウンロード＆展開
&lt;ul>
&lt;li>&lt;a href="https://sh-dev.sharp.co.jp/android/modules/driver/">https://sh-dev.sharp.co.jp/android/modules/driver/&lt;/a>&lt;/li>
&lt;li>次の手順でインストールするドライバをダウンロードして、展開しておきます。&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>ADB USB ドライバをインストール
&lt;ul>
&lt;li>Android 端末の USB デバッグを有効にし（設定 ＞ アプリケーション ＞ 開発）、USB 接続すると、ドライバのインストールダイアログがポップアップするので、手順 2 で展開した ADB USB ドライバのディレクトリを選択してインストールします。
ポップアップしない場合は、「高速転送モード」に切り替えると出たりします。
それでも出ない場合は、「Device Manager」から、Other devices/Android ADB Interface などを見つけられれば、再インストール可能です。&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>確認
&lt;ul>
&lt;li>インストールが完了すれば、以下のように adb から認識されれいるはずです。
&lt;pre tabindex="0">&lt;code>C:\&amp;gt; adb devices
List of devices attached
SSHEV012345 device
&lt;/code>&lt;/pre>&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ol></description></item><item><title>Androidベンダー向けメモ: Android 4.0 でサポートされている Locale の一覧</title><link>https://maku77.github.io/p/ypihqom/</link><pubDate>Tue, 18 Sep 2012 00:00:00 +0900</pubDate><guid>https://maku77.github.io/p/ypihqom/</guid><description>&lt;p>下記は、Android 4.0 においてサポートされている Locale の一覧です。
Android の UI 上の言語名は ICU のライブラリから取得した情報をもとに表示されるのですが、中国語に関しては例外的に、表示上の言語名が「繁体字」or「簡体字」のようになるように拡張されています。
これらの文言は &lt;code>android/packages/apps/Settings/res/values/arrays.xml&lt;/code> 内で定義されています。&lt;/p>
&lt;pre tabindex="0">&lt;code>af_ZA: Afrikaans (South Africa) / アフリカーンス語 (南アフリカ)
am_ET: Amharic (Ethiopia) / アムハラ語 (エチオピア)
ar_EG: Arabic (Egypt) / アラビア語 (エジプト)
bg_BG: Bulgarian (Bulgaria) / ブルガリア語 (ブルガリア)
ca_ES: Catalan (Spain) / カタロニア語 (スペイン)
cs_CZ: Czech (Czech Republic) / チェコ語 (チェコ)
da_DK: Danish (Denmark) / デンマーク語 (デンマーク)
de_DE: German (Germany) / ドイツ語 (ドイツ)
el_GR: Greek (Greece) / ギリシア語 (ギリシア)
en_GB: English (United Kingdom) / 英語 (イギリス)
en_US: English (United States) / 英語 (アメリカ合衆国)
es_ES: Spanish (Spain) / スペイン語 (スペイン)
es_US: Spanish (United States) / スペイン語 (アメリカ合衆国)
fa_IR: Persian (Iran) / ペルシア語 (イラン)
fi_FI: Finnish (Finland) / フィンランド語 (フィンランド)
fr_FR: French (France) / フランス語 (フランス)
hi_IN: Hindi (India) / ヒンディー語 (インド)
hi_IN: Hindi (India) / ヒンディー語 (インド)
hr_HR: Croatian (Croatia) / クロアチア語 (クロアチア)
hu_HU: Hungarian (Hungary) / ハンガリー語 (ハンガリー)
in_ID: Indonesian (Indonesia) / インドネシア語 (インドネシア)
it_IT: Italian (Italy) / イタリア語 (イタリア)
iw_IL: Hebrew (Israel) / ヘブライ語 (イスラエル)
ja_JP: Japanese (Japan) / 日本語 (日本)
ko_KR: Korean (South Korea) / 韓国語 (大韓民国)
lt_LT: Lithuanian (Lithuania) / リトアニア語 (リトアニア)
lv_LV: Latvian (Latvia) / ラトビア語 (レット語) (ラトビア)
ms_MY: Malay (Malaysia) / マライ語 (マレーシア)
nb_NO: Norwegian Bokm?l (Norway) / ノルウェー語 (ボークモール) (ノルウェー)
nl_NL: Dutch (Netherlands) / オランダ語 (オランダ)
pl_PL: Polish (Poland) / ポーランド語 (ポーランド)
pt_BR: Portuguese (Brazil) / ポルトガル語 (ブラジル)
pt_PT: Portuguese (Portugal) / ポルトガル語 (ポルトガル)
rm_CH: Raeto-Romance (Switzerland) / レト＝ロマン語 (スイス)
ro_RO: Romanian (Romania) / ルーマニア語 (ルーマニア)
ru_RU: Russian (Russia) / ロシア語 (ロシア)
sk_SK: Slovak (Slovakia) / スロバキア語 (スロバキア)
sl_SI: Slovenian (Slovenia) / スロベニア語 (スロベニア)
sr_RS: Serbian (Serbia) / セルビア語 (セルビア)
sv_SE: Swedish (Sweden) / スウェーデン語 (スウェーデン)
sw_TZ: Swahili (Tanzania) / スワヒリ語 (タンザニア)
th_TH: Thai (Thailand) / タイ語 (タイ)
tl_PH: Tagalog (Philippines) / タガログ語 (フィリピン)
tr_TR: Turkish (Turkey) / トルコ語 (トルコ)
uk_UA: Ukrainian (Ukraine) / ウクライナ語 (ウクライナ)
vi_VN: Vietnamese (Vietnam) / ベトナム語 (ベトナム)
zh_CN: Chinese (China) / 中国語 (中華人民共和国) ★「簡体」
zh_TW: Chinese (Taiwan) / 中国語 (台湾) ★「繁体」
zu_ZA: Zulu (South Africa) / ズールー語 (南アフリカ)
&lt;/code>&lt;/pre>&lt;p>上記の一覧は、通常の PC 上でロケールシンボル（&lt;code>en_US&lt;/code> など）に対応する言語名、国名を出力したものです。
下記のようなコードを実行して出力しています。&lt;/p></description></item><item><title>Androidトラブルシューティング: repo init でエラーが出る場合</title><link>https://maku77.github.io/p/zh3w2tz/</link><pubDate>Tue, 21 Feb 2012 00:00:00 +0900</pubDate><guid>https://maku77.github.io/p/zh3w2tz/</guid><description>&lt;p>Proxy 環境で、repo コマンド実行時に下記のようなエラーが出る場合、&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-console" data-lang="console">&lt;span class="line">&lt;span class="cl">&lt;span class="gp">$&lt;/span> repo init -u https://android.googlesource.com/platform/manifest
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">...
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">Get https://android.googlesource.com/tools/repo
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">&lt;/span>&lt;span class="err">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="err">&lt;/span>&lt;span class="go">fatal: branch &amp;#39;stable&amp;#39; has not been signed
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>以下のように http でアクセスするように変更すればうまくいくことがあります。&lt;/p>

&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">(1) repo ファイルの REPO_URL を https から http に変更&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-text" data-lang="text">&lt;span class="line">&lt;span class="cl">REPO_URL=&amp;#39;https://android.googlesource.com/tools/repo&amp;#39;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">↓
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">REPO_URL=&amp;#39;http://android.googlesource.com/tools/repo&amp;#39;&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>


&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">(2) プロキシ設定 （~/.bashrc とか）&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">$ &lt;span class="nb">export&lt;/span> &lt;span class="nv">http_proxy&lt;/span>&lt;span class="o">=&lt;/span>http://example.com:8080/&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>


&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">(3) http のアドレスで repo init&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">$ repo init -u http://android.googlesource.com/platform/manifest&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure></description></item><item><title>adb から Backup Manager を走らせる (bmgr backup, bmgr restore)</title><link>https://maku77.github.io/p/x9xhyhz/</link><pubDate>Thu, 26 Jan 2012 00:00:00 +0900</pubDate><guid>https://maku77.github.io/p/x9xhyhz/</guid><description>&lt;p>Android アプリケーションで &lt;strong>BackupAgent&lt;/strong> を実装しておくと、設定値などを Google アカウントに紐づけてバックアップすることができます。
例えば、Android システム設定のバックアップは &lt;code>SettingsProvider&lt;/code> (&lt;code>com.android.providers.settings&lt;/code>) の &lt;code>SettingsBackupAgent&lt;/code> クラスで実装されています。&lt;/p>
&lt;p>アプリケーションの実装で、&lt;code>BackupManager.dataChanged()&lt;/code> を読んでおくと、ダーティフラグがセットされて、Android が適切なタイミングで Google のサーバーにバックアップするのですが、&lt;code>adb shell&lt;/code> から &lt;strong>&lt;code>bmgr&lt;/code>&lt;/strong> コマンドを使うことで、バックアップ、リストアを任意のタイミングで実行できます。&lt;/p>

&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">設定を Google サーバへバックアップ&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-plain" data-lang="plain">&lt;span class="line">&lt;span class="cl">adb&amp;gt; bmgr backup com.android.providers.settings
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">adb&amp;gt; bmgr run&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>


&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">設定を Google サーバからリストア&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-plain" data-lang="plain">&lt;span class="line">&lt;span class="cl">adb&amp;gt; bmgr restore com.android.providers.settings&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>

&lt;ul>
&lt;li>参考: &lt;a href="https://developer.android.com/reference/android/app/backup/BackupAgent">BackupAgent  |  Android Developers&lt;/a>&lt;/li>
&lt;li>参考: &lt;a href="https://developer.android.com/guide/topics/data/keyvaluebackup">Android Backup Service を使用して Key-Value ペアをバックアップする&lt;/a>&lt;/li>
&lt;/ul></description></item><item><title>Androidベンダー向けメモ: root ユーザで adb 接続する</title><link>https://maku77.github.io/p/4ucsovh/</link><pubDate>Wed, 14 Dec 2011 00:00:00 +0900</pubDate><guid>https://maku77.github.io/p/4ucsovh/</guid><description>&lt;p>（下記はデバイス開発者向けの解説であり、root を取得する権限があることを前提としています）&lt;/p>
&lt;p>Android 端末の &lt;code>/system&lt;/code> 領域を &lt;code>rw&lt;/code> で &lt;code>remount&lt;/code> したのに、&lt;/p>
&lt;pre tabindex="0">&lt;code>$ adb push sample.apk /system/app
&lt;/code>&lt;/pre>&lt;p>が Permission denied でエラーになる場合は、ADB 接続が system ユーザで実行されている可能性があります。
以下のようすると root ユーザで ADB 接続できます。&lt;/p>
&lt;pre tabindex="0">&lt;code># adb root
# adb kill-server
# adb start-server
&lt;/code>&lt;/pre></description></item><item><title>Androidメモ: Sony Tablet S に adb 接続する</title><link>https://maku77.github.io/p/gg59gt5/</link><pubDate>Sat, 24 Sep 2011 00:00:00 +0900</pubDate><guid>https://maku77.github.io/p/gg59gt5/</guid><description>&lt;p>基本的には、以下の Sony 公式説明に従えば OK です。&lt;/p>
&lt;ul>
&lt;li>&lt;a href="https://www.sony.jp/support/tablet/products/info/sdk.html">https://www.sony.jp/support/tablet/products/info/sdk.html&lt;/a>&lt;/li>
&lt;/ul>
&lt;p>Android SDK のインストールは済んでいて、&lt;code>adb&lt;/code> コマンドは実行できる状態になっていることを前提としています。&lt;/p>
&lt;h2 id="mac-osx-から接続する">Mac OSX から接続する&lt;/h2>
&lt;ol>
&lt;li>Tablet の設定画面で Debug モード有効にする&lt;/li>
&lt;li>Tablet と Mac を USB で接続&lt;/li>
&lt;li>Mac に Vendor ID を登録する
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-console" data-lang="console">&lt;span class="line">&lt;span class="cl">&lt;span class="gp">$&lt;/span> &lt;span class="nb">echo&lt;/span> 0x054c &amp;gt;&amp;gt; &lt;span class="nv">$HOME&lt;/span>/.android/adb_usb.ini
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;li>ADB 接続
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-console" data-lang="console">&lt;span class="line">&lt;span class="cl">&lt;span class="gp">$&lt;/span> adb kill-server
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="gp">$&lt;/span> adb start-server
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;li>接続できたか確認
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-console" data-lang="console">&lt;span class="line">&lt;span class="cl">&lt;span class="gp">$&lt;/span> adb devices
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;/ol>
&lt;h2 id="windows-から接続する">Windows から接続する&lt;/h2>
&lt;ol>
&lt;li>
&lt;p>Tablet の設定画面で Debug モード有効にする&lt;/p>
&lt;/li>
&lt;li>
&lt;p>Tablet と Windows を USB で接続&lt;/p>
&lt;/li>
&lt;li>
&lt;p>Google USB Driver をインストール&lt;/p>
&lt;ol>
&lt;li>デバイスマネージャの Sony_Tablet を右クリックして、&amp;ldquo;Update Driver Software&amp;hellip;&amp;rdquo; を選択。&lt;/li>
&lt;li>ドライバのディレクトリは、Android SDK の &amp;ldquo;extras/google/usb_driver&amp;rdquo; ディレクトリを選択。&lt;/li>
&lt;/ol>
&lt;/li>
&lt;li>
&lt;p>Windows に Vendor ID を登録する&lt;/p></description></item><item><title>Androidメモ: 現在のスクリーンレイアウトサイズを取得する (Configuration)</title><link>https://maku77.github.io/p/7e9mdcp/</link><pubDate>Wed, 14 Sep 2011 00:00:00 +0900</pubDate><guid>https://maku77.github.io/p/7e9mdcp/</guid><description>&lt;p>Android の現在のスクリーンサイズ (small, medium, large, xlarge) などの情報は &lt;strong>&lt;code>Configuration&lt;/code>&lt;/strong> オブジェクトに格納されています。
Activity の中から以下のように情報を取得できます。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// import android.content.res.Configuration;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">Configuration&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">config&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">getResources&lt;/span>&lt;span class="p">().&lt;/span>&lt;span class="na">getConfiguration&lt;/span>&lt;span class="p">();&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">if&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">((&lt;/span>&lt;span class="n">config&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">screenLayout&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">&amp;amp;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Configuration&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">SCREENLAYOUT_SIZE_MASK&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">==&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Configuration&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">SCREENLAYOUT_SIZE_LARGE&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">// LARGE の場合&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div></description></item><item><title>APK ファイルの情報を表示する (aapt)</title><link>https://maku77.github.io/p/qqrxpjd/</link><pubDate>Sun, 11 Sep 2011 00:00:00 +0900</pubDate><guid>https://maku77.github.io/p/qqrxpjd/</guid><description>&lt;p>Android SDK に付属している &lt;strong>aapt (Android Asset Packaging Tool)&lt;/strong> を使用すると、APK の情報を調べることができます。
主にリソースなどの Asset を対象としたツールですが、バージョン情報や、パーミッション情報なども調べることができます。&lt;/p>
&lt;p>&lt;code>aapt&lt;/code> コマンドは、昔は &lt;code>build-tools&lt;/code> ディレクトリ直下にありましたが、現在は &lt;code>build-tools\23.0.2&lt;/code> のようなバージョン名のディレクトリ以下にインストールされるようです。&lt;/p>
&lt;p>具体的には下記のようなオプションを指定して APK の情報を確認できます（&lt;code>dump&lt;/code> パラメータは &lt;code>d&lt;/code> と省略できます）。&lt;/p>
&lt;ul>
&lt;li>&lt;code>aapt d badging myapp.apk&lt;/code>
&lt;ul>
&lt;li>パッケージ名、アプリ名、バージョン、パーミッション情報、サポートする Locale の一覧などを確認&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>&lt;code>aapt d permissions myapp.apk&lt;/code>
&lt;ul>
&lt;li>使用しているパーミッション (uses-permission) と、定義しているパーミッション (permission) の一覧&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>&lt;code>aapt d strings myapp.apk&lt;/code>
&lt;ul>
&lt;li>文字列リソースの一覧&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>&lt;code>aapt d resources myapp.apk&lt;/code>
&lt;ul>
&lt;li>リソースの一覧（大量に出力されるので注意）&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>&lt;code>aapt d xmltree myapp.apk res/animator/fadein.xml&lt;/code>
&lt;ul>
&lt;li>指定した XML リソースのツリー情報&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>&lt;code>aapt list myapp.apk&lt;/code>
&lt;ul>
&lt;li>リソースファイル名の一覧&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;h2 id="aapt-コマンドのヘルプ">aapt コマンドのヘルプ&lt;/h2>
&lt;p>パラメータなしで、&lt;code>aapt&lt;/code> コマンドを実行すると、下記のようにヘルプが表示されます。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-console" data-lang="console">&lt;span class="line">&lt;span class="cl">&lt;span class="gp">$&lt;/span> aapt
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">Android Asset Packaging Tool
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">&lt;/span>&lt;span class="err">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="err">&lt;/span>&lt;span class="go">Usage:
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go"> aapt l[ist] [-v] [-a] file.{zip,jar,apk}
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go"> List contents of Zip-compatible archive.
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">&lt;/span>&lt;span class="err">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="err">&lt;/span>&lt;span class="go"> aapt d[ump] [--values] [--include-meta-data] WHAT file.{apk} [asset [asset ...]]
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go"> strings Print the contents of the resource table string pool in the APK.
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go"> badging Print the label and icon for the app declared in APK.
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go"> permissions Print the permissions from the APK.
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go"> resources Print the resource table from the APK.
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go"> configurations Print the configurations in the APK.
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go"> xmltree Print the compiled xmls in the given assets.
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go"> xmlstrings Print the strings of the given compiled xml assets.
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">&lt;/span>&lt;span class="err">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="err">&lt;/span>&lt;span class="go"> aapt p[ackage] [-d][-f][-m][-u][-v][-x][-z][-M AndroidManifest.xml] \
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go"> [-0 extension [-0 extension ...]] [-g tolerance] [-j jarfile] \
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go"> [--debug-mode] [--min-sdk-version VAL] [--target-sdk-version VAL] \
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go"> [--app-version VAL] [--app-version-name TEXT] [--custom-package VAL] \
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go"> [--rename-manifest-package PACKAGE] \
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go"> [--rename-instrumentation-target-package PACKAGE] \
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go"> [--utf16] [--auto-add-overlay] \
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go"> [--max-res-version VAL] \
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go"> [-I base-package [-I base-package ...]] \
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go"> [-A asset-source-dir] [-G class-list-file] [-P public-definitions-file] \
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go"> [-S resource-sources [-S resource-sources ...]] \
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go"> [-F apk-file] [-J R-file-dir] \
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go"> [--product product1,product2,...] \
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go"> [-c CONFIGS] [--preferred-density DENSITY] \
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go"> [--split CONFIGS [--split CONFIGS]] \
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go"> [--feature-of package [--feature-after package]] \
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go"> [raw-files-dir [raw-files-dir] ...] \
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go"> [--output-text-symbols DIR]
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">&lt;/span>&lt;span class="err">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="err">&lt;/span>&lt;span class="go"> Package the android resources. It will read assets and resources that are
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go"> supplied with the -M -A -S or raw-files-dir arguments. The -J -P -F and -R
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go"> options control which files are output.
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">&lt;/span>&lt;span class="err">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="err">&lt;/span>&lt;span class="go"> aapt r[emove] [-v] file.{zip,jar,apk} file1 [file2 ...]
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go"> Delete specified files from Zip-compatible archive.
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">&lt;/span>&lt;span class="err">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="err">&lt;/span>&lt;span class="go"> aapt a[dd] [-v] file.{zip,jar,apk} file1 [file2 ...]
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go"> Add specified files to Zip-compatible archive.
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">&lt;/span>&lt;span class="err">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="err">&lt;/span>&lt;span class="go"> aapt c[runch] [-v] -S resource-sources ... -C output-folder ...
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go"> Do PNG preprocessing on one or several resource folders
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go"> and store the results in the output folder.
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">&lt;/span>&lt;span class="err">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="err">&lt;/span>&lt;span class="go"> aapt s[ingleCrunch] [-v] -i input-file -o outputfile
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go"> Do PNG preprocessing on a single file.
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">&lt;/span>&lt;span class="err">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="err">&lt;/span>&lt;span class="go"> aapt v[ersion]
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go"> Print program version.
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">&lt;/span>&lt;span class="err">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="err">&lt;/span>&lt;span class="go"> Modifiers:
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go"> -a print Android-specific data (resources, manifest) when listing
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go"> -c specify which configurations to include. The default is all
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go"> configurations. The value of the parameter should be a comma
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go"> separated list of configuration values. Locales should be specified
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go"> as either a language or language-region pair. Some examples:
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go"> en
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go"> port,en
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go"> port,land,en_US
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go"> -d one or more device assets to include, separated by commas
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go"> -f force overwrite of existing files
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go"> -g specify a pixel tolerance to force images to grayscale, default 0
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go"> -j specify a jar or zip file containing classes to include
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go"> -k junk path of file(s) added
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go"> -m make package directories under location specified by -J
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go"> -u update existing packages (add new, replace older, remove deleted files)
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go"> -v verbose output
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go"> -x create extending (non-application) resource IDs
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go"> -z require localization of resource attributes marked with
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go"> localization=&amp;#34;suggested&amp;#34;
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go"> -A additional directory in which to find raw asset files
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go"> -G A file to output proguard options into.
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go"> -F specify the apk file to output
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go"> -I add an existing package to base include set
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go"> -J specify where to output R.java resource constant definitions
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go"> -M specify full path to AndroidManifest.xml to include in zip
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go"> -P specify where to output public resource definitions
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go"> -S directory in which to find resources. Multiple directories will be scanned
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go"> and the first match found (left to right) will take precedence.
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go"> -0 specifies an additional extension for which such files will not
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go"> be stored compressed in the .apk. An empty string means to not
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go"> compress any files at all.
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go"> --debug-mode
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go"> inserts android:debuggable=&amp;#34;true&amp;#34; in to the application node of the
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go"> manifest, making the application debuggable even on production devices.
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go"> --include-meta-data
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go"> when used with &amp;#34;dump badging&amp;#34; also includes meta-data tags.
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go"> --pseudo-localize
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go"> generate resources for pseudo-locales (en-XA and ar-XB).
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go"> --min-sdk-version
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go"> inserts android:minSdkVersion in to manifest. If the version is 7 or
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go"> higher, the default encoding for resources will be in UTF-8.
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go"> --target-sdk-version
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go"> inserts android:targetSdkVersion in to manifest.
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go"> --max-res-version
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go"> ignores versioned resource directories above the given value.
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go"> --values
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go"> when used with &amp;#34;dump resources&amp;#34; also includes resource values.
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go"> --version-code
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go"> inserts android:versionCode in to manifest.
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go"> --version-name
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go"> inserts android:versionName in to manifest.
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go"> --replace-version
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go"> If --version-code and/or --version-name are specified, these
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go"> values will replace any value already in the manifest. By
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go"> default, nothing is changed if the manifest already defines
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go"> these attributes.
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go"> --custom-package
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go"> generates R.java into a different package.
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go"> --extra-packages
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go"> generate R.java for libraries. Separate libraries with &amp;#39;:&amp;#39;.
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go"> --generate-dependencies
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go"> generate dependency files in the same directories for R.java and resource package
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go"> --auto-add-overlay
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go"> Automatically add resources that are only in overlays.
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go"> --preferred-density
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go"> Specifies a preference for a particular density. Resources that do not
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go"> match this density and have variants that are a closer match are removed.
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go"> --split
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go"> Builds a separate split APK for the configurations listed. This can
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go"> be loaded alongside the base APK at runtime.
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go"> --feature-of
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go"> Builds a split APK that is a feature of the apk specified here. Resources
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go"> in the base APK can be referenced from the the feature APK.
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go"> --feature-after
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go"> An app can have multiple Feature Split APKs which must be totally ordered.
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go"> If --feature-of is specified, this flag specifies which Feature Split APK
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go"> comes before this one. The first Feature Split APK should not define
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go"> anything here.
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go"> --rename-manifest-package
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go"> Rewrite the manifest so that its package name is the package name
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go"> given here. Relative class names (for example .Foo) will be
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go"> changed to absolute names with the old package so that the code
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go"> does not need to change.
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go"> --rename-instrumentation-target-package
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go"> Rewrite the manifest so that all of its instrumentation
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go"> components target the given package. Useful when used in
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go"> conjunction with --rename-manifest-package to fix tests against
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go"> a package that has been renamed.
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go"> --product
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go"> Specifies which variant to choose for strings that have
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go"> product variants
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go"> --utf16
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go"> changes default encoding for resources to UTF-16. Only useful when API
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go"> level is set to 7 or higher where the default encoding is UTF-8.
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go"> --non-constant-id
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go"> Make the resources ID non constant. This is required to make an R java class
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go"> that does not contain the final value but is used to make reusable compiled
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go"> libraries that need to access resources.
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go"> --shared-lib
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go"> Make a shared library resource package that can be loaded by an application
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go"> at runtime to access the libraries resources. Implies --non-constant-id.
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go"> --error-on-failed-insert
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go"> Forces aapt to return an error if it fails to insert values into the manifest
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go"> with --debug-mode, --min-sdk-version, --target-sdk-version --version-code
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go"> and --version-name.
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go"> Insertion typically fails if the manifest already defines the attribute.
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go"> --error-on-missing-config-entry
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go"> Forces aapt to return an error if it fails to find an entry for a configuration.
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go"> --output-text-symbols
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go"> Generates a text file containing the resource symbols of the R class in the
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go"> specified folder.
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go"> --ignore-assets
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go"> Assets to be ignored. Default pattern is:
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go"> !.svn:!.git:!.ds_store:!*.scc:.*:&amp;lt;dir&amp;gt;_*:!CVS:!thumbs.db:!picasa.ini:!*~
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go"> --skip-symbols-without-default-localization
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go"> Prevents symbols from being generated for strings that do not have a default
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go"> localization
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go"> --no-version-vectors
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go"> Do not automatically generate versioned copies of vector XML resources.
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>上記の表示は、下記の &lt;code>aapt&lt;/code> のバージョンのものです。&lt;/p></description></item><item><title>Androidベンダー向けメモ: LowMemoryKiller の仕組み</title><link>https://maku77.github.io/p/qmcauwd/</link><pubDate>Wed, 07 Sep 2011 00:00:00 +0900</pubDate><guid>https://maku77.github.io/p/qmcauwd/</guid><description>&lt;h2 id="lowmemorykiller-によるプロセス-kill-の優先順位の仕組み">LowMemoryKiller によるプロセス kill の優先順位の仕組み&lt;/h2>
&lt;p>Android 独自の仕組みである &lt;strong>Low Memory Killer&lt;/strong> は、空きメモリが一定以下になると、アプリプロセスを自動的に kill します。
実体は下記のカーネルに含まれているネイティブプログラムです。&lt;/p>
&lt;ul>
&lt;li>kernel/drivers/staging/android/lowmemorykiller.c&lt;/li>
&lt;/ul>
&lt;p>どのプロセスが kill されるかは、プロセスごとに設定された &lt;strong>adj&lt;/strong> の値によって決まります。
この値が小さい方が優先度の高いプロセスであることを示し、Low Memory Killer によって殺されにくくなります。
メモリサイズと、adj の関連は、&lt;code>init.rc&lt;/code> の中で以下のような感じで設定されます。&lt;/p>
&lt;pre tabindex="0">&lt;code># Write value must be consistent with the above properties.
write /sys/module/lowmemorykiller/parameters/adj 0,1,2,3,4,5,6,7,14,15
write /sys/module/lowmemorykiller/parameters/minfree 2048,4096,8192,8192,16384,20000,25000,30000,35000,40000
&lt;/code>&lt;/pre>&lt;p>上記の設定では、空きメモリが 8192 page (= 8192 * 4K = 32768K) 以下になったときに、adj が 3 以上であるプロセスが kill されることを示しています。
adj の具体的な値として、以下のようなものがあらかじめ定義されています (Honeycomb)。&lt;/p>
&lt;table>
 &lt;thead>
 &lt;tr>
 &lt;th>ActivityManagerService 内変数&lt;/th>
 &lt;th>System property&lt;/th>
 &lt;th>Default&lt;/th>
 &lt;th>Description&lt;/th>
 &lt;/tr>
 &lt;/thead>
 &lt;tbody>
 &lt;tr>
 &lt;td>SYSTEM_ADJ&lt;/td>
 &lt;td>&lt;/td>
 &lt;td>-16&lt;/td>
 &lt;td>The system process runs at the default adjustment.&lt;/td>
 &lt;/tr>
 &lt;tr>
 &lt;td>CORE_SERVER_ADJ&lt;/td>
 &lt;td>&lt;/td>
 &lt;td>-12&lt;/td>
 &lt;td>This is a process running a core server, such as telephony. Definitely don&amp;rsquo;t want to kill it, but doing so is not completely fatal.&lt;/td>
 &lt;/tr>
 &lt;tr>
 &lt;td>FOREGROUND_APP_ADJ&lt;/td>
 &lt;td>ro.FOREGROUND_APP_ADJ&lt;/td>
 &lt;td>0&lt;/td>
 &lt;td>Foreground app&lt;/td>
 &lt;/tr>
 &lt;tr>
 &lt;td>VISIBLE_APP_ADJ&lt;/td>
 &lt;td>ro.VISIBLE_APP_ADJ&lt;/td>
 &lt;td>1&lt;/td>
 &lt;td>Visible app&lt;/td>
 &lt;/tr>
 &lt;tr>
 &lt;td>PERCEPTIBLE_APP_ADJ&lt;/td>
 &lt;td>ro.PERCEPTIBLE_APP_ADJ&lt;/td>
 &lt;td>2&lt;/td>
 &lt;td>This is a process only hosting components that are perceptible to the user, and we really want to avoid killing them, but they are not immediately visible. An example is background music playback.&lt;/td>
 &lt;/tr>
 &lt;tr>
 &lt;td>HEAVY_WEIGHT_APP_ADJ&lt;/td>
 &lt;td>ro.HEAVY_WEIGHT_APP_ADJ&lt;/td>
 &lt;td>3&lt;/td>
 &lt;td>This is a process with a heavy-weight application. It is in the background, but we want to try to avoid killing it.&lt;/td>
 &lt;/tr>
 &lt;tr>
 &lt;td>SECONDARY_SERVER_ADJ&lt;/td>
 &lt;td>ro.SECONDARY_SERVER_ADJ&lt;/td>
 &lt;td>4&lt;/td>
 &lt;td>This is a process holding a secondary server &amp;ndash; killing tit will not have much of an impact as far as the user is concerned.&lt;/td>
 &lt;/tr>
 &lt;tr>
 &lt;td>BACKUP_APP_ADJ&lt;/td>
 &lt;td>ro.BACKUP_APP_ADJ&lt;/td>
 &lt;td>5&lt;/td>
 &lt;td>This is a process currently hosting a backup operation. Killing it is not entirely fatal but is generally a bad idea.&lt;/td>
 &lt;/tr>
 &lt;tr>
 &lt;td>HOME_APP_ADJ&lt;/td>
 &lt;td>ro.HOME_APP_ADJ&lt;/td>
 &lt;td>6&lt;/td>
 &lt;td>This is a process holding the home application &amp;ndash; we want to try avoiding killing it, even if it would normally be in the background, because the user interacts with it so much.&lt;/td>
 &lt;/tr>
 &lt;tr>
 &lt;td>HIDDEN_APP_MIN_ADJ&lt;/td>
 &lt;td>ro.HIDDEN_APP_MIN_ADJ&lt;/td>
 &lt;td>7&lt;/td>
 &lt;td>This is a process only hosting activities that are not visible, so it can be killed without any disruption.&lt;/td>
 &lt;/tr>
 &lt;tr>
 &lt;td>&lt;/td>
 &lt;td>ro.CONTENT_PROVIDER_ADJ&lt;/td>
 &lt;td>14&lt;/td>
 &lt;td>&lt;/td>
 &lt;/tr>
 &lt;tr>
 &lt;td>EMPTY_APP_ADJ&lt;/td>
 &lt;td>ro.EMPTY_APP_ADJ&lt;/td>
 &lt;td>15&lt;/td>
 &lt;td>This is a process without anything currently running in it. Definitely the first to go!&lt;/td>
 &lt;/tr>
 &lt;tr>
 &lt;td>HIDDEN_APP_MAX_ADJ&lt;/td>
 &lt;td>ro.EMPTY_APP_ADJ&lt;/td>
 &lt;td>15&lt;/td>
 &lt;td>&lt;/td>
 &lt;/tr>
 &lt;tr>
 &lt;td>(GTV)&lt;/td>
 &lt;td>ro.CHROME_CRITICAL_OOM_ADJ&lt;/td>
 &lt;td>0&lt;/td>
 &lt;td>&lt;/td>
 &lt;/tr>
 &lt;tr>
 &lt;td>(GTV)&lt;/td>
 &lt;td>ro.CHROME_HIGH_OOM_ADJ&lt;/td>
 &lt;td>5&lt;/td>
 &lt;td>&lt;/td>
 &lt;/tr>
 &lt;tr>
 &lt;td>(GTV)&lt;/td>
 &lt;td>ro.CHROME_MEDIUM_OOM_ADJ&lt;/td>
 &lt;td>5&lt;/td>
 &lt;td>&lt;/td>
 &lt;/tr>
 &lt;tr>
 &lt;td>(GTV)&lt;/td>
 &lt;td>ro.CHROME_LOW_OOM_ADJ&lt;/td>
 &lt;td>6&lt;/td>
 &lt;td>&lt;/td>
 &lt;/tr>
 &lt;/tbody>
&lt;/table>
&lt;p>プログラム内で参照する adj に関するシステムプロパティは、&lt;code>init.rc&lt;/code> で以下のような感じで設定されています。&lt;/p></description></item><item><title>Androidメモ: AsyncTask による非同期処理と UI 更新処理</title><link>https://maku77.github.io/p/o3hggfz/</link><pubDate>Mon, 22 Aug 2011 00:00:00 +0900</pubDate><guid>https://maku77.github.io/p/o3hggfz/</guid><description>&lt;h2 id="asynctask-とは">AsyncTask とは&lt;/h2>
&lt;p>&lt;a href="https://developer.android.com/reference/android/os/AsyncTask">&lt;code>android.os.AsyncTask&lt;/code>&lt;/a> クラスは、バックグラウンドで何か処理をしながら、逐次 UI を更新していくときに便利に使用できるユーティリティ・クラスです。
UI の更新処理はメインスレッドで行わなければいけないため、ワーカースレッドから UI 更新する場合は、通常は &lt;code>Handler&lt;/code> オブジェクトを介して処理をメインスレッドに委譲しなければいけません。
&lt;code>AsyncTask&lt;/code> を使用すると、このあたりの処理を隠ぺいすることができます。&lt;/p>
&lt;h2 id="asynctask-で実装するメソッド">AsyncTask で実装するメソッド&lt;/h2>
&lt;p>&lt;code>AsyncTask&lt;/code> のサブクラスで以下のようなメソッドをオーバーライドし、処理内容を記述します。
ワーカースレッドでの処理内容を &lt;code>doInBackground()&lt;/code> 内に記述し、UI の更新処理を &lt;code>onProgressUpdate()&lt;/code> で記述するようにします。&lt;/p>
&lt;ul>
&lt;li>&lt;code>doInBackground(Params...)&lt;/code>
&lt;ul>
&lt;li>ワーカースレッドで行いたい処理を記述する。UI スレッドとは違うスレッドで実行される。&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>&lt;code>onProgressUpdate(Progress...)&lt;/code>
&lt;ul>
&lt;li>UI の更新処理を記述する。UI スレッドで実行される。&lt;code>doInBackground()&lt;/code> 内から &lt;code>progressUpdate()&lt;/code> をコールすることで、明示的に呼び出す。&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;p>&lt;code>doInBackground()&lt;/code> の実行前と、実行後には、以下のようなメソッドが UI スレッドから呼び出されます。
このメソッドもオーバーライドして、UI の更新処理を記述することができます。&lt;/p>
&lt;ul>
&lt;li>&lt;code>onPreExecute()&lt;/code>&lt;/li>
&lt;li>&lt;code>onPostExecute(Result)&lt;/code>&lt;/li>
&lt;/ul>
&lt;h2 id="asynctask-のキャンセル処理について">AsyncTask のキャンセル処理について&lt;/h2>
&lt;ul>
&lt;li>&lt;code>doInBackground()&lt;/code> 内から &lt;code>cancel()&lt;/code> を呼ぶと、その時点で &lt;code>onPostExecute()&lt;/code> が実行され、その後も &lt;code>doInBackground()&lt;/code> は継続されます。&lt;/li>
&lt;li>&lt;code>AsyncTask&lt;/code> の外から &lt;code>cancel()&lt;/code> を呼ぶと、その時点で &lt;code>onCanceled()&lt;/code> が実行され、その後も &lt;code>doInBackground()&lt;/code> は継続されます。この場合は、&lt;code>onPostExecute()&lt;/code> は呼び出されません。&lt;/li>
&lt;/ul></description></item><item><title>Androidメモ: StrictMode を有効にして望ましくない実装を検出する</title><link>https://maku77.github.io/p/yvit8zb/</link><pubDate>Wed, 10 Aug 2011 00:00:00 +0900</pubDate><guid>https://maku77.github.io/p/yvit8zb/</guid><description>&lt;h2 id="strictmode-とは">StrictMode とは&lt;/h2>
&lt;p>&lt;strong>StrictMode&lt;/strong> は Android Gingerbread から追加されたユーティリティで、以下のような望ましくない処理を検出して、ログなどに出力させることができるようになっています。&lt;/p>
&lt;ul>
&lt;li>メインスレッドからのディスクアクセス&lt;/li>
&lt;li>メインスレッドからのネットワークアクセス&lt;/li>
&lt;li>SQLite 関連オブジェクトの close 忘れ&lt;/li>
&lt;/ul>
&lt;p>ただし、JNI 実装内でのディスクアクセスやネットワークアクセスなどは検出されない可能性があるので過信は禁物です。
StrictMode によって何を検出したいかの設定（&lt;code>detect*&lt;/code> 設定）や、検出した場合にどこに出力するかの設定（&lt;code>penalty*&lt;/code> 設定）を以下のようにコード内で行います。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// すべてを検出し、見つかったものをログに出力する場合&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">StrictMode&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">ThreadPolicy&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">policy&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">new&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">StrictMode&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">ThreadPolicy&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">Builder&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">detectAll&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">penaltyLog&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">build&lt;/span>&lt;span class="p">();&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">StrictMode&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">setThreadPolicy&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">policy&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>ここではスレッドに関連するポリシーである &lt;strong>&lt;code>StrictMode.ThreadPolicy&lt;/code>&lt;/strong> の設定を行っていますが、VM に対する &lt;strong>&lt;code>StrictMode.VmPolicy&lt;/code>&lt;/strong> の設定も同様に行うことができます。&lt;/p>
&lt;h3 id="参考リンク">参考リンク&lt;/h3>
&lt;ul>
&lt;li>&lt;a href="https://developer.android.com/reference/android/os/StrictMode.html">StrictMode ｜ Android Developers&lt;/a>&lt;/li>
&lt;li>&lt;a href="https://developer.android.com/reference/android/os/StrictMode.ThreadPolicy.Builder.html">StrictMode.ThreadPolicy ｜ Android Developers&lt;/a>&lt;/li>
&lt;li>&lt;a href="https://developer.android.com/reference/android/os/StrictMode.VmPolicy.Builder.html">StrictMode.VmPolicy ｜ Android Developers&lt;/a>&lt;/li>
&lt;li>&lt;a href="https://android-developers.blogspot.com/2010/12/new-gingerbread-api-strictmode.html">Android Developers Blog: New Gingerbread API: StrictMode&lt;/a>&lt;/li>
&lt;li>&lt;a href="https://y-anz-m.blogspot.com/2010/12/androidandroid-23-strictmode.html">Y.A.M の 雑記帳: Android　Android 2.3 - StrictMode&lt;/a>&lt;/li>
&lt;li>&lt;a href="https://d.hatena.ne.jp/bs-android/20101229/1293582940">StrictModeでパフォーマンスをチューニングする - Android(アンドロイド)情報-ブリリアントサービス&lt;/a>&lt;/li>
&lt;/ul>
&lt;h2 id="strictmode-で検出されたバイオレーションログを検索する">StrictMode で検出されたバイオレーションログを検索する&lt;/h2>
&lt;p>Logcat ログを StrictMode タグで絞り込んで、さらにパッケージ名で絞り込むと、StrictMode によって検出された問題個所を素早く見つけることができます。&lt;/p></description></item><item><title>Androidベンダー向けメモ: findmakefile コマンドで Android.mk のあるディレクトリを調べる</title><link>https://maku77.github.io/p/63w3r2r/</link><pubDate>Tue, 09 Aug 2011 00:00:00 +0900</pubDate><guid>https://maku77.github.io/p/63w3r2r/</guid><description>&lt;p>&lt;code>build/envsetup.sh&lt;/code> で定義されているシェル関数 &lt;strong>&lt;code>findmakefile&lt;/code>&lt;/strong> を使用すると、カレントディレクトリから上に &lt;code>Android.mk&lt;/code> を探してそのパスを調べることができます。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-console" data-lang="console">&lt;span class="line">&lt;span class="cl">&lt;span class="gp">$&lt;/span> findmakefile
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">/home/maku/gitwork/android/packages/apps/Browser/Android.mk
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>これを利用して、以下のように Vim で &lt;code>Android.mk&lt;/code> を開くことができます。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-console" data-lang="console">&lt;span class="line">&lt;span class="cl">&lt;span class="gp">$&lt;/span> vim &lt;span class="sb">`&lt;/span>findmakefile&lt;span class="sb">`&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div></description></item><item><title>Androidメモ: Activity の起動モードと起動フラグ（タスクとアフィニティ）のまとめ</title><link>https://maku77.github.io/p/4zpco9q/</link><pubDate>Wed, 03 Aug 2011 00:00:00 +0900</pubDate><guid>https://maku77.github.io/p/4zpco9q/</guid><description>&lt;h2 id="タスクとは">タスクとは&lt;/h2>
&lt;p>Android のアプリは、&lt;strong>「タスク」&lt;/strong> に複数の Activity をスタックすることで実現されています。
デフォルトでは、新しい Activity を起動すると、その起動元の「タスク」に Activity がスタックされていきます。
戻るキーで戻った時に表示される Activity は、この「タスク」にどのように Activity がスタックされているかによります。&lt;/p>
&lt;figure style="text-align: center">
&lt;div class="mermaid">
flowchart RL
 subgraph Task["タスク"]
 ActivityC["Activity C"]
 ActivityB["Activity B"]
 ActivityA["Activity A"]
 end

 ActivityC --> ActivityB
 ActivityB --> ActivityA

 ActivityA:::stoppedActivity
 ActivityB:::stoppedActivity
 ActivityC:::currentActivity

 classDef stoppedActivity fill:#f3e5f5,stroke:#4a148c,stroke-width:2px
 classDef currentActivity fill:#fff3e0,stroke:#e65100,stroke-width:3px
&lt;/div>
&lt;/figure>

&lt;script>
(function() {
 
 if (window.isMermaidLoaded) return;
 window.isMermaidLoaded = true;

 
 const script = document.createElement('script');
 script.src = 'https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js';
 script.onload = () => { mermaid.initialize({startOnLoad: true}); };
 document.body.appendChild(script);
})();
&lt;/script>


&lt;h2 id="アフィニティとは">アフィニティとは&lt;/h2>
&lt;p>Activity がどのタスクに配置されるかは &lt;strong>「アフィニティ」&lt;/strong> という情報で制御されています。affinity は「類似性」、「親和性」という意味です。
Activity とタスクはそれぞれ 1 つの「アフィニティ」を持ちます。&lt;/p></description></item><item><title>Androidメモ: ADB でディレクトリ内のファイルをすべて取得する (adb pull)</title><link>https://maku77.github.io/p/36huwqe/</link><pubDate>Fri, 29 Jul 2011 00:00:00 +0900</pubDate><guid>https://maku77.github.io/p/36huwqe/</guid><description>&lt;p>Android SDK の &lt;strong>&lt;code>adb pull&lt;/code>&lt;/strong> コマンドは、単一のファイルだけではなく、ディレクトリごとファイルを取得するのにも使用できます。
下記の例では、Android デバイス上の &lt;code>/system/lib&lt;/code> ディレクトリ内のファイルをすべて取得しています。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-console" data-lang="console">&lt;span class="line">&lt;span class="cl">&lt;span class="gp">$&lt;/span> adb pull /system/lib
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">pull: building file list...
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">pull: /system/lib/libcutils.so -&amp;gt; ./libcutils.so
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">pull: /system/lib/libssl.so -&amp;gt; ./libssl.so
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">...
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">245 files pulled. 0 files skipped.
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">1575 KB/s (97775523 bytes in 60.596s)
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div></description></item><item><title>Activity の情報を表示する (dumpsys activity)</title><link>https://maku77.github.io/p/mbnw7gq/</link><pubDate>Wed, 08 Jun 2011 00:00:00 +0900</pubDate><guid>https://maku77.github.io/p/mbnw7gq/</guid><description>&lt;p>Android 端末に &lt;code>adb shell&lt;/code> で接続後、&lt;strong>&lt;code>dumpsys&lt;/code>&lt;/strong> コマンドを実行すると Activity core サービスの情報を表示できます。
例えば、出力の Activity スタックを確認することで、最前面に表示されているアプリの正体を調べることができます。
&lt;code>dumpsys&lt;/code> コマンドをパラメータなしで実行すると、大量のメッセージが表示されてしまうので、&lt;strong>&lt;code>activity&lt;/code>&lt;/strong> パラメータを指定して Activity に関する情報だけに絞り込むと見やすくなります。&lt;/p>

&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">端末上で実行する場合（adb shell でログイン後）&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-plain" data-lang="plain">&lt;span class="line">&lt;span class="cl"># dumpsys activity&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>


&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">adb 経由で実行する場合&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-console" data-lang="console">&lt;span class="line">&lt;span class="cl">&lt;span class="gp">$&lt;/span> adb shell dumpsys activity
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>

&lt;p>例えば、以下のようにすれば、Stop 状態のアクティビティ含め、現在起動中のアクティビティの一覧を簡単に調べることができます（ここでは Windows の &lt;code>findstr&lt;/code> コマンドを使用しています）。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bat" data-lang="bat">&lt;span class="line">&lt;span class="cl">C&lt;span class="p">:&lt;/span>&lt;span class="nl">\&lt;/span>&lt;span class="c1">&amp;gt; adb shell dumpsys activity activities | findstr /c:&amp;#34;* TaskRecord&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> * TaskRecord{2758379e #1 A=com.google.android.leanbacklauncher U=0 sz=1}
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> * TaskRecord{18c788c2 #7 A=com.example.myapp1 U=0 sz=1}
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> * TaskRecord{3cffb420 #4 A=com.example.myapp2 U=0 sz=1}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div></description></item><item><title>APK ファイルを逆コンパイルする (apktool)</title><link>https://maku77.github.io/p/xr3n5jk/</link><pubDate>Fri, 27 May 2011 00:00:00 +0900</pubDate><guid>https://maku77.github.io/p/xr3n5jk/</guid><description>&lt;p>&lt;strong>Apktool&lt;/strong> を使用すると、APK ファイルを逆コンパイルして、内部のファイルの内容を確認することができます。&lt;/p>
&lt;ul>
&lt;li>&lt;a href="https://ibotpeaches.github.io/Apktool/">Apktool - A tool for reverse engineering Android apk files&lt;/a>&lt;/li>
&lt;/ul>
&lt;p>使い方は簡単で、次のように解析対象の APK ファイルと、出力先のディレクトリを指定するだけです。&lt;/p>

&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">使い方&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-console" data-lang="console">&lt;span class="line">&lt;span class="cl">&lt;span class="gp">$&lt;/span> apktool d &amp;lt;APKファイル名&amp;gt; &amp;lt;展開先ディレクトリ&amp;gt;
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure></description></item><item><title>Androidベンダー向けメモ: Android の Locale を切り替える（Configuration 値の変更）</title><link>https://maku77.github.io/p/dzocr3s/</link><pubDate>Thu, 19 May 2011 00:00:00 +0900</pubDate><guid>https://maku77.github.io/p/dzocr3s/</guid><description>&lt;p>Android の Locale などの Configuration 値を切り替えるには、&lt;code>IActivityManager&lt;/code> の &lt;code>updateConfiguration()&lt;/code> メソッドを呼び出す必要があります。
ただし、&lt;code>ActivityManagerNative&lt;/code> などは hide クラスとして定義されており、一般のアプリ開発者は以下のコードはビルドできません。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="n">IActivityManaager&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">am&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">ActivityManagerNative&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">getDefault&lt;/span>&lt;span class="p">();&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">try&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">Configuration&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">config&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">am&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">getConfiguration&lt;/span>&lt;span class="p">();&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">config&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">XXXX&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">YYYY&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">am&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">updateConfiguration&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">config&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">catch&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">RemoteException&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">e&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">e&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">printStackTrace&lt;/span>&lt;span class="p">();&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>以下のコードは、Locale を変更する方法を示しています。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="n">IActivityManager&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">am&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">ActivityManagerNative&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">getDefault&lt;/span>&lt;span class="p">();&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">Configuration&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">config&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">am&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">getConfiguration&lt;/span>&lt;span class="p">();&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">config&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">locale&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">locale&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">config&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">userSetLocale&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kc">true&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">am&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">updateConfiguration&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">config&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div></description></item><item><title>Android Nativeメモ: ServiceManager に登録されたサービスを列挙する</title><link>https://maku77.github.io/p/qn635m9/</link><pubDate>Mon, 09 May 2011 00:00:00 +0900</pubDate><guid>https://maku77.github.io/p/qn635m9/</guid><description>&lt;p>下記は、デバイス上の ServiceManager に登録されたサービスを列挙するためのプログラムです。
Android の make でビルドすると、&lt;strong>&lt;code>ListServices&lt;/code>&lt;/strong> という実行ファイルが生成されます。&lt;/p>

&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">main.cpp&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-cpp" data-lang="cpp">&lt;span class="line">&lt;span class="cl">&lt;span class="cp">#undef LOG_TAG
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cp">#define LOG_TAG &amp;#34;ListServices&amp;#34;
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cp">&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cp">#include&lt;/span> &lt;span class="cpf">&amp;lt;binder/IServiceManager.h&amp;gt;&lt;/span>&lt;span class="cp">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cp">#include&lt;/span> &lt;span class="cpf">&amp;lt;utils/Log.h&amp;gt;&lt;/span>&lt;span class="cp">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cp">#include&lt;/span> &lt;span class="cpf">&amp;lt;utils/RefBase.h&amp;gt;&lt;/span>&lt;span class="cp">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cp">#include&lt;/span> &lt;span class="cpf">&amp;lt;utils/Vector.h&amp;gt;&lt;/span>&lt;span class="cp">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cp">#include&lt;/span> &lt;span class="cpf">&amp;lt;utils/String16.h&amp;gt;&lt;/span>&lt;span class="cp">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cp">#include&lt;/span> &lt;span class="cpf">&amp;lt;utils/String8.h&amp;gt;&lt;/span>&lt;span class="cp">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cp">&lt;/span>&lt;span class="k">using&lt;/span> &lt;span class="k">namespace&lt;/span> &lt;span class="n">android&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">static&lt;/span> &lt;span class="kt">int&lt;/span> &lt;span class="nf">compareServiceName&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="k">const&lt;/span> &lt;span class="n">String16&lt;/span>&lt;span class="o">*&lt;/span> &lt;span class="n">lhs&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="k">const&lt;/span> &lt;span class="n">String16&lt;/span>&lt;span class="o">*&lt;/span> &lt;span class="n">rhs&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="o">*&lt;/span>&lt;span class="n">lhs&lt;/span> &lt;span class="o">&amp;gt;&lt;/span> &lt;span class="o">*&lt;/span>&lt;span class="n">rhs&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kt">int&lt;/span> &lt;span class="nf">main&lt;/span>&lt;span class="p">()&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">sp&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">IServiceManager&lt;/span>&lt;span class="o">&amp;gt;&lt;/span> &lt;span class="n">sm&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">defaultServiceManager&lt;/span>&lt;span class="p">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">Vector&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">String16&lt;/span>&lt;span class="o">&amp;gt;&lt;/span> &lt;span class="n">services&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">sm&lt;/span>&lt;span class="o">-&amp;gt;&lt;/span>&lt;span class="n">listServices&lt;/span>&lt;span class="p">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">size_t&lt;/span> &lt;span class="n">n&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">services&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">size&lt;/span>&lt;span class="p">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">LOGI&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;%d services have found&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">n&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">services&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">sort&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">compareServiceName&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">for&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">size_t&lt;/span> &lt;span class="n">i&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="mi">0&lt;/span>&lt;span class="p">;&lt;/span> &lt;span class="n">i&lt;/span> &lt;span class="o">&amp;lt;&lt;/span> &lt;span class="n">n&lt;/span>&lt;span class="p">;&lt;/span> &lt;span class="o">++&lt;/span>&lt;span class="n">i&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">LOGI&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;[%2d] %s&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">i&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="mi">1&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">String8&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">services&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="n">i&lt;/span>&lt;span class="p">]).&lt;/span>&lt;span class="n">string&lt;/span>&lt;span class="p">());&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>


&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">ListServices/Android.mk&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-makefile" data-lang="makefile">&lt;span class="line">&lt;span class="cl">&lt;span class="nv">LOCAL_PATH&lt;/span> &lt;span class="o">:=&lt;/span> &lt;span class="k">$(&lt;/span>call my-dir&lt;span class="k">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="err">include&lt;/span> &lt;span class="k">$(&lt;/span>&lt;span class="nv">CLEAR_VARS&lt;/span>&lt;span class="k">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv">LOCAL_MODULE&lt;/span> &lt;span class="o">:=&lt;/span> ListServices
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv">LOCAL_MODULE_TAGS&lt;/span> &lt;span class="o">:=&lt;/span> optional
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv">LOCAL_SRC_FILES&lt;/span> &lt;span class="o">:=&lt;/span> main.cpp
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv">LOCAL_SHARED_LIBRARIES&lt;/span> &lt;span class="o">:=&lt;/span> libcutils
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="err">include&lt;/span> &lt;span class="k">$(&lt;/span>&lt;span class="nv">BUILD_EXECUTABLE&lt;/span>&lt;span class="k">)&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>

&lt;p>&lt;code>m&lt;/code> コマンドなどで &lt;code>ListServices&lt;/code> をビルドしたら、デバイスに転送してシェル上で実行します。
下記のように、ServiceManager に登録されたサービスが列挙されます。&lt;/p>
&lt;pre tabindex="0">&lt;code># /system/bin/ListServices
04-28 16:38:47.108 1566 1566 I ListServices: 65 services have found
04-28 16:38:47.112 1566 1566 I ListServices: [ 1] SurfaceFlinger
04-28 16:38:47.112 1566 1566 I ListServices: [ 2] accessibility
04-28 16:38:47.112 1566 1566 I ListServices: [ 3] account
04-28 16:38:47.112 1566 1566 I ListServices: [ 4] activity
04-28 16:38:47.112 1566 1566 I ListServices: [ 5] alarm
...
&lt;/code>&lt;/pre></description></item><item><title>Android Nativeメモ: ネイティブサービスの実装 (3) サービスのインタフェースを定義する</title><link>https://maku77.github.io/p/33w8db9/</link><pubDate>Mon, 09 May 2011 00:00:00 +0900</pubDate><guid>https://maku77.github.io/p/33w8db9/</guid><description>&lt;h2 id="クライアント側のコードをすっきりさせたい">クライアント側のコードをすっきりさせたい&lt;/h2>
&lt;p>&lt;code>IBinder&lt;/code> クラスの &lt;code>transact()&lt;/code> インタフェースだけでサービスの機能にアクセスするのは分かりにくく、すべてのクライアントコードに本質的ではない &lt;code>Parcel&lt;/code> オブジェクトの生成コードが表れてしまいます。&lt;/p>

&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">例: CalcService を利用する煩雑なクライアントコード&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-cpp" data-lang="cpp">&lt;span class="line">&lt;span class="cl">&lt;span class="n">sp&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">IServiceManager&lt;/span>&lt;span class="o">&amp;gt;&lt;/span> &lt;span class="n">sm&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">defaultServiceManager&lt;/span>&lt;span class="p">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">sp&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">IBinder&lt;/span>&lt;span class="o">&amp;gt;&lt;/span> &lt;span class="n">binder&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">sm&lt;/span>&lt;span class="o">-&amp;gt;&lt;/span>&lt;span class="n">getService&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">String16&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;CalcService&amp;#34;&lt;/span>&lt;span class="p">));&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">Parcel&lt;/span> &lt;span class="n">data&lt;/span>&lt;span class="p">;&lt;/span> &lt;span class="c1">// Input
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="n">Parcel&lt;/span> &lt;span class="n">reply&lt;/span>&lt;span class="p">;&lt;/span> &lt;span class="c1">// Output
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="n">data&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">writeInt32&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">100&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">data&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">writeInt32&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">50&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">binder&lt;/span>&lt;span class="o">-&amp;gt;&lt;/span>&lt;span class="n">transact&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">data&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="o">&amp;amp;&lt;/span>&lt;span class="n">reply&lt;/span>&lt;span class="p">);&lt;/span> &lt;span class="c1">// Add function
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="n">LEGI&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;CalcService returns: %d&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">reply&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">readInt32&lt;/span>&lt;span class="p">());&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>

&lt;p>サービスのインタフェースを定義し、そのインタフェース経由で機能にアクセスできるようにすればクライアント側のコードがすっきりします。
Binder フレームワークには、このためのヘルパークラスなどが用意されていて、これらをうまく使用すると、以下のような感じで &lt;code>CalcService&lt;/code> にアクセスできるようになります。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-cpp" data-lang="cpp">&lt;span class="line">&lt;span class="cl">&lt;span class="n">sp&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">IServiceManager&lt;/span>&lt;span class="o">&amp;gt;&lt;/span> &lt;span class="n">sm&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">defaultServiceManager&lt;/span>&lt;span class="p">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">sp&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">IBinder&lt;/span>&lt;span class="o">&amp;gt;&lt;/span> &lt;span class="n">binder&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">sm&lt;/span>&lt;span class="o">-&amp;gt;&lt;/span>&lt;span class="n">getService&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">String16&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;CalcService&amp;#34;&lt;/span>&lt;span class="p">));&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">sp&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">ICalcService&lt;/span>&lt;span class="o">&amp;gt;&lt;/span> &lt;span class="n">calc&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">interface_cast&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">ICalcService&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">binder&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kt">int&lt;/span> &lt;span class="n">result&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">calc&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">add&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">100&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">50&lt;/span>&lt;span class="p">);&lt;/span> &lt;span class="c1">// すっきり！
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>簡単に言ってしまえば、&lt;code>IBinder&lt;/code> を直接使うのではなく、分かりやすいラッパークラスを用意してやりましょうということです。
&lt;code>interface_cast&lt;/code> というテンプレート関数は、&lt;code>IInterface.h&lt;/code> で定義されていて、上記のサンプルコードは以下のように展開されます。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-cpp" data-lang="cpp">&lt;span class="line">&lt;span class="cl">&lt;span class="n">sp&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">ICalcService&lt;/span>&lt;span class="o">&amp;gt;&lt;/span> &lt;span class="n">calc&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">interface_cast&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">ICalcService&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">binder&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="err">↓&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">sp&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">ICalcService&lt;/span>&lt;span class="o">&amp;gt;&lt;/span> &lt;span class="n">calc&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">ICalcService&lt;/span>&lt;span class="o">::&lt;/span>&lt;span class="n">asInterface&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">binder&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>要するに、&lt;code>ICalcService&lt;/code> には、&lt;code>IBinder&lt;/code> オブジェクトから &lt;code>ICalcService&lt;/code> オブジェクトを取得するための &lt;code>asInterface()&lt;/code> メソッドが定義されていないといけません。
最終的にクライアントに公開されるファイルは、サービスインタフェースである &lt;code>ICalcService.h&lt;/code> などのヘッダファイルと、その実装である &lt;code>ICalcService.so&lt;/code> などになるでしょう。&lt;/p>
&lt;h2 id="クライアントに公開するサービスインタフェースの実装">クライアントに公開するサービスインタフェースの実装&lt;/h2>
&lt;p>サービスのインタフェースは、&lt;code>IInterface&lt;/code> を継承して作成します。
例えば、サービスクラス &lt;code>CalcService&lt;/code> にアクセスするためのインタフェースは、&lt;code>ICalcService&lt;/code> という名前で作成し、ここに &lt;code>add()&lt;/code> や &lt;code>subtract()&lt;/code> などの分かりやすいアクセスメソッドを用意してやります。
&lt;code>IInterface.h&lt;/code> に定義されているマクロが、プレフィックスとして &lt;code>I&lt;/code> を付ける前提のコードになっているので、このように「&lt;code>I&lt;/code> + サービス名」というネーミングをしなければいけません。&lt;/p></description></item><item><title>Android Nativeメモ: ネイティブサービスの実装 (1) Binder 関連のクラス</title><link>https://maku77.github.io/p/ds6rhco/</link><pubDate>Wed, 27 Apr 2011 00:00:00 +0900</pubDate><guid>https://maku77.github.io/p/ds6rhco/</guid><description>&lt;h2 id="binder-関連クラス">Binder 関連クラス&lt;/h2>
&lt;p>Android のネイティブレイヤのサービスを実装するには、以下のような Binder 関連クラスを使用します。&lt;/p>
&lt;h3 id="継承構造">継承構造&lt;/h3>
&lt;ul>
&lt;li>&lt;strong>&lt;code>RefBase&lt;/code>&lt;/strong> &amp;hellip; 各種オブジェクトの生存期間を参照カウンタ
&lt;ul>
&lt;li>&lt;strong>&lt;code>IBinder&lt;/code>&lt;/strong> &amp;hellip; サービスの基底クラス。プロセス間通信の共通インタフェースとしても使われる。
&lt;ul>
&lt;li>&lt;strong>&lt;code>BpBinder&lt;/code>&lt;/strong> &amp;hellip; クライアント側のプロキシクラス（ServiceManager が自動的にインスタンスを生成する）&lt;/li>
&lt;li>&lt;strong>&lt;code>BBinder&lt;/code>&lt;/strong> &amp;hellip; サービスの基底クラス（基本的な実装を提供）
&lt;ul>
&lt;li>&lt;strong>&lt;code>BnInterface&lt;/code>&lt;/strong>&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>&lt;strong>&lt;code>IInterface&lt;/code>&lt;/strong> &amp;hellip; クライアントに提供するサービスインタフェースの基底クラス&lt;/li>
&lt;li>&lt;strong>&lt;code>BpRefBase&lt;/code>&lt;/strong>
&lt;ul>
&lt;li>&lt;strong>&lt;code>BpInterface&lt;/code>&lt;/strong> &amp;hellip; クライアントに提供するサービスインタフェースの実装&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;h3 id="ポイント">ポイント&lt;/h3>
&lt;ul>
&lt;li>(a) サービスクラスは &lt;code>BBinder&lt;/code> をサブクラス化して作成する。&lt;/li>
&lt;li>(b) サービスにアクセスするインタフェースは &lt;code>IInterface&lt;/code> をサブクラス化して作成する。&lt;/li>
&lt;li>(c) サービスにアクセスするインタフェースの実装は &lt;code>BpInterface&lt;/code> をサブクラス化して作成する。&lt;/li>
&lt;/ul>
&lt;p>(a) さえ準備してサービスを立ち上げれば、クライアントは &lt;code>IBinder&lt;/code> インタフェースでサービスにアクセスできるようになります。
(b)、(c) はまともなサービスインタフェースとしてクライアントに公開する場合に必要です。&lt;/p>
&lt;h3 id="ファイルのパス">ファイルのパス&lt;/h3>
&lt;ul>
&lt;li>クラス定義
&lt;ul>
&lt;li>frameworks/base/include/binder/Binder.h (&lt;code>BBinder&lt;/code>, &lt;code>BpRefBase&lt;/code>)&lt;/li>
&lt;li>frameworks/base/include/binder/BpBinder.h (&lt;code>BpBinder&lt;/code>)&lt;/li>
&lt;li>frameworks/base/include/binder/IBinder.h (&lt;code>IBinder&lt;/code>)&lt;/li>
&lt;li>frameworks/base/include/binder/IInterface.h (&lt;code>IInterface&lt;/code>, &lt;code>BnInterface&lt;/code>, &lt;code>BpInterface&lt;/code>)&lt;/li>
&lt;li>frameworks/base/include/utils/RefBase.h (&lt;code>RefBase&lt;/code>)&lt;/li>
&lt;li>frameworks/base/include/utils/StrongPointer.h (&lt;code>sp&lt;/code>)&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>実装
&lt;ul>
&lt;li>frameworks/base/libs/binder/BpBinder.cpp&lt;/li>
&lt;li>frameworks/base/libs/binder/IInterface.cpp&lt;/li>
&lt;li>frameworks/base/libs/utils/RefBase.cpp&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;h2 id="binder-関連クラスをざっと眺めてみる">Binder 関連クラスをざっと眺めてみる&lt;/h2>
&lt;h3 id="refbase">RefBase&lt;/h3>
&lt;p>&lt;code>RefBase&lt;/code> クラスは、すべての Binder 関連クラスの基底クラスで、インスタンスの生存期間をリファレンスカウンタで管理しています。&lt;/p></description></item><item><title>Android Nativeメモ: ネイティブサービスの実装 (2) サービスの実装から利用まで</title><link>https://maku77.github.io/p/edjwtcr/</link><pubDate>Wed, 27 Apr 2011 00:00:00 +0900</pubDate><guid>https://maku77.github.io/p/edjwtcr/</guid><description>&lt;h2 id="サービスの実装">サービスの実装&lt;/h2>
&lt;p>サービスとなるクラスは &lt;code>IBinder&lt;/code> で定義されたインタフェースを実装する必要があります。
&lt;code>IBinder&lt;/code> を直接実装しようとすると、多くの abstract メソッドを実装しないといけませんが、基本的な実装を提供している &lt;code>BBinder&lt;/code> クラスを継承してサービスを作成すれば、最低限のインタフェースを実装するだけで済みます。&lt;/p>
&lt;p>一番重要なメソッドは、サービスの機能を提供する &lt;code>onTransact()&lt;/code> メソッドです。
例えば、計算を行うためのサービス &lt;code>CalcService&lt;/code> を考えます。&lt;/p>

&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">CalcService.h&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-cpp" data-lang="cpp">&lt;span class="line">&lt;span class="cl">&lt;span class="cp">#include&lt;/span> &lt;span class="cpf">&amp;lt;binder/Binder.h&amp;gt;&lt;/span>&lt;span class="cp">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cp">&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">class&lt;/span> &lt;span class="nc">CalcService&lt;/span> &lt;span class="o">:&lt;/span> &lt;span class="k">public&lt;/span> &lt;span class="n">android&lt;/span>&lt;span class="o">::&lt;/span>&lt;span class="n">BBinder&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">public&lt;/span>&lt;span class="o">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">virtual&lt;/span> &lt;span class="n">status_t&lt;/span> &lt;span class="n">onTransact&lt;/span>&lt;span class="p">(&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kt">uint32_t&lt;/span> &lt;span class="n">code&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="c1">// 処理内容分岐のための ID
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="k">const&lt;/span> &lt;span class="n">android&lt;/span>&lt;span class="o">::&lt;/span>&lt;span class="n">Parcel&lt;/span>&lt;span class="o">&amp;amp;&lt;/span> &lt;span class="n">data&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="c1">// 入力値
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="n">android&lt;/span>&lt;span class="o">::&lt;/span>&lt;span class="n">Parcel&lt;/span>&lt;span class="o">*&lt;/span> &lt;span class="n">reply&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="c1">// 戻り値
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="kt">uint32_t&lt;/span> &lt;span class="n">flags&lt;/span> &lt;span class="c1">// 戻り値が必要かどうかなどを示すフラグ
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">virtual&lt;/span> &lt;span class="o">~&lt;/span>&lt;span class="n">CalcService&lt;/span>&lt;span class="p">()&lt;/span> &lt;span class="p">{}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">};&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>

&lt;p>クライアントからの入力値は &lt;code>data&lt;/code> パラメータで受け取り、クライアントへの戻り値は &lt;code>reply&lt;/code> パラメータに格納します。
この &lt;code>CalcService&lt;/code> に複数の機能（足し算、引き算など）を持たせたい場合は、&lt;code>onTransact()&lt;/code> メソッドの第一引数で渡される &lt;code>code&lt;/code>（int 値）をもとに処理を分岐させます。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-cpp" data-lang="cpp">&lt;span class="line">&lt;span class="cl">&lt;span class="n">status_t&lt;/span> &lt;span class="n">CalcService&lt;/span>&lt;span class="o">::&lt;/span>&lt;span class="n">onTransact&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="kt">uint32_t&lt;/span> &lt;span class="n">code&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="k">const&lt;/span> &lt;span class="n">Parcel&lt;/span>&lt;span class="o">&amp;amp;&lt;/span> &lt;span class="n">data&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">Parcel&lt;/span>&lt;span class="o">*&lt;/span> &lt;span class="n">reply&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="kt">uint32_t&lt;/span> &lt;span class="n">flags&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">switch&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">code&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">case&lt;/span> &lt;span class="mi">0&lt;/span>&lt;span class="o">:&lt;/span> &lt;span class="c1">// Add function
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kt">int&lt;/span> &lt;span class="n">a&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">data&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">readInt32&lt;/span>&lt;span class="p">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kt">int&lt;/span> &lt;span class="n">b&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">data&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">readInt32&lt;/span>&lt;span class="p">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">reply&lt;/span>&lt;span class="o">-&amp;gt;&lt;/span>&lt;span class="n">writeInt32&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">a&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="n">b&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">break&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">case&lt;/span> &lt;span class="mi">1&lt;/span>&lt;span class="o">:&lt;/span> &lt;span class="c1">// Subtract function
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kt">int&lt;/span> &lt;span class="n">a&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">data&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">readInt32&lt;/span>&lt;span class="p">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kt">int&lt;/span> &lt;span class="n">b&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">data&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">readInt32&lt;/span>&lt;span class="p">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">reply&lt;/span>&lt;span class="o">-&amp;gt;&lt;/span>&lt;span class="n">writeInt32&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">a&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">b&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">break&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">default&lt;/span>&lt;span class="o">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="n">BBinder&lt;/span>&lt;span class="o">::&lt;/span>&lt;span class="n">onTransact&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">code&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">data&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">reply&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">flags&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="n">NO_ERROR&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>正確には &lt;code>IBinder::transact()&lt;/code> メソッドがサービスクラスの実装すべき API なのですが、&lt;code>BBinder&lt;/code> クラスの &lt;code>IBinder::transact()&lt;/code> の実装の内部で &lt;code>onTransact()&lt;/code> を呼び出すようになっているので、&lt;code>BBinder&lt;/code> を継承してサービスを実装する場合は、&lt;code>onTransact()&lt;/code> メソッドを実装すればよいことになります。&lt;/p></description></item><item><title>Androidメモ: サービスからコールバックできるようにする</title><link>https://maku77.github.io/p/z2oqmoj/</link><pubDate>Mon, 25 Apr 2011 00:00:00 +0900</pubDate><guid>https://maku77.github.io/p/z2oqmoj/</guid><description>&lt;p>ここでは、別プロセスで動いているサービスにバインドし、そのサービスに対してコールバックを登録できるようにする方法を説明します。
サービスからのコールバックの仕組みを実現するには、以下のような実装が必要です。&lt;/p>
&lt;ul>
&lt;li>サービス側にコールバックを登録する実装&lt;/li>
&lt;li>サービス側からコールバックする実装&lt;/li>
&lt;li>コールバックを登録するクライアント側の実装&lt;/li>
&lt;li>コールバックされたときのクライアント側の実装&lt;/li>
&lt;/ul>
&lt;h2 id="aidl-ファイルを作成する">AIDL ファイルを作成する&lt;/h2>
&lt;p>2つの AIDL ファイルで以下のインタフェースを定義します。&lt;/p>
&lt;ul>
&lt;li>&lt;code>IEchoServiceListener.aidl&lt;/code>（コールバック用のインタフェース）&lt;/li>
&lt;li>&lt;code>IEchoService.aidl&lt;/code>（サービスのコールバック登録用 API）&lt;/li>
&lt;/ul>
&lt;p>AIDL ファイルから生成されるインタフェース（Java ファイル）は、クライアント側とサービス側の両方で共通のものを使用します。&lt;/p>

&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">IEchoServiceListener.aidl&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="kn">package&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nn">com.example.hello&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="kd">interface&lt;/span> &lt;span class="nc">IEchoServiceListener&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kt">void&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nf">onReceiveMessage&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">String&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">message&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>


&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">IEchoService.aidl&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="kn">package&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nn">com.example.hello&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="kn">import&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nn">com.example.hello.IEchoServiceListener&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="kd">interface&lt;/span> &lt;span class="nc">IEchoService&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kt">void&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nf">addListener&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">IEchoServiceListener&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">listener&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kt">void&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nf">removeListener&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">IEchoServiceListener&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">listener&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kt">void&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nf">hello&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">String&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">name&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>

&lt;p>&lt;code>IEchoServiceListener&lt;/code> は同じパッケージに定義されていますが、AIDL ファイル内では import 宣言が必要です。&lt;/p>
&lt;h2 id="サービス側を実装する">サービス側を実装する&lt;/h2>
&lt;p>サービス側で、コールバックを登録／解除するためのメソッドを実装します。
ここでは簡単のため、クライアント側から &lt;code>hello()&lt;/code> メソッドを呼び出したときに、すぐにコールバックするように実装しています。&lt;/p>

&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">EchoService.java&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="kn">package&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nn">com.example.hello&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="kn">import&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nn">android.app.Service&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="kn">import&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nn">android.content.Intent&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="kn">import&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nn">android.os.IBinder&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="kn">import&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nn">android.os.RemoteCallbackList&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="kn">import&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nn">android.os.RemoteException&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="kd">public&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kd">class&lt;/span> &lt;span class="nc">EchoService&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kd">extends&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Service&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kd">private&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">RemoteCallbackList&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">IEchoServiceListener&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">listeners&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">new&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">RemoteCallbackList&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">IEchoServiceListener&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="p">();&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kd">private&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kd">final&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">IEchoService&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">Stub&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">mBinder&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">new&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">IEchoService&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">Stub&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nd">@Override&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kd">public&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kt">void&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nf">addListener&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">IEchoServiceListener&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">listener&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kd">throws&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">RemoteException&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">listeners&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">register&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">listener&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nd">@Override&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kd">public&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kt">void&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nf">removeListener&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">IEchoServiceListener&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">listener&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kd">throws&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">RemoteException&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">listeners&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">unregister&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">listener&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nd">@Override&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kd">public&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kt">void&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nf">hello&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">String&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">name&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kd">throws&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">RemoteException&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kt">int&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">n&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">listeners&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">beginBroadcast&lt;/span>&lt;span class="p">();&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">for&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="kt">int&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">i&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">0&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">i&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">n&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">i&lt;/span>&lt;span class="o">++&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">try&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">listeners&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">getBroadcastItem&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">i&lt;/span>&lt;span class="p">).&lt;/span>&lt;span class="na">onReceiveMessage&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;Hello, &amp;#34;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">+&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">name&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">catch&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">RemoteException&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">e&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">// The RemoteCallbackList will take care of removing&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">// the dead object for us. We can ignore this exception.&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">listeners&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">finishBroadcast&lt;/span>&lt;span class="p">();&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">};&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nd">@Override&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kd">public&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">IBinder&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nf">onBind&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">Intent&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">intent&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">return&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">mBinder&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>

&lt;p>コールバックを管理するためのユーティリティクラスとして、&lt;code>android.os.RemoteCallbackList&lt;/code> が用意されています。&lt;/p></description></item><item><title>Androidメモ: 別プロセスのサービスへバインドする (Remote Bind)</title><link>https://maku77.github.io/p/qjc27rj/</link><pubDate>Thu, 21 Apr 2011 00:00:00 +0900</pubDate><guid>https://maku77.github.io/p/qjc27rj/</guid><description>&lt;p>別のプロセスで動いているサービスに対してバインドを実行するには、サービス側とクライアント側でプロセス間通信 (IPC) を行う必要があります。&lt;/p>
&lt;ul>
&lt;li>参考: &lt;a href="https://developer.android.com/reference/android/app/Service.html#RemoteMessengerServiceSample">Service - Android Developers&lt;/a>&lt;/li>
&lt;/ul>
&lt;h2 id="aidl-で-ipc-用スタブを自動生成する">AIDL で IPC 用スタブを自動生成する&lt;/h2>
&lt;p>プロセス間通信を実現するためのスタブクラスのひな型を自動生成するために、Android では AIDL という言語を使用します。&lt;/p>
&lt;p>例えば、&lt;code>echo&lt;/code> メソッドを提供する &lt;code>EchoService&lt;/code> にアクセスするための AIDL は以下のようになります。
&lt;code>EchoService&lt;/code> が公開するインタフェースを表しているので、頭文字に &lt;code>I&lt;/code> をつけて、&lt;code>IEchoService&lt;/code> というインタフェース名にしています。
クライアント側から見ると、サービス名は &lt;code>IEchoService&lt;/code> として見えるようになります。&lt;/p>

&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">IEchoService.aidl&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="kn">package&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nn">com.example.hello&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="kd">interface&lt;/span> &lt;span class="nc">IEchoService&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">String&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nf">echo&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">String&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">message&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>

&lt;p>ADT プラグインのインストールされた Eclipse を使っている場合は、この AIDL ファイルをソースファイルと同じディレクトリ入れると、自動的に Java ファイルが生成されます。&lt;/p>
&lt;ul>
&lt;li>&lt;code>src/com/example/hello/IEchoService.aidl&lt;/code>（手書きで作成する AIDL ファイル）&lt;/li>
&lt;li>&lt;code>gen/com/example/hello/IEchoService.java&lt;/code>（自動生成される Java ファイル）&lt;/li>
&lt;/ul>
&lt;p>自動生成される &lt;code>IEchoService.java&lt;/code> の内容は以下のようになっています。&lt;/p>

&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">IEchoService.java（自動生成）&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="kn">package&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nn">com.example.hello&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="kd">public&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kd">interface&lt;/span> &lt;span class="nc">IEchoService&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kd">extends&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">android&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">os&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">IInterface&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kd">public&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kd">static&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kd">abstract&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kd">class&lt;/span> &lt;span class="nc">Stub&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kd">extends&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">android&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">os&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">Binder&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kd">implements&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">com&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">example&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">hello&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">IEchoService&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">...&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">...&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>

&lt;h2 id="バインド先のサービスを実装する">バインド先のサービスを実装する&lt;/h2>
&lt;p>サービス本体の実装では、&lt;code>onBind&lt;/code> メソッドで適切な &lt;code>IBinder&lt;/code> オブジェクトを返す必要があります。
AIDL から自動生成された &lt;code>IEchoService.java&lt;/code> ファイルで、&lt;code>IBinder&lt;/code> オブジェクトのひな型となる &lt;code>Stub&lt;/code> のサブクラスが定義されているので、この &lt;code>Stub&lt;/code> クラスを実装するだけで、プロセス間通信に対応した &lt;code>Binder&lt;/code> クラスが完成します。
実装しなければいけないメソッドは、AIDL で定義した公開 API です。&lt;/p></description></item><item><title>Androidメモ: 同じプロセス内のサービスへバインドする (Local Bind)</title><link>https://maku77.github.io/p/mavfgi7/</link><pubDate>Thu, 21 Apr 2011 00:00:00 +0900</pubDate><guid>https://maku77.github.io/p/mavfgi7/</guid><description>&lt;p>Android で同じプロセス内（主に同じアプリ内）のサービスに対してバインドする場合は、&lt;code>bindService&lt;/code> メソッドを使用して比較的簡単にバインドを実行することができます。
&lt;a href="../p/qjc27rj/">別プロセスで動作するサービスへのバインド&lt;/a>とは異なり、AIDL を使った &lt;code>Binder&lt;/code> のスタブ作成などは必要はありません。&lt;/p>
&lt;ul>
&lt;li>参考 &lt;a href="https://developer.android.com/reference/android/app/Service.html#LocalServiceSample">Service - Android Developers&lt;/a>&lt;/li>
&lt;/ul>
&lt;h2 id="バインド先のサービスを実装する">バインド先のサービスを実装する&lt;/h2>
&lt;p>ここでは、&lt;code>EchoService&lt;/code> というサービスを作成します。
&lt;code>EchoService&lt;/code> は、文字列を返す簡単な echo API を提供します。&lt;/p>
&lt;p>サービスにバインドできるようにするには、サービスの &lt;code>onBind&lt;/code> メソッドで適切な &lt;code>IBinder&lt;/code> オブジェクトを返す必要があります。
ローカルプロセス内のバインドでは、特にプロセス間通信などは必要ないので、ここでは、単純に &lt;code>Binder&lt;/code> クラスを継承したクラス (&lt;code>LocalBinder&lt;/code>) を作成しています。
クライアント側ではバインドが成功したときに、このオブジェクトを取得することになります。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="kn">package&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nn">com.example.hello&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="kn">import&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nn">android.app.Service&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="kn">import&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nn">android.content.Intent&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="kn">import&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nn">android.os.Binder&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="kn">import&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nn">android.os.IBinder&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="kd">public&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kd">class&lt;/span> &lt;span class="nc">EchoService&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kd">extends&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Service&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kd">private&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kd">final&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">IBinder&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">mBinder&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">new&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">LocalBinder&lt;/span>&lt;span class="p">();&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nd">@Override&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kd">public&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">IBinder&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nf">onBind&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">Intent&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">intent&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">return&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">mBinder&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kd">public&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">String&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nf">echo&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">String&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">message&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">return&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s">&amp;#34;EchoService: &amp;#34;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">+&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">message&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="cm">/**
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cm"> * Class for clients to access.
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cm"> * Since we know this service always runs in the same process
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cm"> * as its clients, we don&amp;#39;t need to deal with IPC.
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cm"> */&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kd">public&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kd">class&lt;/span> &lt;span class="nc">LocalBinder&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kd">extends&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Binder&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">EchoService&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nf">getService&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">return&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">EchoService&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">this&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>独自のサービスを作成したら、忘れずに &lt;code>AndroidManifest.xml&lt;/code> にエントリを追加しておきます。&lt;/p></description></item><item><title>Androidベンダー向けメモ: android/build/core 以下の *.mk ファイルで定義されている関数 (define) のリスト</title><link>https://maku77.github.io/p/7zgfhqz/</link><pubDate>Fri, 08 Apr 2011 00:00:00 +0900</pubDate><guid>https://maku77.github.io/p/7zgfhqz/</guid><description>&lt;p>下記の bash スクリプトを &lt;code>android/build/core&lt;/code> 以下で実行すると、Android の &lt;code>Makefile&lt;/code> (&lt;code>.mk&lt;/code>) 用に定義されている関数を一覧で取得できます。
Android が定義している関数はハイフンを単語区切りにしているみたいです。&lt;/p>

&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">list_defines.sh&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">&lt;span class="cp">#!/bin/bash
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cp">&lt;/span>find -name &lt;span class="s1">&amp;#39;*.mk&amp;#39;&lt;/span> -o -name &lt;span class="s1">&amp;#39;Makefile&amp;#39;&lt;/span> &lt;span class="p">|&lt;/span> xargs grep &lt;span class="s1">&amp;#39;^define &amp;#39;&lt;/span> &lt;span class="p">|&lt;/span> sed &lt;span class="s1">&amp;#39;s/^\(.\+\):\(.\+\)/\2 ... \1/&amp;#39;&lt;/span> &lt;span class="p">|&lt;/span> sort &lt;span class="p">|&lt;/span> uniq&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>


&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">実行結果&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-console" data-lang="console">&lt;span class="line">&lt;span class="cl">&lt;span class="gp">$&lt;/span> &lt;span class="nb">cd&lt;/span> android/build/core
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="gp">$&lt;/span> ./list_defines.sh
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="err">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="err">&lt;/span>&lt;span class="go">define add-assets-to-package ... ./definitions.mk
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">define _add-clean-step ... ./cleanbuild.mk
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">define add-clean-step ... ./cleanbuild.mk
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">define add-dependency ... ./definitions.mk
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">define add-dex-to-package ... ./definitions.mk
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">define add-java-resources-to-package ... ./definitions.mk
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">define add-jni-shared-libs-to-package ... ./definitions.mk
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">define add-prebuilt-file ... ./definitions.mk
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">define add-prebuilt-files ... ./definitions.mk
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">define add-radio-file ... ./definitions.mk
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">define add-radio-file-internal ... ./definitions.mk
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">define add-required-deps ... ./main.mk
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">define align-package ... ./definitions.mk
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">define all-c-files-under ... ./definitions.mk
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">define all-Iaidl-files-under ... ./definitions.mk
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">define all-java-files-under ... ./definitions.mk
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">define all-makefiles-under ... ./definitions.mk
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">define all-named-subdir-makefiles ... ./definitions.mk
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">define all-proto-files-under ... ./definitions.mk
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">define all-subdir-c-files ... ./definitions.mk
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">define all-subdir-html-files ... ./definitions.mk
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">define all-subdir-Iaidl-files ... ./definitions.mk
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">define all-subdir-java-files ... ./definitions.mk
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">define all-subdir-makefiles ... ./definitions.mk
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">define append-path ... ./definitions.mk
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">define assert-max-file-size ... ./definitions.mk
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">define assert-max-image-size ... ./definitions.mk
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">define auto-prebuilt-boilerplate ... ./multi_prebuilt.mk
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">define build-systemimage-target ... ./Makefile
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">define build-systemtarball-target ... ./Makefile
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">define build-userdataimage-target ... ./Makefile
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">define build-userdatatarball-target ... ./Makefile
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">define check-all-products ... ./product.mk
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">define check-api ... ./tasks/apicheck.mk
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">define clear-var-list ... ./node_fns.mk
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">define collapse-pairs ... ./definitions.mk
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">define combine-notice-files ... ./Makefile
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">define copy-file-to-new-target ... ./definitions.mk
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">define copy-file-to-new-target-with-cp ... ./definitions.mk
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">define copy-file-to-target ... ./definitions.mk
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">define copy-file-to-target-strip-comments ... ./definitions.mk
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">define copy-file-to-target-with-cp-and-permissions ... ./definitions.mk
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">define copy-file-to-target-with-cp ... ./definitions.mk
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">define copy-file-to-target-with-permissions ... ./definitions.mk
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">define copy-file-to-target-with-zipalign ... ./definitions.mk
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">define copy-one-dist-file ... ./distdir.mk
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">define copy-one-file ... ./definitions.mk
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">define copy-one-header ... ./definitions.mk
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">define copy-testcase-apk ... ./tasks/cts.mk
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">define copy-var-list ... ./node_fns.mk
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">define create-empty-package ... ./definitions.mk
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">define create-java-proto-rule ... ./definitions.mk
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">define create-resource-java-files ... ./definitions.mk
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">define default-locale-language ... ./Makefile
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">define default-locale ... ./Makefile
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">define default-locale-region ... ./Makefile
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">define dist-for-goals ... ./distdir.mk
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">define doc-timestamp-for ... ./definitions.mk
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">define dump-device ... ./device.mk
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">define dump-devices ... ./device.mk
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">define dump-module-variables ... ./definitions.mk
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">define dump-product ... ./product.mk
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">define dump-products ... ./product.mk
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">define dump-words-to-file ... ./definitions.mk
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">define emit-line ... ./definitions.mk
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">define _expand-inherited-values ... ./node_fns.mk
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">define extract-and-include-whole-static-libs ... ./definitions.mk
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">define _find-android-products-files ... ./product.mk
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">define find-copy-subdir-files ... ./product_config.mk
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">define find-other-html-files ... ./definitions.mk
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">define find-other-java-files ... ./definitions.mk
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">define find-parent-file ... ./definitions.mk
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">define find-subdir-assets ... ./definitions.mk
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">define find-subdir-files ... ./definitions.mk
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">define find-subdir-subdir-files ... ./definitions.mk
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">define first-makefiles-under ... ./definitions.mk
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">define generate-core-test-description ... ./tasks/cts.mk
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">define get-all-product-makefiles ... ./product.mk
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">define get-file-size ... ./combo/darwin-x86.mk
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">define get-file-size ... ./combo/linux-x86.mk
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">define get-file-size ... ./combo/windows-x86.mk
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">define get-inherited-nodes ... ./node_fns.mk
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">define _get-package-overrides ... ./definitions.mk
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">define get-package-overrides ... ./definitions.mk
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">define get-tagged-modules ... ./definitions.mk
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">define image-size-from-data-size ... ./definitions.mk
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">define import-devices ... ./device.mk
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">define _import-node ... ./node_fns.mk
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">define _import-nodes-inner ... ./node_fns.mk
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">define import-nodes ... ./node_fns.mk
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">define import-products ... ./product.mk
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">define include-path-for ... ./pathmap.mk
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">define include-prebuilt ... ./definitions.mk
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">define inherit-device ... ./device.mk
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">define inherit-product ... ./product.mk
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">define insert-liblog ... ./binary.mk
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">define install-dex-debug ... ./definitions.mk
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">define intermediates-dir-for ... ./definitions.mk
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">define is-c-identifier ... ./product_config.mk
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">define _java-lib-classes.jar ... ./definitions.mk
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">define _java-lib-dep ... ./definitions.mk
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">define java-lib-deps ... ./definitions.mk
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">define _java-lib-dir ... ./definitions.mk
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">define java-lib-files ... ./definitions.mk
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">define _java-lib-full-classes.jar ... ./definitions.mk
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">define _java-lib-full-dep ... ./definitions.mk
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">define local-intermediates-dir ... ./definitions.mk
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">define module-built-files ... ./definitions.mk
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">define module-installed-files ... ./definitions.mk
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">define module-names-for-tag-list ... ./definitions.mk
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">define modules-for-tag-list ... ./definitions.mk
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">define module-stubs-files ... ./definitions.mk
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">define move-var-list ... ./node_fns.mk
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">define my-dir ... ./definitions.mk
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">define normalize-host-libraries ... ./definitions.mk
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">define normalize-libraries ... ./definitions.mk
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">define normalize-path-list ... ./definitions.mk
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">define normalize-target-libraries ... ./definitions.mk
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">define obfuscate-jar ... ./definitions.mk
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">define package_files-copy-root ... ./Makefile
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">define prepare-doc-source-list ... ./droiddoc.mk
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">define pretty ... ./definitions.mk
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">define print-vars ... ./definitions.mk
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">define _resolve-short-device-name ... ./device.mk
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">define resolve-short-device-name ... ./device.mk
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">define _resolve-short-product-name ... ./product.mk
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">define resolve-short-product-name ... ./product.mk
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">define select-android-config-h ... ./config.mk
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">define should-install-to-system ... ./main.mk
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">define sign-package ... ./definitions.mk
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">define sign-package-full ... ./definitions.mk
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">define tranform-host-m-to-o ... ./definitions.mk
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">define transform-aidl-to-java ... ./definitions.mk
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">define transform-classes.jar-to-dex ... ./definitions.mk
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">define transform-classes.jar-to-emma ... ./definitions.mk
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">define transform-c-or-s-to-o-no-deps ... ./definitions.mk
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">define transform-cpp-to-o ... ./definitions.mk
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">define transform-c-to-o ... ./definitions.mk
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">define transform-c-to-o-no-deps ... ./definitions.mk
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">define transform-d-to-p ... ./definitions.mk
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">define transform-generated-source ... ./definitions.mk
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">define transform-host-c-or-s-to-o-no-deps ... ./definitions.mk
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">define transform-host-cpp-to-o ... ./definitions.mk
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">define transform-host-c-to-o ... ./definitions.mk
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">define transform-host-c-to-o-no-deps ... ./definitions.mk
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">define transform-host-java-to-package ... ./definitions.mk
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">define transform-host-m-to-o-no-deps ... ./definitions.mk
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">define transform-host-o-to-executable ... ./definitions.mk
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">define transform-host-o-to-executable-inner ... ./combo/darwin-x86.mk
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">define transform-host-o-to-executable-inner ... ./definitions.mk
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">define transform-host-o-to-package ... ./definitions.mk
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">define transform-host-o-to-shared-lib ... ./definitions.mk
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">define transform-host-o-to-shared-lib-inner ... ./combo/darwin-x86.mk
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">define transform-host-o-to-shared-lib-inner ... ./definitions.mk
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">define transform-host-o-to-static-lib ... ./definitions.mk
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">define transform-host-ranlib-copy-hack ... ./definitions.mk
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">define transform-host-s-to-o ... ./definitions.mk
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">define transform-host-s-to-o-no-deps ... ./definitions.mk
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">define transform-java-to-classes.jar ... ./definitions.mk
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">define transform-l-to-cpp ... ./definitions.mk
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">define transform-m-to-o ... ./definitions.mk
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">define transform-m-to-o-no-deps ... ./definitions.mk
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">&lt;/span>&lt;span class="go">define transform-o-to-executable ... ./definitions.mk
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">define transform-o-to-executable-inner ... ./combo/darwin-x86.mk
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">define transform-o-to-executable-inner ... ./combo/linux-arm.mk
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">define transform-o-to-executable-inner ... ./combo/target_linux-fishtank.mk
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">define transform-o-to-executable-inner ... ./combo/target_linux-x86.mk
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">define transform-o-to-executable-inner ... ./definitions.mk
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">define transform-o-to-package ... ./definitions.mk
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">define transform-o-to-shared-lib ... ./definitions.mk
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">define transform-o-to-shared-lib-inner ... ./combo/darwin-x86.mk
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">define transform-o-to-shared-lib-inner ... ./combo/linux-arm.mk
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">define transform-o-to-shared-lib-inner ... ./combo/target_linux-fishtank.mk
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">define transform-o-to-shared-lib-inner ... ./combo/target_linux-x86.mk
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">define transform-o-to-shared-lib-inner ... ./definitions.mk
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">define transform-o-to-static-executable ... ./definitions.mk
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">define transform-o-to-static-executable-inner ... ./combo/darwin-x86.mk
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">define transform-o-to-static-executable-inner ... ./combo/linux-arm.mk
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">define transform-o-to-static-executable-inner ... ./combo/target_linux-fishtank.mk
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">define transform-o-to-static-executable-inner ... ./combo/target_linux-x86.mk
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">define transform-o-to-static-executable-inner ... ./definitions.mk
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">define transform-o-to-static-lib ... ./definitions.mk
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">define transform-prebuilt-to-target ... ./definitions.mk
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">define transform-prebuilt-to-target-strip-comments ... ./definitions.mk
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">define transform-prebuilt-to-target-with-zipalign ... ./definitions.mk
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">define transform-proto-to-cpp ... ./definitions.mk
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">define transform-ranlib-copy-hack ... ./definitions.mk
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">define transform-s-to-o ... ./definitions.mk
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">define transform-s-to-o-no-deps ... ./definitions.mk
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">define transform-to-prelinked ... ./definitions.mk
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">define transform-to-stripped ... ./definitions.mk
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">define transform-variables ... ./definitions.mk
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">define transform-y-to-cpp ... ./definitions.mk
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">define true-or-empty ... ./definitions.mk
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">define uniq-word ... ./node_fns.mk
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">define unzip-jar-files ... ./definitions.mk
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">define word-color ... ./definitions.mk
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure></description></item><item><title>Androidベンダー向けメモ: インストールされた各 APK パッケージに割り当てられたユーザー ID を調べる (packages.xml)</title><link>https://maku77.github.io/p/okshfzt/</link><pubDate>Tue, 05 Apr 2011 00:00:00 +0900</pubDate><guid>https://maku77.github.io/p/okshfzt/</guid><description>&lt;p>&lt;code>/data/system/packages.xml&lt;/code> ファイルを見ると、各 APK に割り当てられているユーザー ID を調べることができます。&lt;/p>

&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">/data/system/packages.xml&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-xml" data-lang="xml">&lt;span class="line">&lt;span class="cl">&lt;span class="nt">&amp;lt;package&lt;/span> &lt;span class="na">name=&lt;/span>&lt;span class="s">&amp;#34;com.example.history&amp;#34;&lt;/span> &lt;span class="na">codePath=&lt;/span>&lt;span class="s">&amp;#34;/system/app/History.apk&amp;#34;&lt;/span> &lt;span class="na">system=&lt;/span>&lt;span class="s">&amp;#34;true&amp;#34;&lt;/span> &lt;span class="na">ts=&lt;/span>&lt;span class="s">&amp;#34;1301918167000&amp;#34;&lt;/span> &lt;span class="na">version=&lt;/span>&lt;span class="s">&amp;#34;7&amp;#34;&lt;/span> &lt;span class="na">userId=&lt;/span>&lt;span class="s">&amp;#34;10006&amp;#34;&lt;/span>&lt;span class="nt">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;lt;sigs&lt;/span> &lt;span class="na">count=&lt;/span>&lt;span class="s">&amp;#34;1&amp;#34;&lt;/span>&lt;span class="nt">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;lt;cert&lt;/span> &lt;span class="na">index=&lt;/span>&lt;span class="s">&amp;#34;3&amp;#34;&lt;/span> &lt;span class="nt">/&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;lt;/sigs&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nt">&amp;lt;/package&amp;gt;&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure></description></item><item><title>Android Nativeメモ: ネイティブライブラリ (.so) の展開先</title><link>https://maku77.github.io/p/9dzwawd/</link><pubDate>Thu, 31 Mar 2011 00:00:00 +0900</pubDate><guid>https://maku77.github.io/p/9dzwawd/</guid><description>&lt;p>Android 1.5 から JNI 呼び出しで用いる共有ライブラリ (&lt;code>.so&lt;/code>) は、APK の作成時に自動的にパッケージングされるようになりました。&lt;/p>
&lt;ul>
&lt;li>共有ライブラリはアプリ (&lt;code>.apk&lt;/code>) をインストールするときに、自動的に &lt;code>/data/data/&amp;lt;package&amp;gt;/lib&lt;/code> に展開される。&lt;/li>
&lt;li>アプリ起動時に &lt;code>/data/data/&amp;lt;package&amp;gt;/lib&lt;/code> の下の共有ライブラリ (&lt;code>.so&lt;/code>) は動的にロードできるようパスが通される。&lt;/li>
&lt;li>アプリのアンインストール時には共有ライブラリは自動的に削除される。&lt;/li>
&lt;/ul></description></item><item><title>Android Nativeメモ: C++ 実装用のスマートポインタ (RefBase, sp) を使用する</title><link>https://maku77.github.io/p/w48omg6/</link><pubDate>Thu, 03 Feb 2011 00:00:00 +0900</pubDate><guid>https://maku77.github.io/p/w48omg6/</guid><description>&lt;p>Android フレームワークの &lt;code>android/frameworks/base/include/utils/RefBase.h&lt;/code> にスマートポインタクラス &lt;strong>&lt;code>sp&lt;/code>&lt;/strong> が定義されてます。
使い方は、&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-cpp" data-lang="cpp">&lt;span class="line">&lt;span class="cl">&lt;span class="n">sp&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">Hoge&lt;/span>&lt;span class="o">&amp;gt;&lt;/span> &lt;span class="n">hoge&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="k">new&lt;/span> &lt;span class="n">Hoge&lt;/span>&lt;span class="p">();&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>のような感じで、&lt;code>hoge&lt;/code> がスコープを外れると自動的にデストラクタを呼んでくれます。
&lt;code>sp&lt;/code> はリファレンスカウンタを持っているので、&lt;code>sp&lt;/code> オブジェクト間で代入処理 (&lt;code>operator=&lt;/code>) を行っても大丈夫です（代入した瞬間に &lt;code>delete&lt;/code> されてしまうことはない）。&lt;/p>
&lt;p>スマートポインタとして扱えるようにするクラスは、以下のように &lt;strong>&lt;code>RefBase&lt;/code>&lt;/strong> を継承して作成する必要があります。
これは、&lt;code>RefBase&lt;/code> が参照カウンタなどを実装しているからです。&lt;/p>

&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">Hoge.h&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-cpp" data-lang="cpp">&lt;span class="line">&lt;span class="cl">&lt;span class="cp">#include&lt;/span> &lt;span class="cpf">&amp;lt;utils/RefBase.h&amp;gt;&lt;/span>&lt;span class="cp">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cp">&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">class&lt;/span> &lt;span class="nc">Hoge&lt;/span> &lt;span class="o">:&lt;/span> &lt;span class="k">public&lt;/span> &lt;span class="k">virtual&lt;/span> &lt;span class="n">RefBase&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">public&lt;/span>&lt;span class="o">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">static&lt;/span> &lt;span class="n">sp&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">Hoge&lt;/span>&lt;span class="o">&amp;gt;&lt;/span> &lt;span class="n">self&lt;/span>&lt;span class="p">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">...&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">};&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>


&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">Hoge.cpp&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-cpp" data-lang="cpp">&lt;span class="line">&lt;span class="cl">&lt;span class="n">Hoge&lt;/span>&lt;span class="o">::&lt;/span>&lt;span class="n">Hoge&lt;/span>&lt;span class="p">()&lt;/span> &lt;span class="o">:&lt;/span> &lt;span class="n">RefBase&lt;/span>&lt;span class="p">()&lt;/span> &lt;span class="p">{}&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>

&lt;p>&lt;code>Android.mk&lt;/code> では &lt;code>libutils.so&lt;/code> を使用する指定をしておく必要があります。&lt;/p>

&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">Android.mk&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-makefile" data-lang="makefile">&lt;span class="line">&lt;span class="cl">&lt;span class="nv">LOCAL_SHARED_LIBRARIES&lt;/span> &lt;span class="o">:=&lt;/span> &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span> libutils
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure></description></item><item><title>Traceview でプロファイル情報を表示する</title><link>https://maku77.github.io/p/2wgxfwd/</link><pubDate>Fri, 14 Jan 2011 00:00:00 +0900</pubDate><guid>https://maku77.github.io/p/2wgxfwd/</guid><description>&lt;p>参考: &lt;a href="https://developer.android.com/studio/profile/traceview">Traceview - Android Developers&lt;/a>&lt;/p>
&lt;h2 id="プロファイリングデータを取得する">プロファイリングデータを取得する&lt;/h2>
&lt;p>アプリケーション内の特定のコード区間のプロファイリングを行うには、プロファイリンク期間を &lt;code>android.os.debug.Debug &lt;/code> クラスの &lt;code>startMethodTracing() &lt;/code> と &lt;code>stopMethodTracing()&lt;/code> で囲みます。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="n">Debug&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">startMethodTracing&lt;/span>&lt;span class="p">();&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">...&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">プロファイリング中&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">...&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">Debug&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">stopMethodTracing&lt;/span>&lt;span class="p">();&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>プロファイリング結果は、&lt;code>/sdcard/dmtrace.trace&lt;/code> というバイナリファイルに出力されます。
端末に SD カードが挿入されていないとエラーになります。&lt;/p>
&lt;p>&lt;code>startMethodTracing&lt;/code> メソッドのパラメータでファイル名のベース名を指定すると、&lt;code>/sdcard/&amp;lt;basename&amp;gt;.trace&lt;/code> というファイル名で出力されるようになります。
結局 SD カードに出力されることには変わりありません。&lt;/p>
&lt;p>ドキュメントには、&lt;/p>
&lt;blockquote>
&lt;p>These methods start and stop method tracing across the entire virtual machine.&lt;/p>
&lt;/blockquote>
&lt;p>と記述されているので、&lt;code>Debug.startMethodTracing()&lt;/code> を呼び出した時点から、アプリケーション全体（正確には Dalvik VM 全体）のプロファイリングが行われることになります。
Activity がそのアプリのエントリポイントとなっているのなら、&lt;code>onCreate()&lt;/code>, &lt;code>onDestroy()&lt;/code> でそれぞれ、&lt;code>startMethodTracing()&lt;/code>、&lt;code>stopMethodTracing()&lt;/code> を呼び出すようにすれば、そのアプリ全体のプロファイリングを行うことができます。&lt;/p>
&lt;h2 id="プロファイリングデータを表示する">プロファイリングデータを表示する&lt;/h2>
&lt;p>Android SDK に含まれている &lt;code>traceview&lt;/code> コマンドを使用すると、プロファイリング結果をグラフィカルに表示することができます。&lt;/p>


&lt;figure class="xImage">
 &lt;img style="" width="654" height="426" src="../p/2wgxfwd/img-001.png" alt="/p/2wgxfwd/img-001.png" />
 &lt;figcaption>図: Traceview&lt;/figcaption>
&lt;/figure>

&lt;p>上記の図では、タイムラインに main スレッドが一本だけ表示されていますが、複数のスレッドが存在すれば、main 以外のスレッドもその下に表示されます。&lt;/p>
&lt;p>まずは、&lt;code>/sdcard/dmtrace.trace&lt;/code> ファイルを PC に取得します。&lt;/p>
&lt;pre tabindex="0">&lt;code>C:\&amp;gt; adb pull /sdcard/dmtrace.trace
&lt;/code>&lt;/pre>&lt;p>あとは &lt;code>traceview&lt;/code> コマンドのパラメータとして、&lt;code>dmtrace.trace&lt;/code> のパスを渡すだけです。
Windows ではフルパスで指定する必要があります。&lt;/p></description></item><item><title>Androidベンダー向けメモ: make 後の生成イメージが格納されるディレクトリを調べる ($ANDROID_PRODUCT_OUT)</title><link>https://maku77.github.io/p/xsdpj94/</link><pubDate>Mon, 08 Nov 2010 00:00:00 +0900</pubDate><guid>https://maku77.github.io/p/xsdpj94/</guid><description>&lt;p>Android ビルド時に &lt;code>lunch&lt;/code> コマンドでビルドターゲットを指定すると、ビルドイメージが作成される先のディレクトリ名を &lt;strong>&lt;code>$ANDROID_PRODUCT_OUT&lt;/code>&lt;/strong> 変数で参照できるようになります。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-console" data-lang="console">&lt;span class="line">&lt;span class="cl">&lt;span class="gp">$&lt;/span> &lt;span class="nb">echo&lt;/span> &lt;span class="nv">$ANDROID_PRODUCT_OUT&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">/home/maku/work/android/out/target/product/your_product
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>上記の変数は、&lt;code>build/envsetup.sh&lt;/code> の中で定義されるようになっています。&lt;/p>
&lt;p>この変数を使用すれば、例えば、&lt;code>adb push&lt;/code> で &lt;code>/system/app&lt;/code> ディレクトリ内のファイルを端末に転送するための下記のような関数を定義することができます（&lt;code>/system&lt;/code> 用のデバイスが &lt;code>/dev/sda5&lt;/code> になっている場合）。&lt;/p>

&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">~/.bashrc&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">&lt;span class="k">function&lt;/span> adb-push-all &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> adb shell &lt;span class="s1">&amp;#39;mount -o remount -rw /dev/sda5 /system&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> adb push &lt;span class="nv">$ANDROID_PRODUCT_OUT&lt;/span>/system/app /system/app
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> adb shell &lt;span class="s1">&amp;#39;sync&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">}&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure></description></item><item><title>Androidメモ: スリープモードに遷移する／スリープから抜ける</title><link>https://maku77.github.io/p/cfqazd7/</link><pubDate>Mon, 01 Nov 2010 00:00:00 +0900</pubDate><guid>https://maku77.github.io/p/cfqazd7/</guid><description>&lt;h2 id="adb-コマンドを使ってスリープモードに移行するスリープから抜ける">ADB コマンドを使ってスリープモードに移行する／スリープから抜ける&lt;/h2>

&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">ADB コマンドでスリープ状態に入る&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-console" data-lang="console">&lt;span class="line">&lt;span class="cl">&lt;span class="gp">$&lt;/span> adb shell &lt;span class="s2">&amp;#34;echo mem &amp;gt; /sys/power/state&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>


&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">ADB コマンドでスリープ状態から抜ける&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-console" data-lang="console">&lt;span class="line">&lt;span class="cl">&lt;span class="gp">$&lt;/span> adb shell &lt;span class="s2">&amp;#34;echo on &amp;gt; /sys/power/state&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>

&lt;h2 id="コード内からスリープモードに移行するベンダー向け情報">コード内からスリープモードに移行する（ベンダー向け情報）&lt;/h2>
&lt;p>プログラム内からスリープモードに移行するには、&lt;code>AndroidManifest.xml&lt;/code> に &lt;strong>&lt;code>DEVICE_POWER&lt;/code>&lt;/strong> のパーミッション使用宣言を追加しておきます。&lt;/p>

&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">AndroidManifest.xml&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-xml" data-lang="xml">&lt;span class="line">&lt;span class="cl">&lt;span class="nt">&amp;lt;manifest&lt;/span> &lt;span class="err">...&lt;/span>&lt;span class="nt">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;lt;uses-permission&lt;/span> &lt;span class="na">android:name=&lt;/span>&lt;span class="s">&amp;#34;android.permission.DEVICE_POWER&amp;#34;&lt;/span> &lt;span class="nt">/&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nt">&amp;lt;/manifest&amp;gt;&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>

&lt;p>適切にパーミッションが割り当てられると、コード内から以下のようにスリープへ移行することができます。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="n">PowerManager&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">pm&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">PowerManager&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">getSystemService&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">Context&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">POWER_SERVICE&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">pm&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">goToSleep&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">SystemClock&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">uptimeMillis&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">+&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">1&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>このコードを実行するには、システム権限アプリとして動作している必要があります。
通常アプリから実行すると、以下のような &lt;strong>SecurityException&lt;/strong> が発生します。&lt;/p>
&lt;pre tabindex="0">&lt;code>E/AndroidRuntime( 7118): java.lang.RuntimeException:
 Unable to create service com.example.sample.MyService:
 java.lang.SecurityException:
 Neither user 10052 nor current process has android.permission.DEVICE_POWER.
&lt;/code>&lt;/pre></description></item><item><title>Androidメモ: 画面消灯 (SCREEN OFF) までの時間を取得・設定する</title><link>https://maku77.github.io/p/fkn27wa/</link><pubDate>Mon, 01 Nov 2010 00:00:00 +0900</pubDate><guid>https://maku77.github.io/p/fkn27wa/</guid><description>&lt;p>ユーザの無操作状態が「何ミリ秒」続いたときに画面を自動的に OFF にするか、というタイムアウト値 (&lt;code>SCREEN_OFF_TIMEOUT&lt;/code>) を取得するには以下のようにします。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// import android.provider.Settings;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="c1">// import static android.provider.Settings.System.SCREEN_OFF_TIMEOUT;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="kt">int&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">timeoutInMs&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">0&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">try&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">timeoutInMs&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Settings&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">System&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">getInt&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">getContentResolver&lt;/span>&lt;span class="p">(),&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">SCREEN_OFF_TIMEOUT&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">catch&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">SettingNotFoundException&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">e&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">e&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">printStackTrace&lt;/span>&lt;span class="p">();&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>例えば、1 時間に設定されている場合は、3600000（1時間＊60分＊60秒＊1000）という値が取得できます。&lt;/p>
&lt;p>次のようにすれば、画面 OFF までのタイムアウト時間を「設定」することができます。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// 10 分でスクリーンオフ&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">Settings&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">System&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">putInt&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">getContentResolver&lt;/span>&lt;span class="p">(),&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">SCREEN_OFF_TIMEOUT&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">10&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">*&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">60&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">*&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">1000&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div></description></item><item><title>Androidメモ: ネットワーク情報を取得する (ConnectivityManager, NetworkInfo)</title><link>https://maku77.github.io/p/rm9ve9q/</link><pubDate>Thu, 09 Sep 2010 00:00:00 +0900</pubDate><guid>https://maku77.github.io/p/rm9ve9q/</guid><description>&lt;h2 id="ネットワークの情報を取得する">ネットワークの情報を取得する&lt;/h2>
&lt;p>ネットワーク関連の情報は、&lt;strong>&lt;code>ConnectivityManager&lt;/code>&lt;/strong> の &lt;code>getActiveNetworkInfo()&lt;/code> メソッドで取得できる &lt;strong>&lt;code>NetworkInfo&lt;/code>&lt;/strong> オブジェクトを使って参照できます。
&lt;code>NetworkInfo&lt;/code> オブジェクトは以下のように取得します。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// import android.net.ConnectivityManager;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="c1">// import android.net.NetworkInfo;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">ConnectivityManager&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">manager&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">ConnectivityManager&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">getSystemService&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">CONNECTIVITY_SERVICE&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">if&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">manager&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">==&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kc">null&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">return&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kc">false&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">NetworkInfo&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">networkInfo&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">manager&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">getActiveNetworkInfo&lt;/span>&lt;span class="p">();&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">if&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">networkInfo&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">==&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kc">null&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">return&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kc">false&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;code>NetworkInfo&lt;/code> を取得するためには &lt;strong>&lt;code>ACCESS_NETWORK_STATE&lt;/code>&lt;/strong> パーミッションが必要なため、&lt;code>AndroidManifest.xml&lt;/code> で以下のように宣言しておきます。&lt;/p>

&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">AndroidManifest.xml&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-xml" data-lang="xml">&lt;span class="line">&lt;span class="cl">&lt;span class="nt">&amp;lt;manifest&lt;/span> &lt;span class="err">...&lt;/span>&lt;span class="nt">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;lt;uses-permission&lt;/span> &lt;span class="na">android:name=&lt;/span>&lt;span class="s">&amp;#34;android.permission.ACCESS_NETWORK_STATE&amp;#34;&lt;/span> &lt;span class="nt">/&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ...
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nt">&amp;lt;/manifest&amp;gt;&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>

&lt;ul>
&lt;li>参考: &lt;a href="https://developer.android.com/reference/android/net/ConnectivityManager">ConnectivityManager｜Android Developers&lt;/a>&lt;/li>
&lt;/ul>
&lt;h2 id="ネットワークの情報を一覧表示する">ネットワークの情報を一覧表示する&lt;/h2>
&lt;p>&lt;code>NetworkInfo&lt;/code> オブジェクトの &lt;strong>&lt;code>toString()&lt;/code>&lt;/strong> メソッドで、ネットワーク情報の文字列表現を取得できます。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="n">System&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">out&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">println&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">networkInfo&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">toString&lt;/span>&lt;span class="p">());&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>
&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">出力結果（実際は一行）&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-plain" data-lang="plain">&lt;span class="line">&lt;span class="cl">NetworkInfo:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> type: ETHERNET[],
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> state: CONNECTED/CONNECTED,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> reason: eth0 DHCP success,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> extra: (none),
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> roaming: false,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> failover: false,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> isAvailable: false,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> iPaddress: 192.168.3.98&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>

&lt;h2 id="ネットワークに接続されているか調べる">ネットワークに接続されているか調べる&lt;/h2>
&lt;p>Android デバイスがネットワークに接続されているかどうかは、&lt;code>NetworkInfo&lt;/code> オブジェクトの &lt;strong>&lt;code>isConnected()&lt;/code>&lt;/strong> メソッドで調べることができます。&lt;/p></description></item><item><title>Androidベンダー向けメモ: Make 変数でビルド範囲を制御する</title><link>https://maku77.github.io/p/mco3pis/</link><pubDate>Mon, 06 Sep 2010 00:00:00 +0900</pubDate><guid>https://maku77.github.io/p/mco3pis/</guid><description>&lt;p>Android のワンショット make の仕組みでは、&lt;code>Android.mk&lt;/code> に基づいてビルド処理が行われますが、下位ディレクトリにある &lt;code>Android.mk&lt;/code> はデフォルトでは検索しないようになっています。
下位ディレクトリのモジュール（プロジェクト）までビルドするには、上位の &lt;code>Android.mk&lt;/code> で &lt;code>include&lt;/code> 処理を記述する必要がありますが、この &lt;code>include&lt;/code> 処理を実行するかどうかを Make 変数で制御することにより、ビルド範囲の制御が可能です。&lt;/p>
&lt;p>下記の例では、&lt;code>CONFIG_HOGE&lt;/code> という Make 変数の値により、下位ディレクトリのモジュールのビルドを制御しています。&lt;/p>
&lt;pre tabindex="0">&lt;code>ifeq ($(CONFIG_HOGE),true)
 include $(call all-subdir-makefiles)
endif
&lt;/code>&lt;/pre></description></item><item><title>ANR の原因を突き止める</title><link>https://maku77.github.io/p/be5zj9v/</link><pubDate>Mon, 16 Aug 2010 00:00:00 +0900</pubDate><guid>https://maku77.github.io/p/be5zj9v/</guid><description>&lt;p>Android のメインスレッドを長期間ブロックするコードがあると、ANR (Application Not Responding) が発生してアプリケーションが強制終了されます。
端末の画面上で Not responding ダイアログが表示されたら &lt;code>[Force Close]&lt;/code> ボタンを押すと、以下のようなログが出るので、kill されたプロセス ID を確認します。&lt;/p>
&lt;pre tabindex="0">&lt;code>I ActivityManager: Killing process com.example.player (pid=854) at user&amp;#39;s request
I Process : Sending signal. PID: 854 SIG: 9
&lt;/code>&lt;/pre>&lt;p>この場合のプロセス ID は 854 です。
ANR の詳細は、&lt;code>/data/anr/traces.txt&lt;/code> に出力されています。
このテキストファイルを見てそのプロセス ID に関するコールスタックを確認すると、具体的にどのメソッドでブロックしてしまっているかがわかります。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-console" data-lang="console">&lt;span class="line">&lt;span class="cl">&lt;span class="gp">$&lt;/span> adb pull /data/anr/traces.txt
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="gp">$&lt;/span> vim traces.txt
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>例えば、以下のように出力されていれば、&lt;code>VideoView.java&lt;/code> 258 行目の &lt;code>MediaPlayer.prepareAsync&lt;/code> 呼び出しでブロックしていることが分かります。&lt;/p>
&lt;pre tabindex="0">&lt;code>----- pid 854 at 2008-10-01 12:03:02 -----
Cmd line: com.example.player

DALVIK THREADS:
&amp;#34;main&amp;#34; prio=5 tid=3 NATIVE
 | group=&amp;#34;main&amp;#34; sCount=1 dsCount=0 s=N obj=0xb4c69e50 self=0x804d3f0
 | sysTid=854 nice=0 sched=0/0 cgrp=unknown handle=-1224341824
 at android.media.MediaPlayer.prepareAsync(Native Method)
 at android.widget.VideoView.openVideo(VideoView.java:258)
 at android.widget.VideoView.access$2000(VideoView.java:53)
 at android.widget.VideoView$6.surfaceCreated(VideoView.java:506)
...
&lt;/code>&lt;/pre></description></item><item><title>Androidメモ: Androidの特殊ディレクトリの情報を取得する (android.os.Environment)</title><link>https://maku77.github.io/p/vjcad5m/</link><pubDate>Tue, 15 Jun 2010 00:00:00 +0900</pubDate><guid>https://maku77.github.io/p/vjcad5m/</guid><description>&lt;p>Android の特殊ディレクトリの情報を取得するには、&lt;strong>&lt;code>android.os.Environment&lt;/code>&lt;/strong> クラスを使用します。
以下は、いくつかの主要なディレクトリのパスを取得する方法です。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="n">java&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">io&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">File&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">dataDir&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">android&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">os&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">Environment&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">getDataDirectory&lt;/span>&lt;span class="p">();&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">java&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">io&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">File&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">downloadDir&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">android&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">os&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">Environment&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">getDownloadCacheDirectory&lt;/span>&lt;span class="p">();&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">java&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">io&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">File&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">storageDir&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">android&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">os&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">Environment&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">getExternalStorageDirectory&lt;/span>&lt;span class="p">();&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">java&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">io&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">File&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">rootDir&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">android&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">os&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">Environment&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">getRootDirectory&lt;/span>&lt;span class="p">();&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">Log&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">d&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">TAG&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">dataDir&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">getAbsolutePath&lt;/span>&lt;span class="p">());&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c1">// &amp;#34;/data&amp;#34;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">Log&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">d&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">TAG&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">downloadDir&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">getAbsolutePath&lt;/span>&lt;span class="p">());&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c1">// &amp;#34;/cache&amp;#34;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">Log&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">d&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">TAG&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">storageDir&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">getAbsolutePath&lt;/span>&lt;span class="p">());&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c1">// &amp;#34;/sdcard&amp;#34;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">Log&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">d&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">TAG&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">rootDir&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">getAbsolutePath&lt;/span>&lt;span class="p">());&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c1">// &amp;#34;/system&amp;#34;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div></description></item><item><title>Androidベンダー向けメモ: ART/Dalvik VM のバージョンを調べる (dalvikvm -showversion)</title><link>https://maku77.github.io/p/5at33s8/</link><pubDate>Tue, 01 Jun 2010 00:00:00 +0900</pubDate><guid>https://maku77.github.io/p/5at33s8/</guid><description>&lt;p>Android デバイスの VM のバージョンは &lt;code>dalvikvm&lt;/code> コマンドで調べることができます。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-console" data-lang="console">&lt;span class="line">&lt;span class="cl">&lt;span class="gp">$&lt;/span> adb shell
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="gp">#&lt;/span> dalvikvm -showversion
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">DalvikVM version 1.1.0
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>ART を使用している場合は、下記のような感じで表示されます。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-console" data-lang="console">&lt;span class="line">&lt;span class="cl">&lt;span class="gp">#&lt;/span> dalvikvm -showversion
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">ART version 2.1.0
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div></description></item><item><title>Androidメモ: SharedPreferences でアプリの設定値を保存する</title><link>https://maku77.github.io/p/d7dho89/</link><pubDate>Sat, 29 May 2010 00:00:00 +0900</pubDate><guid>https://maku77.github.io/p/d7dho89/</guid><description>&lt;h2 id="sharedpreferences-とは">SharedPreferences とは&lt;/h2>
&lt;p>&lt;code>SharedPreferences&lt;/code> は、キー＆バリューの組み合わせをファイル（不揮発メモリ）に保存する仕組みで、アプリ内で使用する設定情報などを保存するのに使用できます。
設定値は XML ファイルの形で保存されるのですが、ファイル操作に関する処理は隠ぺいされているので、アプリの設計者はキー＆バリューの取り扱いのみに集中して実装することができます。
アプリ内のコンポーネント間で、キー＆バリューのデータをやりとりする場合にも使用できます。&lt;/p>
&lt;p>&lt;code>SharedPreferences&lt;/code> には下記のようなタイプの値を保存することができます。&lt;/p>
&lt;ul>
&lt;li>&lt;code>boolean&lt;/code>&lt;/li>
&lt;li>&lt;code>string&lt;/code>&lt;/li>
&lt;li>&lt;code>int&lt;/code>&lt;/li>
&lt;li>&lt;code>long&lt;/code>&lt;/li>
&lt;li>&lt;code>float&lt;/code>&lt;/li>
&lt;/ul>
&lt;p>逆にもっと複雑なデータを保存したいときは、&lt;code>SharedPreferences&lt;/code> ではなく、別の方法（通常のファイル I/O など）で永続化する必要があります。&lt;/p>
&lt;h2 id="sharedpreferences-による値を書き込む">SharedPreferences による値を書き込む&lt;/h2>
&lt;p>キー＆バリューのペアを扱う &lt;code>SharedPreferences&lt;/code> オブジェクトを生成するには、以下のように &lt;a href="https://developer.android.com/reference/android/content/Context.html#getSharedPreferences(java.lang.String,%2520int)">Context#getSharedPreferences()&lt;/a> メソッドを使用します。
このとき第 1 パラメータで指定した名前が XML ファイルの名前に使用されます（拡張子 &lt;code>.xml&lt;/code> は省略して指定します）。
第 2 パラメータには、Android 7.0 (API level24) 以降では &lt;code>Context.MODE_PRIVATE&lt;/code> しか指定できません。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="n">SharedPreferences&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">pref&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">context&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">getSharedPreferences&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;my_settings&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Context&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">MODE_PRIVATE&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;code>SharedPreferences&lt;/code> の値の編集を編集したいときは、&lt;a href="https://developer.android.com/reference/android/content/SharedPreferences.html#edit()">edit()&lt;/a> メソッドを使って &lt;a href="https://developer.android.com/reference/android/content/SharedPreferences.Editor.html">SharedPreferences.Editor&lt;/a> オブジェクトを取得する必要があります。
値の編集が終わったら、最後に &lt;a href="https://developer.android.com/reference/android/content/SharedPreferences.Editor.html#commit()">Editor#commit()&lt;/a> メソッドを呼び出すことで &lt;code>SharedPreferences&lt;/code> に変更が反映されます。
このメソッドを呼び出し忘れると何も保存されないので注意してください。
&lt;code>commit()&lt;/code> の呼び出しが面倒に感じるかもしれませんが、このような仕組みになっているおかげで、変更内容を一括で（アトミックに）反映することができ、効率的なファイルへの書き込みやイベント通知を行えるようになっています。&lt;/p>

&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">SharedPreferences に値を書き込む（Java）&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// import android.content.SharedPreferences;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">SharedPreferences&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">pref&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">context&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">getSharedPreferences&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;my_settings&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Context&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">MODE_PRIVATE&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">SharedPreferences&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">Editor&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">editor&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">pref&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">edit&lt;/span>&lt;span class="p">();&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">editor&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">putString&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;stringValue&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s">&amp;#34;ほげ&amp;#34;&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">editor&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">putBoolean&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;booleanValue&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kc">true&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">editor&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">putInt&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;intValue&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">100&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">editor&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">commit&lt;/span>&lt;span class="p">();&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>


&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">SharedPreferences に値を書き込む（Kotlin）&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-kotlin" data-lang="kotlin">&lt;span class="line">&lt;span class="cl">&lt;span class="n">getSharedPreferences&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;my_settings&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nc">Context&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">MODE_PRIVATE&lt;/span>&lt;span class="p">).&lt;/span>&lt;span class="n">edit&lt;/span>&lt;span class="p">().&lt;/span>&lt;span class="n">apply&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">putString&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;stringValue&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s2">&amp;#34;ほげ&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">putBoolean&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;booleanValue&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="k">true&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">putInt&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;intValue&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="m">100&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">commit&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>

&lt;p>アプリのパッケージ名が &lt;code>com.example.hello&lt;/code> だとすると、上記のような &lt;code>SharedPreferences&lt;/code> 設定は下記のようなファイルとして保存されます。&lt;/p></description></item><item><title>Androidベンダー向けメモ: 製品にパッケージングする APK を指定する (PRODUCT_PACKAGES)</title><link>https://maku77.github.io/p/n8n3mwo/</link><pubDate>Mon, 17 May 2010 00:00:00 +0900</pubDate><guid>https://maku77.github.io/p/n8n3mwo/</guid><description>&lt;p>Android でプロダクトごとにインストールする APK パッケージは、&lt;code>$(TARGET_PRODUCT).mk&lt;/code> の &lt;strong>&lt;code>PRODUCT_PACKAGES&lt;/code>&lt;/strong> 変数で指定します。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-makefile" data-lang="makefile">&lt;span class="line">&lt;span class="cl">&lt;span class="nv">PRODUCT_PACKAGES&lt;/span> &lt;span class="o">:=&lt;/span> &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span> AlarmClock &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span> AlarmProvider &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span> Bluetooth &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span> ...
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>上記は、&lt;code>build/target/product/generic.mk&lt;/code> から抜粋しています。&lt;/p></description></item><item><title>Androidベンダー向けメモ: システムプロパティのあれこれ</title><link>https://maku77.github.io/p/4yw4wwr/</link><pubDate>Sat, 08 May 2010 00:00:00 +0900</pubDate><guid>https://maku77.github.io/p/4yw4wwr/</guid><description>&lt;h2 id="システムプロパティの定義方法">システムプロパティの定義方法&lt;/h2>
&lt;h3 id="ビルド時に埋め込む方法">ビルド時に埋め込む方法&lt;/h3>
&lt;p>プロダクトごとの &lt;code>Makefile&lt;/code>（&lt;code>your_product.mk&lt;/code> など） に、以下のように記述しておくと、ビルド時に &lt;code>build.prop&lt;/code> に追加されます。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-makefile" data-lang="makefile">&lt;span class="line">&lt;span class="cl">&lt;span class="nv">PRODUCT_PROPERTY_OVERRIDES&lt;/span> &lt;span class="o">+=&lt;/span> &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span> persist.sys.timezone &lt;span class="o">=&lt;/span> Asia/Tokyo
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="イメージのビルド後にプロパティファイルをいじる方法">イメージのビルド後にプロパティファイルをいじる方法&lt;/h3>
&lt;p>&lt;code>default.prop&lt;/code> に以下のような感じで追加すると、デバイス起動時にシステムプロパティとして設定されます。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-ini" data-lang="ini">&lt;span class="line">&lt;span class="cl">&lt;span class="na">persist.sys.timezone&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s">Asia/Tokyo&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="システム起動時の-init-の中で設定する">システム起動時の init の中で設定する&lt;/h3>
&lt;p>&lt;code>init.rc&lt;/code> あるいは、プロダクトごとの &lt;code>init&lt;/code> ファイルに、以下のような感じで追加しておくことができます。&lt;/p>
&lt;pre tabindex="0">&lt;code>setprop persist.sys.timezone Asia/Tokyo
&lt;/code>&lt;/pre>&lt;h2 id="android-デバイス起動時にシステムプロパティが設定される流れ">Android デバイス起動時にシステムプロパティが設定される流れ&lt;/h2>
&lt;ol>
&lt;li>init process が以下からプロパティをロードする
&lt;ul>
&lt;li>&lt;code>/default.prop&lt;/code>&lt;/li>
&lt;li>&lt;code>/system/build.prop&lt;/code>&lt;/li>
&lt;li>&lt;code>/system/default.prop&lt;/code>&lt;/li>
&lt;li>&lt;code>/data/local.prop&lt;/code>&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>システムプロパティ情報を提供するための unix domain socket server が作成される。
socket のパスは &lt;code>/dev/socket/property_service&lt;/code> で、サイズは環境変数の &lt;code>ANDROID_PROPERTY_WORKSPACE&lt;/code> で取得する。
Bionic libc のライブラリ &lt;code>libcutils&lt;/code> がこの shared memory に対してシステムプロパティを読み書きするインタフェースを提供する。&lt;/li>
&lt;/ol>
&lt;h2 id="システムプロパティの-getset">システムプロパティの get/set&lt;/h2>
&lt;h3 id="from-cc-native-code">from C/C++ native code&lt;/h3>
&lt;p>Bionic libc の &lt;code>libcutils&lt;/code> をリンクし、&lt;code>cutils/properties.h&lt;/code> を include して、以下の関数を使用します。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-cpp" data-lang="cpp">&lt;span class="line">&lt;span class="cl">&lt;span class="kt">int&lt;/span> &lt;span class="nf">property_get&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="k">const&lt;/span> &lt;span class="kt">char&lt;/span> &lt;span class="o">*&lt;/span>&lt;span class="n">key&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="kt">char&lt;/span> &lt;span class="o">*&lt;/span>&lt;span class="n">value&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="k">const&lt;/span> &lt;span class="kt">char&lt;/span> &lt;span class="o">*&lt;/span>&lt;span class="n">default_value&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kt">int&lt;/span> &lt;span class="nf">property_set&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="k">const&lt;/span> &lt;span class="kt">char&lt;/span> &lt;span class="o">*&lt;/span>&lt;span class="n">key&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="k">const&lt;/span> &lt;span class="kt">char&lt;/span> &lt;span class="o">*&lt;/span>&lt;span class="n">value&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kt">int&lt;/span> &lt;span class="nf">property_list&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="kt">void&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="o">*&lt;/span>&lt;span class="n">propfn&lt;/span>&lt;span class="p">)(&lt;/span>&lt;span class="k">const&lt;/span> &lt;span class="kt">char&lt;/span> &lt;span class="o">*&lt;/span>&lt;span class="n">key&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="k">const&lt;/span> &lt;span class="kt">char&lt;/span> &lt;span class="o">*&lt;/span>&lt;span class="n">value&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="kt">void&lt;/span> &lt;span class="o">*&lt;/span>&lt;span class="n">cookie&lt;/span>&lt;span class="p">),&lt;/span> &lt;span class="kt">void&lt;/span> &lt;span class="o">*&lt;/span>&lt;span class="n">cookie&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>使い方はこんな感じ。&lt;/p></description></item><item><title>Logcat のログ出力をフィルタする</title><link>https://maku77.github.io/p/asryvzc/</link><pubDate>Mon, 19 Apr 2010 00:00:00 +0900</pubDate><guid>https://maku77.github.io/p/asryvzc/</guid><description>&lt;p>Android の logcat ログの出力は、出力のレベルでフィルタリングしたり、&lt;code>Log.d()&lt;/code> メソッドなどの第一引数で指定したタグでフィルタリングできるようになっています。&lt;/p>
&lt;h2 id="adb-logcat-コマンドでのフィルタ方法">adb logcat コマンドでのフィルタ方法&lt;/h2>
&lt;p>logcat コマンドによるログのフィルタリングでは、priority として &lt;code>V/D/I/W/E/F/S&lt;/code> のいずれかを指定できます
例えば、&lt;code>W&lt;/code> を指定した場合は、Warning レベル以上のログ (&lt;code>W/E/F/S&lt;/code>) のみが表示されるようになります。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-console" data-lang="console">&lt;span class="line">&lt;span class="cl">&lt;span class="gp">$&lt;/span> adb logcat *:W &lt;span class="c1"># Warning 以上のログだけ表示&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="gp">$&lt;/span> adb logcat -s Tag1:* &lt;span class="c1"># Tag1 タグのログだけを表示&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="gp">$&lt;/span> adb logcat *:S Tag1:* &lt;span class="c1"># 同上&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="gp">$&lt;/span> adb logcat -s Tag1:W Tag2:E &lt;span class="c1"># Tag1 と Tag2 のログだけを表示&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="gp">$&lt;/span> adb logcat Tag1:S &lt;span class="c1"># Tag1 タグのログを非表示&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>タグ名でログを絞り込みたい場合は、-s オプションで全てタグのログをデフォルトでオフした上で、任意のタグを指定する必要があります。
そうしないと、指定していないタグに関しては、すべてのレベルのログが出てしまいます。&lt;/p>

&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">絞り込みに失敗する例 (Tag1 に関してしかレベル制御されない）&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-console" data-lang="console">&lt;span class="line">&lt;span class="cl">&lt;span class="gp">$&lt;/span> adb logcat Tag1:W
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>

&lt;p>Linux を使っているなら、&lt;code>grep&lt;/code> にパイプしまって適当にフィルタリングするのもありです。
正規表現も使えるし、こっちのが実は柔軟性は高いかもしれません。
ただ、このやり方は、ログ受信側でフィルタしているだけなので、Android のシステムがログの出力を抑制しているわけではないことに注意してください。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-console" data-lang="console">&lt;span class="line">&lt;span class="cl">&lt;span class="gp">$&lt;/span> adb logcat &lt;span class="p">|&lt;/span> grep HogeHoge
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="おまけ-よく使う方法">おまけ: よく使う方法&lt;/h2>
&lt;p>下記は私がよく使う方法です。まず、&lt;code>logcat -c&lt;/code> でこれまでのログをクリアしておいて、自分のアプリのタグだけのログ表示に絞り込んでいます。&lt;/p></description></item><item><title>Androidメモ: Eclipse から Android SDK を使えるようにする (ADK)</title><link>https://maku77.github.io/p/4ch6hjg/</link><pubDate>Sun, 11 Apr 2010 00:00:00 +0900</pubDate><guid>https://maku77.github.io/p/4ch6hjg/</guid><description>&lt;p>Android SDK がインストール済みであることを前提にしています。&lt;/p>
&lt;h2 id="eclipse-に-android-development-toolkit-adk-をインストール">Eclipse に Android Development Toolkit (ADK) をインストール&lt;/h2>
&lt;p>Eclipse から Android SDK を使用するには、&lt;strong>ADK&lt;/strong> というプラグインをインストールします。&lt;/p>
&lt;ol>
&lt;li>Eclipse メニューから &lt;code>Help&lt;/code> =&amp;gt; &lt;code>Install New Software...&lt;/code> と選択。
&lt;ul>
&lt;li>Work with: の欄に &lt;code>https://dl-ssl.google.com/android/eclipse/&lt;/code> と入力してインストール。&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>Android SDK のパスを設定
&lt;ul>
&lt;li>Eclipse のメニューから &lt;code>Window&lt;/code> =&amp;gt; &lt;code>Preferences&lt;/code> を選択。&lt;/li>
&lt;li>&lt;code>Android&lt;/code> を選択し、SDK Location に SDK を展開したディレクトリのパスを入力。
（これをやっておかないと、New Android Project のダイアログで Android SDK has not been setup. と出てプロジェクトを作成できません）&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ol>
&lt;h3 id="プロキシ設定">プロキシ設定&lt;/h3>
&lt;p>プロキシ環境にいる場合は、Window =&amp;gt; Preferences =&amp;gt; General =&amp;gt; Network Connections から設定します。&lt;/p>
&lt;p>プロキシを設定してもダメな場合は、以下のようなことを試すとうまくいくかもしれません。&lt;/p>
&lt;ul>
&lt;li>アドレスを &lt;code>https://&lt;/code> から &lt;code>http://&lt;/code> に変える&lt;/li>
&lt;li>Eclipse のバージョンを最新にする&lt;/li>
&lt;/ul>
&lt;h2 id="android-sdk-の-package-のアップデート">Android SDK の Package のアップデート&lt;/h2>
&lt;ol>
&lt;li>Eclipse のメニューから &lt;code>Window&lt;/code> =&amp;gt; &lt;code>Android SDK and ADV Manager&lt;/code>。&lt;/li>
&lt;li>&lt;code>Available Packages&lt;/code> を選択し、URL を選択して、&lt;code>Install Selected&lt;/code> をクリック。&lt;/li>
&lt;/ol>
&lt;h3 id="sdk-のアップデート中に-fetching-から進まない場合">SDK のアップデート中に fetching&amp;hellip; から進まない場合&lt;/h3>
&lt;p>プロキシ設定を行う必要があるかもしれません。
Eclipse そのもののプロキシ設定ではなく、&lt;strong>Android SDK and AVD Manager&lt;/strong> ウィンドウの &lt;code>Settings&lt;/code> という項目で設定します。&lt;/p></description></item></channel></rss>