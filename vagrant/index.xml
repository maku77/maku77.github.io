<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>Vagrant on 天才まくまくノート</title><link>https://maku77.github.io/vagrant/</link><description>Recent content in Vagrant on 天才まくまくノート</description><generator>Hugo</generator><language>ja-jp</language><lastBuildDate>Tue, 01 Nov 2016 00:00:00 +0900</lastBuildDate><atom:link href="https://maku77.github.io/vagrant/index.xml" rel="self" type="application/rss+xml"/><item><title>Vagrantメモ: 不要な box を削除する (vagrant remove box)</title><link>https://maku77.github.io/p/6wsa466/</link><pubDate>Tue, 01 Nov 2016 00:00:00 +0900</pubDate><guid>https://maku77.github.io/p/6wsa466/</guid><description>&lt;h2 id="box-ファイルとは">box ファイルとは&lt;/h2>
&lt;p>Vagrant の仮想マシンは、OS のスナップショットともいえる box ファイルをベースにして生成されるようになっています。
この仕組みによって、仮想マシンの破棄 (&lt;code>vagrant destroy&lt;/code>)、再生性 (&lt;code>vagrant up&lt;/code>)、Ansible による環境構築のテスト、といった試行錯誤が短時間で実行できるようになっています。&lt;/p>
&lt;p>box ファイルの実体は VirtualBox などの仮想イメージなので、ファイルサイズは非常に大きくなります（数百 MB ～ 数 GB 程度）。
そのため、box ファイルは複数の Vagrant プロジェクトから共有されるようになっており、デフォルトでは &lt;code>~/.vagrant.d&lt;/code> ディレクトリに格納されています（Windows の場合は &lt;code>%USERPROFILE%\.vagrant.d&lt;/code>）。&lt;/p>
&lt;pre tabindex="0">&lt;code>$ ls ~/.vagrant.d/boxes
centos-VAGRANTSLASH-7 hashicorp-VAGRANTSLASH-precise64
&lt;/code>&lt;/pre>&lt;p>この例では、&lt;code>centos/7&lt;/code> と &lt;code>hashicorp/precise64&lt;/code> という box が格納されていることが分かります（スラッシュはファイル名に含められないので &lt;code>-VAGRANTSLASH-&lt;/code> と置換されているようです）。&lt;/p>
&lt;h2 id="不要な-box-の削除">不要な box の削除&lt;/h2>
&lt;p>box ファイルはサイズが大きく、ホスト上のディスクスペースを消費してしまうため、本当に不要になったら削除してしまいましょう。
現在存在している box ファイルを確認するには、&lt;code>vagrant box list&lt;/code> コマンドを使用します。&lt;/p>
&lt;pre tabindex="0">&lt;code>$ vagrant box list
centos/7 (virtualbox, 1609.01)
hashicorp/precise64 (virtualbox, 1.1.0)
&lt;/code>&lt;/pre>&lt;p>不要な box が存在していることが分かったら、その box 名を &lt;code>vagrant box remove&lt;/code> コマンドに渡します。&lt;/p></description></item><item><title>Vagrantメモ: Vagrant の３種類のネットワーク構成の違い</title><link>https://maku77.github.io/p/joud5wr/</link><pubDate>Mon, 31 Oct 2016 00:00:00 +0900</pubDate><guid>https://maku77.github.io/p/joud5wr/</guid><description>&lt;h2 id="３種類のネットワーク構成の概要">３種類のネットワーク構成の概要&lt;/h2>
&lt;p>Vagrant におけるホストマシンと仮想マシンの間のネットワーク構成は、下記の３種類の形態から選択して構築します。&lt;/p>
&lt;dl>
&lt;dt>ホストオンリーネットワーク (private network)&lt;/dt>
&lt;dd>ホストマシンと仮想マシンの間でプライベートなアドレス空間を割り当て、その範囲内で通信できるようにします。ホスト内で閉じた世界になります。&lt;/dd>
&lt;dt>ポートフォワード (forwarded port)&lt;/dt>
&lt;dd>ホストマシンの特定のポート番号へのアクセスを、仮想マシンの特定のポート番号にフォワードします。物理ネットワーク上では、1台のホストマシンがすべてのサービスを提供しているかのように見えます。&lt;/dd>
&lt;dt>ブリッジネットワーク (bridge network)&lt;/dt>
&lt;dd>ホストマシンが参加している物理ネットワークに仮想マシンを参加させます。物理ネットワーク上で IP アドレスが割り当てられるため、あたかも物理的なマシンが増えたかのように見えます。&lt;/dd>
&lt;/dl>
&lt;h2 id="どのネットワーク構成を選択するべきか">どのネットワーク構成を選択するべきか&lt;/h2>
&lt;p>それぞれのネットワーク構成に一長一短があり、状況に応じて適切なネットワーク構成を選ぶことになります。
ここでは、各マシン同士のアクセスが可能かどうかと、そこから判断した仮想マシン側のセキュリティリスクという観点でざっと特徴をまとめておきます。&lt;/p>
&lt;table>
 &lt;thead>
 &lt;tr>
 &lt;th>ネットワーク構成&lt;/th>
 &lt;th style="text-align: center">host&lt;br>↓&lt;br>guest&lt;/th>
 &lt;th style="text-align: center">guest&lt;br>↓&lt;br>host&lt;/th>
 &lt;th style="text-align: center">guest&lt;br>↓&lt;br>guest&lt;/th>
 &lt;th style="text-align: center">physical net&lt;br>↓&lt;br>guest&lt;/th>
 &lt;th>Security risk&lt;/th>
 &lt;/tr>
 &lt;/thead>
 &lt;tbody>
 &lt;tr>
 &lt;td>ホストオンリーネットワーク&lt;br>(private network)&lt;/td>
 &lt;td style="text-align: center">OK&lt;/td>
 &lt;td style="text-align: center">OK&lt;/td>
 &lt;td style="text-align: center">OK&lt;/td>
 &lt;td style="text-align: center">&amp;ndash;&lt;/td>
 &lt;td>Low（仮想マシンは外から見えない）&lt;/td>
 &lt;/tr>
 &lt;tr>
 &lt;td>ポートフォワード&lt;br>(forwarded port)&lt;/td>
 &lt;td style="text-align: center">OK&lt;/td>
 &lt;td style="text-align: center">&amp;ndash;&lt;/td>
 &lt;td style="text-align: center">&amp;ndash;&lt;/td>
 &lt;td style="text-align: center">OK&lt;/td>
 &lt;td>Medium（仮想マシンの特定のポートだけアクセス可能）&lt;/td>
 &lt;/tr>
 &lt;tr>
 &lt;td>ブリッジネットワーク&lt;br>(public network)&lt;/td>
 &lt;td style="text-align: center">OK&lt;/td>
 &lt;td style="text-align: center">OK&lt;/td>
 &lt;td style="text-align: center">OK&lt;/td>
 &lt;td style="text-align: center">OK&lt;/td>
 &lt;td>High（仮想マシンが物理ネットワークに参加する）&lt;/td>
 &lt;/tr>
 &lt;/tbody>
&lt;/table></description></item><item><title>Vagrantメモ: ブリッジネットワークを構築する</title><link>https://maku77.github.io/p/ymenseo/</link><pubDate>Mon, 31 Oct 2016 00:00:00 +0900</pubDate><guid>https://maku77.github.io/p/ymenseo/</guid><description>&lt;p>Vagrant でブリッジネットワークを有効にすると、ホストマシンと同じ LAN 内に、あたかももう一台の物理マシンがあるかのように、仮想マシンに IP アドレスを割り当てることができます。&lt;/p>
&lt;ul>
&lt;li>&lt;a href="https://www.vagrantup.com/docs/networking/public_network.html">Public Networks - Networking - Vagrant by HashiCorp&lt;/a>&lt;/li>
&lt;/ul>
&lt;p>ホストオンリーネットワークと同様に、仮想マシンからホストマシンへアクセスできるようになるだけでなく、LAN 内の他のマシンから仮想マシンにアクセスすることもできます（LAN のセキュリティポリシーでマシン間のアクセスが制限されている場合を除く）。&lt;/p>
&lt;p>ブリッジネットワークを有効にするには、下記のように &lt;code>config.vm.network&lt;/code> のネットワークタイプとして、&lt;strong>&lt;code>public_network&lt;/code>&lt;/strong> を設定します。&lt;/p>

&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">LAN 内の DHCP サーバから IP アドレスを割り当てる&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-ruby" data-lang="ruby">&lt;span class="line">&lt;span class="cl">&lt;span class="no">Vagrant&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">configure&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;2&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="k">do&lt;/span> &lt;span class="o">|&lt;/span>&lt;span class="n">config&lt;/span>&lt;span class="o">|&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">config&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">vm&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">network&lt;/span> &lt;span class="s2">&amp;#34;public_network&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">end&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>


&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">静的に IP アドレスを割り当てる&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-ruby" data-lang="ruby">&lt;span class="line">&lt;span class="cl">&lt;span class="no">Vagrant&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">configure&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;2&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="k">do&lt;/span> &lt;span class="o">|&lt;/span>&lt;span class="n">config&lt;/span>&lt;span class="o">|&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">config&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">vm&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">network&lt;/span> &lt;span class="s2">&amp;#34;public_network&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="ss">ip&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;192.168.0.17&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">end&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>

&lt;p>&lt;code>Vagrantfile&lt;/code> を変更したら、仮想マシンを立ち上げなおせば設定が反映されます。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-console" data-lang="console">&lt;span class="line">&lt;span class="cl">&lt;span class="gp">$&lt;/span> vagrant reload
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div></description></item><item><title>Vagrantメモ: ホストオンリーネットワークを構成する (private network)</title><link>https://maku77.github.io/p/oyoyz27/</link><pubDate>Mon, 31 Oct 2016 00:00:00 +0900</pubDate><guid>https://maku77.github.io/p/oyoyz27/</guid><description>&lt;h2 id="ホストオンリーネットワークの特徴">ホストオンリーネットワークの特徴&lt;/h2>
&lt;p>ホストオンリーネットワーク (private network) の構成を利用すると、ホストマシンと仮想マシンの間に専用のネットワークを構築できます。&lt;/p>
&lt;p>ホストオンリーネットワークにはホストマシンと仮想マシンの間だけから見える&lt;a href="https://en.wikipedia.org/wiki/Private_network#Private_IPv4_address_spaces">プライベート IP アドレス&lt;/a>を割り当てるため、既存の物理 LAN 上に存在する他のマシンからは、仮想マシンの存在を知ることはできません。
既存の LAN への影響がないため、パブリックな環境でも安心して利用できるネットワーク構成と言えます（既存の物理 LAN とは異なるネットワークに割り当てて使用します）。&lt;/p>
&lt;pre tabindex="0">&lt;code>物理 LAN 上のマシン ----[NG]----&amp;gt; 仮想マシン
&lt;/code>&lt;/pre>&lt;p>一方で、ホストマシンと仮想マシンは同じ専用ネットワークに所属することになるため、相互に自由なアクセスが可能です。
例えば、仮想マシンからホスト上で動作しているサービスを利用する、といったことが行えます。&lt;/p>
&lt;pre tabindex="0">&lt;code>ホスト &amp;lt;----[OK]----&amp;gt; 仮想マシン
&lt;/code>&lt;/pre>&lt;p>ポートフォワードを利用したネットワーク構成と比べ、各マシンで動作するサーバに素のポート番号でアクセスできる（HTTP サーバにポート 80 でアクセスできる）ため、シンプルで分かりやすいネットワーク構成になります。&lt;/p>
&lt;h2 id="ホストオンリーネットワークを構成する">ホストオンリーネットワークを構成する&lt;/h2>
&lt;p>ホストオンリーネットワークを構築するには、&lt;code>config.vm.network&lt;/code> で &lt;strong>private_network&lt;/strong> を指定します。
ここでは、プライベートネットワークとして &lt;code>192.168.100.0&lt;/code> というネットワークアドレス使用することにします。
仮想マシンには &lt;code>192.168.100.10&lt;/code> という IP アドレスを割り当てます。
仮想マシンの IP アドレスの末尾は１にしないようにしてください（後述）。&lt;/p>

&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">Vagrantfile（DHCP で構成する）&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-ruby" data-lang="ruby">&lt;span class="line">&lt;span class="cl">&lt;span class="no">Vagrant&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">configure&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;2&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="k">do&lt;/span> &lt;span class="o">|&lt;/span>&lt;span class="n">config&lt;/span>&lt;span class="o">|&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">config&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">vm&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">box&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s2">&amp;#34;hashicorp/precise64&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">config&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">vm&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">network&lt;/span> &lt;span class="s2">&amp;#34;private_network&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="ss">ip&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;192.168.100.10&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">end&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>

&lt;p>あとは Vagrant 仮想マシンをリロードすれば設定が反映されます。&lt;/p>
&lt;pre tabindex="0">&lt;code>$ vagrant reload
&lt;/code>&lt;/pre>&lt;h2 id="ホスト側に割り当てられるプライベートアドレス">ホスト側に割り当てられるプライベートアドレス&lt;/h2>
&lt;p>ホストオンリーネットワークを構成すると、&lt;strong>ホスト側のアドレスとしては、ネットワークアドレスの下位オクテット（最後の８ビット）が１になったアドレス&lt;/strong>が割り当てられます。
仮想マシン側のアドレスの末尾を１にしなかったのはそのためです。&lt;/p>
&lt;p>ホスト側の IP アドレスを確認してみると、Host-Only Network というセクションで、&lt;code>192.168.100.1&lt;/code> と割り振られていることがわかります。&lt;/p>
&lt;pre tabindex="0">&lt;code>C:\&amp;gt; ipconfig
...
イーサネット アダプター VirtualBox Host-Only Network #4:

 接続固有の DNS サフィックス . . . :
 リンクローカル IPv6 アドレス. . . . : fe80::840f:cd57:4fa2:9c8c%20
 IPv4 アドレス . . . . . . . . . . : 192.168.100.1
 サブネット マスク . . . . . . . . : 255.255.255.0
 デフォルト ゲートウェイ . . . . . :
...
&lt;/code>&lt;/pre>&lt;p>仮想マシン側からは、このアドレスを指定することでホストマシンにアクセスできます。&lt;/p></description></item><item><title>Vagrantメモ: 複数の仮想マシンで共通の SSH キーを使用する</title><link>https://maku77.github.io/p/y9zrmbf/</link><pubDate>Fri, 28 Oct 2016 00:00:00 +0900</pubDate><guid>https://maku77.github.io/p/y9zrmbf/</guid><description>&lt;p>Vagrant で作成した複数の仮想マシンを Ansible などでまとめて制御する場合、同じ SSH キーでアクセスできると便利だったりします。&lt;/p>
&lt;p>Vagrant 1.7 以降のデフォルトでは、作成した仮想マシンごとに異なる SSH キーが設定されます。
例えば、ここでは、下記のような &lt;code>Vagrantfile&lt;/code> を使用して３つの仮想マシンを作成してみます。&lt;/p>

&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">Vagrantfile&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-ruby" data-lang="ruby">&lt;span class="line">&lt;span class="cl">&lt;span class="no">BOX&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s2">&amp;#34;hashicorp/precise64&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="no">Vagrant&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">configure&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;2&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="k">do&lt;/span> &lt;span class="o">|&lt;/span>&lt;span class="n">config&lt;/span>&lt;span class="o">|&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">config&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">vm&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">define&lt;/span> &lt;span class="s2">&amp;#34;vagrant1&amp;#34;&lt;/span> &lt;span class="k">do&lt;/span> &lt;span class="o">|&lt;/span>&lt;span class="n">c&lt;/span>&lt;span class="o">|&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">c&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">vm&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">box&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="no">BOX&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">end&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">config&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">vm&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">define&lt;/span> &lt;span class="s2">&amp;#34;vagrant2&amp;#34;&lt;/span> &lt;span class="k">do&lt;/span> &lt;span class="o">|&lt;/span>&lt;span class="n">c&lt;/span>&lt;span class="o">|&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">c&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">vm&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">box&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="no">BOX&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">end&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">config&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">vm&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">define&lt;/span> &lt;span class="s2">&amp;#34;vagrant3&amp;#34;&lt;/span> &lt;span class="k">do&lt;/span> &lt;span class="o">|&lt;/span>&lt;span class="n">c&lt;/span>&lt;span class="o">|&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">c&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">vm&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">box&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="no">BOX&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">end&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">end&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>

&lt;p>立ち上げます。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-console" data-lang="console">&lt;span class="line">&lt;span class="cl">&lt;span class="gp">$&lt;/span> vagrant up
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">Bringing machine &amp;#39;vagrant1&amp;#39; up with &amp;#39;virtualbox&amp;#39; provider...
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">Bringing machine &amp;#39;vagrant2&amp;#39; up with &amp;#39;virtualbox&amp;#39; provider...
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">Bringing machine &amp;#39;vagrant3&amp;#39; up with &amp;#39;virtualbox&amp;#39; provider...
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>仮想マシンが作成されたら、&lt;code>vagrant ssh-config&lt;/code> コマンドを使用して、それぞれの SSH 接続情報を確認することができます。
仮想マシンごとに別々のプライベートキーが作成されていることが分かります（★の部分）。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-console" data-lang="console">&lt;span class="line">&lt;span class="cl">&lt;span class="gp">$&lt;/span> vagrant ssh-config
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">Host vagrant1
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go"> HostName 127.0.0.1
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go"> User vagrant
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go"> Port 2222
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go"> UserKnownHostsFile /dev/null
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go"> StrictHostKeyChecking no
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go"> PasswordAuthentication no
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go"> IdentityFile /home/maku/sandbox/.vagrant/machines/vagrant1/virtualbox/private_key ★
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go"> IdentitiesOnly yes
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go"> LogLevel FATAL
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">&lt;/span>&lt;span class="err">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="err">&lt;/span>&lt;span class="go">Host vagrant2
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go"> HostName 127.0.0.1
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go"> User vagrant
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go"> Port 2200
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go"> UserKnownHostsFile /dev/null
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go"> StrictHostKeyChecking no
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go"> PasswordAuthentication no
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go"> IdentityFile /home/maku/sandbox/.vagrant/machines/vagrant2/virtualbox/private_key ★
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go"> IdentitiesOnly yes
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go"> LogLevel FATAL
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">&lt;/span>&lt;span class="err">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="err">&lt;/span>&lt;span class="go">Host vagrant3
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go"> HostName 127.0.0.1
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go"> User vagrant
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go"> Port 2201
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go"> UserKnownHostsFile /dev/null
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go"> StrictHostKeyChecking no
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go"> PasswordAuthentication no
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go"> IdentityFile /home/maku/sandbox/.vagrant/machines/vagrant3/virtualbox/private_key ★
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go"> IdentitiesOnly yes
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go"> LogLevel FATAL
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>複数の仮想マシンでひとつの SSH キーを使用するようにするには、下記のように &lt;code>config.ssh.insert_key = false&lt;/code> を設定します。&lt;/p></description></item><item><title>Vagrantメモ: 不要な Vagrant 仮想マシンを削除する (vagrant destroy)</title><link>https://maku77.github.io/p/2gdbr8x/</link><pubDate>Thu, 27 Oct 2016 00:00:00 +0900</pubDate><guid>https://maku77.github.io/p/2gdbr8x/</guid><description>&lt;p>Vagrant で試行錯誤して仮想マシンを作っていると、以前作成した仮想マシンのゴミが残ってしまうことがあります。
ポートフォワード設定が重複してしまうと、新しい仮想マシンの起動も下記のように失敗してしまいます。&lt;/p>
&lt;pre tabindex="0">&lt;code>The forwarded port to 8080 is already in use on the host machine.
&lt;/code>&lt;/pre>&lt;h2 id="不要な仮想マシンを特定して１つずつ削除する">不要な仮想マシンを特定して１つずつ削除する&lt;/h2>
&lt;p>このような場合は、まず &lt;code>vagrant global-status&lt;/code> で Vagrant で管理されている仮想マシンの一覧を表示します。
&lt;code>vagrant status&lt;/code> と異なり、&lt;code>vagrant global-status&lt;/code> はどのディレクトリからでも実行でき、ホスト上のすべての Vagrant 環境に関する情報を表示してくれます。&lt;/p>
&lt;pre tabindex="0">&lt;code>C:\&amp;gt; vagrant global-status
id name provider state directory
--------------------------------------------------------------------------
963e6d9 vagrant1 virtualbox running D:/z/vagrant
dd68a71 vagrant2 virtualbox poweroff D:/z/vagrant

The above shows information about all known Vagrant environments
on this machine. This data is cached and may not be completely
up-to-date. To interact with any of the machines, you can go to
that directory and run Vagrant, or you can use the ID directly
with Vagrant commands from any directory. For example:
&amp;#34;vagrant destroy 1a2b3c4d&amp;#34;
&lt;/code>&lt;/pre>&lt;p>上記の情報を頼りにして、不要な仮想マシンを削除してしまえば OK です。&lt;/p></description></item><item><title>Vagrantメモ: 複数の仮想マシンを同時に立ち上げる</title><link>https://maku77.github.io/p/uu87xz5/</link><pubDate>Tue, 25 Oct 2016 00:00:00 +0900</pubDate><guid>https://maku77.github.io/p/uu87xz5/</guid><description>&lt;h2 id="複数の仮想マシンを立ち上げる">複数の仮想マシンを立ち上げる&lt;/h2>
&lt;p>Vagrant 仮想マシンとして複数のサーバを同時に立ち上げるには、&lt;code>Vagrantfile&lt;/code> の中で下記のようにそれぞれの仮想マシン定義を行います。
ここでは、すべて仮想マシンの box として &lt;code>hashicorp/precise&lt;/code> (Ubuntu 12.04) を指定していますが、仮想マシンごとに異なる box を設定することもできます。&lt;/p>

&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">Vagrantfile&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-ruby" data-lang="ruby">&lt;span class="line">&lt;span class="cl">&lt;span class="no">Vagrant&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">configure&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;2&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="k">do&lt;/span> &lt;span class="o">|&lt;/span>&lt;span class="n">config&lt;/span>&lt;span class="o">|&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">config&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">vm&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">box&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s2">&amp;#34;hashicorp/precise64&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">config&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">vm&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">define&lt;/span> &lt;span class="s2">&amp;#34;vagrant1&amp;#34;&lt;/span> &lt;span class="k">do&lt;/span> &lt;span class="o">|&lt;/span>&lt;span class="n">c&lt;/span>&lt;span class="o">|&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">c&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">vm&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">network&lt;/span> &lt;span class="s2">&amp;#34;forwarded_port&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="ss">guest&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mi">80&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="ss">host&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mi">10080&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">c&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">vm&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">network&lt;/span> &lt;span class="s2">&amp;#34;forwarded_port&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="ss">guest&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mi">443&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="ss">host&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mi">10443&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">end&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">config&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">vm&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">define&lt;/span> &lt;span class="s2">&amp;#34;vagrant2&amp;#34;&lt;/span> &lt;span class="k">do&lt;/span> &lt;span class="o">|&lt;/span>&lt;span class="n">c&lt;/span>&lt;span class="o">|&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">c&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">vm&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">network&lt;/span> &lt;span class="s2">&amp;#34;forwarded_port&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="ss">guest&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mi">80&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="ss">host&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mi">20080&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">c&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">vm&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">network&lt;/span> &lt;span class="s2">&amp;#34;forwarded_port&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="ss">guest&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mi">443&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="ss">host&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mi">20443&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">end&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">config&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">vm&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">define&lt;/span> &lt;span class="s2">&amp;#34;vagrant3&amp;#34;&lt;/span> &lt;span class="k">do&lt;/span> &lt;span class="o">|&lt;/span>&lt;span class="n">c&lt;/span>&lt;span class="o">|&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">c&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">vm&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">network&lt;/span> &lt;span class="s2">&amp;#34;forwarded_port&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="ss">guest&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mi">80&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="ss">host&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mi">30080&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">c&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">vm&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">network&lt;/span> &lt;span class="s2">&amp;#34;forwarded_port&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="ss">guest&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mi">443&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="ss">host&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mi">30443&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">end&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">end&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>

&lt;p>各仮想マシンのコンフィギュレーションブロック内でポートフォワード設定を行っていますが、単純に仮想マシンを立ち上げるだけであれば、このあたりの個別の設定は後回しにしても構いません。
あとは、&lt;code>vagrant up&lt;/code> とするだけで、すべての仮想マシンが順番に立ち上がります。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-console" data-lang="console">&lt;span class="line">&lt;span class="cl">&lt;span class="gp">$&lt;/span> vagrant up
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">Bringing machine &amp;#39;vagrant1&amp;#39; up with &amp;#39;virtualbox&amp;#39; provider...
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">Bringing machine &amp;#39;vagrant2&amp;#39; up with &amp;#39;virtualbox&amp;#39; provider...
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">Bringing machine &amp;#39;vagrant3&amp;#39; up with &amp;#39;virtualbox&amp;#39; provider...
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">...
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>ちゃんと稼働しているかどうかは &lt;code>vagrant status&lt;/code> コマンドで確認することができます。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-console" data-lang="console">&lt;span class="line">&lt;span class="cl">&lt;span class="gp">$&lt;/span> vagrant status
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">Current machine states:
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">&lt;/span>&lt;span class="err">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="err">&lt;/span>&lt;span class="go">vagrant1 running (virtualbox)
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">vagrant2 running (virtualbox)
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">vagrant3 running (virtualbox)
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">&lt;/span>&lt;span class="err">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="err">&lt;/span>&lt;span class="go">This environment represents multiple VMs. The VMs are all listed
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">above with their current state. For more information about a specific
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">VM, run `vagrant status NAME`.
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>それぞれの仮想マシンに SSH 接続するときは、下記のように &lt;code>vagrant ssh&lt;/code> コマンドのパラメータで仮想マシン名を指定します。&lt;/p></description></item><item><title>Vagrantメモ: ポートフォワードにより仮想マシン内のサーバにアクセスする</title><link>https://maku77.github.io/p/zssu72a/</link><pubDate>Mon, 24 Oct 2016 00:00:00 +0900</pubDate><guid>https://maku77.github.io/p/zssu72a/</guid><description>&lt;h2 id="ポートフォワードによるネットワーク構成について">ポートフォワードによるネットワーク構成について&lt;/h2>
&lt;p>Vagrant 仮想マシン内でサーバを立ち上げた場合、デフォルトではそのポートは仮想マシン内で閉じた世界のものになっています。
例えば、仮想マシン内で Web サーバをポート番号 80 で立ち上げただけでは、外の世界（ホスト側）から &lt;code>http://localhost/&lt;/code> でアクセスできるようにはなりません。
外の世界から仮想マシン内のサーバにアクセスできるようにするための方法として、ポートフォワードがあります（&lt;a href="../p/ymenseo/">ブリッジネットワークを構築する&lt;/a>方法もあります）。&lt;/p>
&lt;p>ポートフォワードの設定では、ホストマシンのあるポート番号を、特定の仮想マシンのポート番号にマッピングします。
ホストマシンの特定のポート番号にアクセスがあったときに、ホストマシンが仮想マシンに対してリクエストを転送することで、間接的に仮想マシンへ接続されます。&lt;/p>
&lt;pre tabindex="0">&lt;code>LAN 上のマシン ----[port:10080]----&amp;gt; ホスト ----[port:80]----&amp;gt; 仮想マシン
&lt;/code>&lt;/pre>&lt;p>ポートフォワードを利用したネットワーク構成では、既存の物理 LAN 上の別のマシンからは、ホストマシンの IP アドレスしか見えません。
仮想マシンの存在は隠蔽されており、ホストマシンですべてのサービスが提供されているかのように見えます。&lt;/p>
&lt;h2 id="ポートフォワードの設定を行う">ポートフォワードの設定を行う&lt;/h2>
&lt;p>&lt;code>Vagrantfile&lt;/code> ファイルの中で、&lt;code>config.vm.network&lt;/code> に &lt;strong>&lt;code>forwarded_port&lt;/code>&lt;/strong> を設定することで、ポートフォワードの設定を行うことができます。
下記は、仮想マシン内の HTTP (80) と HTTPS (443) のポートを、ホスト側のポート 10080 と 10443 にそれぞれマッピングする例です。&lt;/p>

&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">Vagrantfile&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-ruby" data-lang="ruby">&lt;span class="line">&lt;span class="cl">&lt;span class="no">Vagrant&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">configure&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;2&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="k">do&lt;/span> &lt;span class="o">|&lt;/span>&lt;span class="n">config&lt;/span>&lt;span class="o">|&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">config&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">vm&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">box&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s2">&amp;#34;hashicorp/precise64&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">config&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">vm&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">network&lt;/span> &lt;span class="s2">&amp;#34;forwarded_port&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="ss">guest&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mi">80&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="ss">host&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mi">10080&lt;/span> &lt;span class="c1"># HTTP&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">config&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">vm&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">network&lt;/span> &lt;span class="s2">&amp;#34;forwarded_port&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="ss">guest&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mi">443&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="ss">host&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mi">10443&lt;/span> &lt;span class="c1"># HTTPS&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">end&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>

&lt;p>設定を変更したら、仮想マシンをリロードして反映させます。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-console" data-lang="console">&lt;span class="line">&lt;span class="cl">&lt;span class="gp">$&lt;/span> vagrant reload
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">...
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">==&amp;gt; default: Forwarding ports...
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go"> default: 80 (guest) =&amp;gt; 10080 (host) (adapter 1)
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go"> default: 443 (guest) =&amp;gt; 10443 (host) (adapter 1)
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go"> default: 22 (guest) =&amp;gt; 2222 (host) (adapter 1)
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">...
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>これで、Web ブラウザなどから &lt;code>http://localhost:10080/&lt;/code> にアクセスしたときに、仮想マシン内の Web サーバの 80 ポートに繋がるようになります（もちろん、仮想マシン側で nginx などの Web サーバを立ち上げておく必要があります）。&lt;/p></description></item><item><title>Vagrantメモ: Vagrant プラグインを vagrant up で自動的にインストールする</title><link>https://maku77.github.io/p/3wvm5wi/</link><pubDate>Fri, 21 Oct 2016 00:00:00 +0900</pubDate><guid>https://maku77.github.io/p/3wvm5wi/</guid><description>&lt;p>Vagrant のプラグインは下記のようにインストールすることができます。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-console" data-lang="console">&lt;span class="line">&lt;span class="cl">&lt;span class="gp">$&lt;/span> vagrant plugin install ＜プラグイン名＞
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;code>Vagrantfile&lt;/code> に下記のように記述しておけば、プラグインのインストールを、&lt;code>vagrant up&lt;/code> 時に自動的に行うことができるようになります。&lt;/p>

&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">Vagrantfile&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-ruby" data-lang="ruby">&lt;span class="line">&lt;span class="cl">&lt;span class="k">def&lt;/span> &lt;span class="nf">install_plugin&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">plugin&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nb">system&lt;/span> &lt;span class="s2">&amp;#34;vagrant plugin install &lt;/span>&lt;span class="si">#{&lt;/span>&lt;span class="n">plugin&lt;/span>&lt;span class="si">}&lt;/span>&lt;span class="s2">&amp;#34;&lt;/span> &lt;span class="k">unless&lt;/span> &lt;span class="no">Vagrant&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">has_plugin?&lt;/span> &lt;span class="n">plugin&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">end&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 必要なプラグインを指定&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">install_plugin&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;vagrant-proxyconf&amp;#39;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="no">Vagrant&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">configure&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;2&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="k">do&lt;/span> &lt;span class="o">|&lt;/span>&lt;span class="n">config&lt;/span>&lt;span class="o">|&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">config&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">vm&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">box&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s2">&amp;#34;hashicorp/precise64&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># ...&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">end&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>


&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">実行例&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-console" data-lang="console">&lt;span class="line">&lt;span class="cl">&lt;span class="gp">$&lt;/span> vagrant up
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">Installing the &amp;#39;vagrant-proxyconf&amp;#39; plugin. This can take a few minutes...
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">Installed the plugin &amp;#39;vagrant-proxyconf (1.5.2)&amp;#39;!
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">Bringing machine &amp;#39;default&amp;#39; up with &amp;#39;virtualbox&amp;#39; provider...
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure></description></item><item><title>Vagrantメモ: ホストマシンと仮想マシンでファイルを共有する</title><link>https://maku77.github.io/p/ad8jegg/</link><pubDate>Fri, 21 Oct 2016 00:00:00 +0900</pubDate><guid>https://maku77.github.io/p/ad8jegg/</guid><description>&lt;p>Vagrant ホスト側の &lt;code>Vagrantfile&lt;/code> の置かれているディレクトリは、仮想マシン側からは、&lt;code>/vagrant&lt;/code> というパスで参照することができます。&lt;/p>
&lt;pre tabindex="0">&lt;code>vagrant@precise64:~$ ls /vagrant
Vagrantfile
&lt;/code>&lt;/pre>&lt;p>この性質を利用して、仮想マシン側で使用するシェルスクリプトを、ホスト側のエディタで編集するといったことが可能になります。&lt;/p></description></item><item><title>Vagrantメモ: 仮想マシンでシェルスクリプトを実行する</title><link>https://maku77.github.io/p/4qkuf64/</link><pubDate>Fri, 21 Oct 2016 00:00:00 +0900</pubDate><guid>https://maku77.github.io/p/4qkuf64/</guid><description>&lt;p>Vagrant では、仮想マシンの作成時にシェルスクリプトを実行して、サーバ環境のセットアップを行うことができます。
下記のように、&lt;code>config.vm.provision&lt;/code> でシェルスクリプトを指定しておくと、仮想マシン側で任意の処理を実行することができます。&lt;/p>
&lt;h2 id="外部のシェルスクリプトファイルを実行する">外部のシェルスクリプトファイルを実行する&lt;/h2>

&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">Vagrantfile&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-ruby" data-lang="ruby">&lt;span class="line">&lt;span class="cl">&lt;span class="no">Vagrant&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">configure&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;2&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="k">do&lt;/span> &lt;span class="o">|&lt;/span>&lt;span class="n">config&lt;/span>&lt;span class="o">|&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">config&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">vm&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">box&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s2">&amp;#34;hashicorp/precise64&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">config&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">vm&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">provision&lt;/span> &lt;span class="ss">:shell&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="ss">path&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;bootstrap.sh&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">end&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>

&lt;p>シェルスクリプトは、&lt;code>Vagrantfile&lt;/code> があるディレクトリと同じディレクトリに置きます。&lt;/p>

&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">bootstrap.sh&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="line">&lt;span class="cl">apt-get update
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">apt-get install -y nginx&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>

&lt;p>&lt;code>config.vm.provision&lt;/code> で指定したシェルスクリプトは、仮想マシンの作成し直したときか、&lt;code>vagrant provision&lt;/code> コマンドを実行したときに実行されます。
仮想マシンを作成し直すには、&lt;code>vagrant destroy&lt;/code> と &lt;code>vagrant up&lt;/code> の実行が必要なため時間がかかります。
テストで実行する場合は、&lt;code>vagrant provision&lt;/code> コマンドを使用するとよいでしょう。&lt;/p>

&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">起動中の仮想マシンで provision 実行&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-console" data-lang="console">&lt;span class="line">&lt;span class="cl">&lt;span class="gp">$&lt;/span> vagrant provision
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>

&lt;h2 id="vagrantfile-に埋め込んだシェルスクリプトを実行する">Vagrantfile に埋め込んだシェルスクリプトを実行する&lt;/h2>
&lt;p>下記のようにすれば、仮想マシンで実行したいシェルスクリプトを &lt;code>Vagrantfile&lt;/code> ファイル内に埋め込むことができます。&lt;/p>

&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">Vagrantfile&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-ruby" data-lang="ruby">&lt;span class="line">&lt;span class="cl">&lt;span class="no">Vagrant&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">configure&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;2&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="k">do&lt;/span> &lt;span class="o">|&lt;/span>&lt;span class="n">config&lt;/span>&lt;span class="o">|&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">config&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">vm&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">box&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s2">&amp;#34;hashicorp/precise64&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">config&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">vm&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">provision&lt;/span> &lt;span class="ss">:shell&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="ss">inline&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="vg">$script&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">end&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="vg">$script&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s">&amp;lt;&amp;lt;END
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">&lt;/span>&lt;span class="n">apt&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">get&lt;/span> &lt;span class="n">update&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">apt&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">get&lt;/span> &lt;span class="n">install&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="n">y&lt;/span> &lt;span class="n">nginx&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">END&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>


&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">provision 実行&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-console" data-lang="console">&lt;span class="line">&lt;span class="cl">&lt;span class="gp">$&lt;/span> vagrant provision
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>

&lt;h2 id="詳細なコンフィギュレーションには-ansible-を使うべし">詳細なコンフィギュレーションには Ansible を使うべし&lt;/h2>
&lt;p>上記のように、シェルスクリプトを利用してサーバ環境のセットアップを行うものよいのですが、シェルスクリプトは、あくまで仮想マシン作成時に一度だけ実行することを前提としています。
設定を少しずつ変更しながら環境を構築していきたい場合などは、Ansible や Chef などのツールを使用するのがオススメです。
Ansible や Chef には冪統性（べきとうせい）を保証する仕組みが備わっており、試行錯誤しながら最終的なコンフィギュレーションに近づけていくことができます。&lt;/p></description></item><item><title>Vagrantメモ: 仮想マシンのプロキシを設定する</title><link>https://maku77.github.io/p/jgcwrrg/</link><pubDate>Fri, 21 Oct 2016 00:00:00 +0900</pubDate><guid>https://maku77.github.io/p/jgcwrrg/</guid><description>&lt;p>Vagrant の仮想マシン側のプロキシ設定を行うには、&lt;strong>vagrant-proxyconf&lt;/strong> プラグインを使用すると便利です。&lt;/p>
&lt;h2 id="vagrant-proxyconf-によるプロキシ設定">vagrant-proxyconf によるプロキシ設定&lt;/h2>
&lt;p>Vagrant のプラグインは、&lt;code>vagrant plugin install&lt;/code> で簡単にインストールすることができます。&lt;/p>

&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">vagrant-proxyconf プラグインのインストール&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-console" data-lang="console">&lt;span class="line">&lt;span class="cl">&lt;span class="gp">$&lt;/span> vagrant plugin install vagrant-proxyconf
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">Installing the &amp;#39;vagrant-proxyconf&amp;#39; plugin. This can take a few minutes...
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">Installed the plugin &amp;#39;vagrant-proxyconf (1.5.2)&amp;#39;!
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>

&lt;p>あとは、&lt;code>Vagrantfile&lt;/code> の中で下記のようにプロキシ設定を行います。&lt;/p>

&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">Vagrantfile&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-ruby" data-lang="ruby">&lt;span class="line">&lt;span class="cl">&lt;span class="no">Vagrant&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">configure&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;2&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="k">do&lt;/span> &lt;span class="o">|&lt;/span>&lt;span class="n">config&lt;/span>&lt;span class="o">|&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">config&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">vm&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">box&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s2">&amp;#34;hashicorp/precise64&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">config&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">proxy&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">http&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s2">&amp;#34;http://proxy.example.com:8080&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">config&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">proxy&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">https&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s2">&amp;#34;http://proxy.example.com:8080&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">config&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">proxy&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">no_proxy&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s2">&amp;#34;localhost,127.0.0.1&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">end&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>

&lt;p>すると、Vagrant 仮想マシンを立ち上げるときに、自動的に各アプリ用のプロキシが設定されます。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-console" data-lang="console">&lt;span class="line">&lt;span class="cl">&lt;span class="gp">$&lt;/span> vagrant up
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">...
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">==&amp;gt; default: Configuring proxy for Apt...
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">==&amp;gt; default: Configuring proxy environment variables...
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>これで、Vagrant 仮想マシンから &lt;code>apt-get&lt;/code> コマンドなどを実行したときにプロキシ経由でアクセスするようになります。&lt;/p>
&lt;h2 id="ホスト側の環境変数-http_proxy-の値で仮想マシンのプロキシを設定する">ホスト側の環境変数 http_proxy の値で仮想マシンのプロキシを設定する&lt;/h2>
&lt;p>Ruby では、環境変数の値を &lt;code>ENV&lt;/code> で取得できるので、下記のようにすれば、ホスト側のプロキシ設定 (&lt;code>http_proxy&lt;/code>) を、仮想マシン側のプロキシ設定にも反映することができます。&lt;/p></description></item><item><title>Vagrantメモ: Vagrant により仮想マシンを立ち上げる</title><link>https://maku77.github.io/p/4trtqtw/</link><pubDate>Wed, 19 Oct 2016 00:00:00 +0900</pubDate><guid>https://maku77.github.io/p/4trtqtw/</guid><description>&lt;p>Vagrant は、仮想マシンの構成をするための情報として &lt;strong>&lt;code>Vagrantfile&lt;/code>&lt;/strong> というファイルを参照するので、まずはこのファイルを作成する必要があります。&lt;/p>
&lt;h2 id="vagrantfile-を生成する">Vagrantfile を生成する&lt;/h2>
&lt;p>&lt;code>vagrant init&lt;/code> コマンドで、&lt;code>Vagrantfile&lt;/code> の雛形を生成することができます。
ここでは、HashiCorp の提供している Ubuntu 12.04 LTS 64-bit のイメージ (&lt;code>hashicorp/precise64&lt;/code>) を使用するように指定しています。&lt;/p>
&lt;pre tabindex="0">&lt;code>$ vagrant init hashicorp/precise64

A `Vagrantfile` has been placed in this directory. You are now
ready to `vagrant up` your first virtual environment! Please read
the comments in the Vagrantfile as well as documentation on
`vagrantup.com` for more information on using Vagrant.
&lt;/code>&lt;/pre>&lt;p>仮想マシンのベースとなる OS イメージのことを &lt;strong>box&lt;/strong> と呼びます。
デフォルトで使用可能な box は下記のようなものが用意されており、他の box は &lt;a href="https://atlas.hashicorp.com/boxes/search">HashiCorp&amp;rsquo;s Atlas&lt;/a> で探すことができます。&lt;/p></description></item><item><title>Vagrantメモ: Vagrant の仮想マシンに SSH で接続する</title><link>https://maku77.github.io/p/itd26k3/</link><pubDate>Wed, 19 Oct 2016 00:00:00 +0900</pubDate><guid>https://maku77.github.io/p/itd26k3/</guid><description>&lt;h2 id="vagrant-ssh-コマンドで-ssh-接続する">vagrant ssh コマンドで SSH 接続する&lt;/h2>
&lt;p>&lt;code>vagrant up&lt;/code> コマンドによる仮想マシンの起動が終わると、SSH でシェル接続が可能になります。
通常、SSH での接続にはサーバアドレスやユーザ ID の指定などが必要ですが、Vagrant によって立ち上げられた仮想マシンには、&lt;code>vagrant ssh&lt;/code> コマンドを使用して簡単に SSH 接続できるようになっています。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-console" data-lang="console">&lt;span class="line">&lt;span class="cl">&lt;span class="gp">$&lt;/span> vagrant ssh
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="err">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="err">&lt;/span>&lt;span class="go">Welcome to Ubuntu 12.04 LTS (GNU/Linux 3.2.0-23-generic x86_64)
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">&lt;/span>&lt;span class="err">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="err">&lt;/span>&lt;span class="go"> * Documentation: https://help.ubuntu.com/
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">Welcome to your Vagrant-built virtual machine.
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">Last login: Wed Oct 19 06:59:47 2016 from 10.0.2.2
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">&lt;/span>&lt;span class="err">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="err">&lt;/span>&lt;span class="go">vagrant@precise64:~$
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;code>vagrant ssh&lt;/code> 経由で Vagrant の仮想マシンに接続するには、OpenSSH ベースの SSH クライアントがインストールされている必要があります。&lt;/p>

&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">SSH クライアントがインストールされていない場合のエラー&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-console" data-lang="console">&lt;span class="line">&lt;span class="cl">&lt;span class="gp">$&lt;/span> vagrant ssh
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">`ssh` executable not found in any directories in the %PATH% variable.
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>


&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">OpenSSH ではない SSH クライアントがインストールされている場合（ここでは PuTTy）のエラー&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-console" data-lang="console">&lt;span class="line">&lt;span class="cl">&lt;span class="gp">$&lt;/span> vagrant ssh
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">The `ssh` executable found in the PATH is a PuTTY Link SSH client.
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">Vagrant is only compatible with OpenSSH SSH clients. Please install
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">an OpenSSH SSH client or manually SSH in using your existing client
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">using the information below.
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">&lt;/span>&lt;span class="err">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="err">&lt;/span>&lt;span class="go">Host: 127.0.0.1
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">Port: 2222
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">Username: vagrant
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">Private key: D:/z/vagrant/.vagrant/machines/default/virtualbox/private_key
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>

&lt;p>Windows 用の OpenSSH クライアントは下記からダウンロードできます。&lt;/p></description></item><item><title>Vagrantメモ: Vagrant とは？ Vagrant をインストールする</title><link>https://maku77.github.io/p/dwwvd7z/</link><pubDate>Tue, 18 Oct 2016 00:00:00 +0900</pubDate><guid>https://maku77.github.io/p/dwwvd7z/</guid><description>&lt;h2 id="vagrant-とは">Vagrant とは？&lt;/h2>
&lt;p>Vagrant（ベイグラント）は、仮想環境の構築（OS 自体のインストールを含む）から設定までを自動で行うためのソフトウェアです。&lt;/p>
&lt;ul>
&lt;li>Vagrantfile という設定ファイルを記述しておくと、同じ OS 環境、同じソフトウェアのインストールから設定を１ステップ (&lt;code>vagrant up&lt;/code>) で再現できるようになります。&lt;/li>
&lt;li>VirtualBox、VMware、Hyper-V などのローカルの仮想環境だけでなく、AWS (Amazon EC2) などのクラウド上の仮想環境もサポートします（Vagrant ではこれらを provider と呼びます）。共通の Vagrantfile を使用しつつ、立ち上げ先の環境だけを切り替えることができる (&lt;code>vagrant up --provider=aws&lt;/code>) ので、VirtualBox から AWS へ乗り換えた場合なども、同じワークフローで環境構築できます（→ 運用エンジニア (Ops) のメリット）。&lt;/li>
&lt;li>各開発者が同一のサーバ環境を構築できるようになり、開発環境の構築ミスによるエラーを防ぐことができます（→ 開発エンジニア (Dev) のメリット）。&lt;/li>
&lt;li>環境構築の手順がコードによって管理されることにより、従来のソフトウェア開発においてソースコードに対して適用されていた、バージョン管理、レビュー、テストなどのプロセスを環境構築にも適用することができるようになります (→ IaaS: Infrastructure as a Code)。&lt;/li>
&lt;li>Vagrant 自体の開発言語は Ruby です。&lt;/li>
&lt;/ul>
&lt;h2 id="vagrant-をインストールする">Vagrant をインストールする&lt;/h2>
&lt;p>各 OS 用の Vagrant パッケージは下記からダウンロードできます。&lt;/p>
&lt;ul>
&lt;li>&lt;a href="https://www.vagrantup.com/">Vagrant by HashiCorp&lt;/a>&lt;/li>
&lt;/ul>
&lt;p>Vagrant 1.8.6 for Windows のパッケージサイズは 167 MB です。
正しくインストールできたかどうかは、下記のように確認できます。&lt;/p>
&lt;pre tabindex="0">&lt;code>D:\&amp;gt; vagrant --version
Vagrant 1.8.6
&lt;/code>&lt;/pre>&lt;p>仮想環境として、VirtualBox を使用する場合は、VirtualBox も別途インストールしておく必要があります。
AWS などのクラウド環境を使用する場合は、VirtualBox のインストールは必要ありません。&lt;/p></description></item></channel></rss>