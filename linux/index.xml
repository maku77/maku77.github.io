<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>Linux/Shell on 天才まくまくノート</title><link>https://maku77.github.io/linux/</link><description>Recent content in Linux/Shell on 天才まくまくノート</description><generator>Hugo</generator><language>ja-jp</language><lastBuildDate>Sun, 12 Oct 2025 00:00:00 +0900</lastBuildDate><atom:link href="https://maku77.github.io/linux/index.xml" rel="self" type="application/rss+xml"/><item><title>Linuxシェルスクリプト: 名前付きのコマンドラインオプションを扱う (getopts)</title><link>https://maku77.github.io/p/2fyizgw/</link><pubDate>Mon, 05 Dec 2022 00:00:00 +0900</pubDate><guid>https://maku77.github.io/p/2fyizgw/</guid><description>&lt;p>Bash 組み込みの &lt;strong>&lt;code>getopts&lt;/code>&lt;/strong> コマンドを使用すると、シェルスクリプトに渡されたコマンドラインオプション (&lt;code>-a&lt;/code> など）を解析することができます。
&lt;code>getopts&lt;/code> は 1 文字のオプションしか扱えないことに注意してください。&lt;/p>
&lt;h2 id="引数なしのオプション">引数なしのオプション&lt;/h2>
&lt;p>下記は &lt;code>getopts&lt;/code> の基本的な使用例です。
&lt;code>getopts&lt;/code> のオプション文字列として &lt;code>abc&lt;/code> を指定することにより、このシェルスクリプトで、&lt;strong>&lt;code>-a&lt;/code>&lt;/strong>、&lt;strong>&lt;code>-b&lt;/code>&lt;/strong>、&lt;strong>&lt;code>-c&lt;/code>&lt;/strong> という 3 種類のオプションを受け取れるようになっています。
ユーザーが指定したオプションが、1 文字ずつ &lt;code>opt&lt;/code> 変数に格納されるので、その値で &lt;code>case&lt;/code> による分岐処理を行います。&lt;/p>

&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">sample.sh&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">&lt;span class="cp">#!/bin/bash
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cp">&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">while&lt;/span> &lt;span class="nb">getopts&lt;/span> &lt;span class="s1">&amp;#39;abc&amp;#39;&lt;/span> opt&lt;span class="p">;&lt;/span> &lt;span class="k">do&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">case&lt;/span> &lt;span class="s2">&amp;#34;&lt;/span>&lt;span class="si">${&lt;/span>&lt;span class="nv">opt&lt;/span>&lt;span class="si">}&lt;/span>&lt;span class="s2">&amp;#34;&lt;/span> in
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> a&lt;span class="o">)&lt;/span> &lt;span class="nb">echo&lt;/span> &lt;span class="s2">&amp;#34;オプション -a を指定しました&amp;#34;&lt;/span> &lt;span class="p">;;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> b&lt;span class="o">)&lt;/span> &lt;span class="nb">echo&lt;/span> &lt;span class="s2">&amp;#34;オプション -b を指定しました&amp;#34;&lt;/span> &lt;span class="p">;;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> c&lt;span class="o">)&lt;/span> &lt;span class="nb">echo&lt;/span> &lt;span class="s2">&amp;#34;オプション -c を指定しました&amp;#34;&lt;/span> &lt;span class="p">;;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">esac&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">done&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>


&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">実行例&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-console" data-lang="console">&lt;span class="line">&lt;span class="cl">&lt;span class="gp">$&lt;/span> ./sample.sh -a
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">オプション -a を指定しました
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">&lt;/span>&lt;span class="err">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="err">&lt;/span>&lt;span class="gp">$&lt;/span> ./sample.sh -a -c
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">オプション -a を指定しました
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">オプション -c を指定しました
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">&lt;/span>&lt;span class="err">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="err">&lt;/span>&lt;span class="gp">$&lt;/span> ./sample.sh -x
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">./sample.sh: illegal option -- x
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>

&lt;p>最後の実行例から分かるように、&lt;code>getopts&lt;/code> は定義されていないオプション (&lt;code>-x&lt;/code>) を指定したときに、自動的にエラーメッセージ (&lt;code>illegal option&lt;/code>) を出力します。
このエラー出力を抑制するには、次のように、オプション文字列の先頭に &lt;strong>&lt;code>:&lt;/code>&lt;/strong> を付け、&lt;strong>&lt;code>:abc&lt;/code>&lt;/strong> のように指定します。
不正なオプションが指定された場合は、&lt;code>opt&lt;/code> 変数の値が &lt;strong>&lt;code>?&lt;/code>&lt;/strong> になるので、自分でエラー処理を行うことも可能です。&lt;/p></description></item><item><title>Linuxメモ: echo の結果を標準エラー出力 (stderr) に出力する</title><link>https://maku77.github.io/p/q2k3j2h/</link><pubDate>Mon, 05 Dec 2022 00:00:00 +0900</pubDate><guid>https://maku77.github.io/p/q2k3j2h/</guid><description>&lt;h2 id="標準エラー出力への出力">標準エラー出力への出力&lt;/h2>
&lt;p>&lt;code>echo&lt;/code> コマンドの出力結果を、デフォルトの標準出力ではなく、標準エラー出力に出力するには、末尾で &lt;strong>&lt;code>1&amp;gt;&amp;amp;2&lt;/code>&lt;/strong> のようにリダイレクトします（&lt;strong>&lt;code>&amp;gt;&amp;amp;2&lt;/code>&lt;/strong> という省略形でも OK）。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">&lt;span class="cp">#!/bin/bash
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cp">&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">echo&lt;/span> &lt;span class="s2">&amp;#34;Hello World&amp;#34;&lt;/span> 1&amp;gt;&lt;span class="p">&amp;amp;&lt;/span>&lt;span class="m">2&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>このように出力先を制御したプログラムは、実行結果をリダイレクトしたり、パイプ接続した場合の振る舞いに影響してきます。&lt;/p>

&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">sample.sh&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">&lt;span class="cp">#!/bin/bash
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cp">&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">echo&lt;/span> AAA
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">echo&lt;/span> BBB 1&amp;gt;&lt;span class="p">&amp;amp;&lt;/span>&lt;span class="m">2&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">echo&lt;/span> CCC&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>

&lt;p>上記のプログラムの出力結果を &lt;code>out.txt&lt;/code> というファイルにリダイレクトすると、ターミナル上には &lt;code>BBB&lt;/code> という標準エラー出力のみが表示されます。&lt;/p>

&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">実行例&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-console" data-lang="console">&lt;span class="line">&lt;span class="cl">&lt;span class="gp">$&lt;/span> ./sample.sh &amp;gt; out.txt
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">BBB
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>


&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">out.txt の内容&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-plain" data-lang="plain">&lt;span class="line">&lt;span class="cl">AAA
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">CCC&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>

&lt;h2 id="cat-の場合">cat の場合&lt;/h2>
&lt;p>&lt;code>cat&lt;/code> コマンドによるヒアドキュメントでも、標準エラー出力に出力できます。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">cat 1&amp;gt;&lt;span class="p">&amp;amp;&lt;/span>&lt;span class="m">2&lt;/span> &lt;span class="s">&amp;lt;&amp;lt;EOF
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">AAA AAA AAA
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">BBB BBB BBB
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">CCC CCC CCC
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">EOF&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>シェルスクリプトの Usage 出力などに便利です。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">usage&lt;span class="o">()&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> cat 1&amp;gt;&lt;span class="p">&amp;amp;&lt;/span>&lt;span class="m">2&lt;/span> &lt;span class="s">&amp;lt;&amp;lt;EOF
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">Usage: $(basename $0) [OPTIONS]
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">Options:
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> -h Display this message
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> -d DIR Output directory (default: .)
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> -v Use verbose output
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">EOF&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nb">exit&lt;/span> -1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="その他の出力先制御">その他の出力先制御&lt;/h2>
&lt;p>コマンドの出力をさまざまな形でリダイレクトすることで、本来の標準出力、標準エラー出力への出力を次のように振り分けることができます。&lt;/p></description></item><item><title>Linux シェルスクリプト: expect で外部コマンドの出力を待機する</title><link>https://maku77.github.io/p/3i3j2hx/</link><pubDate>Sat, 10 Nov 2018 00:00:00 +0900</pubDate><guid>https://maku77.github.io/p/3i3j2hx/</guid><description>&lt;p>Linux や macOS の &lt;strong>&lt;code>expect&lt;/code>&lt;/strong> コマンドを使用すると、任意のコマンドの出力を待ち受けて、自動でそれに応答するといったことを実現できます。&lt;/p>
&lt;h2 id="expect-の基本的な使い方">expect の基本的な使い方&lt;/h2>
&lt;p>&lt;code>expect&lt;/code> がインストールされていない場合は、パッケージ管理ツール（&lt;code>apt&lt;/code> や &lt;code>yum&lt;/code>）を使用してインストールしてください（macOS には最初からインストールされています）。
まずは、簡単な例として、下記のような簡単なユーザ入力を必要とするスクリプトを自動で動作させてみます。&lt;/p>

&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">greet.sh&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">&lt;span class="cp">#!/bin/bash
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cp">&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">echo&lt;/span> -n &lt;span class="s2">&amp;#34;Enter your name: &amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">read&lt;/span> name
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">echo&lt;/span> &lt;span class="s2">&amp;#34;Hello, &lt;/span>&lt;span class="nv">$name&lt;/span>&lt;span class="s2">&amp;#34;&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>

&lt;p>これをそのまま実行すると、下記のようにユーザ入力の待ち受け状態となります。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-console" data-lang="console">&lt;span class="line">&lt;span class="cl">&lt;span class="gp">$&lt;/span> ./greet.sh
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">Enter your name:
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>このような状態になったときに、自動的に入力を行うには、下記のように &lt;strong>&lt;code>expect -c&lt;/code>&lt;/strong> コマンドを使ったシェルスクリプトを作成します。&lt;/p>

&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">sample.sh&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">&lt;span class="cp">#!/bin/bash
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cp">&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">expect -c &lt;span class="s2">&amp;#34;
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s2"> set timeout 3
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s2"> spawn ./greet.sh
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s2"> expect \&amp;#34;Enter your name:\&amp;#34;
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s2"> send \&amp;#34;Maku\n\&amp;#34;
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s2"> interact
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s2">&amp;#34;&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>

&lt;p>&lt;code>expect -c&lt;/code> の後ろのダブルクォートで囲まれた部分には、&lt;code>expect&lt;/code> で実行するスクリプトを記述します。
この中でダブルクォートを使用したいときは、&lt;code>\&amp;quot;&lt;/code> のようにエスケープしなければいけないことに注意してください。
スクリプト中の各行は次のような意味を持っています。&lt;/p>
&lt;ul>
&lt;li>&lt;code>set timeout 3&lt;/code> &amp;hellip; 外部プログラムの実行を 3 秒待つ&lt;/li>
&lt;li>&lt;code>spawn ./greet.sh&lt;/code> &amp;hellip; 指定した外部プログラム (&lt;code>./greet.sh&lt;/code>) を実行する&lt;/li>
&lt;li>&lt;code>expect &amp;quot;Enter your name:&amp;quot;&lt;/code> &amp;hellip; 外部プログラムの出力 (&lt;code>Enter your name:&lt;/code>) を待つ&lt;/li>
&lt;li>&lt;code>send &amp;quot;Maku\n&amp;quot;&lt;/code> &amp;hellip; 外部プログラムに Maku → Enter と入力する&lt;/li>
&lt;li>&lt;code>interact&lt;/code> &amp;hellip; 外部プログラムとのインタラクションへ戻る&lt;/li>
&lt;/ul>
&lt;p>上記のシェルスクリプトを実行すると、外部プログラム &lt;code>greet.sh&lt;/code> の入力待ちに対して、自動的に &lt;code>Maku&lt;/code> という入力を行います。&lt;/p></description></item><item><title>Linuxメモ: echo で出力した文字列の中の連続するスペースが 1 つのスペースになってしまうのを防ぐ</title><link>https://maku77.github.io/p/25gqyai/</link><pubDate>Thu, 11 Oct 2018 00:00:00 +0900</pubDate><guid>https://maku77.github.io/p/25gqyai/</guid><description>&lt;p>Linux の &lt;code>echo&lt;/code> コマンドで文字列変数 &lt;code>$str&lt;/code> の値を出力しようとして、下記のように実行すると、文字列に含まれている連続するスペースが 1 つのスペースにまとめられてしまいます。&lt;/p>

&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">sample.sh（間違った方法）&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">&lt;span class="cp">#!/bin/bash
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cp">&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv">str&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;AAA BBB CCC&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">echo&lt;/span> &lt;span class="nv">$str&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>


&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">実行結果&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-plain" data-lang="plain">&lt;span class="line">&lt;span class="cl">AAA BBB CCC&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>

&lt;p>これは、変数展開が行われることによってダブルクォートが取り除かれ、下記のように &lt;code>echo&lt;/code> コマンドに 3 つのパラメータが渡されたものとして扱われるからです。
パラメータの区切りとして使われるスペースの数は関係なく、各パラメータ (&lt;code>AAA&lt;/code>、&lt;code>BBB&lt;/code>、&lt;code>CCC&lt;/code>) が 1 つのスペースで結合されて出力されます。&lt;/p>

&lt;figure class="xCodeBlock">

&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-console" data-lang="console">&lt;span class="line">&lt;span class="cl">&lt;span class="gp">$&lt;/span> &lt;span class="nb">echo&lt;/span> AAA BBB CCC
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">AAA BBB CCC
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>

&lt;p>スペースを含む文字列を 1 つの文字列として &lt;code>echo&lt;/code> コマンドに渡すには、次のようにダブルクォートで囲む必要があります。&lt;/p>

&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">sample.sh（正しい方法）&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">&lt;span class="cp">#!/bin/bash
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cp">&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv">str&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;AAA BBB CCC&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">echo&lt;/span> &lt;span class="s2">&amp;#34;&lt;/span>&lt;span class="nv">$str&lt;/span>&lt;span class="s2">&amp;#34;&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>


&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">実行結果&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-plain" data-lang="plain">&lt;span class="line">&lt;span class="cl">AAA BBB CCC&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure></description></item><item><title>Linuxメモ: シェルスクリプトのコーディングスタイル</title><link>https://maku77.github.io/p/oukq4dh/</link><pubDate>Tue, 25 Sep 2018 00:00:00 +0900</pubDate><guid>https://maku77.github.io/p/oukq4dh/</guid><description>&lt;p>Bash のシェルスクリプトを記述するときに最低限揃えておきたいコーディングスタイルです。
&lt;a href="http://google.github.io/styleguide/shell.xml">Google のコーディングスタイル&lt;/a>を参考にしています。&lt;/p>
&lt;ul>
&lt;li>基本的に bash を使用することとし、1 行目の Shebang として &lt;code>#!/bin/bash&lt;/code> と記述する&lt;/li>
&lt;li>インデント: 半角スペース &lt;strong>2&lt;/strong> 文字（タブ文字は使用しない）&lt;/li>
&lt;li>&lt;code>if&lt;/code> と同じ行に &lt;code>then&lt;/code> を記述する&lt;/li>
&lt;li>&lt;code>for&lt;/code> や &lt;code>while&lt;/code> と同じ行に &lt;code>do&lt;/code> を記述する&lt;/li>
&lt;li>1 行あたりの文字数は &lt;strong>80&lt;/strong> 文字まで&lt;/li>
&lt;li>関数名や変数名はすべて小文字（例: &lt;code>my_func&lt;/code>）&lt;/li>
&lt;li>外部コマンドを実行するときはバッククォート (&lt;code>\&lt;/code>) を使用せず、&lt;strong>&lt;code>$(func arg1 arg2)&lt;/code>&lt;/strong> という形式を使用する&lt;/li>
&lt;li>シェル変数は小文字 (&lt;strong>&lt;code>$src_dir&lt;/code>&lt;/strong>)、環境変数は大文字 (&lt;strong>&lt;code>$FOO_BAR&lt;/code>&lt;/strong>)&lt;/li>
&lt;/ul></description></item><item><title>Linuxメモ: Deep Learning や仮想通貨のマイニング時に CPU 使用率が 100% になってしまうのを防ぐ (cpulimit)</title><link>https://maku77.github.io/p/t8yiqm8/</link><pubDate>Wed, 02 May 2018 00:00:00 +0900</pubDate><guid>https://maku77.github.io/p/t8yiqm8/</guid><description>&lt;h2 id="概要">概要&lt;/h2>
&lt;p>普段使い用の PC 上でディープラーニングのプログラムを走らせたりすると、CPU の負荷が 100% になってしまい、別の作業に支障が出てしまうことがあります（特に計算処理に GPU を使えない環境の場合）。
CPU の発熱量が半端なく、ファンが全力で回転してうるさくて集中できなくなってしまいます。
長時間高温な状態で動作させると、ハードウェアへのダメージも大きくなってしまうでしょう。&lt;/p>
&lt;p>CPU 負荷を下げようとして、&lt;code>nice&lt;/code> コマンドや &lt;code>renice&lt;/code> コマンドを使用してプロセスの優先度（nice 値）の値を変更しても無駄です。
なぜなら、プロセスの優先度設定は、あくまで別のプロセスと比較したときの CPU 使用率の割合を変更するものであり、システムをアイドル状態にすることを促すものではないからです。
優先度の低いプロセスであっても、CPU に空きがあったら 100% まで使用してしまいます。&lt;/p>
&lt;p>このようなときは、&lt;strong>cpulimit&lt;/strong> を使ってプロセスの CPU 使用率を制限してやることで、負荷の低い状態をキープすることができます。
もちろん、そのプロセス内の処理には時間がかかるようになってしまいますが、ゆっくりでいいから処理が進めばいい、といったケースでは重宝すると思います。&lt;/p>
&lt;h2 id="cpulimit-のインストール方法">cpulimit のインストール方法&lt;/h2>
&lt;p>cpulimit はそれぞれの OS 用のパッケージを使ってインストールしてしまうのが手っ取り早いでしょう。&lt;/p>
&lt;h4 id="mac-の場合homebrew-を使用">Mac の場合（Homebrew を使用）&lt;/h4>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-console" data-lang="console">&lt;span class="line">&lt;span class="cl">&lt;span class="gp">$&lt;/span> brew install cpulimit
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h4 id="ubuntu-linux-の場合">Ubuntu (Linux) の場合&lt;/h4>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-console" data-lang="console">&lt;span class="line">&lt;span class="cl">&lt;span class="gp">$&lt;/span> sudo apt-get install cpulimit
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="cpulimit-の使い方">cpulimit の使い方&lt;/h2>
&lt;p>cpulimit の &lt;code>-l (--limit)&lt;/code> オプションを使用して、特定のプロセスの CPU 使用率をパーセンテージ指定で制限することができます。&lt;/p>
&lt;h3 id="例-プロセス番号-12345-を-cpu-使用率50に制限">例: プロセス番号 12345 を CPU 使用率50％に制限&lt;/h3>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-console" data-lang="console">&lt;span class="line">&lt;span class="cl">&lt;span class="gp">$&lt;/span> cpulimit -l &lt;span class="m">50&lt;/span> -p &lt;span class="m">12345&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;code>ps&lt;/code> コマンドなどで実行中のプロセスのプロセス ID を確認することができれば、その ID を指定して CPU 使用率に制限をかけることができます。
上記のように CPU 使用率を制限した場合、cpulimit のプロセスの方を &lt;code>Ctrl-C&lt;/code> で停止すれば制限が解除されます。&lt;/p></description></item><item><title>Linuxシェルスクリプト: 外部コマンドの実行結果を 1 行ずつ処理する (for, while, read)</title><link>https://maku77.github.io/p/s9r9q7n/</link><pubDate>Wed, 01 Nov 2017 00:00:00 +0900</pubDate><guid>https://maku77.github.io/p/s9r9q7n/</guid><description>&lt;h2 id="パイプで-while-read-につなぐ方法">パイプで while read につなぐ方法&lt;/h2>
&lt;p>外部コマンドの出力結果を 1 行ずつ変数に取得しながらループ処理するには、コマンドの出力をパイプ (&lt;code>|&lt;/code>) で &lt;strong>&lt;code>while read&lt;/code>&lt;/strong> につなぎます。
次の例では、外部コマンド &lt;code>find . -name '*.sh'&lt;/code>（カレントディレクトリ以下の &lt;code>.sh&lt;/code> ファイルを再帰的に列挙）の出力結果を 1 行ずつ &lt;code>line&lt;/code> 変数に取得してループ処理しています。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">find . -name &lt;span class="s1">&amp;#39;*.sh&amp;#39;&lt;/span> &lt;span class="p">|&lt;/span> &lt;span class="k">while&lt;/span> &lt;span class="nb">read&lt;/span> line&lt;span class="p">;&lt;/span> &lt;span class="k">do&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nb">echo&lt;/span> &lt;span class="s2">&amp;#34;&lt;/span>&lt;span class="nv">$line&lt;/span>&lt;span class="s2">&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">done&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;code>line&lt;/code> という変数名は別の名前に変えても大丈夫です。
この例では 1 ファイルずつループ処理しているので、&lt;code>file&lt;/code> という変数名の方が直感的かもしれません。&lt;/p>
&lt;div class="xNote">
 &lt;span class="xNote_title">☝️ ワンポイント&lt;/span>
 &lt;span class="xNote_body">&lt;code>echo&lt;/code> 出力時に &lt;code>&amp;quot;$line&amp;quot;&lt;/code> のようにダブルクォートで囲んでいるのは、&lt;code>echo&lt;/code> が連続したスペースを 1 つのスペースにまとめて出力してしまうのを防ぐためです。
パス内にスペースが含まれていなければ問題は発生しませんが、必ずダブルクォートで囲むようにしましょう。&lt;/span>
&lt;/div>
&lt;h2 id="外部コマンドの出力を配列として受け取る方法">外部コマンドの出力を配列として受け取る方法&lt;/h2>
&lt;p>パイプ (&lt;code>|&lt;/code>) を使用せず、&lt;strong>&lt;code>$(command)&lt;/code>&lt;/strong> の形で実行した外部コマンドの出力を、配列で受け取る方法もあります。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">&lt;span class="nv">list&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="k">$(&lt;/span>find . -name &lt;span class="s1">&amp;#39;*.sh&amp;#39;&lt;/span>&lt;span class="k">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">for&lt;/span> line in &lt;span class="s2">&amp;#34;&lt;/span>&lt;span class="nv">$list&lt;/span>&lt;span class="s2">&amp;#34;&lt;/span>&lt;span class="p">;&lt;/span> &lt;span class="k">do&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nb">echo&lt;/span> &lt;span class="s2">&amp;#34;&lt;/span>&lt;span class="nv">$line&lt;/span>&lt;span class="s2">&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">done&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>外部コマンドの出力を 1 行ずつ正しくループ処理するために、&lt;code>$list&lt;/code> をダブルクォートで囲むことを忘れないでください。
&lt;code>for&lt;/code> ループの &lt;code>in&lt;/code> の後ろには、スペース区切りで各要素が列挙されているものとして認識されます。
行内にスペースが含まれている場合に、行全体を 1 つの要素として処理するためには、&lt;code>$list&lt;/code> 変数を展開するときにダブルクォートで囲んでおく必要があります。&lt;/p></description></item><item><title>Linuxメモ: 実行中のシェルスクリプトのファイル名を取得する ($0)</title><link>https://maku77.github.io/p/6vkj2pi/</link><pubDate>Sun, 20 Aug 2017 00:00:00 +0900</pubDate><guid>https://maku77.github.io/p/6vkj2pi/</guid><description>&lt;p>シェルスクリプト内から、自身のファイル名を取得するには &lt;strong>&lt;code>$0&lt;/code>&lt;/strong> という特殊変数を参照します。&lt;/p>

&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">sample.sh&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">&lt;span class="cp">#!/bin/bash
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cp">&lt;/span>&lt;span class="nb">echo&lt;/span> &lt;span class="s2">&amp;#34;&lt;/span>&lt;span class="nv">$0&lt;/span>&lt;span class="s2">&amp;#34;&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>

&lt;p>正確には、&lt;code>$0&lt;/code> に格納されているパスは、そのスクリプト実行時に実際に指定したパスになります。
そのため、どのようにスクリプトを起動したかによって結果が変わってきます。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-console" data-lang="console">&lt;span class="line">&lt;span class="cl">&lt;span class="gp">#&lt;/span> 絶対パスで起動した場合
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="gp">$&lt;/span> /Users/maku/sample.sh
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">/Users/maku/sample.sh
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">&lt;/span>&lt;span class="err">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="err">&lt;/span>&lt;span class="gp">#&lt;/span> 相対パスで起動した場合
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="gp">$&lt;/span> &lt;span class="nb">cd&lt;/span> /Users
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="gp">$&lt;/span> maku/sample.sh
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">maku/sample.sh
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">&lt;/span>&lt;span class="err">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="err">&lt;/span>&lt;span class="gp">#&lt;/span> カレントディレクトリのスクリプトを起動した場合
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="gp">$&lt;/span> ./sample.sh
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">./sample.sh
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">&lt;/span>&lt;span class="err">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="err">&lt;/span>&lt;span class="gp">#&lt;/span> sh コマンドのパラメータで起動した場合
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="gp">$&lt;/span> sh sample.sh
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">sample.sh
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>確実にファイル名（ベース名）だけを取得したい場合や、絶対パスを取得したい場合は以下のようにするのがよいでしょう。&lt;/p>

&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">sample.sh&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">&lt;span class="cp">#!/bin/bash
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cp">&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv">MY_BASENAME&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="k">$(&lt;/span>basename &lt;span class="nv">$0&lt;/span>&lt;span class="k">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv">MY_ABS_PATH&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="k">$(&lt;/span>&lt;span class="nb">cd&lt;/span> &lt;span class="k">$(&lt;/span>dirname &lt;span class="nv">$0&lt;/span>&lt;span class="k">)&lt;/span>&lt;span class="p">;&lt;/span> &lt;span class="nb">pwd&lt;/span>&lt;span class="k">)&lt;/span>/&lt;span class="nv">$MY_BASENAME&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">echo&lt;/span> &lt;span class="s2">&amp;#34;&lt;/span>&lt;span class="nv">$MY_BASENAME&lt;/span>&lt;span class="s2">&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">echo&lt;/span> &lt;span class="s2">&amp;#34;&lt;/span>&lt;span class="nv">$MY_ABS_PATH&lt;/span>&lt;span class="s2">&amp;#34;&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>


&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">実行結果&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-console" data-lang="console">&lt;span class="line">&lt;span class="cl">&lt;span class="gp">$&lt;/span> ~/sample.sh
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">sample.sh
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">/Users/maku/sample.sh
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure></description></item><item><title>Linuxメモ: ディレクトリ内のファイルを zip ファイルにバックアップする</title><link>https://maku77.github.io/p/3qnenzf/</link><pubDate>Sat, 19 Aug 2017 00:00:00 +0900</pubDate><guid>https://maku77.github.io/p/3qnenzf/</guid><description>&lt;h2 id="zip-コマンドの基本">zip コマンドの基本&lt;/h2>
&lt;p>下記のようにすると、&lt;code>sample&lt;/code> ディレクトリ内のファイルをすべて &lt;code>sample.zip&lt;/code> アーカイブとして保存することができます。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-console" data-lang="console">&lt;span class="line">&lt;span class="cl">&lt;span class="gp">$&lt;/span> zip -r sample.zip sample
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>より上位のディレクトリからアーカイブを作成する場合は、同様に、&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-console" data-lang="console">&lt;span class="line">&lt;span class="cl">&lt;span class="gp">$&lt;/span> zip -r sample.zip aaa/bbb/ccc/sample
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>とすることができますが、このようにすると、アーカイブ内に &lt;code>aaa/bbb/ccc&lt;/code> ディレクトリが含まれてしまいます。
アーカイブ内のトップのディレクトリを &lt;code>sample&lt;/code> ディレクトリにしたい場合は、次のようにカレントディレクトリを変更してから &lt;code>zip&lt;/code> コマンドを実行するようにします。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-console" data-lang="console">&lt;span class="line">&lt;span class="cl">&lt;span class="gp">$&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="nb">cd&lt;/span> aaa/bbb/ccc &lt;span class="o">&amp;amp;&amp;amp;&lt;/span> zip -r sample.zip sample&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>コマンド全体を括弧で囲んでいるのは、コマンド実行後にシェルのカレントディレクトリを元のディレクトリに復帰させるためです。&lt;/p>
&lt;h2 id="アーカイブファイル名に日付を入れる">アーカイブファイル名に日付を入れる&lt;/h2>
&lt;p>&lt;code>date&lt;/code> コマンドと組み合わせて、下記のように実行すれば、アーカイブ名に自動的に日付を入れることができます（例: &lt;code>sample-20170819.zip&lt;/code>）。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-console" data-lang="console">&lt;span class="line">&lt;span class="cl">&lt;span class="gp">$&lt;/span> zip -r sample-&lt;span class="sb">`&lt;/span>date +%Y%m%d&lt;span class="sb">`&lt;/span>.zip sample
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="指定したディレクトリを除いてアーカイブする">指定したディレクトリを除いてアーカイブする&lt;/h2>
&lt;p>例えば、アーカイブの対象から &lt;code>.git&lt;/code> ディレクトリを除きたいときは、下記のように &lt;code>--exclude&lt;/code> オプションを指定します。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-console" data-lang="console">&lt;span class="line">&lt;span class="cl">&lt;span class="gp">$&lt;/span> zip -r sample.zip --exclude&lt;span class="o">=&lt;/span>*/.git/* sample
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>複数の &lt;code>--exclude&lt;/code> オプションを指定することもできます。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-console" data-lang="console">&lt;span class="line">&lt;span class="cl">&lt;span class="gp">$&lt;/span> zip -r sample.zip --exclude&lt;span class="o">=&lt;/span>*/.git/* --exclude&lt;span class="o">=&lt;/span>*/.svn/* sample
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div></description></item><item><title>Linuxメモ: curl で HTTP のレスポンスヘッダのみを確認する例</title><link>https://maku77.github.io/p/2fnpkp9/</link><pubDate>Wed, 14 Sep 2016 00:00:00 +0900</pubDate><guid>https://maku77.github.io/p/2fnpkp9/</guid><description>&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-console" data-lang="console">&lt;span class="line">&lt;span class="cl">&lt;span class="gp">$&lt;/span> curl -s -D - localhost:8080 -o /dev/null
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">HTTP/1.1 403 Forbidden
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">Date: Wed, 14 Sep 2016 12:46:40 GMT
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">Server: Jetty(8.y.z-SNAPSHOT)
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">Expires: Thu, 01 Jan 1970 00:00:00 GMT
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">Content-Type: text/html;charset=UTF-8
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">X-Hudson: 1.395
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">X-Jenkins: 1.565.1
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">X-Jenkins-Session: a53528f4
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">X-Hudson-CLI-Port: 41906
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">X-Jenkins-CLI-Port: 41906
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">X-Jenkins-CLI2-Port: 41906
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">X-You-Are-Authenticated-As: anonymous
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">X-You-Are-In-Group:
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">X-Required-Permission: hudson.model.Hudson.Read
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">X-Permission-Implied-By: hudson.security.Permission.GenericRead
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">X-Permission-Implied-By: hudson.model.Hudson.Administer
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">Content-Length: 793
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">Vary: Accept-Encoding
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">Proxy-Connection: Keep-Alive
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">Connection: Keep-Alive
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">Set-Cookie: JSESSIONID.e92abcec=jhmj6nosqyo51rcld8mgf20jc;Path=/
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div></description></item><item><title>Linuxメモ: 実行中のシェルスクリプトがあるディレクトリに移動する</title><link>https://maku77.github.io/p/dpvyxy8/</link><pubDate>Fri, 12 Aug 2016 00:00:00 +0900</pubDate><guid>https://maku77.github.io/p/dpvyxy8/</guid><description>&lt;p>シェルスクリプト内の処理が、シェルスクリプト自体が置いてあるディレクトリをカレントディレクトリとすることを前提として記述されていると、他のディレクトリにいるときにそのスクリプトを実行することができなくなってしまいます。
そのような場合は、スクリプトの先頭で、そのスクリプトがあるディレクトリに移動するようにしておくと、どのディレクトリからでも実行できるスクリプトにすることができます。&lt;/p>
&lt;p>下記は、&lt;code>dirname&lt;/code> コマンドを利用してカレントディレクトリを移動する例です。&lt;/p>

&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">sample.sh&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">&lt;span class="cp">#!/bin/bash
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cp">&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">cd&lt;/span> &lt;span class="sb">`&lt;/span>dirname &lt;span class="nv">$0&lt;/span>&lt;span class="sb">`&lt;/span> &lt;span class="c1"># スクリプトのあるディレクトリへ移動&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># あとは好きな処理を記述していく&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">chmod -R +r build/&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>

&lt;p>シェルスクリプトは通常新しく起動したシェル内で実行されるため、このスクリプトを起動したシェルのカレントディレクトリが移動してしまうことはありません（&lt;code>source&lt;/code> コマンドで起動した場合は例外）。&lt;/p></description></item><item><title>Linuxメモ: シェルスクリプト: シェル変数/環境変数がセットされているか調べる</title><link>https://maku77.github.io/p/xi5nrtd/</link><pubDate>Fri, 16 Oct 2015 00:00:00 +0900</pubDate><guid>https://maku77.github.io/p/xi5nrtd/</guid><description>&lt;h2 id="変数がセットされていることを調べる">変数がセットされていることを調べる&lt;/h2>
&lt;p>下記の例では、変数 &lt;code>NAME&lt;/code> がセットされているかどうか調べています。&lt;/p>

&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">sample.sh&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">&lt;span class="cp">#!/bin/bash
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cp">&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">if&lt;/span> &lt;span class="o">[&lt;/span> -n &lt;span class="s2">&amp;#34;&lt;/span>&lt;span class="nv">$NAME&lt;/span>&lt;span class="s2">&amp;#34;&lt;/span> &lt;span class="o">]&lt;/span>&lt;span class="p">;&lt;/span> &lt;span class="k">then&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nb">echo&lt;/span> &lt;span class="nv">$NAME&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">fi&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>


&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">実行例&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-console" data-lang="console">&lt;span class="line">&lt;span class="cl">&lt;span class="gp">$&lt;/span> ./sample.sh
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="err">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="err">&lt;/span>&lt;span class="gp">$&lt;/span> &lt;span class="nv">NAME&lt;/span>&lt;span class="o">=&lt;/span>maku ./sample.sh
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">maku
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>

&lt;h2 id="変数がセットされていないことを調べる">変数がセットされていないことを調べる&lt;/h2>
&lt;p>下記の例では、変数 &lt;code>NAME&lt;/code> が&lt;strong>セットされていない&lt;/strong>ことを調べています。&lt;/p>

&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">sample.sh&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">&lt;span class="cp">#!/bin/bash
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cp">&lt;/span>&lt;span class="k">if&lt;/span> &lt;span class="o">[&lt;/span> -z &lt;span class="s2">&amp;#34;&lt;/span>&lt;span class="nv">$NAME&lt;/span>&lt;span class="s2">&amp;#34;&lt;/span> &lt;span class="o">]&lt;/span>&lt;span class="p">;&lt;/span> &lt;span class="k">then&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nb">echo&lt;/span> &lt;span class="s1">&amp;#39;NAME is not set&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">fi&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>


&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">実行例&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-console" data-lang="console">&lt;span class="line">&lt;span class="cl">&lt;span class="gp">$&lt;/span> ./sample.sh
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">NAME is not set
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">&lt;/span>&lt;span class="err">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="err">&lt;/span>&lt;span class="gp">$&lt;/span> &lt;span class="nv">NAME&lt;/span>&lt;span class="o">=&lt;/span>maku ./sample.sh
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>

&lt;h2 id="仕組みの解説">仕組みの解説&lt;/h2>
&lt;p>&lt;code>test&lt;/code> や &lt;code>[ ... ]&lt;/code> 構造で使用できる演算子に下記のようなものがあります。&lt;/p>
&lt;ul>
&lt;li>&lt;code>-z 文字列&lt;/code> - 文字列の長さが 0 の場合に真&lt;/li>
&lt;li>&lt;code>-n 文字列&lt;/code> - 文字列の長さが 0 でない場合に真&lt;/li>
&lt;/ul>
&lt;p>変数の値を &lt;code>&amp;quot;$NAME&amp;quot;&lt;/code> という構文で確実に文字列になるように展開し、上記の演算子でその文字列の長さをチェックすることにより、変数がセットされている（あるいはセットされていない）ことを調べることができます。&lt;/p></description></item><item><title>Linuxメモ: Linux の各種 ID（プロセス ID やユーザ ID など）についてのメモ</title><link>https://maku77.github.io/p/ycrtvgk/</link><pubDate>Thu, 02 Jan 2014 00:00:00 +0900</pubDate><guid>https://maku77.github.io/p/ycrtvgk/</guid><description>&lt;dl>
&lt;dt>プロセス ID (pid: Process ID)&lt;/dt>
&lt;dd>Unix システム上で動作しているプロセスには、0 ～ 30000 までのユニークな &lt;strong>pid&lt;/strong>（プロセス ID）が割り当てられます。
プロセス ID が 1 のものは、最初に立ち上がる init プロセスです（例外として、終了した親プロセスの &lt;strong>pid&lt;/strong> を子プロセスから参照すると 1 が返されます）。&lt;/dd>
&lt;dt>プロセス・グループ ID (pgid: Process Group ID)&lt;/dt>
&lt;dd>プロセス・グループとは、1 つ以上のプロセスをまとめて扱う仕組みで、個々のプロセスに対してではなく、プロセス・グループに対してシグナルを送ったりすることができます。
プロセス・グループには 1 つのプロセス・グループ・リーダ（プロセス）が存在し、そのプロセス ID (pid) をプロセス・グループ ID (gpid) として使用します（つまり、プロセス・グループ・リーダの pid と gpid は等しくなります）。
プロセス・グループ・リーダではないプロセスをリーダにするには、&lt;code>setpgrp&lt;/code> システムコールを使用します。&lt;/dd>
&lt;dt>ターミナル・グループ (tty group)&lt;/dt>
&lt;dd>プロセス・グループ・リーダがあるターミナルと関連を持っている場合、そのプロセス・グループのすべてのプロセスは同じターミナル・グループに属します。
ターミナルとの接続が切れた場合、そのターミナル・グループ内のすべてのプロセスに &lt;code>SIGHUP&lt;/code> シグナルが送られます。&lt;/dd>
&lt;dt>リアル・ユーザ ID（実ユーザ ID）(ruid: Real User ID)&lt;/dt>
&lt;dd>ログイン名と 1 対 1 で対応付けられるユーザを識別するための ID です。
&lt;code>/etc/passwd&lt;/code> を見ると、どのように対応付けられているかが分かります。
子プロセスを生成した場合は、親プロセスの ruid が引き継がれます。&lt;/dd>
&lt;dt>リアル・グループ ID（実グループ ID）(rgid: Real Group ID)&lt;/dt>
&lt;dd>リアル・ユーザ ID のグループ版と考えれば OK です。
&lt;code>/etc/passwd&lt;/code> を見ると、ログイン名と rgid の対応付けが分かります。&lt;/dd>
&lt;dt>実効ユーザ ID／実効グループ ID&lt;/dt>
&lt;dd>ファイルにアクセスできるかどうかを決定するためのカギとなる ID です。
子プロセスは親プロセスの実効ユーザ ID、実効グループ ID を引き継ぎます。
実行した実行ファイルに &lt;code>set-user-id&lt;/code>、&lt;code>set-group-id&lt;/code> ビットが設定されている場合は、その実行ファイルの所有者のユーザ ID、グループ ID が実効ユーザ ID、および、実効グループ ID となります。&lt;/dd>
&lt;/dl></description></item><item><title>Linuxメモ: Bash の構文: 関数のデフォルト引数を定義する</title><link>https://maku77.github.io/p/7ovg5nr/</link><pubDate>Sun, 09 Dec 2012 00:00:00 +0900</pubDate><guid>https://maku77.github.io/p/7ovg5nr/</guid><description>&lt;p>以下の関数では、パラメータを何も指定しないで呼び出すと、&lt;code>par1&lt;/code> ローカル変数に &lt;code>ABC&lt;/code> が入ります。
パラメータを指定すると、そちらが使用されます。&lt;/p>

&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">param-test.sh&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">&lt;span class="k">function&lt;/span> param-test&lt;span class="o">()&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nb">local&lt;/span> &lt;span class="nv">par1&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="si">${&lt;/span>&lt;span class="nv">1&lt;/span>&lt;span class="k">:-&lt;/span>&lt;span class="nv">ABC&lt;/span>&lt;span class="si">}&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nb">echo&lt;/span> &lt;span class="s2">&amp;#34;param = &lt;/span>&lt;span class="nv">$par1&lt;/span>&lt;span class="s2">&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">}&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>


&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">実行例&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-console" data-lang="console">&lt;span class="line">&lt;span class="cl">&lt;span class="gp">$&lt;/span> . param-test.sh
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="gp">$&lt;/span> param-test
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">param = ABC
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">&lt;/span>&lt;span class="err">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="err">&lt;/span>&lt;span class="gp">$&lt;/span> param-test &lt;span class="m">10000&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">param = 10000
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure></description></item><item><title>Linuxメモ: Windows で Linux 系のコマンドを使用できるようにする (Gow)</title><link>https://maku77.github.io/p/qijsiy5/</link><pubDate>Mon, 19 Nov 2012 00:00:00 +0900</pubDate><guid>https://maku77.github.io/p/qijsiy5/</guid><description>&lt;h2 id="gow-のインストール">Gow のインストール&lt;/h2>
&lt;p>&lt;a href="https://github.com/bmatzelle/gow/wiki">Gow (Gnu On Windows)&lt;/a>&lt;/p>
&lt;p>Gow をインストールすると、Windows で Linux の主なコマンド群をサクッと使うことができるようになります。
インストーラを実行するだけで数秒でインストールできるので、簡単なコマンドを使うために Cygwin のような大げさな環境をインストールしなくても済みます。&lt;/p>
&lt;h2 id="gow-で使えるようになる-linux-系コマンドの一覧">Gow で使えるようになる Linux 系コマンドの一覧&lt;/h2>
&lt;p>&lt;a href="https://github.com/bmatzelle/gow/wiki/executables_list">Gow - executables_list&lt;/a>&lt;/p>
&lt;p>Gow がインストールされている環境であれば、以下のように確認することもできます。&lt;/p>

&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">Gow 0.7 で確認&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-plain" data-lang="plain">&lt;span class="line">&lt;span class="cl">C:\&amp;gt; gow -l
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Available executables:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> awk, basename, bash, bc, bison, bunzip2, bzip2, bzip2recover, cat,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> chgrp, chmod, chown, chroot, cksum, clear, cp, csplit, curl, cut, dc,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> dd, df, diff, diff3, dirname, dos2unix, du, egrep, env, expand, expr,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> factor, fgrep, flex, fmt, fold, gawk, gfind, gow, grep, gsar, gzip,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> head, hostid, hostname, id, indent, install, join, jwhois, less,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> lesskey, ln, ls, m4, make, md5sum, mkdir, mkfifo, mknod, mv, ncftp, nl,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> od, pageant, paste, patch, pathchk, plink, pr, printenv, printf, pscp,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> psftp, putty, puttygen, pwd, rm, rmdir, scp, sdiff, sed, seq, sftp,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> sha1sum, shar, sleep, sort, split, ssh, su, sum, sync, tac, tail, tar,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> tee, test, touch, tr, uname, unexpand, uniq, unix2dos, unlink, unrar,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> unshar, uudecode, uuencode, vim, wc, wget, whereis, which, whoami,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> xargs, yes, zip&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure></description></item><item><title>Linuxシェルスクリプト: テキストファイルを 1 行ずつ読み込む (read)</title><link>https://maku77.github.io/p/co9p7nj/</link><pubDate>Mon, 05 Nov 2012 00:00:00 +0900</pubDate><guid>https://maku77.github.io/p/co9p7nj/</guid><description>&lt;h2 id="テキストファイルを-1-行だけ読み込む">テキストファイルを 1 行だけ読み込む&lt;/h2>
&lt;p>&lt;strong>&lt;code>read&lt;/code>&lt;/strong> コマンドはユーザからの入力を 1 行取得するために使用できますが、ファイルからの入力を 1 行読み込むのにも使用できます。&lt;/p>

&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">sample.sh （input.txt の内容を 1 行だけ読み込む）&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">&lt;span class="cp">#!/bin/bash
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cp">&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">read&lt;/span> line &amp;lt; input.txt
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">echo&lt;/span> &lt;span class="s2">&amp;#34;&lt;/span>&lt;span class="nv">$line&lt;/span>&lt;span class="s2">&amp;#34;&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>


&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">input.txt（入力データ）&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-plain" data-lang="plain">&lt;span class="line">&lt;span class="cl">AAA 100
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">BBB 200
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">CCC 300&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>


&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">実行結果&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-console" data-lang="console">&lt;span class="line">&lt;span class="cl">&lt;span class="gp">$&lt;/span> ./sample.sh
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">AAA 100
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>

&lt;p>これだけだとあまり役に立たないので、通常は次のように &lt;code>while&lt;/code> ループを組み合わせて、すべての行を読み出します。&lt;/p>
&lt;h2 id="テキストファイルから-1-行ずつ読み込む">テキストファイルから 1 行ずつ読み込む&lt;/h2>
&lt;p>&lt;strong>&lt;code>read&lt;/code>&lt;/strong> コマンドと &lt;strong>&lt;code>while&lt;/code>&lt;/strong> ループを組み合わせると、テキストファイルのすべての行を 1 行ずつ処理できます。&lt;/p>

&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">sample.sh （input.txt の内容を 1 行ずつ読み込む）&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">&lt;span class="cp">#!/bin/bash
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cp">&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">while&lt;/span> &lt;span class="nb">read&lt;/span> line&lt;span class="p">;&lt;/span> &lt;span class="k">do&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nb">echo&lt;/span> &lt;span class="s2">&amp;#34;&lt;/span>&lt;span class="nv">$line&lt;/span>&lt;span class="s2">&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">done&lt;/span> &amp;lt; input.txt&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>


&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">input.txt（入力データ）&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-plain" data-lang="plain">&lt;span class="line">&lt;span class="cl">AAA 100
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">BBB 200
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">CCC 300&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>


&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">実行結果&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-console" data-lang="console">&lt;span class="line">&lt;span class="cl">&lt;span class="gp">$&lt;/span> ./sample.sh
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">AAA 100
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">BBB 200
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">CCC 300
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>

&lt;div class="xNote">
 &lt;span class="xNote_title">☝️ ワンポイント&lt;/span>
 &lt;span class="xNote_body">&lt;code>echo&lt;/code> のパラメータ &lt;code>&amp;quot;$line&amp;quot;&lt;/code> をダブルクォートで囲んでいることに注意してください。
こうすることで、1 行分の文字列を、ひとつのパラメータとして渡すことができます。
ダブルクォートで囲まないと、&lt;code>echo AAA 100&lt;/code> のように、2 つのパラメータが渡されたかのように処理されてしまうため、連続するスペースが 1 つのスペースに置き換えられて出力されてしまいます。&lt;/span>
&lt;/div>
&lt;ul>
&lt;li>参考: &lt;a href="../p/25gqyai/">echo で出力した文字列の中の連続するスペースが 1 つのスペースになってしまうのを防ぐ&lt;/a>&lt;/li>
&lt;/ul>
&lt;h2 id="行頭のスペースが消えてしまうのを防ぐ">行頭のスペースが消えてしまうのを防ぐ&lt;/h2>
&lt;p>例えば、下記のように行頭がインデントされたテキストファイルを読み込むとします。&lt;/p></description></item><item><title>Linuxメモ: シェルスクリプト: 変数の基本</title><link>https://maku77.github.io/p/cjn9dbq/</link><pubDate>Mon, 05 Nov 2012 00:00:00 +0900</pubDate><guid>https://maku77.github.io/p/cjn9dbq/</guid><description>&lt;h2 id="変数の定義と参照">変数の定義と参照&lt;/h2>
&lt;p>変数へ値を代入するときは &lt;code>$&lt;/code> を付けず、変数を参照するときは &lt;code>$&lt;/code> を付けます。&lt;/p>

&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">sample.sh&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">&lt;span class="cp">#!/bin/sh
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cp">&lt;/span>&lt;span class="nv">name&lt;/span>&lt;span class="o">=&lt;/span>Michael &lt;span class="c1"># 変数の定義&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">echo&lt;/span> Hello &lt;span class="nv">$name&lt;/span> &lt;span class="c1"># 変数の参照&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">echo&lt;/span> &lt;span class="s2">&amp;#34;Hello &lt;/span>&lt;span class="nv">$name&lt;/span>&lt;span class="s2">&amp;#34;&lt;/span> &lt;span class="c1"># ダブルクォーテーションは変数を展開する&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">echo&lt;/span> &lt;span class="s1">&amp;#39;Hello $name&amp;#39;&lt;/span> &lt;span class="c1"># シングルクォーテーションは変数を展開しない&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>


&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">実行結果&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-console" data-lang="console">&lt;span class="line">&lt;span class="cl">&lt;span class="gp">$&lt;/span> ./sample.sh
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">Hello Michael
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">Hello Michael
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">Hello $name
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>

&lt;h2 id="定義していない変数は空文字と同じ">定義していない変数は空文字と同じ&lt;/h2>
&lt;p>未定義の変数を参照すると、空文字列と同様に扱われます。
エラーにはなりません。&lt;/p>

&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">sample.sh&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">&lt;span class="cp">#!/bin/sh
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cp">&lt;/span>&lt;span class="nb">echo&lt;/span> &lt;span class="s2">&amp;#34;Hello &lt;/span>&lt;span class="nv">$name&lt;/span>&lt;span class="s2"> !&amp;#34;&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>


&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">実行結果&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-console" data-lang="console">&lt;span class="line">&lt;span class="cl">&lt;span class="gp">$&lt;/span> ./sample.sh
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">Hello !
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>

&lt;h2 id="-の前後にスペースは入れちゃだめ">&amp;ldquo;=&amp;rdquo; の前後にスペースは入れちゃだめ！&lt;/h2>
&lt;p>変数定義の &lt;code>=&lt;/code> の前後にはスペースを入れてはいけません。
スペースを入れると、変数名の部分がシェル上で実行可能なコマンドとして認識されてしまいます。
例えば、以下のようにすると、&lt;code>value&lt;/code> というコマンドを、引数 &lt;code>&amp;quot;= hello&amp;quot;&lt;/code> で実行すると解釈されてしまいます。&lt;/p>

&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">間違った代入（その１）&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">&lt;span class="nv">value&lt;/span> &lt;span class="o">=&lt;/span> hello&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>

&lt;p>さらに、以下のように、&lt;code>&amp;quot;=&amp;quot;&lt;/code> の後ろだけにスペースを入れると…&lt;/p>

&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">間違った代入（その２）&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">&lt;span class="nv">value&lt;/span>&lt;span class="o">=&lt;/span> hello&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>

&lt;p>これは、変数 &lt;code>value&lt;/code> を空にした状態で、コマンド &lt;code>hello&lt;/code> を呼び出すと解釈されてしまいます。&lt;/p></description></item><item><title>Linuxメモ: ユーザー入力を取得する (read)</title><link>https://maku77.github.io/p/6m6n5k3/</link><pubDate>Mon, 05 Nov 2012 00:00:00 +0900</pubDate><guid>https://maku77.github.io/p/6m6n5k3/</guid><description>&lt;h2 id="ユーザー入力の基本">ユーザー入力の基本&lt;/h2>
&lt;p>bash スクリプトの中で、&lt;strong>&lt;code>read 変数名&lt;/code>&lt;/strong> とすると、ユーザーがキーボードで入力したテキストを変数に取得することができます。
&lt;code>変数名&lt;/code> の部分には、&lt;code>$&lt;/code> プレフィックスを付けないことに注意してください（変数の内容を参照するときは &lt;code>$&lt;/code> が必要です）。&lt;/p>

&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">hello.sh&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">&lt;span class="cp">#!/bin/sh
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cp">&lt;/span>&lt;span class="nb">echo&lt;/span> -n &lt;span class="s2">&amp;#34;Enter your name: &amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">read&lt;/span> name
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">echo&lt;/span> &lt;span class="s2">&amp;#34;Hello, &lt;/span>&lt;span class="nv">$name&lt;/span>&lt;span class="s2">&amp;#34;&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>


&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">実行結果&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-console" data-lang="console">&lt;span class="line">&lt;span class="cl">&lt;span class="gp">$&lt;/span> ./hello.sh
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">Enter your name: まくまく
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">Hello, まくまく
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>

&lt;div class="xNote">
 &lt;span class="xNote_title">☝️ echo の -n オプション&lt;/span>
 &lt;span class="xNote_body">&lt;code>echo&lt;/code> コマンドの出力はデフォルトで末尾で改行されますが、&lt;strong>&lt;code>-n&lt;/code>&lt;/strong> オプションを使うとこの改行を抑制できます。
上記の例のように、プロンプト表示で利用できます。&lt;/span>
&lt;/div>
&lt;h2 id="ユーザーが-y-を入力したときだけ処理を継続する">ユーザーが y を入力したときだけ処理を継続する&lt;/h2>
&lt;p>&lt;code>read&lt;/code> コマンドの典型的な使用例として、ユーザーに &lt;code>y/n&lt;/code> の選択肢を入力させるものがあります。
次の &lt;code>remove_all&lt;/code> 関数は、何もかもを削除する前に、ユーザーに最終確認を行っています。&lt;/p>

&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">remove.sh&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">&lt;span class="cp">#!/bin/bash
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cp">&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">function&lt;/span> remove_all &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nb">echo&lt;/span> -n &lt;span class="s1">&amp;#39;Are you sure? (y/n): &amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nb">read&lt;/span> input
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="o">[&lt;/span> &lt;span class="s2">&amp;#34;&lt;/span>&lt;span class="nv">$input&lt;/span>&lt;span class="s2">&amp;#34;&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s1">&amp;#39;Y&amp;#39;&lt;/span> -o &lt;span class="s2">&amp;#34;&lt;/span>&lt;span class="nv">$input&lt;/span>&lt;span class="s2">&amp;#34;&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s1">&amp;#39;y&amp;#39;&lt;/span> &lt;span class="o">]&lt;/span>&lt;span class="p">;&lt;/span> &lt;span class="k">then&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nb">echo&lt;/span> &lt;span class="s1">&amp;#39;All things have been removed!&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">fi&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">remove_all&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>


&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">実行例&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-console" data-lang="console">&lt;span class="line">&lt;span class="cl">&lt;span class="gp">$&lt;/span> ./remove.sh
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">Are you sure? (y/n): y
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">All things have been removed!
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>

&lt;p>&lt;code>if&lt;/code> の中で &lt;code>$input&lt;/code> の内容を確認するときに、ダブルクォーテーションで囲んでいるのは、ユーザーの入力がなかった場合に空文字 &lt;code>&amp;quot;&amp;quot;&lt;/code> を取得するためです。
これがないと、ユーザーが何も入力せずにエンターした場合にエラーになってしまいます。&lt;/p></description></item><item><title>Linuxメモ: dbus-python で D-Bus の P2P クライアントを実装する</title><link>https://maku77.github.io/p/pzyxbo7/</link><pubDate>Wed, 05 Sep 2012 00:00:00 +0900</pubDate><guid>https://maku77.github.io/p/pzyxbo7/</guid><description>&lt;p>python-dbus では、今のところ P2P 用のサーバを作成できないようです。
なので、ここでは P2P クライアントのサンプルだけを示します。&lt;/p>
&lt;ul>
&lt;li>&lt;a href="./p2p-client.py">p2p-client.py&lt;/a>&lt;/li>
&lt;/ul>
&lt;p>P2P 通信を行うには、&lt;code>dbus.SessionBus&lt;/code> オブジェクトを使ってバス名を指定するのではなく、&lt;code>dbus.connection.Connection&lt;/code> オブジェクトを使って、アドレス指定で接続します。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-python" data-lang="python">&lt;span class="line">&lt;span class="cl">&lt;span class="n">con&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">dbus&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">connection&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">Connection&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;tcp:host=127.0.0.1,port=12300&amp;#39;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>Connection が確立できたら、あとは Object path を指定して、リモートオブジェクトを取得できます。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-python" data-lang="python">&lt;span class="line">&lt;span class="cl">&lt;span class="n">counter_object&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">con&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">get_object&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">object_path&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">OBJECT_PATH&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">counter_iface&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">dbus&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">Interface&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">counter_object&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">INTERFACE&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div></description></item><item><title>Linuxメモ: dbus-python で Session bus を使用するサーバ＆クライアントを実装する（シグナルの実装）</title><link>https://maku77.github.io/p/zkx7oe6/</link><pubDate>Wed, 05 Sep 2012 00:00:00 +0900</pubDate><guid>https://maku77.github.io/p/zkx7oe6/</guid><description>&lt;p>dbus-python のサーバ＆クライアント実装において、シグナルを使用するサンプルです。
シグナルを使用すると、サーバ側からクライアント側に任意のタイミングで通知を送ることができます。
以下のサンプルでは、&lt;code>SetCount()&lt;/code> メソッドが呼ばれた場合に、&lt;code>CountChanged&lt;/code> シグナルを発行しています。&lt;/p>
&lt;h2 id="サーバ側の実装">サーバ側の実装&lt;/h2>
&lt;ul>
&lt;li>&lt;a href="./server-signal.py">server-signal.py&lt;/a>&lt;/li>
&lt;/ul>
&lt;p>サーバ側に、シグナル発行用のメソッド &lt;code>CountChanged()&lt;/code> を追加して、&lt;code>SetCount()&lt;/code> メソッド内から呼び出すようにします。
シグナルを定義するには、&lt;code>@dbus.service.signal&lt;/code> を付けてメソッドを定義します。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-python" data-lang="python">&lt;span class="line">&lt;span class="cl">&lt;span class="k">class&lt;/span> &lt;span class="nc">CounterObject&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">dbus&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">service&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">Object&lt;/span>&lt;span class="p">):&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">def&lt;/span> &lt;span class="fm">__init__&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="bp">self&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">bus&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">obj_path&lt;/span>&lt;span class="p">):&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">dbus&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">service&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">Object&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="fm">__init__&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="bp">self&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">bus&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">obj_path&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">count&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="mi">0&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nd">@dbus.service.signal&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">INTERFACE&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">signature&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;i&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">def&lt;/span> &lt;span class="nf">CountChanged&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="bp">self&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">count&lt;/span>&lt;span class="p">):&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nb">print&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;Emit signal: &amp;#39;&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="nb">str&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">count&lt;/span>&lt;span class="p">))&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nd">@dbus.service.method&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">INTERFACE&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">in_signature&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;i&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">out_signature&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">def&lt;/span> &lt;span class="nf">SetCount&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="bp">self&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">count&lt;/span>&lt;span class="p">):&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nb">print&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;SetCount called: &amp;#39;&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="nb">str&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">count&lt;/span>&lt;span class="p">))&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">count&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">count&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">CountChanged&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">count&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nd">@dbus.service.method&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">INTERFACE&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">in_signature&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">out_signature&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;i&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">def&lt;/span> &lt;span class="nf">GetCount&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="bp">self&lt;/span>&lt;span class="p">):&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nb">print&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;GetCount called&amp;#39;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">count&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="クライアント側の実装">クライアント側の実装&lt;/h2>
&lt;ul>
&lt;li>&lt;a href="./client-signal.py">client-signal.py&lt;/a>&lt;/li>
&lt;/ul>
&lt;p>リモートオブジェクトを操作するためのインタフェースを取得したら、&lt;code>connect_to_signal()&lt;/code> メソッドを呼ぶことで、シグナルハンドラを登録することができます。
下記の例では、&lt;code>CountChanged&lt;/code> シグナルを、&lt;code>on_count_changed&lt;/code> というシグナルハンドラで受信するように登録しています。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-python" data-lang="python">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Signal handler for &amp;#34;CountChanged&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">def&lt;/span> &lt;span class="nf">on_count_changed&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">count&lt;/span>&lt;span class="p">):&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nb">print&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;CountChanged: &amp;#39;&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="nb">str&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">count&lt;/span>&lt;span class="p">))&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">def&lt;/span> &lt;span class="nf">main&lt;/span>&lt;span class="p">():&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">...&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">counter_iface&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">connect_to_signal&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;CountChanged&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">on_count_changed&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>シグナルは非同期に受信する必要があるので、クライアント側にもメインループを生成する必要があります（下記の &lt;code>loop.run()&lt;/code> の部分）。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-python" data-lang="python">&lt;span class="line">&lt;span class="cl">&lt;span class="k">def&lt;/span> &lt;span class="nf">on_timeout&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">counter_iface&lt;/span>&lt;span class="p">):&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">val&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">counter_iface&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">GetCount&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">counter_iface&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">SetCount&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">val&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="mi">1&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="kc">True&lt;/span> &lt;span class="c1"># continued&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">def&lt;/span> &lt;span class="nf">main&lt;/span>&lt;span class="p">():&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">...&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># Call the SetCount method repeatedly&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">gobject&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">timeout_add&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">1000&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">on_timeout&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">counter_iface&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># Start the mainloop to receive signals&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">loop&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">gobject&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">MainLoop&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">loop&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">run&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>ここでは、1 秒おきに &lt;code>SetCount&lt;/code> するようにタイマーをしかけていますので、結果的に、1 秒おきに &lt;code>CountChanged&lt;/code> シグナルが発生することになります。&lt;/p></description></item><item><title>Linuxメモ: dbus-python で Session bus を使用するサーバ＆クライアントを実装する（単純なメソッドの実装）</title><link>https://maku77.github.io/p/app39n9/</link><pubDate>Wed, 05 Sep 2012 00:00:00 +0900</pubDate><guid>https://maku77.github.io/p/app39n9/</guid><description>&lt;p>dbus-python を利用したサーバとクライアントの実装例です。
ここでは、&lt;code>SetCount()&lt;/code> と &lt;code>GetCount()&lt;/code> だけを行える &lt;code>Counter&lt;/code> オブジェクトを提供するサービスと、クライアントを作成してみます。
インタフェース名などは以下のようにします。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-plaintext" data-lang="plaintext">&lt;span class="line">&lt;span class="cl">Bus name: com.example.CounterService
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Object path: /com/example/CounterObject
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Interface: com.example.Counter
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="session-bus-を使用する-server-を実装する">Session bus を使用する Server を実装する&lt;/h2>
&lt;ul>
&lt;li>&lt;a href="./server.py">server.py&lt;/a>&lt;/li>
&lt;/ul>
&lt;p>D-Bus server 側では、export するオブジェクトを &lt;code>dbus.service.Object&lt;/code> を継承して作成します。
公開するメソッドには &lt;code>@dbus.service.method&lt;/code> アノテーションを付けて、以下の設定を行います。&lt;/p>
&lt;ul>
&lt;li>何という名前のインタフェース名で公開するか&lt;/li>
&lt;li>入力パラメータの Type string (in_signature)&lt;/li>
&lt;li>戻り値の Type string (out_signature)&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-python" data-lang="python">&lt;span class="line">&lt;span class="cl">&lt;span class="k">class&lt;/span> &lt;span class="nc">CounterObject&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">dbus&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">service&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">Object&lt;/span>&lt;span class="p">):&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nd">@dbus.service.method&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">INTERFACE&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">in_signature&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;i&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">out_signature&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">def&lt;/span> &lt;span class="nf">SetCount&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="bp">self&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">count&lt;/span>&lt;span class="p">):&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">count&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">count&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nb">print&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;SetCount called: &amp;#39;&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="nb">str&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">count&lt;/span>&lt;span class="p">))&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nd">@dbus.service.method&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">INTERFACE&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">in_signature&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">out_signature&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;i&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">def&lt;/span> &lt;span class="nf">GetCount&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="bp">self&lt;/span>&lt;span class="p">):&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nb">print&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;GetCount called&amp;#39;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">count&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>上記のように作成したオブジェクトは、以下のような手順で export します。&lt;/p>
&lt;ol>
&lt;li>SessionBus オブジェクトの作成&lt;/li>
&lt;/ol>
&lt;ul>
&lt;li>&lt;code>session_bus = dbus.SessionBus()&lt;/code>&lt;/li>
&lt;/ul>
&lt;ol start="2">
&lt;li>1 の SessionBus に、バス名を関連付ける&lt;/li>
&lt;/ol>
&lt;ul>
&lt;li>&lt;code>bus_name = dbus.service.BusName(BUS_NAME, session_bus)&lt;/code>&lt;/li>
&lt;/ul>
&lt;ol start="3">
&lt;li>SessionBus 上で任意のオブジェクトを export（ここでは CounterObject インスタンス）&lt;/li>
&lt;/ol>
&lt;ul>
&lt;li>&lt;code>counter_object = CounterObject(session_bus, OBJECT_PATH)&lt;/code>&lt;/li>
&lt;/ul>
&lt;ol start="4">
&lt;li>MainLoop 開始&lt;/li>
&lt;/ol>
&lt;h2 id="session-bus-を使用する-client-を実装する">Session bus を使用する Client を実装する&lt;/h2>
&lt;ul>
&lt;li>&lt;a href="./client.py">client.py&lt;/a>&lt;/li>
&lt;/ul>
&lt;p>D-Bus クライアント側は、以下のような手順でリモートオブジェクト、インタフェースを取得します。&lt;/p></description></item><item><title>Linuxメモ: dbus-python の公式サンプルコード</title><link>https://maku77.github.io/p/k2c9k5k/</link><pubDate>Tue, 04 Sep 2012 00:00:00 +0900</pubDate><guid>https://maku77.github.io/p/k2c9k5k/</guid><description>&lt;h2 id="dbus-python-のサンプルコード">dbus-python のサンプルコード&lt;/h2>
&lt;p>下記は、dbus-python-1.1.1 に付属しているサンプルコードです。&lt;/p>
&lt;ul>
&lt;li>単純なメソッドを実装したサーバー＆クライアント
&lt;ul>
&lt;li>&lt;a href="./example-service.py">example-service.py&lt;/a>&lt;/li>
&lt;li>&lt;a href="./example-client.py">example-client.py&lt;/a>&lt;/li>
&lt;li>&lt;a href="./example-async-client.py">example-async-client.py&lt;/a>&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>シグナルを実装したサーバー＆クライアント
&lt;ul>
&lt;li>&lt;a href="./example-signal-emitter.py">example-signal-emitter.py&lt;/a>&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>その他
&lt;ul>
&lt;li>&lt;a href="./list-system-services.py">list-system-services.py&lt;/a>&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;h2 id="python-dbus-のインストール">python-dbus のインストール&lt;/h2>
&lt;p>Python で &lt;code>import dbus&lt;/code> の実行時にエラーが発生する場合は、&lt;code>python-dbus&lt;/code> がインストールされていません。
以下のようにしてインストールしてください。&lt;/p>

&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">Ubuntu の場合&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-console" data-lang="console">&lt;span class="line">&lt;span class="cl">&lt;span class="gp">$&lt;/span> sudo apt-get install python-dbus
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure></description></item><item><title>Linuxメモ: Bash の構文: 関数から戻り値を返す ($?)</title><link>https://maku77.github.io/p/8uionzb/</link><pubDate>Mon, 09 Jul 2012 00:00:00 +0900</pubDate><guid>https://maku77.github.io/p/8uionzb/</guid><description>&lt;p>シェル関数が &lt;code>return&lt;/code> で返すことのできる値は &lt;strong>数値 (0～255) だけ&lt;/strong> です。
&lt;code>return&lt;/code> で返された戻り値を参照するには &lt;strong>&lt;code>$?&lt;/code>&lt;/strong> を使います。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">&lt;span class="k">function&lt;/span> myfunc &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="m">1&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">myfunc
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">echo&lt;/span> &lt;span class="nv">$?&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>関数の実行結果を文字列として受け取りたい場合は、関数内部で &lt;code>echo&lt;/code> した結果を以下のようにバッククォート呼び出しして取得します。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">&lt;span class="k">function&lt;/span> myfunc &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nb">echo&lt;/span> &lt;span class="s1">&amp;#39;Hello&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv">val&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="sb">`&lt;/span>myfunc&lt;span class="sb">`&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">echo&lt;/span> &lt;span class="nv">$val&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div></description></item><item><title>Linuxメモ: Bash の構文: 関数内でローカル変数を扱う (local)</title><link>https://maku77.github.io/p/52i36fy/</link><pubDate>Mon, 09 Jul 2012 00:00:00 +0900</pubDate><guid>https://maku77.github.io/p/52i36fy/</guid><description>&lt;p>Bash は関数外と関数内で変数を共有します。
例えば、以下のように関数内で代入を行うと、関数外でセットした値を上書きしてしまいます。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">&lt;span class="k">function&lt;/span> myfunc &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nv">a&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">200&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>
&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">実行例&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-console" data-lang="console">&lt;span class="line">&lt;span class="cl">&lt;span class="gp">$&lt;/span> &lt;span class="nv">a&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">100&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="gp">$&lt;/span> myfunc
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="gp">$&lt;/span> &lt;span class="nb">echo&lt;/span> &lt;span class="nv">$a&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">200 ★aの値が変わってる！
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>

&lt;p>関数内だけで有効なローカル変数を扱うには以下のように &lt;code>local&lt;/code> キーワードを付けます。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">&lt;span class="k">function&lt;/span> myfunc &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nb">local&lt;/span> &lt;span class="nv">a&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">200&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>
&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">実行例&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-console" data-lang="console">&lt;span class="line">&lt;span class="cl">&lt;span class="gp">$&lt;/span> &lt;span class="nv">a&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">100&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="gp">$&lt;/span> myfunc
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="gp">$&lt;/span> &lt;span class="nb">echo&lt;/span> &lt;span class="nv">$a&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">100 ★aの値はそのまま
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure></description></item><item><title>Linuxメモ: rsync コマンドでディレクトリを同期する</title><link>https://maku77.github.io/p/dvd889d/</link><pubDate>Thu, 05 Jul 2012 00:00:00 +0900</pubDate><guid>https://maku77.github.io/p/dvd889d/</guid><description>&lt;p>&lt;strong>&lt;code>rsync&lt;/code>&lt;/strong> コマンドを使用すると、簡単に 2 つのディレクトリを同期することができます。
下記の例では、&lt;code>src&lt;/code> ディレクトリの中身を &lt;code>dst&lt;/code> ディレクトリに同期しています。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-console" data-lang="console">&lt;span class="line">&lt;span class="cl">&lt;span class="gp">$&lt;/span> rsync -av src/ dst
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;strong>&lt;code>src&lt;/code> の後ろにスラッシュを付ける&lt;/strong> のを忘れないようにしてください。
このスラッシュを忘れると、&lt;code>dst&lt;/code> ディレクトリの中に &lt;code>src&lt;/code> ディレクトリができちゃいます。
オプションの &lt;strong>&lt;code>-a&lt;/code>&lt;/strong> は archive mode として動作させることを示しており、よく使うオプションをまとめて指定したのと同様の効果があります (例えば、ディレクトリを再帰的にコピー、属性をそのまま保つなど)。&lt;/p>
&lt;p>&lt;code>rsync&lt;/code> コマンドは更新されているファイルだけをコピーしてくれるので、大量のファイルが格納されていても、同期処理は短時間で完了します。
&lt;code>rsync&lt;/code> は、ローカル PC 内のディレクトリの同期だけではなく、リモートホスト上のディレクトリとの同期にも対応しています。
詳しい &lt;code>rsync&lt;/code> コマンドの使い方は下記を参照してください。&lt;/p>
&lt;ul>
&lt;li>参考: &lt;a href="https://maku.blog/p/c3s7wyx">Linuxコマンド: &lt;code>rsync&lt;/code> コマンドで2つのディレクトリを同期する&lt;/a>&lt;/li>
&lt;/ul></description></item><item><title>Linuxメモ: GDBus サーバから signal を発行する</title><link>https://maku77.github.io/p/o5744xu/</link><pubDate>Mon, 25 Jun 2012 00:00:00 +0900</pubDate><guid>https://maku77.github.io/p/o5744xu/</guid><description>&lt;p>GDBus のサーバ実装側からシグナルを発行するには、&lt;code>gdbus-codegen&lt;/code> で生成されたヘッダファイルに定義されている、&lt;code>xxx_emit_xxx&lt;/code> という関数を呼び出します。&lt;/p>
&lt;p>あるメソッドの実装の中からシグナルを発行するには、そのメソッドの &lt;code>xxx_complete_xxx&lt;/code> 関数を呼び出す前に、&lt;code>xxx_emit_xxx&lt;/code> 関数を呼び出す必要があります。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-cpp" data-lang="cpp">&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// Implementation of &amp;#34;Add&amp;#34; method.
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="n">gboolean&lt;/span> &lt;span class="nf">handleAdd&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">ComExampleMyAppCalc&lt;/span> &lt;span class="o">*&lt;/span>&lt;span class="n">object&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">GDBusMethodInvocation&lt;/span> &lt;span class="o">*&lt;/span>&lt;span class="n">invocation&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">gint&lt;/span> &lt;span class="n">val1&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">gint&lt;/span> &lt;span class="n">val2&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">gint&lt;/span> &lt;span class="n">ret&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">val1&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="n">val2&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// ここでシグナル発行
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="n">com_example_my_app_calc_emit_hoge_hoge&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">object&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s">&amp;#34;data1&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s">&amp;#34;data2&amp;#34;&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">com_example_my_app_calc_complete_add&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">object&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">invocation&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">ret&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="n">TRUE&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div></description></item><item><title>Linuxメモ: D-Bus Java で P2P D-Bus サーバに接続してメソッドを呼び出すサンプル</title><link>https://maku77.github.io/p/uznw8u8/</link><pubDate>Fri, 22 Jun 2012 00:00:00 +0900</pubDate><guid>https://maku77.github.io/p/uznw8u8/</guid><description>&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">Main.java&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="kn">import&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nn">org.freedesktop.dbus.DBusSigHandler&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="kn">import&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nn">org.freedesktop.dbus.DirectConnection&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="kn">import&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nn">org.freedesktop.dbus.exceptions.DBusException&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="kn">import&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nn">com.example.MyApp.Calc&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="kd">public&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kd">class&lt;/span> &lt;span class="nc">Main&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kd">private&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kd">static&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kd">final&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">String&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">SERVER_ADDR&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s">&amp;#34;unix:abstract=sample&amp;#34;&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kd">private&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kd">static&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kd">final&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">String&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">OBJECT_PATH&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s">&amp;#34;/com/example/MyApp&amp;#34;&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kd">public&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kd">static&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kt">void&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nf">main&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">String&lt;/span>&lt;span class="o">[]&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">args&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">try&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">DirectConnection&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">dc&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">new&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">DirectConnection&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">SERVER_ADDR&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">Calc&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">calc&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">dc&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">getRemoteObject&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">OBJECT_PATH&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Calc&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">class&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">// ...&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kt">int&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">result&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">calc&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">Add&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">100&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">200&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">// ...&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">dc&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">disconnect&lt;/span>&lt;span class="p">();&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">catch&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">DBusException&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">e&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">e&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">printStackTrace&lt;/span>&lt;span class="p">();&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">...&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure></description></item><item><title>Linuxメモ: GDBus でバイナリデータ（バイト配列）を受け取る方法</title><link>https://maku77.github.io/p/y7cx287/</link><pubDate>Fri, 22 Jun 2012 00:00:00 +0900</pubDate><guid>https://maku77.github.io/p/y7cx287/</guid><description>&lt;p>D-Bus メソッド経由でバイト配列を送ろうとして、パラメータのタイプを &lt;code>ay&lt;/code> と定義して、&lt;code>gdbus-codegen&lt;/code> でコード生成すると、デフォルトでは &lt;code>gchar*&lt;/code> 型の文字列データとしてパラメータが定義されてしまいます。
&lt;code>gchar*&lt;/code> データとしてやりとりしようとすると、0 を含むデータを受け取れなくなってしまうので、&lt;code>GVariant*&lt;/code> としてバイナリデータを受け取る必要があります。
そのためには、Introspection XML の &lt;code>arg&lt;/code> 要素の子要素として、以下のように &lt;code>annotation&lt;/code> 要素を追加します。&lt;/p>

&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">introspection.xml（抜粋）&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-xml" data-lang="xml">&lt;span class="line">&lt;span class="cl">...
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nt">&amp;lt;method&lt;/span> &lt;span class="na">name=&lt;/span>&lt;span class="s">&amp;#34;PushBinaryData&amp;#34;&lt;/span>&lt;span class="nt">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;lt;arg&lt;/span> &lt;span class="na">type=&lt;/span>&lt;span class="s">&amp;#34;ay&amp;#34;&lt;/span> &lt;span class="na">name=&lt;/span>&lt;span class="s">&amp;#34;data&amp;#34;&lt;/span> &lt;span class="na">direction=&lt;/span>&lt;span class="s">&amp;#34;in&amp;#34;&lt;/span>&lt;span class="nt">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;lt;annotation&lt;/span> &lt;span class="na">name=&lt;/span>&lt;span class="s">&amp;#34;org.gtk.GDBus.C.ForceGVariant&amp;#34;&lt;/span> &lt;span class="na">value=&lt;/span>&lt;span class="s">&amp;#34;true&amp;#34;&lt;/span> &lt;span class="nt">/&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;lt;/arg&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nt">&amp;lt;/method&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">...&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>

&lt;p>すると、GDBus サーバ側のハンドラでは &lt;code>GVariant*&lt;/code> 型のパラメータとしてデータを受信できるようになるので、以下のように内部のデータを取得できます。
データのサイズも、&lt;code>GVariant&lt;/code> オブジェクトから取得することができます。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-cpp" data-lang="cpp">&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// GVariant* variant;
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="k">const&lt;/span> &lt;span class="kt">char&lt;/span>&lt;span class="o">*&lt;/span> &lt;span class="n">p&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="k">const&lt;/span> &lt;span class="kt">char&lt;/span>&lt;span class="o">*&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="n">g_variant_get_data&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">variant&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">gsize&lt;/span> &lt;span class="n">size&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">g_variant_get_size&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">variant&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">for&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="kt">int&lt;/span> &lt;span class="n">i&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="mi">0&lt;/span>&lt;span class="p">;&lt;/span> &lt;span class="n">i&lt;/span> &lt;span class="o">&amp;lt;&lt;/span> &lt;span class="n">size&lt;/span>&lt;span class="p">;&lt;/span> &lt;span class="o">++&lt;/span>&lt;span class="n">i&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">g_print&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;data[%d]=%d&lt;/span>&lt;span class="se">\n&lt;/span>&lt;span class="s">&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">i&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">p&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="n">i&lt;/span>&lt;span class="p">]);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div></description></item><item><title>Linuxメモ: glib の GVariant を使ってみる</title><link>https://maku77.github.io/p/4w6f4u5/</link><pubDate>Wed, 20 Jun 2012 00:00:00 +0900</pubDate><guid>https://maku77.github.io/p/4w6f4u5/</guid><description>&lt;h2 id="gvariant-型とは">GVariant 型とは&lt;/h2>
&lt;ul>
&lt;li>本家ドキュメント
&lt;ul>
&lt;li>&lt;a href="http://developer.gnome.org/glib/stable/glib-GVariantType.html">GVariantType — introduction to the GVariant type system&lt;/a>&lt;/li>
&lt;li>&lt;a href="http://developer.gnome.org/glib/stable/glib-GVariant.html">GVariant — strongly typed value datatype&lt;/a>&lt;/li>
&lt;li>&lt;a href="http://developer.gnome.org/glib/stable/gvariant-format-strings.html">GVariant Format Strings&lt;/a>&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;p>GDBus のライブラリを使って、array や dictionary などのデータをやりとりしようとすると、C の実装としては &lt;code>GVariant&lt;/code> 型で扱うことになります。
&lt;code>GVariant&lt;/code> オブジェクトが保持するデータの型は、&lt;strong>type strings&lt;/strong> という文字列で表現されます。
例えば、&lt;code>GVariant&lt;/code> オブジェクトの type strings が、&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-plaintext" data-lang="plaintext">&lt;span class="line">&lt;span class="cl">&amp;#34;s&amp;#34;
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>と定義されている場合、その &lt;code>GVariant&lt;/code> オブジェクトは 1 つの文字列データを保持しています。
以下のサンプルコードは、1 つの文字列データを保持する &lt;code>GVariant&lt;/code> オブジェクトを作成し、そこから文字列データを取り出す例です。&lt;/p>

&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">Makefile&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-makefile" data-lang="makefile">&lt;span class="line">&lt;span class="cl">&lt;span class="nv">CXX&lt;/span> &lt;span class="o">=&lt;/span> clang++
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv">MY_LIBS&lt;/span> &lt;span class="o">=&lt;/span> glib-2.0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv">CPPFLAGS&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="k">$(&lt;/span>shell pkg-config --cflags &lt;span class="si">${&lt;/span>&lt;span class="nv">MY_LIBS&lt;/span>&lt;span class="si">}&lt;/span>&lt;span class="k">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv">LDLIBS&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="k">$(&lt;/span>shell pkg-config --libs &lt;span class="si">${&lt;/span>&lt;span class="nv">MY_LIBS&lt;/span>&lt;span class="si">}&lt;/span>&lt;span class="k">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nf">sample&lt;/span>&lt;span class="o">:&lt;/span> &lt;span class="n">sample&lt;/span>.&lt;span class="n">cpp&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>


&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">sample.cpp&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-cpp" data-lang="cpp">&lt;span class="line">&lt;span class="cl">&lt;span class="cp">#include&lt;/span> &lt;span class="cpf">&amp;lt;glib.h&amp;gt;&lt;/span>&lt;span class="cp">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cp">&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kt">int&lt;/span> &lt;span class="nf">main&lt;/span>&lt;span class="p">()&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// Create a GVariant object.
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="n">GVariant&lt;/span> &lt;span class="o">*&lt;/span>&lt;span class="n">variant&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">g_variant_new&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;s&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s">&amp;#34;Hello&amp;#34;&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// Obtain a value from a GVariant object.
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="n">gchar&lt;/span> &lt;span class="o">*&lt;/span>&lt;span class="n">val&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">g_variant_get&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">variant&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s">&amp;#34;s&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="o">&amp;amp;&lt;/span>&lt;span class="n">val&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">g_print&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;value = %s&lt;/span>&lt;span class="se">\n&lt;/span>&lt;span class="s">&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">val&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">g_free&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">val&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>

&lt;p>特に、&lt;code>GVariant&lt;/code> オブジェクトが１つのデータだけを保持している場合は、専用の関数を使えば type strings の指定は必要なくなります。&lt;/p></description></item><item><title>Linuxメモ: GDBus で簡単な P2P（クライアント＆サーバ）アプリを実装する</title><link>https://maku77.github.io/p/ce62z6o/</link><pubDate>Mon, 11 Jun 2012 00:00:00 +0900</pubDate><guid>https://maku77.github.io/p/ce62z6o/</guid><description>&lt;h2 id="gdbus-用のスタブを自動生成する">GDBus 用のスタブを自動生成する&lt;/h2>
&lt;p>&lt;code>gdbus-codegen&lt;/code> コマンドを使用すると、以下のような introspection データからスタブとなるコードを作成することができます。
&lt;code>gdbus-codegen&lt;/code> コマンドがインストールされていない場合は以下のようにインストールできます。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-console" data-lang="console">&lt;span class="line">&lt;span class="cl">&lt;span class="gp">$&lt;/span> sudo apt-get install libglib2.0-dev
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="gp">$&lt;/span> sudo apt-get install libglib2.0-doc
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>ここでは、足し算と引き算を行う &lt;code>com.example.MyApp.Calc&lt;/code> インタフェースを考えてみます。&lt;/p>

&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">interface.xml&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-xml" data-lang="xml">&lt;span class="line">&lt;span class="cl">&lt;span class="cp">&amp;lt;?xml version=&amp;#34;1.0&amp;#34;?&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nt">&amp;lt;node&lt;/span> &lt;span class="na">name=&lt;/span>&lt;span class="s">&amp;#34;/com/example/MyApp&amp;#34;&lt;/span>&lt;span class="nt">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;lt;interface&lt;/span> &lt;span class="na">name=&lt;/span>&lt;span class="s">&amp;#34;com.example.MyApp.Calc&amp;#34;&lt;/span>&lt;span class="nt">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;lt;method&lt;/span> &lt;span class="na">name=&lt;/span>&lt;span class="s">&amp;#34;Add&amp;#34;&lt;/span>&lt;span class="nt">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;lt;arg&lt;/span> &lt;span class="na">type=&lt;/span>&lt;span class="s">&amp;#34;i&amp;#34;&lt;/span> &lt;span class="na">name=&lt;/span>&lt;span class="s">&amp;#34;val1&amp;#34;&lt;/span> &lt;span class="na">direction=&lt;/span>&lt;span class="s">&amp;#34;in&amp;#34;&lt;/span> &lt;span class="nt">/&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;lt;arg&lt;/span> &lt;span class="na">type=&lt;/span>&lt;span class="s">&amp;#34;i&amp;#34;&lt;/span> &lt;span class="na">name=&lt;/span>&lt;span class="s">&amp;#34;val2&amp;#34;&lt;/span> &lt;span class="na">direction=&lt;/span>&lt;span class="s">&amp;#34;in&amp;#34;&lt;/span> &lt;span class="nt">/&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;lt;arg&lt;/span> &lt;span class="na">type=&lt;/span>&lt;span class="s">&amp;#34;i&amp;#34;&lt;/span> &lt;span class="na">name=&lt;/span>&lt;span class="s">&amp;#34;ret_val&amp;#34;&lt;/span> &lt;span class="na">direction=&lt;/span>&lt;span class="s">&amp;#34;out&amp;#34;&lt;/span> &lt;span class="nt">/&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;lt;/method&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;lt;method&lt;/span> &lt;span class="na">name=&lt;/span>&lt;span class="s">&amp;#34;Subtract&amp;#34;&lt;/span>&lt;span class="nt">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;lt;arg&lt;/span> &lt;span class="na">type=&lt;/span>&lt;span class="s">&amp;#34;i&amp;#34;&lt;/span> &lt;span class="na">name=&lt;/span>&lt;span class="s">&amp;#34;val1&amp;#34;&lt;/span> &lt;span class="na">direction=&lt;/span>&lt;span class="s">&amp;#34;in&amp;#34;&lt;/span> &lt;span class="nt">/&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;lt;arg&lt;/span> &lt;span class="na">type=&lt;/span>&lt;span class="s">&amp;#34;i&amp;#34;&lt;/span> &lt;span class="na">name=&lt;/span>&lt;span class="s">&amp;#34;val2&amp;#34;&lt;/span> &lt;span class="na">direction=&lt;/span>&lt;span class="s">&amp;#34;in&amp;#34;&lt;/span> &lt;span class="nt">/&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;lt;arg&lt;/span> &lt;span class="na">type=&lt;/span>&lt;span class="s">&amp;#34;i&amp;#34;&lt;/span> &lt;span class="na">name=&lt;/span>&lt;span class="s">&amp;#34;ret_val&amp;#34;&lt;/span> &lt;span class="na">direction=&lt;/span>&lt;span class="s">&amp;#34;out&amp;#34;&lt;/span> &lt;span class="nt">/&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;lt;/method&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;lt;/interface&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nt">&amp;lt;/node&amp;gt;&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>

&lt;p>以下のように実行すると、&lt;code>calc.h&lt;/code> と &lt;code>calc.c&lt;/code> が生成されます。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-console" data-lang="console">&lt;span class="line">&lt;span class="cl">&lt;span class="gp">$&lt;/span> gdbus-codegen --generate-c-code&lt;span class="o">=&lt;/span>calc interface.xml
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;ul>
&lt;li>&lt;a href="./calc.h">calc.h&lt;/a>&lt;/li>
&lt;li>&lt;a href="./calc.c">calc.c&lt;/a>&lt;/li>
&lt;/ul>
&lt;h2 id="gdbus-プログラムをビルドするための-makefile-を作成する">GDBus プログラムをビルドするための Makefile を作成する&lt;/h2>
&lt;p>GDBus を使ったコードをビルドのための &lt;code>Makefile&lt;/code> を用意します。
ここでは、例として &lt;code>server.cpp&lt;/code> というソースコードから、&lt;code>server&lt;/code> というプログラムを生成することにします。&lt;/p>

&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">Makefile&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-makefile" data-lang="makefile">&lt;span class="line">&lt;span class="cl">&lt;span class="nv">CXX&lt;/span> &lt;span class="o">=&lt;/span> clang++
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv">MY_LIBS&lt;/span> &lt;span class="o">=&lt;/span> glib-2.0 gio-unix-2.0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv">CPPFLAGS&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="k">$(&lt;/span>shell pkg-config --cflags &lt;span class="si">${&lt;/span>&lt;span class="nv">MY_LIBS&lt;/span>&lt;span class="si">}&lt;/span>&lt;span class="k">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv">LDLIBS&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="k">$(&lt;/span>shell pkg-config --libs &lt;span class="si">${&lt;/span>&lt;span class="nv">MY_LIBS&lt;/span>&lt;span class="si">}&lt;/span>&lt;span class="k">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nf">server&lt;/span>&lt;span class="o">:&lt;/span> &lt;span class="n">server&lt;/span>.&lt;span class="n">cpp&lt;/span> &lt;span class="n">calc&lt;/span>.&lt;span class="n">o&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nf">client&lt;/span>&lt;span class="o">:&lt;/span> &lt;span class="n">client&lt;/span>.&lt;span class="n">cpp&lt;/span> &lt;span class="n">calc&lt;/span>.&lt;span class="n">o&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>

&lt;p>glib-2.0、gio-unix-2.0 のインクルードパスや、ライブラリ指定は、&lt;code>pkg-config&lt;/code> コマンドを利用して生成しています。
&lt;code>glib-object.h&lt;/code> で定義されている、&lt;code>g_type_init()&lt;/code> などを呼び出すためには、gio-unix-2.0 というライブラリも必要です。&lt;/p></description></item><item><title>Linuxメモ: D-Bus Java で Session bus に接続してメソッドを呼び出す</title><link>https://maku77.github.io/p/atszfrg/</link><pubDate>Tue, 15 May 2012 00:00:00 +0900</pubDate><guid>https://maku77.github.io/p/atszfrg/</guid><description>&lt;p>D-Bus Java の &lt;code>CreateInterface&lt;/code> コマンドを使用すると、API インタフェースを定義した XML ファイル (introspection data) から、Java のインタフェースを作成することができます。&lt;/p>
&lt;p>ここでは、以下のような XML ファイルからインタフェースを生成します（セッションバスなどで公開されているオブジェクトに接続して生成することもできます）。&lt;/p>

&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">interface.xml&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-xml" data-lang="xml">&lt;span class="line">&lt;span class="cl">&lt;span class="cp">&amp;lt;?xml version=&amp;#34;1.0&amp;#34;?&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nt">&amp;lt;node&lt;/span> &lt;span class="na">name=&lt;/span>&lt;span class="s">&amp;#34;/com/example/MyApp&amp;#34;&lt;/span>&lt;span class="nt">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;lt;interface&lt;/span> &lt;span class="na">name=&lt;/span>&lt;span class="s">&amp;#34;com.example.MyApp.Calc&amp;#34;&lt;/span>&lt;span class="nt">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;lt;method&lt;/span> &lt;span class="na">name=&lt;/span>&lt;span class="s">&amp;#34;Add&amp;#34;&lt;/span>&lt;span class="nt">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;lt;arg&lt;/span> &lt;span class="na">type=&lt;/span>&lt;span class="s">&amp;#34;i&amp;#34;&lt;/span> &lt;span class="na">name=&lt;/span>&lt;span class="s">&amp;#34;val1&amp;#34;&lt;/span> &lt;span class="na">direction=&lt;/span>&lt;span class="s">&amp;#34;in&amp;#34;&lt;/span> &lt;span class="nt">/&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;lt;arg&lt;/span> &lt;span class="na">type=&lt;/span>&lt;span class="s">&amp;#34;i&amp;#34;&lt;/span> &lt;span class="na">name=&lt;/span>&lt;span class="s">&amp;#34;val2&amp;#34;&lt;/span> &lt;span class="na">direction=&lt;/span>&lt;span class="s">&amp;#34;in&amp;#34;&lt;/span> &lt;span class="nt">/&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;lt;arg&lt;/span> &lt;span class="na">type=&lt;/span>&lt;span class="s">&amp;#34;i&amp;#34;&lt;/span> &lt;span class="na">name=&lt;/span>&lt;span class="s">&amp;#34;ret_val&amp;#34;&lt;/span> &lt;span class="na">direction=&lt;/span>&lt;span class="s">&amp;#34;out&amp;#34;&lt;/span> &lt;span class="nt">/&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;lt;/method&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;lt;method&lt;/span> &lt;span class="na">name=&lt;/span>&lt;span class="s">&amp;#34;Subtract&amp;#34;&lt;/span>&lt;span class="nt">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;lt;arg&lt;/span> &lt;span class="na">type=&lt;/span>&lt;span class="s">&amp;#34;i&amp;#34;&lt;/span> &lt;span class="na">name=&lt;/span>&lt;span class="s">&amp;#34;val1&amp;#34;&lt;/span> &lt;span class="na">direction=&lt;/span>&lt;span class="s">&amp;#34;in&amp;#34;&lt;/span> &lt;span class="nt">/&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;lt;arg&lt;/span> &lt;span class="na">type=&lt;/span>&lt;span class="s">&amp;#34;i&amp;#34;&lt;/span> &lt;span class="na">name=&lt;/span>&lt;span class="s">&amp;#34;val2&amp;#34;&lt;/span> &lt;span class="na">direction=&lt;/span>&lt;span class="s">&amp;#34;in&amp;#34;&lt;/span> &lt;span class="nt">/&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;lt;arg&lt;/span> &lt;span class="na">type=&lt;/span>&lt;span class="s">&amp;#34;i&amp;#34;&lt;/span> &lt;span class="na">name=&lt;/span>&lt;span class="s">&amp;#34;ret_val&amp;#34;&lt;/span> &lt;span class="na">direction=&lt;/span>&lt;span class="s">&amp;#34;out&amp;#34;&lt;/span> &lt;span class="nt">/&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;lt;/method&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;lt;/interface&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nt">&amp;lt;/node&amp;gt;&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>


&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">生成&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-console" data-lang="console">&lt;span class="line">&lt;span class="cl">&lt;span class="gp">$&lt;/span> CreateInterface interface.xml &amp;gt; Calc.java
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>

&lt;p>以下のようなファイルが生成されます。シンプル！&lt;/p>

&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">Calc.java&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="cm">/* File: com/example/MyApp/Calc.java */&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="kn">package&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nn">com.example.MyApp&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="kn">import&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nn">org.freedesktop.dbus.DBusInterface&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="kd">public&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kd">interface&lt;/span> &lt;span class="nc">Calc&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kd">extends&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">DBusInterface&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kd">public&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kt">int&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nf">Add&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="kt">int&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">val1&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kt">int&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">val2&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kd">public&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kt">int&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nf">Subtract&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="kt">int&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">val1&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kt">int&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">val2&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>

&lt;p>次に、これを使ってクライアントのコードを記述します。
GLib bindings を使った場合のコードと比べると、かなりシンプルです。&lt;/p></description></item><item><title>Linuxメモ: D-Bus 関連用語</title><link>https://maku77.github.io/p/y3w7mc2/</link><pubDate>Mon, 14 May 2012 00:00:00 +0900</pubDate><guid>https://maku77.github.io/p/y3w7mc2/</guid><description>&lt;p>D-Bus 系のライブラリを使用するにあたって、知っておくべき用語を解説します。&lt;/p>
&lt;h2 id="bus">Bus&lt;/h2>
&lt;p>D-Bus の通信は、Bus を通して行われます。
Bus は、message bus という特殊なアプリケーション (daemon) が保持しており、以下のような種類があります。&lt;/p>
&lt;dl>
&lt;dt>system bus&lt;/dt>
&lt;dd>システム内で１つだけ存在する。カーネルレイヤの情報も収集し、USB 接続の検出などにも使われている。&lt;/dd>
&lt;dt>session buses&lt;/dt>
&lt;dd>ユーザごとに存在する。一番よく使われるバス。Desktop bus とも呼ばれる。&lt;/dd>
&lt;dt>private buses&lt;/dt>
&lt;dd>２アプリが Peer-to-Peer で接続するためのバス。&lt;/dd>
&lt;/dl>
&lt;h2 id="message">Message&lt;/h2>
&lt;p>Bus 経由で伝達する際の、データの１単位を表します。
プログラムで言うと１つのメソッド呼び出しのやり取りに相当します。
メッセージは内部的には非同期通信ですが、各ライブラリ (Bindings) の API として、同期メソッドが提供されています。&lt;/p>
&lt;h2 id="namespace--address">Namespace / Address&lt;/h2>
&lt;dl>
&lt;dt>Service name (Bus name)&lt;/dt>
&lt;dd>個々のアプリケーションのバスへの &amp;ldquo;Connection&amp;rdquo; を示す名前。
ドキュメントによっては、&amp;ldquo;bus names&amp;rdquo; と読んでいるが、正確にはバスの名前ではなく、個々のバスへの &amp;ldquo;接続&amp;rdquo; を示す名前であることに注意。
（あくまで、バスの実体は system bus、session bus として存在していて、ここで言う &amp;ldquo;bus name&amp;rdquo;（接続を意味する）とは概念が異なる。）
Service 名は、接続相手となるアプリの接続を指定するために使われるので、Java の package 名のように一意な名前をつける必要がある。
接続は一般的には１アプリで１つであり、例えば、mycompany.com というドメインを持つ会社が作成する MyApp というアプリの接続なら、com.mycompany.MyApp というようにドメイン名を逆順に使って名前を付ければよい。
同じアプリケーションが同時に複数起動するケースを考慮する場合は、それぞれのアプリの接続に別の Service 名を割り当てる必要がある。そのような場合は、例えば、Process ID を付加することで一意な Service 名を作り出す。&lt;/dd>
&lt;dt>Object path&lt;/dt>
&lt;dd>それぞれの Service は複数の Object を公開することができ、それぞれの Object は複数の Interface を公開することができる。
Object 名は、Object path と呼ばれ、ディレクトリ構造のように / で区切った名前を定義する。
Object path は、必ず / で始めるため、最短でも &amp;ldquo;/&amp;rdquo; の一文字で構成される。
Object path は、一般的には Bus name と同様にドメイン名を使って、一意な Object path を付けることが多い（Object path の例: /com/mycompany/MyApp）。
実際には、アプリ要件ごとに柔軟に定義することができ、例えば、スプレッドシートアプリなら、1 つのセルを表す &amp;ldquo;/cell/A/10&amp;rdquo; のような Object path を定義することができる。&lt;/dd>
&lt;dt>Interface&lt;/dt>
&lt;dd>Bus 経由で公開されるメソッド、シグナルの集まりのこと。メソッド名、パラメータ、戻り値などが定義される。
実際にプログラムで実装するメソッド名と合わせる必要はないが、通常は合わせる（Interface の例: org.freedesktop.DBus.Peer）。&lt;/dd>
&lt;dt>Method &amp;amp; Signal&lt;/dt>
&lt;dd>メソッド名は Interface 名に続く形で表現される（Interface名＋Method名の例: org.freedesktop.DBus.Peer.Ping）。
Method 名だけでメソッドを一意に識別できる場合は、Method 呼び出し時に Interface 名を省略することができる（別の Interface にも同名のメソッドがある場合は、どちらのメソッドが呼び出されるか分からない）。
シグナルも同じように表現されるが、メソッドと違って一方通行のブロードキャストメッセージなので、戻り値は存在しない（投げっぱなし）。&lt;/dd>
&lt;/dl></description></item><item><title>Linuxメモ: D-Bus Java をインストールする</title><link>https://maku77.github.io/p/dqd9932/</link><pubDate>Fri, 11 May 2012 00:00:00 +0900</pubDate><guid>https://maku77.github.io/p/dqd9932/</guid><description>&lt;p>（Ubuntu 12.04 で確認）&lt;/p>
&lt;h2 id="必要なファイルのダウンロード">必要なファイルのダウンロード&lt;/h2>
&lt;p>以下から、&lt;code>dbus-java-2.7.tar.gz&lt;/code> などをダウンロードします。&lt;/p>
&lt;ul>
&lt;li>&lt;a href="http://www.freedesktop.org/wiki/Software/DBusBindings">http://www.freedesktop.org/wiki/Software/DBusBindings&lt;/a>&lt;/li>
&lt;/ul>
&lt;p>INSTALL ドキュメントを見ると、他にも Metthew さんのライブラリが必要のようなので、以下から &lt;code>libmatthew-java-0.8.tar.gz&lt;/code> などをダウンロードします。&lt;/p>
&lt;ul>
&lt;li>&lt;a href="http://www.matthew.ath.cx/projects/java/">http://www.matthew.ath.cx/projects/java/&lt;/a>&lt;/li>
&lt;/ul>
&lt;h2 id="ライブラリ-jar-so-ファイルのビルド">ライブラリ (*.jar *.so) ファイルのビルド&lt;/h2>

&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">libmatthew-java のビルド&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-console" data-lang="console">&lt;span class="line">&lt;span class="cl">&lt;span class="gp">$&lt;/span> tar xzvf libmatthew-java-0.8.tar.gz
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="gp">$&lt;/span> &lt;span class="nb">cd&lt;/span> libmatthew-java-0.8
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="gp">$&lt;/span> make
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>

&lt;p>&lt;code>jni.h&lt;/code> が見つからないと言われたら、&lt;code>Makefile&lt;/code> を編集して、&lt;code>jni.h&lt;/code> のディレクトリにパスを通してから &lt;code>make&lt;/code> を実行します。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-makefile" data-lang="makefile">&lt;span class="line">&lt;span class="cl">&lt;span class="nv">INCLUDE&lt;/span>&lt;span class="o">+=&lt;/span> ....... -I/usr/lib/jvm/java-7-openjdk-amd64/include
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;code>make install&lt;/code> まで実行すると、システムに jar ファイルと so ファイルがインストールされるのですが、ここでは、Linux 環境の汚染を防ぐために、&lt;code>make install&lt;/code> は行わないことにします（プロジェクトごとに jar ファイルのクラスパスを指定するようにします）。&lt;/p>
&lt;h2 id="dbus-java-のビルド">dbus-java のビルド&lt;/h2>
&lt;p>&lt;code>dbus-java-2.7&lt;/code> のビルドには JDK の version 1.6 が必要そうです (&lt;code>dbus-java&lt;/code> のコードが Java の Generics 構文などに対応できていません)。
JDK 1.6 がインストールされていない場合は先にインストールします。&lt;/p>

&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">Ubuntu での例&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-console" data-lang="console">&lt;span class="line">&lt;span class="cl">&lt;span class="gp">$&lt;/span> sudo apt-get install openjdk-6-jdk
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="gp">$&lt;/span> sudo update-java-alternatives -s java-1.6.0-openjdk-amd64
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>

&lt;p>また、&lt;code>msgfmt&lt;/code> コマンドも必要なので、&lt;code>gettext&lt;/code> パッケージをインストールします。&lt;/p></description></item><item><title>Linuxメモ: D-Bus 関連リンクと関連ツール</title><link>https://maku77.github.io/p/rexgyo3/</link><pubDate>Thu, 10 May 2012 00:00:00 +0900</pubDate><guid>https://maku77.github.io/p/rexgyo3/</guid><description>&lt;h2 id="gdbus">GDBus&lt;/h2>
&lt;ul>
&lt;li>&lt;a href="http://developer.gnome.org/gio/stable/gdbus-convenience.html">[本家] Highlevel D-Bus Support&lt;/a>&lt;/li>
&lt;li>&lt;a href="http://developer.gnome.org/gio/stable/gdbus-lowlevel.html">[本家] Lowlevel D-Bus Support&lt;/a>&lt;/li>
&lt;li>&lt;a href="http://developer.gnome.org/gio/2.32/GDBusServer.html">GDBusServer (Peer-to-Peer の実装サンプル）&lt;/a>&lt;/li>
&lt;li>&lt;a href="http://developer.gnome.org/gio/stable/ch30s05.html">gdbus-codegen ツールの使い方&lt;/a>&lt;/li>
&lt;/ul>
&lt;h2 id="d-bus-java">D-Bus Java&lt;/h2>
&lt;ul>
&lt;li>&lt;a href="http://dbus.freedesktop.org/doc/dbus-java/">DBus-Java Documentation（Javadoc もあります）&lt;/a>&lt;/li>
&lt;/ul>
&lt;p>D-Bus low-level API や GLib bindings のコードを最初に見るよりも、先に Java bindings を使ってみるのが使い方のイメージを掴みやすいかも。&lt;/p>
&lt;h2 id="その他のリンク">その他のリンク&lt;/h2>
&lt;ul>
&lt;li>&lt;a href="http://dbus.freedesktop.org/doc/dbus-glib/">D-Bus GLib bindings - Reference Manual&lt;/a>&lt;/li>
&lt;li>&lt;a href="http://techbase.kde.org/Development/Tutorials/D-Bus">Development/Tutorials/D-Bus - KDE TechBase&lt;/a>&lt;/li>
&lt;li>&lt;a href="http://maemo.org/development/training/maemo_platform_development_content/plain_html/node13/">maemo.org - Plain_html: D. Source code for the GLib D-Bus synchronous example&lt;/a>&lt;/li>
&lt;li>&lt;a href="http://www.matthew.ath.cx/misc/dbus">DBus low-level API を使ったサンプルコード&lt;/a>&lt;/li>
&lt;/ul>
&lt;h2 id="d-bus-関連ツール">D-Bus 関連ツール&lt;/h2>
&lt;dl>
&lt;dt>qdbusviewer (for Linux)&lt;/dt>
&lt;dd>GUI で、System Bus、Session Bus 上のサービスを一覧にし、そのサービスが公開しているオブジェクトと、メソッド＆シグナルも一覧にできるツール。メソッドの呼び出しと、その Reply の確認なども行えます。&lt;/dd>
&lt;dt>qdbus (for Linux)&lt;/dt>
&lt;dd>qdbusviewer を CUI 版にしたようなツール。特に理由がなければ、qdbusviewer を使ったほうが便利です。&lt;/dd>
&lt;/dl></description></item><item><title>Linuxメモ: dbus-glib で method call を実装する（クライアント側の実装）</title><link>https://maku77.github.io/p/53cn789/</link><pubDate>Thu, 10 May 2012 00:00:00 +0900</pubDate><guid>https://maku77.github.io/p/53cn789/</guid><description>&lt;p>&lt;code>dbus-binding-tool&lt;/code> を使用すると、クライアント側の実装に使うヘッダーファイルとして、
以下のようなコードが自動生成されます。&lt;/p>

&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">client.h（抜粋）&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-cpp" data-lang="cpp">&lt;span class="line">&lt;span class="cl">&lt;span class="n">gboolean&lt;/span> &lt;span class="nf">com_example_DBus_Test_Calc_add&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">DBusGProxy&lt;/span> &lt;span class="o">*&lt;/span>&lt;span class="n">proxy&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">const&lt;/span> &lt;span class="n">gint&lt;/span> &lt;span class="n">IN_val1&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="k">const&lt;/span> &lt;span class="n">gint&lt;/span> &lt;span class="n">IN_val2&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">gint&lt;/span>&lt;span class="o">*&lt;/span> &lt;span class="n">OUT_return_val&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">GError&lt;/span> &lt;span class="o">**&lt;/span>&lt;span class="n">error&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="n">dbus_g_proxy_call&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">proxy&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s">&amp;#34;add&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">error&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">G_TYPE_INT&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">IN_val1&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">G_TYPE_INT&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">IN_val2&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">G_TYPE_INVALID&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">G_TYPE_INT&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">OUT_return_val&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">G_TYPE_INVALID&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">gboolean&lt;/span> &lt;span class="nf">com_example_DBus_Test_Calc_subtract&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">DBusGProxy&lt;/span> &lt;span class="o">*&lt;/span>&lt;span class="n">proxy&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">const&lt;/span> &lt;span class="n">gint&lt;/span> &lt;span class="n">IN_val1&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="k">const&lt;/span> &lt;span class="n">gint&lt;/span> &lt;span class="n">IN_val2&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">gint&lt;/span>&lt;span class="o">*&lt;/span> &lt;span class="n">OUT_return_val&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">GError&lt;/span> &lt;span class="o">**&lt;/span>&lt;span class="n">error&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="n">dbus_g_proxy_call&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">proxy&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s">&amp;#34;subtract&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">error&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">G_TYPE_INT&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">IN_val1&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">G_TYPE_INT&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">IN_val2&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">G_TYPE_INVALID&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">G_TYPE_INT&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">OUT_return_val&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">G_TYPE_INVALID&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>

&lt;p>Async （非同期）版のコードも生成されていることが分かります。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-cpp" data-lang="cpp">&lt;span class="line">&lt;span class="cl">&lt;span class="n">DBusGProxyCall&lt;/span>&lt;span class="o">*&lt;/span> &lt;span class="nf">com_example_DBus_Test_Calc_add_async&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">DBusGProxy&lt;/span> &lt;span class="o">*&lt;/span>&lt;span class="n">proxy&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">const&lt;/span> &lt;span class="n">gint&lt;/span> &lt;span class="n">IN_val1&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="k">const&lt;/span> &lt;span class="n">gint&lt;/span> &lt;span class="n">IN_val2&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">com_example_DBus_Test_Calc_add_reply&lt;/span> &lt;span class="n">callback&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">gpointer&lt;/span> &lt;span class="n">userdata&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// ...
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="k">return&lt;/span> &lt;span class="n">dbus_g_proxy_begin_call&lt;/span>&lt;span class="p">(...);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">DBusGProxyCall&lt;/span>&lt;span class="o">*&lt;/span> &lt;span class="nf">com_example_DBus_Test_Calc_subtract_async&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">DBusGProxy&lt;/span> &lt;span class="o">*&lt;/span>&lt;span class="n">proxy&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">const&lt;/span> &lt;span class="n">gint&lt;/span> &lt;span class="n">IN_val1&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="k">const&lt;/span> &lt;span class="n">gint&lt;/span> &lt;span class="n">IN_val2&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">com_example_DBus_Test_Calc_subtract_reply&lt;/span> &lt;span class="n">callback&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">gpointer&lt;/span> &lt;span class="n">userdata&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// ...
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="k">return&lt;/span> &lt;span class="n">dbus_g_proxy_begin_call&lt;/span>&lt;span class="p">(...);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div></description></item><item><title>Linuxメモ: GDBus と dbus-glib</title><link>https://maku77.github.io/p/gqfnr2z/</link><pubDate>Wed, 09 May 2012 00:00:00 +0900</pubDate><guid>https://maku77.github.io/p/gqfnr2z/</guid><description>&lt;p>D-Bus の low-level API は &lt;strong>libdbus&lt;/strong> というライブラリで提供されています。&lt;/p>
&lt;p>通常、D-Bus アプリケーションを作成するときは、この low-level API だけ使用してコーディングするのではなく、D-Bus binding と呼ばれる、より上位のライブラリを使用します（というような記述が、D-Bus の API ドキュメントのトップに書いてあります）。&lt;/p>
&lt;ul>
&lt;li>&lt;a href="http://dbus.freedesktop.org/doc/api/html/index.html">http://dbus.freedesktop.org/doc/api/html/index.html&lt;/a>&lt;/li>
&lt;/ul>
&lt;p>例えば C 言語の場合は、&lt;strong>dbus-glib&lt;/strong> や &lt;strong>GDBus&lt;/strong> などがあります。
現在は dbus-glib は obsolete になっていて、GDBus が GIO ライブラリの一部として提供されているようです（glib-2.30.x 以降でサポート）。
とはいえ、現状は GDBus の情報はネット上にほとんどありません。&lt;/p>
&lt;p>それぞれのライブラリで、API のプレフィックスが以下のように異なっているので、サンプルコードなどを読むときに、どのライブラリを使用しているかの判断基準になります。&lt;/p>
&lt;ul>
&lt;li>Low-level API: &lt;code>dbus_XXX&lt;/code>&lt;/li>
&lt;li>dbus-glib API: &lt;code>dbus_g_XXX&lt;/code>&lt;/li>
&lt;li>GDBus API: &lt;code>g_dbus_XXX&lt;/code>&lt;/li>
&lt;/ul>
&lt;p>GDBus は dbus-glib と違い、内部で libdbus を使用していません。&lt;/p>
&lt;p>GDBus は type system として &lt;strong>GVariant&lt;/strong> をバリバリ使うので、GVariant についてマスターしている必要があります（はっきり言って、GVariant 使ったコードはあまり美しくないです）。&lt;/p>
&lt;p>XML introspection データからグルーコード（Stub とか Proxy とか）を作成するツールがあるのですが、dbus-glib が dbus-binding-tool を使うのに対し、GDBus は gdbus-codegen というツールを使用します。&lt;/p></description></item><item><title>Linuxメモ: dbus-glib で method call を実装する（サーバ側の実装）</title><link>https://maku77.github.io/p/ed9gaii/</link><pubDate>Tue, 08 May 2012 00:00:00 +0900</pubDate><guid>https://maku77.github.io/p/ed9gaii/</guid><description>&lt;p>下記は dbus-glib によるサーバ実装のファイル一式です。&lt;/p>
&lt;ul>
&lt;li>&lt;a href="./dbus-glib-server.zip">dbus-glib-server.zip&lt;/a>&lt;/li>
&lt;/ul>
&lt;p>実行してから &lt;code>qdbusviewer&lt;/code> アプリの表示を見ると、セッションバスに登録された &lt;code>com.example.MyApp&lt;/code> サービスを確認することができます。&lt;/p>


&lt;figure class="xImage">
 &lt;img style="" width="552" height="265" src="../p/ed9gaii/img-001.png" alt="/p/ed9gaii/img-001.png" />
&lt;/figure>

&lt;p>ちゃんと、&lt;code>com.example.MyApp.Calc&lt;/code> インタフェースが公開されていることが分かります。&lt;/p></description></item><item><title>Linuxメモ: dbus-glib で method call を実装する（ヘッダファイルの生成）</title><link>https://maku77.github.io/p/uzr93f8/</link><pubDate>Tue, 08 May 2012 00:00:00 +0900</pubDate><guid>https://maku77.github.io/p/uzr93f8/</guid><description>&lt;p>ここでは、D-Bus (GLib bindings) を使って、リモートメソッド呼び出しを実現してみます。
名前は以下のように定義し、リモートでの足し算 (Add) と引き算 (Subtract) を実装します。&lt;/p>
&lt;ul>
&lt;li>Bus name
&lt;ul>
&lt;li>&lt;code>com.example.MyApp&lt;/code>&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>Object path
&lt;ul>
&lt;li>&lt;code>/com/example/MyApp&lt;/code>&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>Interface
&lt;ul>
&lt;li>&lt;code>com.example.MyApp.Calc&lt;/code>&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>Method
&lt;ul>
&lt;li>&lt;code>Add(in INT32, in INT32, out INT32)&lt;/code>&lt;/li>
&lt;li>&lt;code>Subtract(in INT32, in INT32, out INT32)&lt;/code>&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;p>&lt;code>dbus-binding-tool&lt;/code> を使って、XML ファイルからサーバ、クライアント実装用のヘッダファイルを生成できます。&lt;/p>

&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">interface.xml&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-xml" data-lang="xml">&lt;span class="line">&lt;span class="cl">&lt;span class="cp">&amp;lt;?xml version=&amp;#34;1.0&amp;#34;?&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nt">&amp;lt;node&lt;/span> &lt;span class="na">name=&lt;/span>&lt;span class="s">&amp;#34;/com/example/MyApp&amp;#34;&lt;/span>&lt;span class="nt">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;lt;interface&lt;/span> &lt;span class="na">name=&lt;/span>&lt;span class="s">&amp;#34;com.example.MyApp.Calc&amp;#34;&lt;/span>&lt;span class="nt">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;lt;method&lt;/span> &lt;span class="na">name=&lt;/span>&lt;span class="s">&amp;#34;Add&amp;#34;&lt;/span>&lt;span class="nt">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;lt;arg&lt;/span> &lt;span class="na">type=&lt;/span>&lt;span class="s">&amp;#34;i&amp;#34;&lt;/span> &lt;span class="na">name=&lt;/span>&lt;span class="s">&amp;#34;val1&amp;#34;&lt;/span> &lt;span class="na">direction=&lt;/span>&lt;span class="s">&amp;#34;in&amp;#34;&lt;/span> &lt;span class="nt">/&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;lt;arg&lt;/span> &lt;span class="na">type=&lt;/span>&lt;span class="s">&amp;#34;i&amp;#34;&lt;/span> &lt;span class="na">name=&lt;/span>&lt;span class="s">&amp;#34;val2&amp;#34;&lt;/span> &lt;span class="na">direction=&lt;/span>&lt;span class="s">&amp;#34;in&amp;#34;&lt;/span> &lt;span class="nt">/&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;lt;arg&lt;/span> &lt;span class="na">type=&lt;/span>&lt;span class="s">&amp;#34;i&amp;#34;&lt;/span> &lt;span class="na">name=&lt;/span>&lt;span class="s">&amp;#34;ret_val&amp;#34;&lt;/span> &lt;span class="na">direction=&lt;/span>&lt;span class="s">&amp;#34;out&amp;#34;&lt;/span> &lt;span class="nt">/&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;lt;/method&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;lt;method&lt;/span> &lt;span class="na">name=&lt;/span>&lt;span class="s">&amp;#34;Subtract&amp;#34;&lt;/span>&lt;span class="nt">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;lt;arg&lt;/span> &lt;span class="na">type=&lt;/span>&lt;span class="s">&amp;#34;i&amp;#34;&lt;/span> &lt;span class="na">name=&lt;/span>&lt;span class="s">&amp;#34;val1&amp;#34;&lt;/span> &lt;span class="na">direction=&lt;/span>&lt;span class="s">&amp;#34;in&amp;#34;&lt;/span> &lt;span class="nt">/&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;lt;arg&lt;/span> &lt;span class="na">type=&lt;/span>&lt;span class="s">&amp;#34;i&amp;#34;&lt;/span> &lt;span class="na">name=&lt;/span>&lt;span class="s">&amp;#34;val2&amp;#34;&lt;/span> &lt;span class="na">direction=&lt;/span>&lt;span class="s">&amp;#34;in&amp;#34;&lt;/span> &lt;span class="nt">/&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;lt;arg&lt;/span> &lt;span class="na">type=&lt;/span>&lt;span class="s">&amp;#34;i&amp;#34;&lt;/span> &lt;span class="na">name=&lt;/span>&lt;span class="s">&amp;#34;ret_val&amp;#34;&lt;/span> &lt;span class="na">direction=&lt;/span>&lt;span class="s">&amp;#34;out&amp;#34;&lt;/span> &lt;span class="nt">/&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;lt;/method&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;lt;/interface&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nt">&amp;lt;/node&amp;gt;&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>


&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">ヘッダファイルの生成&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-console" data-lang="console">&lt;span class="line">&lt;span class="cl">&lt;span class="gp">$&lt;/span> dbus-binding-tool --mode&lt;span class="o">=&lt;/span>glib-server --prefix&lt;span class="o">=&lt;/span>ServerImpl interface.xml &amp;gt; server_autogen.h
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="gp">$&lt;/span> dbus-binding-tool --mode&lt;span class="o">=&lt;/span>glib-client interface.xml &amp;gt; client_autogen.h
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>

&lt;p>サーバ側のヘッダファイルを生成するときは、必ずプレフィックスを指定する必要があるようです。
これは、メソッド実装側のメソッド名のプレフィックスとして付きます。&lt;/p></description></item><item><title>Linuxメモ: dbus-glib 開発用ライブラリをインストールする</title><link>https://maku77.github.io/p/pksy5or/</link><pubDate>Wed, 02 May 2012 00:00:00 +0900</pubDate><guid>https://maku77.github.io/p/pksy5or/</guid><description>&lt;p>（Ubuntu 12.04 で確認）&lt;/p>
&lt;h2 id="dbus-glib-ライブラリのインストール">dbus-glib ライブラリのインストール&lt;/h2>
&lt;p>ここでは、D-Bus library (GLib bindings) をインストールして、C/C++ で D-Bus を使ったコードをコンパイルできるようにします。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-console" data-lang="console">&lt;span class="line">&lt;span class="cl">&lt;span class="gp">$&lt;/span> sudo apt-get install libdbus-glib-1-dev
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>ちなみに、&lt;code>apt-cache search 'libdbus'&lt;/code> のように実行すると、それっぽいパッケージを検索することができます。&lt;/p>
&lt;p>上記を実行すると、以下のようなヘッダファイルがインストールされます。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-plaintext" data-lang="plaintext">&lt;span class="line">&lt;span class="cl">/usr/include/dbus-1.0/dbus/dbus.h
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">/usr/include/dbus-1.0/dbus/dbus-glib.h
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">...
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">/usr/include/glib-2.0/glib.h
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">...
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">/usr/lib/x86_64-linux-gnu/glib-2.0/include （64 bit Linux の場合）
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="d-busglib-bindings-のヘッダをインクルードするコードをビルドしてみる">D-Bus、GLib bindings のヘッダをインクルードするコードをビルドしてみる&lt;/h2>

&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">main.cpp&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-cpp" data-lang="cpp">&lt;span class="line">&lt;span class="cl">&lt;span class="cp">#include&lt;/span> &lt;span class="cpf">&amp;lt;dbus/dbus.h&amp;gt;&lt;/span>&lt;span class="cp">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cp">#include&lt;/span> &lt;span class="cpf">&amp;lt;dbus/dbus-glib.h&amp;gt;&lt;/span>&lt;span class="cp">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cp">#include&lt;/span> &lt;span class="cpf">&amp;lt;glib.h&amp;gt;&lt;/span>&lt;span class="cp">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cp">&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kt">int&lt;/span> &lt;span class="nf">main&lt;/span>&lt;span class="p">()&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>


&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">ビルド&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-console" data-lang="console">&lt;span class="line">&lt;span class="cl">&lt;span class="gp">$&lt;/span> clang++ main.cpp &lt;span class="sb">`&lt;/span>pkg-config --cflags --libs dbus-glib-1&lt;span class="sb">`&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>

&lt;p>ここで使用している &lt;code>pkg-config&lt;/code> コマンドは、指定したライブラリのインクルードパスなどのオプション文字列を生成してくれます。
単独で実行すると、例えば以下のような出力が得られます。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-console" data-lang="console">&lt;span class="line">&lt;span class="cl">&lt;span class="gp">$&lt;/span> pkg-config --cflags --libs dbus-glib-1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">-I/usr/include/dbus-1.0 -I/usr/lib/x86_64-linux-gnu/dbus-1.0/include
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">-I/usr/include/glib-2.0 -I/usr/lib/x86_64-linux-gnu/glib-2.0/include
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">-ldbus-glib-1 -ldbus-1 -lpthread -lrt -lgobject-2.0 -lglib-2.0
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div></description></item><item><title>Linuxメモ: シェルスクリプトで配列を扱う</title><link>https://maku77.github.io/p/m82nd2v/</link><pubDate>Thu, 02 Feb 2012 00:00:00 +0900</pubDate><guid>https://maku77.github.io/p/m82nd2v/</guid><description>&lt;p>Bash シェルスクリプト内で配列を扱う方法です。&lt;/p>
&lt;h2 id="配列を作成する">配列を作成する&lt;/h2>
&lt;p>下記の例では、配列変数 &lt;code>arr&lt;/code> に 3 つの要素を格納しています。&lt;/p>
&lt;h3 id="インデックスを指定して1つずつ代入していく方法">インデックスを指定して1つずつ代入していく方法&lt;/h3>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">arr&lt;span class="o">[&lt;/span>0&lt;span class="o">]=&lt;/span>AAA
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">arr&lt;span class="o">[&lt;/span>1&lt;span class="o">]=&lt;/span>&lt;span class="m">100&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">arr&lt;span class="o">[&lt;/span>2&lt;span class="o">]=&lt;/span>&lt;span class="s1">&amp;#39;Hello world&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">echo&lt;/span> &lt;span class="si">${&lt;/span>&lt;span class="nv">arr&lt;/span>&lt;span class="p">[0]&lt;/span>&lt;span class="si">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">echo&lt;/span> &lt;span class="si">${&lt;/span>&lt;span class="nv">arr&lt;/span>&lt;span class="p">[1]&lt;/span>&lt;span class="si">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">echo&lt;/span> &lt;span class="si">${&lt;/span>&lt;span class="nv">arr&lt;/span>&lt;span class="p">[2]&lt;/span>&lt;span class="si">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>
&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">実行結果&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-plain" data-lang="plain">&lt;span class="line">&lt;span class="cl">AAA
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">100
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Hello world&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>

&lt;h3 id="配列の初期化時に要素をまとめて指定する方法">配列の初期化時に要素をまとめて指定する方法&lt;/h3>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">&lt;span class="nv">arr&lt;/span>&lt;span class="o">=(&lt;/span>AAA BBB CCC&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">echo&lt;/span> &lt;span class="si">${&lt;/span>&lt;span class="nv">arr&lt;/span>&lt;span class="p">[0]&lt;/span>&lt;span class="si">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">echo&lt;/span> &lt;span class="si">${&lt;/span>&lt;span class="nv">arr&lt;/span>&lt;span class="p">[1]&lt;/span>&lt;span class="si">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">echo&lt;/span> &lt;span class="si">${&lt;/span>&lt;span class="nv">arr&lt;/span>&lt;span class="p">[2]&lt;/span>&lt;span class="si">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>
&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">実行結果&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-plain" data-lang="plain">&lt;span class="line">&lt;span class="cl">AAA
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">BBB
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">CCC&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>

&lt;p>以下のように、複数行にまたいで値を記述することもできます。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">&lt;span class="nv">arr&lt;/span>&lt;span class="o">=(&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> AAA
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> BBB
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> CCC
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="配列をループ処理する">配列をループ処理する&lt;/h2>
&lt;p>下記の例では、3 つの要素を持つ配列変数 &lt;code>arr&lt;/code> を定義し、各要素をループで 1 つずつ処理しています。
配列要素の値にスペースが含まれる場合、下記の &lt;code>&amp;quot;CCC DDD&amp;quot;&lt;/code> のようにダブルクォートで囲む必要があります。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">&lt;span class="nv">arr&lt;/span>&lt;span class="o">=(&lt;/span>AAA BBB &lt;span class="s2">&amp;#34;CCC DDD&amp;#34;&lt;/span>&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">for&lt;/span> x in &lt;span class="s2">&amp;#34;&lt;/span>&lt;span class="si">${&lt;/span>&lt;span class="nv">arr&lt;/span>&lt;span class="p">[@]&lt;/span>&lt;span class="si">}&lt;/span>&lt;span class="s2">&amp;#34;&lt;/span>&lt;span class="p">;&lt;/span> &lt;span class="k">do&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nb">echo&lt;/span> &lt;span class="s2">&amp;#34;&lt;/span>&lt;span class="nv">$x&lt;/span>&lt;span class="s2">&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">done&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>
&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">実行結果&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-plain" data-lang="plain">&lt;span class="line">&lt;span class="cl">AAA
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">BBB
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">CCC DDD&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>

&lt;p>ちなみに、上記のコードは、以下のようにすれば配列変数を定義しないで書けます。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">&lt;span class="k">for&lt;/span> x in AAA BBB &lt;span class="s2">&amp;#34;CCC DDD&amp;#34;&lt;/span>&lt;span class="p">;&lt;/span> &lt;span class="k">do&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nb">echo&lt;/span> &lt;span class="s2">&amp;#34;&lt;/span>&lt;span class="nv">$x&lt;/span>&lt;span class="s2">&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">done&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="配列のサイズ要素数を調べる">配列のサイズ（要素数）を調べる&lt;/h2>
&lt;p>Bash で定義した配列変数のサイズを調べるには下記のようにします。
ここでは、配列変数 &lt;code>arr&lt;/code> を定義して、そのサイズを調べています。&lt;/p></description></item><item><title>Linuxメモ: Linux システムコールを使用して core dump を吐かないようにする (setrlimit)</title><link>https://maku77.github.io/p/afze7gn/</link><pubDate>Tue, 11 Oct 2011 00:00:00 +0900</pubDate><guid>https://maku77.github.io/p/afze7gn/</guid><description>&lt;p>Linux プロセスが異常終了した場合に吐き出される core dump ファイルはセキュリティホールになり得ます。
core dump ファイルを出力しないようにするには、各プロセスで以下のように Linux システムコールの &lt;strong>&lt;code>setrlimit&lt;/code>&lt;/strong> を実行します。&lt;/p>

&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">core dump を吐かないようにする (C&amp;#43;&amp;#43;)&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-cpp" data-lang="cpp">&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// #include &amp;lt;sys/time.h&amp;gt;
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// #include &amp;lt;sys/resource.h&amp;gt;
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">rlimit&lt;/span> &lt;span class="n">rl&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">rl&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">rlim_cur&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="mi">0&lt;/span>&lt;span class="p">;&lt;/span> &lt;span class="c1">// soft limit
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="n">rl&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">rlim_max&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="mi">0&lt;/span>&lt;span class="p">;&lt;/span> &lt;span class="c1">// hard limit
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="k">if&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">setrlimit&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">RLIMIT_CORE&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="o">&amp;amp;&lt;/span>&lt;span class="n">rl&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="o">!=&lt;/span> &lt;span class="mi">0&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// setrlimit failed! exit process
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="p">}&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>

&lt;p>このように実行しておけば、仮に root を奪取されて &lt;code>ulimit -c&lt;/code> コマンドを実行されても core dump を吐かなくなります。&lt;/p></description></item><item><title>Linuxメモ: echo で出力する文字の色を変える</title><link>https://maku77.github.io/p/fufwdub/</link><pubDate>Wed, 11 May 2011 00:00:00 +0900</pubDate><guid>https://maku77.github.io/p/fufwdub/</guid><description>&lt;p>Linux の &lt;code>echo&lt;/code> コマンドで特殊なエスケープシーケンスを出力すると、テキストの文字を変更することができます。
次の Bash スクリプトでは、色を変更しつつ &lt;code>echo&lt;/code> 出力する、&lt;code>error&lt;/code> / &lt;code>warn&lt;/code> / &lt;code>info&lt;/code> 関数を定義しています。&lt;/p>

&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">sample.sh&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">&lt;span class="cp">#!/bin/bash
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cp">&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">error&lt;span class="o">()&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nb">echo&lt;/span> -e &lt;span class="s2">&amp;#34;\033[31m&lt;/span>&lt;span class="nv">$*&lt;/span>&lt;span class="s2">\033[00m&amp;#34;&lt;/span> &amp;gt;&lt;span class="p">&amp;amp;&lt;/span>&lt;span class="m">2&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">warn&lt;span class="o">()&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nb">echo&lt;/span> -e &lt;span class="s2">&amp;#34;\033[33m&lt;/span>&lt;span class="nv">$*&lt;/span>&lt;span class="s2">\033[00m&amp;#34;&lt;/span> &amp;gt;&lt;span class="p">&amp;amp;&lt;/span>&lt;span class="m">2&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">info&lt;span class="o">()&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nb">echo&lt;/span> -e &lt;span class="s2">&amp;#34;\033[32m&lt;/span>&lt;span class="nv">$*&lt;/span>&lt;span class="s2">\033[00m&amp;#34;&lt;/span> &amp;gt;&lt;span class="p">&amp;amp;&lt;/span>&lt;span class="m">2&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">error &lt;span class="s1">&amp;#39;Error message&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">warn &lt;span class="s1">&amp;#39;Warning message&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">info &lt;span class="s1">&amp;#39;Information message&amp;#39;&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>

&lt;p>このシェルスクリプトを実行すると、次のように色付きのメッセージが表示されます。&lt;/p>


&lt;figure class="xImage">
 &lt;img style="" width="264" height="77" src="../p/fufwdub/img-001.png" alt="/p/fufwdub/img-001.png" />
 &lt;figcaption>図: echo コマンドの出力色を変更&lt;/figcaption>
&lt;/figure>

&lt;p>ちなみに、&lt;code>echo&lt;/code> コマンドの末尾の &lt;code>&amp;gt;&amp;amp;2&lt;/code> は、標準エラー出力へ出力することを示しています。&lt;/p>
&lt;ul>
&lt;li>参考: &lt;a href="../p/q2k3j2h/">echo の結果を標準エラー出力 (stderr) に出力する (&lt;code>1&amp;gt;&amp;amp;2&lt;/code>)&lt;/a>&lt;/li>
&lt;/ul></description></item><item><title>Linuxメモ: 改行コードが原因の関数定義の syntax error</title><link>https://maku77.github.io/p/c2ycgaj/</link><pubDate>Wed, 27 Apr 2011 00:00:00 +0900</pubDate><guid>https://maku77.github.io/p/c2ycgaj/</guid><description>&lt;p>下記は簡単な関数を定義しているだけのシンプルなシェルスクリプトですが、&lt;/p>

&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">my_functions.sh&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">&lt;span class="k">function&lt;/span> hello &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nb">echo&lt;/span> &lt;span class="s1">&amp;#39;Good morning!&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">}&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>

&lt;p>このファイルを &lt;code>source&lt;/code> コマンドで読み込んだときに以下のような syntax error が出ることがあります。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-console" data-lang="console">&lt;span class="line">&lt;span class="cl">&lt;span class="gp">$&lt;/span> &lt;span class="nb">source&lt;/span> my_functions.sh
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">&amp;#39;ash: my_functions.bash: line 1: syntax error near unexpected token `{
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">&amp;#39;ash: my_functions.bash: line 1: `function hello {
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>このようなエラーが出る場合は、テキストファイルの改行コードが Windows (CR+LF) で保存されている可能性があります。
改行コードを変更するには、例えば Vim エディタから以下のように実行します。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-vim" data-lang="vim">&lt;span class="line">&lt;span class="cl">&lt;span class="p">:&lt;/span>&lt;span class="k">set&lt;/span> &lt;span class="nx">ff&lt;/span>&lt;span class="p">=&lt;/span>&lt;span class="nx">unix&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">:&lt;/span>&lt;span class="nx">w&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div></description></item><item><title>Linuxメモ: Bash の構文: 関数へパラメータを渡す</title><link>https://maku77.github.io/p/ecj6wbo/</link><pubDate>Fri, 15 Apr 2011 00:00:00 +0900</pubDate><guid>https://maku77.github.io/p/ecj6wbo/</guid><description>&lt;p>関数に渡されたパラメータの処理方法は、シェルスクリプト実行時に渡されたコマンドラインパラメータの処理方法と同じです。
以下のコマンドラインパラメータの処理方法に関する記事も参考にしてください。&lt;/p>
&lt;ul>
&lt;li>&lt;a href="../p/c2kx7er/">コマンドライン引数を取得する&lt;/a>&lt;/li>
&lt;/ul>
&lt;h2 id="関数へ渡されたパラメータの数を調べる-">関数へ渡されたパラメータの数を調べる ($#)&lt;/h2>
&lt;p>関数内で &lt;strong>&lt;code>$#&lt;/code>&lt;/strong> を参照すると、渡されたパラメータの数を調べることができます。&lt;/p>

&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">サンプルコード&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">&lt;span class="k">function&lt;/span> foo &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nb">echo&lt;/span> &lt;span class="nv">$#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">}&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>


&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">実行結果&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-console" data-lang="console">&lt;span class="line">&lt;span class="cl">&lt;span class="gp">$&lt;/span> foo &lt;span class="m">100&lt;/span> &lt;span class="m">200&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">2
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">&lt;/span>&lt;span class="err">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="err">&lt;/span>&lt;span class="gp">$&lt;/span> foo aaa bbb ccc
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">3
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">&lt;/span>&lt;span class="err">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="err">&lt;/span>&lt;span class="gp">$&lt;/span> foo &lt;span class="s2">&amp;#34;This is a pen&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">1
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>

&lt;div class="xNote">
 &lt;span class="xNote_title">☝️ ワンポイント&lt;/span>
 &lt;span class="xNote_body">関数の外で &lt;code>$#&lt;/code> を参照すると、シェルスクリプト実行時に渡されたコマンドラインパラメータの数を取得できます。&lt;/span>
&lt;/div>

&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">応用例: 関数へ渡されたパラメータが少なくとも 1 つ以上あるか調べる&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">&lt;span class="k">function&lt;/span> foo &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="o">[&lt;/span> &lt;span class="nv">$#&lt;/span> -lt &lt;span class="m">1&lt;/span> &lt;span class="o">]&lt;/span>&lt;span class="p">;&lt;/span> &lt;span class="k">then&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nb">echo&lt;/span> &lt;span class="s1">&amp;#39;Function &amp;#34;foo&amp;#34; needs at least one parameter&amp;#39;&lt;/span> &amp;gt;&lt;span class="p">&amp;amp;&lt;/span>&lt;span class="m">2&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nb">exit&lt;/span> -1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">fi&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nb">echo&lt;/span> &lt;span class="s1">&amp;#39;OK&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">}&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>

&lt;h2 id="関数へ渡されたパラメータを順番に処理する">関数へ渡されたパラメータを順番に処理する&lt;/h2>

&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">サンプルコード&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">&lt;span class="k">function&lt;/span> enum_params &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">while&lt;/span> &lt;span class="o">[&lt;/span> -n &lt;span class="s2">&amp;#34;&lt;/span>&lt;span class="nv">$1&lt;/span>&lt;span class="s2">&amp;#34;&lt;/span> &lt;span class="o">]&lt;/span>&lt;span class="p">;&lt;/span> &lt;span class="k">do&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nb">echo&lt;/span> &lt;span class="nv">$1&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nb">shift&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">done&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">}&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>

&lt;p>&lt;code>[ -n &amp;quot;$1&amp;quot; ]&lt;/code> の部分では、パラメーターが空文字ではないかどうかを調べています。
&lt;code>shift&lt;/code> コマンドは、パラメータを左にシフトします。
つまり、&lt;code>$2&lt;/code> の値が &lt;code>$1&lt;/code> に、&lt;code>$3&lt;/code> の値が &lt;code>$2&lt;/code> に、というようにシフトされます。
これにより、すべてのパラメーターを &lt;code>$1&lt;/code> で順番に参照することができます。&lt;/p></description></item><item><title>Linuxシェルスクリプト: ディレクトリ内のファイルを順に処理する (for, while)</title><link>https://maku77.github.io/p/or3cmv6/</link><pubDate>Sun, 06 Feb 2011 00:00:00 +0900</pubDate><guid>https://maku77.github.io/p/or3cmv6/</guid><description>&lt;h2 id="ワイルドカードを使用する方法">ワイルドカードを使用する方法&lt;/h2>
&lt;p>ワイルドカード (&lt;strong>&lt;code>*&lt;/code>&lt;/strong>) を使って、カレントディレクトリ内のファイルをループ処理することができます。&lt;/p>

&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">例: すべてのファイル（ドットファイルを除く）をループ処理&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">&lt;span class="k">for&lt;/span> x in *&lt;span class="p">;&lt;/span> &lt;span class="k">do&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nb">echo&lt;/span> &lt;span class="s2">&amp;#34;&lt;/span>&lt;span class="nv">$x&lt;/span>&lt;span class="s2">&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">done&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>

&lt;p>特定の拡張子を持つファイルのみを列挙するには次のようにします。&lt;/p>

&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">例: すべての PNG ファイルをループ処理&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">&lt;span class="k">for&lt;/span> x in *.png&lt;span class="p">;&lt;/span> &lt;span class="k">do&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nb">echo&lt;/span> &lt;span class="nv">$x&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">done&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>

&lt;p>次のように一行で書くこともできます。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">&lt;span class="k">for&lt;/span> x in *.png&lt;span class="p">;&lt;/span> &lt;span class="k">do&lt;/span> &lt;span class="nb">echo&lt;/span> &lt;span class="s2">&amp;#34;&lt;/span>&lt;span class="nv">$x&lt;/span>&lt;span class="s2">&amp;#34;&lt;/span>&lt;span class="p">;&lt;/span> &lt;span class="k">done&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="find-コマンドの結果を使用する方法再帰的にファイル探索">find コマンドの結果を使用する方法（再帰的にファイル探索）&lt;/h2>
&lt;p>下記の例では、&lt;code>find&lt;/code> コマンドによって見つかったファイルを &lt;code>while&lt;/code> ループで順番に処理しています。
深い階層にあるファイルも再帰的に処理されます。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">find . -type f &lt;span class="p">|&lt;/span> &lt;span class="k">while&lt;/span> &lt;span class="nb">read&lt;/span> x&lt;span class="p">;&lt;/span> &lt;span class="k">do&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nb">echo&lt;/span> &lt;span class="s2">&amp;#34;&lt;/span>&lt;span class="nv">$x&lt;/span>&lt;span class="s2">&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">done&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;ul>
&lt;li>参考: &lt;a href="../p/s9r9q7n/">外部コマンドの実行結果を 1 行ずつ処理する (&lt;code>for&lt;/code>, &lt;code>while&lt;/code>, &lt;code>read&lt;/code>)&lt;/a>&lt;/li>
&lt;/ul></description></item><item><title>Linuxメモ: カーネルに渡されたパラメータを調べる (/proc/cmdline)</title><link>https://maku77.github.io/p/3wheif6/</link><pubDate>Tue, 01 Feb 2011 00:00:00 +0900</pubDate><guid>https://maku77.github.io/p/3wheif6/</guid><description>&lt;p>&lt;strong>&lt;code>/proc/cmdline&lt;/code>&lt;/strong> の内容を出力すると、カーネルへ渡されたコマンドラインパラメータを調べることができます。&lt;/p>
&lt;pre tabindex="0">&lt;code>$ cat /proc/cmdline
BOOT_IMAGE=/boot/vmlinuz-2.6.32-28.generic root=UUID=37c279f8-9c77-78c5-c379-d01e2c480351 ro quiet splash
&lt;/code>&lt;/pre>&lt;p>他にも、&lt;code>/proc&lt;/code> 以下のファイルにアクセスしていろいろな情報を取得することができます。
例えば、&lt;code>cat /proc/cpuinfo&lt;/code> とすると、CPU の情報を調べることができます。
どのような情報を取得できるか、&lt;code>man proc&lt;/code> で確認してみてください。&lt;/p></description></item><item><title>Linuxメモ: Linux のメモリ情報を調べるコマンド</title><link>https://maku77.github.io/p/2tumm9k/</link><pubDate>Thu, 20 Jan 2011 00:00:00 +0900</pubDate><guid>https://maku77.github.io/p/2tumm9k/</guid><description>&lt;h2 id="free-コマンド">free コマンド&lt;/h2>
&lt;p>&lt;code>free&lt;/code> コマンドを使用して、Linux システム全体の空きメモリ容量 (KByte) を調べることができます。
内部的には、&lt;code>/proc/meminfo&lt;/code> の内容を整形して表示しています。&lt;/p>

&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">実行例（Ubuntu 10.04 の場合）&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-console" data-lang="console">&lt;span class="line">&lt;span class="cl">&lt;span class="gp">$&lt;/span> free
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go"> total used free shared buffers cached
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">Mem: 4057716 3110204 947512 0 255708 2091224
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">-/+ buffers/cache: 763272 3294444★ ←実質的な空き容量はここを見る
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">Swap: 11884536 60600 11823936
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>

&lt;p>Linux では、ディスクアクセスの負荷軽減のために、空きメモリをバッファ領域（ファイルのメタ情報などを保持）とキャッシュ領域（ファイルの内容そのものをキャッシュ）に割り当てています。
上記の &lt;strong>Mem:&lt;/strong> の行の &lt;strong>free&lt;/strong> 値 &lt;code>947512&lt;/code> は、空き容量からバッファ領域 (&lt;strong>buffers&lt;/strong>) とキャッシュ領域 (&lt;strong>cached&lt;/strong>) に割り当てた分を差し引いた値を示しているので、free の値はいつも小さくなります。
実質的な空き容量を求めるには、free の値に buffers と cached の分を足してやる必要があります。
その下の行の &lt;strong>-/+ buffers/cache:&lt;/strong> というところがこの計算をした結果を示しており、一行目の &lt;code>free&lt;/code>、&lt;code>buffers&lt;/code>、&lt;code>cached&lt;/code> をすべて足した、実質的な空き容量が表示されています。&lt;/p>
&lt;pre tabindex="0">&lt;code>3294444（実質 free） = 947512 (mem free) + 255708 (buffers) + 2091224 (cached)
&lt;/code>&lt;/pre>&lt;h3 id="おまけ-free-コマンドの-help-やオプション">おまけ: free コマンドの help やオプション&lt;/h3>
&lt;p>下記は &lt;code>free&lt;/code> コマンドのヘルプ説明です。&lt;/p></description></item><item><title>Linuxメモ: カレントディレクトリや指定したファイルの絶対パスを取得する</title><link>https://maku77.github.io/p/arxcjmp/</link><pubDate>Fri, 15 Oct 2010 00:00:00 +0900</pubDate><guid>https://maku77.github.io/p/arxcjmp/</guid><description>&lt;h2 id="カレントディレクトリの絶対パスを取得する">カレントディレクトリの絶対パスを取得する&lt;/h2>
&lt;p>以下のどの方法でも、カレントディレクトリの絶対パスを取得できます。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">&lt;span class="nv">current_dir&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="k">$(&lt;/span>&lt;span class="nb">pwd&lt;/span>&lt;span class="k">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv">current_dir&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;&lt;/span>&lt;span class="nv">$PWD&lt;/span>&lt;span class="s2">&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv">current_dir&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="sb">`&lt;/span>&lt;span class="nb">pwd&lt;/span>&lt;span class="sb">`&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="指定したファイルの絶対パスを取得する">指定したファイルの絶対パスを取得する&lt;/h2>
&lt;p>相対パスで指定したファイルのパスを絶対パスに変換するには、下記のように &lt;code>dirname&lt;/code> と &lt;code>basename&lt;/code> を組み合わせて使用します。
&lt;code>$path&lt;/code> には、カレントディレクトリからの相対パスでファイル名が格納されているとします。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">&lt;span class="nv">abs_path&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="k">$(&lt;/span>&lt;span class="nb">cd&lt;/span> &lt;span class="k">$(&lt;/span>dirname &lt;span class="nv">$path&lt;/span>&lt;span class="k">)&lt;/span>&lt;span class="p">;&lt;/span> &lt;span class="nb">pwd&lt;/span>&lt;span class="k">)&lt;/span>/&lt;span class="k">$(&lt;/span>basename &lt;span class="nv">$path&lt;/span>&lt;span class="k">)&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>内部で &lt;code>cd&lt;/code> コマンドを実行しているため、ディレクトリ名を含むパスを指定したときは、実際にそのディレクトリが存在していないといけないことに注意してください。
下記のサンプルスクリプトは、コマンドラインパラメータとして渡された相対パスを絶対パスに変換します。&lt;/p>

&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">rel2abs.sh（渡されたファイルパスを絶対パスに変換する）&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">&lt;span class="cp">#!/bin/bash
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cp">&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv">abs_path&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="k">$(&lt;/span>&lt;span class="nb">cd&lt;/span> &lt;span class="k">$(&lt;/span>dirname &lt;span class="nv">$1&lt;/span>&lt;span class="k">)&lt;/span>&lt;span class="p">;&lt;/span> &lt;span class="nb">pwd&lt;/span>&lt;span class="k">)&lt;/span>/&lt;span class="k">$(&lt;/span>basename &lt;span class="nv">$1&lt;/span>&lt;span class="k">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">echo&lt;/span> &lt;span class="s2">&amp;#34;&lt;/span>&lt;span class="nv">$abs_path&lt;/span>&lt;span class="s2">&amp;#34;&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>


&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">実行結果&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-console" data-lang="console">&lt;span class="line">&lt;span class="cl">&lt;span class="gp">$&lt;/span> &lt;span class="nb">cd&lt;/span> /Users/maku/scripts
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="gp">$&lt;/span> ./rel2abs.sh aaa/bbb/ccc.txt
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">/Users/maku/scripts/aaa/bbb/ccc.txt
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">&lt;/span>&lt;span class="err">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="err">&lt;/span>&lt;span class="gp">$&lt;/span> &lt;span class="nb">cd&lt;/span> /Users/maku
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="gp">$&lt;/span> scripts/rel2abs.sh scripts/aaa/bbb/ccc.txt
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">/Users/maku/scripts/aaa/bbb/ccc.txt
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>

&lt;p>実行時のカレントディレクトリが異なっていても、正しく絶対パスを取得できていることがわかると思います。&lt;/p></description></item><item><title>Linuxメモ: シェルスクリプト: 定数を定義する (readonly)</title><link>https://maku77.github.io/p/dwsvs5j/</link><pubDate>Tue, 07 Sep 2010 00:00:00 +0900</pubDate><guid>https://maku77.github.io/p/dwsvs5j/</guid><description>&lt;p>Bash スクリプト内で定数を定義するには、&lt;strong>&lt;code>readonly&lt;/code>&lt;/strong> コマンドを使用します。
&lt;code>readonly&lt;/code> を使うことで、変数や関数を読み取り専用に設定でき、誤って値を変更したり削除したりすることを防げます。
下記のように実行すると、指定した変数や関数に対する代入や &lt;code>unset&lt;/code> ができなくなります。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">&lt;span class="nb">readonly&lt;/span> my_var &lt;span class="c1"># 変数 my_var を readonly に&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">readonly&lt;/span> -a my_arr &lt;span class="c1"># 配列 my_arr を readonly に&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">readonly&lt;/span> -f my_func &lt;span class="c1"># 関数 my_func を readonly に&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>変数の定義と同時に &lt;code>readonly&lt;/code> 指定することも可能です。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">&lt;span class="nb">readonly&lt;/span> &lt;span class="nv">USERNAME&lt;/span>&lt;span class="o">=&lt;/span>maku
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>下記の例では、変数 &lt;code>MAX_SIZE&lt;/code> を値 100 で初期化し、その後 200 という値を代入しようとしています。&lt;/p>

&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">sample.sh&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">&lt;span class="cp">#!/bin/bash
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cp">&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">readonly&lt;/span> &lt;span class="nv">MAX_SCORE&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">100&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv">MAX_SCORE&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">200&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>

&lt;p>&lt;code>MAX_SCORE&lt;/code> 変数は &lt;code>readonly&lt;/code> 化されているので、代入を実行しようとしたときにエラーになります。&lt;/p>

&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">実行結果&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-console" data-lang="console">&lt;span class="line">&lt;span class="cl">&lt;span class="gp">$&lt;/span> ./sample.sh
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">./sample.sh: 行 4: MAX_SCORE: 読み取り専用の変数です
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure></description></item><item><title>Linuxメモ: シェルスクリプトのあるディレクトリの絶対パスを取得する</title><link>https://maku77.github.io/p/m5z4fi3/</link><pubDate>Fri, 20 Aug 2010 00:00:00 +0900</pubDate><guid>https://maku77.github.io/p/m5z4fi3/</guid><description>&lt;p>スクリプト自身の格納されているディレクトリの絶対パスは下記のようにして得ることができます（内部的に &lt;code>cd&lt;/code> を実行していますが、実行後のカレントディレクトリが変わってしまうことはありません）。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">&lt;span class="nv">self_dir&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="k">$(&lt;/span>&lt;span class="nb">cd&lt;/span> &lt;span class="k">$(&lt;/span>dirname &lt;span class="nv">$0&lt;/span>&lt;span class="k">)&lt;/span>&lt;span class="p">;&lt;/span> &lt;span class="nb">pwd&lt;/span>&lt;span class="k">)&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>ちなみに、シェルスクリプトと同じディレクトリにあるファイルの絶対パスは、上記で求めたディレクトリパスと組み合わせれば作れます。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">&lt;span class="nb">echo&lt;/span> &lt;span class="si">${&lt;/span>&lt;span class="nv">self_dir&lt;/span>&lt;span class="si">}&lt;/span>/sample.txt
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div></description></item><item><title>Linuxメモ: NTP でシステム時刻を設定する</title><link>https://maku77.github.io/p/4zi9s4y/</link><pubDate>Thu, 22 Jul 2010 00:00:00 +0900</pubDate><guid>https://maku77.github.io/p/4zi9s4y/</guid><description>&lt;p>（Ubuntu 9.04 で確認）&lt;/p>
&lt;h2 id="ntp-による時刻設定を有効にする">NTP による時刻設定を有効にする&lt;/h2>
&lt;p>まず、&lt;code>ntp&lt;/code> パッケージをインストールします。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-console" data-lang="console">&lt;span class="line">&lt;span class="cl">&lt;span class="gp">$&lt;/span> sudo apt-get install ntp
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>使用する NTP サーバは、下記のファイルで指定します。&lt;/p>

&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">/etc/ntp.conf&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-plain" data-lang="plain">&lt;span class="line">&lt;span class="cl">server ntp.ubuntu.com&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>

&lt;p>上記のような行を編集して、任意の NTP サーバのアドレスを指定してください。
複数の NTP サーバを指定することもできます。&lt;/p>
&lt;p>最後に NTP daemon を再起動すれば NTP による自動時刻設定が有効になります。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-console" data-lang="console">&lt;span class="line">&lt;span class="cl">&lt;span class="gp">$&lt;/span> sudo /etc/init.d/ntp restart
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="ntp-の動作確認">NTP の動作確認&lt;/h2>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-console" data-lang="console">&lt;span class="line">&lt;span class="cl">&lt;span class="gp">$&lt;/span> sudo ntpq -p
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>上記のコマンドで、サーバ名が表示されれば OK です。&lt;/p>
&lt;h2 id="手動で-ntp-サーバの時刻を取得">手動で NTP サーバの時刻を取得&lt;/h2>
&lt;p>&lt;code>ntpdate&lt;/code> コマンドを使用して、明示的に OS のシステム時刻を NTP サーバの時刻に同期させることができます。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-console" data-lang="console">&lt;span class="line">&lt;span class="cl">&lt;span class="gp">$&lt;/span> sudo ntpdate -u ntp.ubuntu.com
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div></description></item><item><title>Bash の変数展開機能を活用する（文字列の置換、デフォルト値など）</title><link>https://maku77.github.io/p/jsctar8/</link><pubDate>Tue, 20 Jul 2010 00:00:00 +0900</pubDate><guid>https://maku77.github.io/p/jsctar8/</guid><description>&lt;p>Bash の変数は通常 &lt;code>${x}&lt;/code> のような形で参照しますが、様々な変数展開機能を利用すると、変数の存在を確認したり、一部を置換したり、デフォルト値を設定したりすることができます。
下記にざっと紹介しますが、公式なドキュメントは &lt;code>man bash&lt;/code> の &lt;code>Parameter Expansion&lt;/code> のセクションで参照することができます。&lt;/p>
&lt;h2 id="パターン照合演算子">パターン照合演算子&lt;/h2>
&lt;p>次のような変数展開の構文を使用すると、変数に格納された文字列の一部を置換した文字列を作成することができます。&lt;/p>
&lt;table>
 &lt;thead>
 &lt;tr>
 &lt;th>構文&lt;/th>
 &lt;th>意味&lt;/th>
 &lt;/tr>
 &lt;/thead>
 &lt;tbody>
 &lt;tr>
 &lt;td>&lt;strong>&lt;code>${変数/パターン/置換文字列}&lt;/code>&lt;/strong>&lt;/td>
 &lt;td>パターンに一致する部分を置換文字列に置き換える（１つだけ）&lt;/td>
 &lt;/tr>
 &lt;tr>
 &lt;td>&lt;strong>&lt;code>${変数//パターン/置換文字列}&lt;/code>&lt;/strong>&lt;/td>
 &lt;td>パターンに一致する部分を置換文字列に置き換える（すべて）&lt;/td>
 &lt;/tr>
 &lt;tr>
 &lt;td>&lt;strong>&lt;code>${変数#パターン}&lt;/code>&lt;/strong>&lt;/td>
 &lt;td>&lt;b>先頭&lt;/b>から&lt;b>最短一致&lt;/b>でパターンに一致する部分を取り除く&lt;/td>
 &lt;/tr>
 &lt;tr>
 &lt;td>&lt;strong>&lt;code>${変数##パターン}&lt;/code>&lt;/strong>&lt;/td>
 &lt;td>&lt;b>先頭&lt;/b>から&lt;b>最長一致&lt;/b>でパターンに一致する部分を取り除く&lt;/td>
 &lt;/tr>
 &lt;tr>
 &lt;td>&lt;strong>&lt;code>${変数%パターン}&lt;/code>&lt;/strong>&lt;/td>
 &lt;td>&lt;b>末尾&lt;/b>から&lt;b>最短一致&lt;/b>でパターンに一致する部分を取り除く&lt;/td>
 &lt;/tr>
 &lt;tr>
 &lt;td>&lt;strong>&lt;code>${変数%%パターン}&lt;/code>&lt;/strong>&lt;/td>
 &lt;td>&lt;b>末尾&lt;/b>から&lt;b>最長一致&lt;/b>でパターンに一致する部分を取り除く&lt;/td>
 &lt;/tr>
 &lt;/tbody>
&lt;/table>
&lt;p>パターン部分では、ワイルドカード（&lt;code>*&lt;/code>、&lt;code>?&lt;/code>、&lt;code>[a-z]&lt;/code> など）を使用できます。&lt;/p>
&lt;h3 id="例-変数内の-b-を-b-に置換する">例: 変数内の b を B に置換する&lt;/h3>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-console" data-lang="console">&lt;span class="line">&lt;span class="cl">&lt;span class="gp">$&lt;/span> &lt;span class="nv">x&lt;/span>&lt;span class="o">=&lt;/span>aaabbbccc
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="gp">$&lt;/span> &lt;span class="nv">y&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="si">${&lt;/span>&lt;span class="nv">x&lt;/span>&lt;span class="p">/b/B&lt;/span>&lt;span class="si">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="gp">$&lt;/span> &lt;span class="nb">echo&lt;/span> &lt;span class="nv">$y&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">aaaBbbccc
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>最初に見つかった文字列だけが置換されていることがわかります。
パターンに一致する文字列をすべて置換するには次のようにします（最初のスラッシュを2つにします）。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-console" data-lang="console">&lt;span class="line">&lt;span class="cl">&lt;span class="gp">$&lt;/span> &lt;span class="nv">x&lt;/span>&lt;span class="o">=&lt;/span>aaabbbccc
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="gp">$&lt;/span> &lt;span class="nv">y&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="si">${&lt;/span>&lt;span class="nv">x&lt;/span>&lt;span class="p">//b/B&lt;/span>&lt;span class="si">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="gp">$&lt;/span> &lt;span class="nb">echo&lt;/span> &lt;span class="nv">$y&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">aaaBBBccc
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>以下のように sed コマンドを使ったのと同様の効果を bash の機能だけで実現できていることになります。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-console" data-lang="console">&lt;span class="line">&lt;span class="cl">&lt;span class="gp">$&lt;/span> &lt;span class="nv">y&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="k">$(&lt;/span>&lt;span class="nb">echo&lt;/span> &lt;span class="nv">$x&lt;/span> &lt;span class="p">|&lt;/span> sed -e &lt;span class="s1">&amp;#39;s/bbb/BBB/g&amp;#39;&lt;/span>&lt;span class="k">)&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="例-フルパスから-basename-を取り出す">例: フルパスから basename を取り出す&lt;/h3>
&lt;p>下記の例では &lt;code>/aaa/bbb/ccc&lt;/code> という絶対パスから、ベースネーム部分の &lt;code>ccc&lt;/code> を抽出しています。
&lt;code>*/&lt;/code> というパターンで先頭から最長一致させ、&lt;code>/aaa/bbb/&lt;/code> という部分を取り除いています。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-console" data-lang="console">&lt;span class="line">&lt;span class="cl">&lt;span class="gp">$&lt;/span> &lt;span class="nv">x&lt;/span>&lt;span class="o">=&lt;/span>/aaa/bbb/ccc
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="gp">$&lt;/span> &lt;span class="nv">y&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="si">${&lt;/span>&lt;span class="nv">x&lt;/span>&lt;span class="p">##*/&lt;/span>&lt;span class="si">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="gp">$&lt;/span> &lt;span class="nb">echo&lt;/span> &lt;span class="nv">$y&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">ccc
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>ちなみに、ベースネーム部分を取得したいのであれば、通常は &lt;code>basename&lt;/code> コマンドを使って以下のようにした方が簡単です。&lt;/p></description></item><item><title>Linuxメモ: bash のバージョンを調べる ($BASH_VERSION)</title><link>https://maku77.github.io/p/9w4ywr2/</link><pubDate>Tue, 20 Jul 2010 00:00:00 +0900</pubDate><guid>https://maku77.github.io/p/9w4ywr2/</guid><description>&lt;p>現在使用している bash のバージョンは、&lt;code>$BASH_VERSION&lt;/code> 環境変数で参照することができます。&lt;/p>
&lt;h2 id="centos-55-の場合">CentOS 5.5 の場合&lt;/h2>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">$ &lt;span class="nb">echo&lt;/span> &lt;span class="nv">$BASH_VERSION&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">3.2.25&lt;span class="o">(&lt;/span>1&lt;span class="o">)&lt;/span>-release
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="ubuntu-1204-の場合">Ubuntu 12.04 の場合&lt;/h2>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">$ &lt;span class="nb">echo&lt;/span> &lt;span class="nv">$BASH_VERSION&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">4.2.24&lt;span class="o">(&lt;/span>1&lt;span class="o">)&lt;/span>-release
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div></description></item><item><title>Linuxメモ: 絶対パスと相対パスの変換 (basename, dirname)</title><link>https://maku77.github.io/p/3qgbv7i/</link><pubDate>Tue, 20 Jul 2010 00:00:00 +0900</pubDate><guid>https://maku77.github.io/p/3qgbv7i/</guid><description>&lt;h2 id="basename---ファイル名だけを抽出する">basename - ファイル名だけを抽出する&lt;/h2>
&lt;p>Linux の &lt;strong>&lt;code>basename&lt;/code>&lt;/strong> コマンドを使うと、パスを表す文字列からファイル名だけを抽出できます。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-console" data-lang="console">&lt;span class="line">&lt;span class="cl">&lt;span class="gp">$&lt;/span> basename /aaa/bbb/ccc
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">ccc
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">&lt;/span>&lt;span class="err">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="err">&lt;/span>&lt;span class="gp">$&lt;/span> basename /aaa/bbb/ccc/
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">ccc
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">&lt;/span>&lt;span class="err">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="err">&lt;/span>&lt;span class="gp">$&lt;/span> basename aaa/bbb/ccc
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">ccc
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="dirname---ディレクトリファイルが格納されているディレクトリのパスを抽出する">dirname - ディレクトリ、ファイルが格納されているディレクトリのパスを抽出する&lt;/h2>
&lt;p>Linux の &lt;strong>&lt;code>dirname&lt;/code>&lt;/strong> コマンドを使うと、ファイルやディレクトリが格納されているディレクトリのパスを抽出できます。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-console" data-lang="console">&lt;span class="line">&lt;span class="cl">&lt;span class="gp">$&lt;/span> dirname /aaa/bbb/ccc
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">/aaa/bbb
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">&lt;/span>&lt;span class="err">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="err">&lt;/span>&lt;span class="gp">$&lt;/span> dirname /aaa/bbb/ccc/
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">/aaa/bbb
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">&lt;/span>&lt;span class="err">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="err">&lt;/span>&lt;span class="gp">$&lt;/span> dirname aaa/bbb/ccc
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">aaa/bbb
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div></description></item><item><title>Linuxシェルスクリプト: ある外部コマンドが使用できるかチェックする</title><link>https://maku77.github.io/p/xi5sjju/</link><pubDate>Sun, 13 Jun 2010 00:00:00 +0900</pubDate><guid>https://maku77.github.io/p/xi5sjju/</guid><description>&lt;p>シェルスクリプトの中で特定の外部コマンドを使用する必要がある場合、先頭部分でその外部コマンドが使用できる状態かどうかを調べておくと親切です。
例えば、次のようにすれば、&lt;code>ruby&lt;/code> コマンドが使用できるかを確認できます。&lt;/p>

&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">sample.sh&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">&lt;span class="k">if&lt;/span> &lt;span class="nb">type&lt;/span> -P ruby &amp;gt; /dev/null&lt;span class="p">;&lt;/span> &lt;span class="k">then&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nb">echo&lt;/span> &lt;span class="s1">&amp;#39;ruby コマンドを使用できます&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">else&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nb">echo&lt;/span> &lt;span class="s1">&amp;#39;ruby コマンドが見つかりません&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">fi&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>

&lt;div class="xNote">
 &lt;span class="xNote_title">☝️ type -P コマンド&lt;/span>
 &lt;span class="xNote_body">&lt;code>type -P ruby&lt;/code> コマンドは、パスの通ったディレクトリから &lt;code>ruby&lt;/code> を検索してそのパスを取得するためのものですが、ここでは &lt;code>ruby&lt;/code> コマンドが使用できる環境になっているかを確認するために利用しています。
単純に実行すると、検索結果のパスが出力されてしまうので、&lt;code>null&lt;/code> デバイスへリダイレクトして出力を抑制しています。&lt;/span>
&lt;/div>
&lt;p>特定のコマンドが使用できない場合にスクリプトを終了させるには、以下のように記述すればよいでしょう。
条件式を &lt;strong>&lt;code>!&lt;/code>&lt;/strong> で反転させていることに注意してください。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">&lt;span class="k">if&lt;/span> ! &lt;span class="nb">type&lt;/span> -P ruby &amp;gt; /dev/null&lt;span class="p">;&lt;/span> &lt;span class="k">then&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nb">echo&lt;/span> &lt;span class="s1">&amp;#39;This script requires Ruby. Please install Ruby first and try again.&amp;#39;&lt;/span> &amp;gt;&lt;span class="p">&amp;amp;&lt;/span>&lt;span class="m">2&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nb">exit&lt;/span> -1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">fi&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 処理を継続&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div></description></item><item><title>Linuxシェルスクリプト: ある環境変数が定義されているかチェックする (test -z)</title><link>https://maku77.github.io/p/r3myewb/</link><pubDate>Sun, 13 Jun 2010 00:00:00 +0900</pubDate><guid>https://maku77.github.io/p/r3myewb/</guid><description>&lt;h2 id="環境変数がセットされているかを確認する">環境変数がセットされているかを確認する&lt;/h2>
&lt;p>下記の例では、&lt;code>SRC_ROOT&lt;/code> という環境変数が設定されているかを調べ、設定されていない場合はメッセージを表示して終了しています。&lt;/p>

&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">sample.sh&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">&lt;span class="cp">#!/bin/bash
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cp">&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">if&lt;/span> &lt;span class="o">[&lt;/span> -z &lt;span class="s2">&amp;#34;&lt;/span>&lt;span class="nv">$SRC_ROOT&lt;/span>&lt;span class="s2">&amp;#34;&lt;/span> &lt;span class="o">]&lt;/span>&lt;span class="p">;&lt;/span> &lt;span class="k">then&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nb">echo&lt;/span> &lt;span class="s1">&amp;#39;Please set the &amp;#34;SRC_ROOT&amp;#34; environment variable and try again.&amp;#39;&lt;/span> &amp;gt;&lt;span class="p">&amp;amp;&lt;/span>&lt;span class="m">2&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nb">exit&lt;/span> -1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">fi&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">echo&lt;/span> &lt;span class="s1">&amp;#39;Program continues...&amp;#39;&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>

&lt;p>&lt;code>-z&lt;/code> は、指定された変数の文字列長が 0 であるかを調べるオプションです。
&lt;code>SRC_ROOT&lt;/code> 変数にスペースを含む文字列が設定されている場合に備えて、&lt;code>&amp;quot;$SRC_ROOT&amp;quot;&lt;/code> のようにダブルクォートで囲むことをお勧めします。&lt;/p>
&lt;div class="xNote">
 &lt;span class="xNote_title">☝️ ワンポイント&lt;/span>
 &lt;span class="xNote_body">&lt;code>echo&lt;/code> の出力を &lt;code>&amp;gt;&amp;amp;2&lt;/code> とリダイレクトすると標準エラー出力へ出力できます。&lt;/span>
&lt;/div>

&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">実行例&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-console" data-lang="console">&lt;span class="line">&lt;span class="cl">&lt;span class="gp">$&lt;/span> ./sample.sh
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">Please set the &amp;#34;SRC_ROOT&amp;#34; environment variable and try again.
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">&lt;/span>&lt;span class="err">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="err">&lt;/span>&lt;span class="gp">$&lt;/span> &lt;span class="nv">SRC_ROOT&lt;/span>&lt;span class="o">=&lt;/span>/Users/maku/src ./sample.sh
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">Program continues...
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>

&lt;h2 id="おまけtest-コマンドについて">（おまけ）test コマンドについて&lt;/h2>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">&lt;span class="k">if&lt;/span> &lt;span class="o">[&lt;/span> -z &lt;span class="s2">&amp;#34;&lt;/span>&lt;span class="nv">$SRC_ROOT&lt;/span>&lt;span class="s2">&amp;#34;&lt;/span> &lt;span class="o">]&lt;/span>&lt;span class="p">;&lt;/span> &lt;span class="k">then&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>という条件判定は、次のように &lt;strong>&lt;code>test&lt;/code>&lt;/strong> コマンドを使うのと同等です。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">&lt;span class="k">if&lt;/span> &lt;span class="nb">test&lt;/span> -z &lt;span class="s2">&amp;#34;&lt;/span>&lt;span class="nv">$SRC_ROOT&lt;/span>&lt;span class="s2">&amp;#34;&lt;/span>&lt;span class="p">;&lt;/span> &lt;span class="k">then&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;strong>&lt;code>test -z&lt;/code>&lt;/strong> コマンドは、指定された変数値の文字列長が 0 かどうかを確認するコマンドです。
これを利用して、上記のように &lt;strong>特定の変数値がセットされていない&lt;/strong> ことを調べることができます。&lt;/p>
&lt;p>ちなみに、&lt;strong>&lt;code>[&lt;/code>&lt;/strong> は特殊な記号のように見えますが、実質は &lt;code>test&lt;/code> コマンドのエイリアスなので、前後にスペースが必要なことに注意してください。&lt;/p></description></item><item><title>Linuxシェルスクリプト: コマンドライン引数の数が正しいかチェックする ($#)</title><link>https://maku77.github.io/p/4tbzpyf/</link><pubDate>Sun, 13 Jun 2010 00:00:00 +0900</pubDate><guid>https://maku77.github.io/p/4tbzpyf/</guid><description>&lt;p>関連記事: &lt;a href="../p/c2kx7er/">Linuxシェルスクリプト: コマンドライン引数の基本 (&lt;code>$1&lt;/code>, &lt;code>$@&lt;/code>, &lt;code>$*&lt;/code>)&lt;/a>&lt;/p>
&lt;h2 id="コマンドライン引数が足りないときに-usage-出力して終了する">コマンドライン引数が足りないときに Usage 出力して終了する&lt;/h2>
&lt;p>シェルスクリプト起動時に渡されたコマンドライン引数の数は、&lt;strong>&lt;code>$#&lt;/code>&lt;/strong> 変数で取得することができます。
シェルスクリプトが最低 2 つのパラメーターを必要としている場合は、先頭部分で下記のようなチェックをするのがよいでしょう。&lt;/p>

&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">例: 2 つ以上のパラメーターが必要&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">&lt;span class="cp">#!/bin/bash
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cp">&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">if&lt;/span> &lt;span class="o">[&lt;/span> &lt;span class="nv">$#&lt;/span> -lt &lt;span class="m">2&lt;/span> &lt;span class="o">]&lt;/span>&lt;span class="p">;&lt;/span> &lt;span class="k">then&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nb">echo&lt;/span> &lt;span class="s2">&amp;#34;Usage: &lt;/span>&lt;span class="k">$(&lt;/span>basename &lt;span class="nv">$0&lt;/span>&lt;span class="k">)&lt;/span>&lt;span class="s2"> &amp;lt;file1&amp;gt; &amp;lt;file2&amp;gt;&amp;#34;&lt;/span> &amp;gt;&lt;span class="p">&amp;amp;&lt;/span>&lt;span class="m">2&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nb">exit&lt;/span> -1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">fi&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 処理を継続&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>

&lt;p>下記はバリエーションです。&lt;/p>

&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">例: 1 つ以上のパラメーターが必要&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">&lt;span class="cp">#!/bin/bash
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cp">&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">if&lt;/span> &lt;span class="o">[&lt;/span> ! &lt;span class="s2">&amp;#34;&lt;/span>&lt;span class="nv">$1&lt;/span>&lt;span class="s2">&amp;#34;&lt;/span> &lt;span class="o">]&lt;/span>&lt;span class="p">;&lt;/span> &lt;span class="k">then&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nb">echo&lt;/span> &lt;span class="s2">&amp;#34;Usage: &lt;/span>&lt;span class="k">$(&lt;/span>basename &lt;span class="nv">$0&lt;/span>&lt;span class="k">)&lt;/span>&lt;span class="s2"> &amp;lt;file&amp;gt;&amp;#34;&lt;/span> &amp;gt;&lt;span class="p">&amp;amp;&lt;/span>&lt;span class="m">2&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nb">exit&lt;/span> -1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">fi&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 処理を継続&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>


&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">例: 1 つの引数が必要で、かつ、その名前のファイルが存在する&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">&lt;span class="cp">#!/bin/bash
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cp">&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">if&lt;/span> &lt;span class="o">[&lt;/span> ! &lt;span class="s2">&amp;#34;&lt;/span>&lt;span class="nv">$1&lt;/span>&lt;span class="s2">&amp;#34;&lt;/span> &lt;span class="o">]&lt;/span>&lt;span class="p">;&lt;/span> &lt;span class="k">then&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nb">echo&lt;/span> &lt;span class="s2">&amp;#34;Usage: &lt;/span>&lt;span class="k">$(&lt;/span>basename &lt;span class="nv">$0&lt;/span>&lt;span class="k">)&lt;/span>&lt;span class="s2"> &amp;lt;file&amp;gt;&amp;#34;&lt;/span> &amp;gt;&lt;span class="p">&amp;amp;&lt;/span>&lt;span class="m">2&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nb">exit&lt;/span> -1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">fi&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">if&lt;/span> &lt;span class="o">[&lt;/span> ! -f &lt;span class="s2">&amp;#34;&lt;/span>&lt;span class="nv">$1&lt;/span>&lt;span class="s2">&amp;#34;&lt;/span> &lt;span class="o">]&lt;/span>&lt;span class="p">;&lt;/span> &lt;span class="k">then&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nb">echo&lt;/span> &lt;span class="s2">&amp;#34;&lt;/span>&lt;span class="nv">$1&lt;/span>&lt;span class="s2"> is not found&amp;#34;&lt;/span> &amp;gt;&lt;span class="p">&amp;amp;&lt;/span>&lt;span class="m">2&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nb">exit&lt;/span> -1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">fi&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 処理を継続&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>

&lt;h2 id="コマンドライン引数が指定されていないときにデフォルト値を使用する">コマンドライン引数が指定されていないときにデフォルト値を使用する&lt;/h2>
&lt;p>1 番目のコマンドライン引数を参照するときに &lt;strong>&lt;code>${1:-XXX}&lt;/code>&lt;/strong> とすると、引数を省略したときに &lt;code>XXX&lt;/code> というデフォルト値が返されます。
例えば、次の例では、コマンドライン引数で「出力先ディレクトリ」を指定できるようにしていますが、省略した場合のデフォルトとして &lt;code>out&lt;/code> ディレクトリを使用するようにしています。&lt;/p></description></item><item><title>Linuxメモ: シェルスクリプト: 数値変数を加算／減算する</title><link>https://maku77.github.io/p/3cukwcu/</link><pubDate>Sun, 13 Jun 2010 00:00:00 +0900</pubDate><guid>https://maku77.github.io/p/3cukwcu/</guid><description>&lt;p>数値変数 &lt;code>val&lt;/code> の値に対して加算／減算を行うには下記のようにします。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">&lt;span class="nv">val&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">100&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">let&lt;/span> &lt;span class="nv">val&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="nv">$val&lt;/span>+200
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">echo&lt;/span> &lt;span class="nv">$val&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>あるいは、下記のように記述することもできます。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">&lt;span class="nv">val&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">100&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv">val&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="k">$((&lt;/span>&lt;span class="nv">$val&lt;/span>&lt;span class="o">+&lt;/span>&lt;span class="m">200&lt;/span>&lt;span class="k">))&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">echo&lt;/span> &lt;span class="nv">$val&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>
&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">実行結果&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-plain" data-lang="plain">&lt;span class="line">&lt;span class="cl">300&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure></description></item><item><title>Linuxメモ: Linux カーネル／OS のバージョンを調べる</title><link>https://maku77.github.io/p/odgqrwa/</link><pubDate>Tue, 01 Jun 2010 00:00:00 +0900</pubDate><guid>https://maku77.github.io/p/odgqrwa/</guid><description>&lt;h2 id="linux-カーネルのバージョンを調べる">Linux カーネルのバージョンを調べる&lt;/h2>
&lt;pre tabindex="0">&lt;code>$ cat /proc/version
$ uname -a
&lt;/code>&lt;/pre>&lt;h2 id="linux-os-のバージョンを調べる">Linux OS のバージョンを調べる&lt;/h2>

&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">Ubuntu の場合&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-console" data-lang="console">&lt;span class="line">&lt;span class="cl">&lt;span class="gp">$&lt;/span> cat /etc/lsb-release
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">DISTRIB_ID=Ubuntu
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">DISTRIB_RELEASE=13.10
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">DISTRIB_CODENAME=saucy
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">DISTRIB_DESCRIPTION=&amp;#34;Ubuntu 13.10&amp;#34;
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">&lt;/span>&lt;span class="err">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="err">&lt;/span>&lt;span class="gp">$&lt;/span> lsb_release -a
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">No LSB modules are available.
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">Distributor ID: Ubuntu
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">Description: Ubuntu 13.10
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">Release: 13.10
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">Codename: saucy
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>


&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">Debian の場合&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-console" data-lang="console">&lt;span class="line">&lt;span class="cl">&lt;span class="gp">$&lt;/span> cat /etc/debian_version
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">5.0
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>


&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">CentOS（RedHat系）の場合&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-console" data-lang="console">&lt;span class="line">&lt;span class="cl">&lt;span class="gp">$&lt;/span> cat /etc/redhat-release
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">CentOS release 5.5 (Final)
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>


&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">Fedora の場合&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-console" data-lang="console">&lt;span class="line">&lt;span class="cl">&lt;span class="gp">$&lt;/span> cat /etc/fedora-release
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">Fedora release 9 (Sulphur)
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure></description></item><item><title>Linuxメモ: シェルスクリプトを実行したユーザの名前を調べる</title><link>https://maku77.github.io/p/3eofc3v/</link><pubDate>Wed, 16 Dec 2009 00:00:00 +0900</pubDate><guid>https://maku77.github.io/p/3eofc3v/</guid><description>&lt;p>下記の例では、シェルスクリプトを実行したユーザが root であるかどうかを調べています。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">&lt;span class="k">if&lt;/span> &lt;span class="o">[&lt;/span> &lt;span class="s2">&amp;#34;&lt;/span>&lt;span class="nv">$USER&lt;/span>&lt;span class="s2">&amp;#34;&lt;/span> !&lt;span class="o">=&lt;/span> &lt;span class="s2">&amp;#34;root&amp;#34;&lt;/span> &lt;span class="o">]&lt;/span>&lt;span class="p">;&lt;/span> &lt;span class="k">then&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nb">echo&lt;/span> &lt;span class="s2">&amp;#34;Must be executed by root.&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nb">exit&lt;/span> -1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">fi&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div></description></item><item><title>Linuxメモ: Bash の構文: 関数を定義する／削除する</title><link>https://maku77.github.io/p/em67j5z/</link><pubDate>Tue, 15 Dec 2009 00:00:00 +0900</pubDate><guid>https://maku77.github.io/p/em67j5z/</guid><description>&lt;h2 id="関数定義の基本">関数定義の基本&lt;/h2>
&lt;p>Bash では以下のいずれかの構文を利用して、関数を定義することができます。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">&lt;span class="k">function&lt;/span> funcname &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;lt;shell commands...&amp;gt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">funcname&lt;span class="o">()&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;lt;shell commands...&amp;gt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>開き括弧 (&lt;code>{&lt;/code>) は、上記のように関数名と同じ行に記述してもよいし、次の行に単独で記述してもよいです。&lt;/p>
&lt;h2 id="関数を削除する">関数を削除する&lt;/h2>
&lt;p>定義されている関数を削除するには以下のようにします。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">&lt;span class="nb">unset&lt;/span> -f funcname
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>現在のログインセッションでどんな関数が定義されているかを調べるには以下のようにします。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-console" data-lang="console">&lt;span class="line">&lt;span class="cl">&lt;span class="gp">$&lt;/span> &lt;span class="nb">declare&lt;/span> -F &lt;span class="c1"># 関数名のみ出力&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="gp">$&lt;/span> &lt;span class="nb">declare&lt;/span> -f &lt;span class="c1"># 関数の定義も出力&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="関数と環境変数">関数と環境変数&lt;/h2>
&lt;p>関数はスクリプトとは異なり、実行したシェルと同じプロセスで実行されます。
つまり、以下のように関数内で環境変数を設定すれば、関数を呼び出したシェルにも反映されます。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">myfunc&lt;span class="o">()&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nb">export&lt;/span> &lt;span class="nv">AAA&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">100&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="空の関数は-syntax-error-になる">空の関数は syntax error になる&lt;/h2>
&lt;p>中身が空の関数が定義されていると、構文エラーが発生するようです。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">myfunc&lt;span class="o">()&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># syntax error&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>
&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">エラーの例&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-console" data-lang="console">&lt;span class="line">&lt;span class="cl">&lt;span class="gp">$&lt;/span> ./sample.sh
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">./sample.sh: 行 3: 予期しないトークン `}&amp;#39; 周辺に構文エラーがあります
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">./sample.sh: 行 3: `}&amp;#39;
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure></description></item><item><title>Linuxメモ: Bash の構文: ループ内での複数の出力をまとめてリダイレクト、パイプ処理する</title><link>https://maku77.github.io/p/tmm4zvz/</link><pubDate>Wed, 02 Dec 2009 00:00:00 +0900</pubDate><guid>https://maku77.github.io/p/tmm4zvz/</guid><description>&lt;h2 id="コマンドのグルーピング">コマンドのグルーピング&lt;/h2>
&lt;p>Bash 上で任意のコマンドを実行するときに、&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">$ &lt;span class="o">(&lt;/span>command1&lt;span class="p">;&lt;/span> command2&lt;span class="p">;&lt;/span> command3&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>のようにコマンドを括弧 &lt;code>()&lt;/code> で囲んでグルーピングすると、リダイレクトなどの効果が全てのコマンドに対して働くようになります。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">$ &lt;span class="o">(&lt;/span>&lt;span class="nb">echo&lt;/span> &lt;span class="s1">&amp;#39;AAA&amp;#39;&lt;/span>&lt;span class="p">;&lt;/span> &lt;span class="nb">echo&lt;/span> &lt;span class="s1">&amp;#39;BBB&amp;#39;&lt;/span>&lt;span class="p">;&lt;/span> &lt;span class="nb">echo&lt;/span> &lt;span class="s1">&amp;#39;CCC&amp;#39;&lt;/span>&lt;span class="o">)&lt;/span> &amp;gt; output.txt
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>上記は一行で記述していますが、次のように複数行に分けて記述することもできます。
この場合、各コマンドの末尾にセミコロン (&lt;code>;&lt;/code>) は必要ありません。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">&lt;span class="o">(&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nb">echo&lt;/span> &lt;span class="s1">&amp;#39;AAA&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nb">echo&lt;/span> &lt;span class="s1">&amp;#39;BBB&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nb">echo&lt;/span> &lt;span class="s1">&amp;#39;CCC&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">)&lt;/span> &amp;gt; output.txt
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>グルーピングしたコマンドの出力をパイプ処理でつなげていくこともできます。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">&lt;span class="o">(&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nb">echo&lt;/span> &lt;span class="s1">&amp;#39;foo&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nb">echo&lt;/span> &lt;span class="s1">&amp;#39;bar&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nb">echo&lt;/span> &lt;span class="s1">&amp;#39;yahoo&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nb">echo&lt;/span> &lt;span class="s1">&amp;#39;foo&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">)&lt;/span> &lt;span class="p">|&lt;/span> sort &lt;span class="p">|&lt;/span> uniq
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>括弧で囲まれたコマンドは子シェルで実行されるので、その中でカレントディレクトリや環境変数などを変更した場合は、コマンド終了時に元に戻ります。
一時的にカレントディレクトリを変更してコマンドを実行したい場合に便利です。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">$ &lt;span class="nb">pwd&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">/home
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">$ &lt;span class="o">(&lt;/span>&lt;span class="nb">cd&lt;/span> /etc&lt;span class="p">;&lt;/span> &lt;span class="nb">pwd&lt;/span>&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">/etc
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">$ &lt;span class="nb">pwd&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">/home
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="ループ内の出力をリダイレクトする">ループ内の出力をリダイレクトする&lt;/h2>
&lt;p>&lt;code>for&lt;/code> ループや &lt;code>while&lt;/code> ループの中で &lt;code>echo&lt;/code> 出力した結果は、&lt;code>done&lt;/code> の後ろでリダイレクトするようにすれば、まとめてファイルに出力することができます。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">&lt;span class="k">for&lt;/span> x in AAA BBB CCC&lt;span class="p">;&lt;/span> &lt;span class="k">do&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nb">echo&lt;/span> &lt;span class="s2">&amp;#34;&lt;/span>&lt;span class="nv">$x&lt;/span>&lt;span class="s2">&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nb">echo&lt;/span> &lt;span class="s2">&amp;#34;......&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">done&lt;/span> &amp;gt; output.txt
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>
&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">出力結果 (output.txt)&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-plain" data-lang="plain">&lt;span class="line">&lt;span class="cl">AAA
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">......
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">BBB
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">......
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">CCC
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">......&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>

&lt;p>上記では &lt;code>&amp;gt;&lt;/code> を使用していますが、&lt;code>&amp;gt;&amp;gt;&lt;/code> にすれば追記処理に変更することができます。&lt;/p></description></item><item><title>Linuxシェルスクリプト: コマンドライン引数の基本 ($1, $@, $*)</title><link>https://maku77.github.io/p/c2kx7er/</link><pubDate>Wed, 29 Oct 2008 00:00:00 +0900</pubDate><guid>https://maku77.github.io/p/c2kx7er/</guid><description>&lt;h2 id="コマンドライン引数の基本-1--9">コマンドライン引数の基本 (&lt;code>$1&lt;/code> ~ &lt;code>$9&lt;/code>)&lt;/h2>
&lt;p>bash シェルスクリプト実行時にコマンドラインで渡した引数を参照するには、次のようなパラメーター参照用の特殊変数を使用します。&lt;/p>
&lt;ul>
&lt;li>&lt;strong>&lt;code>$1&lt;/code>&lt;/strong> &amp;hellip; 第 1 パラメーター&lt;/li>
&lt;li>&lt;strong>&lt;code>$2&lt;/code>&lt;/strong> &amp;hellip; 第 2 パラメーター&lt;/li>
&lt;li>&lt;strong>&lt;code>$3&lt;/code>&lt;/strong> &amp;hellip; 第 3 パラメーター&lt;/li>
&lt;/ul>
&lt;p>パラメーターの参照には、&lt;strong>&lt;code>$1&lt;/code>&lt;/strong> 〜 &lt;strong>&lt;code>$9&lt;/code>&lt;/strong> が使用できます。
使用することは余りないと思いますが、10 番目以降のパラメータを参照したいときは、&lt;strong>&lt;code>${10}&lt;/code>&lt;/strong> のように数値を &lt;code>{}&lt;/code> で囲めば参照できます。&lt;/p>

&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">sample.sh&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">&lt;span class="cp">#!/bin/bash
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cp">&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">echo&lt;/span> &lt;span class="s1">&amp;#39;1 番目: &amp;#39;&lt;/span> &lt;span class="s2">&amp;#34;&lt;/span>&lt;span class="nv">$1&lt;/span>&lt;span class="s2">&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">echo&lt;/span> &lt;span class="s1">&amp;#39;2 番目: &amp;#39;&lt;/span> &lt;span class="s2">&amp;#34;&lt;/span>&lt;span class="nv">$2&lt;/span>&lt;span class="s2">&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">echo&lt;/span> &lt;span class="s1">&amp;#39;3 番目: &amp;#39;&lt;/span> &lt;span class="s2">&amp;#34;&lt;/span>&lt;span class="nv">$3&lt;/span>&lt;span class="s2">&amp;#34;&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>


&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">実行結果&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-console" data-lang="console">&lt;span class="line">&lt;span class="cl">&lt;span class="gp">$&lt;/span> ./sample.sh AAA BBB &lt;span class="s2">&amp;#34;CCC DDD&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">1 番目: AAA
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">2 番目: BBB
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">3 番目: CCC DDD
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>

&lt;p>コマンドライン引数を指定しなかった場合は、対応する変数は空になります。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-console" data-lang="console">&lt;span class="line">&lt;span class="cl">&lt;span class="gp">$&lt;/span> ./sample.sh AAA
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">1 番目: AAA
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">2 番目:
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">3 番目:
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;div class="xNote">
 &lt;span class="xNote_title">☝️ 変数はダブルクォートで囲む&lt;/span>
 &lt;span class="xNote_body">&lt;code>echo&lt;/code> の引数として変数の値を渡すときは、&lt;strong>&lt;code>&amp;quot;$1&amp;quot;&lt;/code>&lt;/strong> のようにダブルクォートで囲む癖をつけましょう。
&lt;code>$1&lt;/code> のようにそのまま記述してしまうと、変数の値として連続するスペースが含まれていたときに 1 つのスペースにまとめられてしまいます。&lt;/span>
&lt;/div>
&lt;div class="xNote">
 &lt;span class="xNote_title">☝️ 引数とパラメーターの違い&lt;/span>
 &lt;span class="xNote_body">正確には、&lt;strong>引数 (arguments)&lt;/strong> という用語は、スクリプトや関数を呼び出す側が渡す値のことを示し、&lt;strong>パラメーター (parameters)&lt;/strong> という用語は、呼び出される側のスクリプトや関数が、その値を参照するときに使う変数のことを示します。
ただ、どちらのケースでもパラメーターという用語を使っているドキュメントもよく見かけるので、あまり気にしない方がよさそうです。&lt;/span>
&lt;/div>
&lt;h2 id="コマンドライン引数にデフォルト値を指定する-1-xxx">コマンドライン引数にデフォルト値を指定する (&lt;code>${1:-XXX}&lt;/code>)&lt;/h2>
&lt;p>コマンドライン引数が指定されなかったときに使用する値として、デフォルト値を指定しておくこともできます。
デフォルト値は、パラメーター参照時に &lt;strong>&lt;code>${1:-デフォルト値}&lt;/code>&lt;/strong> という形で指定します。
下記の例では、1 番目、2 番目、3 番目のコマンドラインパラメーターのデフォルト値を、それぞれ &lt;code>AAA&lt;/code>、&lt;code>BBB&lt;/code>、&lt;code>CCC&lt;/code> に設定しています。&lt;/p></description></item><item><title>Linuxメモ: Bash の構文: for/while によるループ処理</title><link>https://maku77.github.io/p/eimpfje/</link><pubDate>Tue, 28 Oct 2008 00:00:00 +0900</pubDate><guid>https://maku77.github.io/p/eimpfje/</guid><description>&lt;h2 id="スペースで区切られた単語ワードを順番に処理する">スペースで区切られた単語（ワード）を順番に処理する&lt;/h2>
&lt;p>次の Bash スクリプトでは、ループ処理したいテキスト (&lt;code>aaa&lt;/code>, &lt;code>bbb&lt;/code>, &lt;code>ccc&lt;/code>) を直接 &lt;code>for&lt;/code> ループで指定しています。
ここでは、&lt;code>do&lt;/code> を &lt;code>for&lt;/code> と同じ行に記述するコーディングスタイルを採用しています。&lt;/p>

&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">例: aaa bbb ccc を順番に処理&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">&lt;span class="k">for&lt;/span> x in aaa bbb ccc&lt;span class="p">;&lt;/span> &lt;span class="k">do&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nb">echo&lt;/span> &lt;span class="nv">$x&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">done&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>


&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">実行結果&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-plain" data-lang="plain">&lt;span class="line">&lt;span class="cl">aaa
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">bbb
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ccc&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>

&lt;p>以下のように、スペースで区切られた文字列が格納された文字列変数を処理することもできます。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">&lt;span class="nv">list&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;aaa bbb ccc&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">for&lt;/span> x in &lt;span class="nv">$list&lt;/span>&lt;span class="p">;&lt;/span> &lt;span class="k">do&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nb">echo&lt;/span> &lt;span class="nv">$x&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">done&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="スペースを含む文字列を1つの要素として扱う">スペースを含む文字列を1つの要素として扱う&lt;/h2>
&lt;p>リスト内の各要素をダブルクォートで囲んでおくと、その単位でループ処理されるようになります。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">&lt;span class="cp">#!/bin/bash
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cp">&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">for&lt;/span> i in &lt;span class="s2">&amp;#34;aaa bbb&amp;#34;&lt;/span> &lt;span class="s2">&amp;#34;ccc ddd&amp;#34;&lt;/span> &lt;span class="s2">&amp;#34;eee fff&amp;#34;&lt;/span>&lt;span class="p">;&lt;/span> &lt;span class="k">do&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nb">echo&lt;/span> &lt;span class="nv">$i&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">done&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>
&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">実行結果&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-plain" data-lang="plain">&lt;span class="line">&lt;span class="cl">aaa bbb
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ccc ddd
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">eee fff&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>

&lt;p>変数を使う場合もほぼ同様ですが、&lt;strong>それぞれの変数をダブルクォートで囲む&lt;/strong> 必要があります（これを忘れると、それぞれの変数内の文字列がスペースで区切られてループ処理されてしまいます）。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">&lt;span class="nv">x&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;aaa bbb&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv">y&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;ccc ddd&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv">z&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;eee fff&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">for&lt;/span> i in &lt;span class="s2">&amp;#34;&lt;/span>&lt;span class="nv">$x&lt;/span>&lt;span class="s2">&amp;#34;&lt;/span> &lt;span class="s2">&amp;#34;&lt;/span>&lt;span class="nv">$y&lt;/span>&lt;span class="s2">&amp;#34;&lt;/span> &lt;span class="s2">&amp;#34;&lt;/span>&lt;span class="nv">$z&lt;/span>&lt;span class="s2">&amp;#34;&lt;/span>&lt;span class="p">;&lt;/span> &lt;span class="k">do&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nb">echo&lt;/span> &lt;span class="nv">$i&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">done&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>
&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">実行結果&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-plain" data-lang="plain">&lt;span class="line">&lt;span class="cl">aaa bbb
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ccc ddd
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">eee fff&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>

&lt;p>ちなみに、下記のようにすべての変数をまとめてダブルクォートで囲むと、ひとつの要素として処理されます。&lt;/p></description></item><item><title>Linuxメモ: あるファイルがテキストファイルかどうか調べる (file)</title><link>https://maku77.github.io/p/ams75pd/</link><pubDate>Mon, 08 Sep 2008 00:00:00 +0900</pubDate><guid>https://maku77.github.io/p/ams75pd/</guid><description>&lt;p>テキストファイルを &lt;code>file&lt;/code> コマンドにかけると、&lt;code>... text ...&lt;/code> のような結果が出力されます。
それを &lt;code>grep&lt;/code> することで、そのファイルがテキストファイルかどうか調べることができます。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-console" data-lang="console">&lt;span class="line">&lt;span class="cl">&lt;span class="gp">$&lt;/span> file sample.txt &lt;span class="p">|&lt;/span> grep text
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div></description></item><item><title>Linuxメモ: ファイルやディレクトリを検索する (find, grep)</title><link>https://maku77.github.io/p/hudubr8/</link><pubDate>Mon, 08 Sep 2008 00:00:00 +0900</pubDate><guid>https://maku77.github.io/p/hudubr8/</guid><description>&lt;h2 id="find-と-grep-の基本">find と grep の基本&lt;/h2>
&lt;h3 id="指定した拡張子のファイルを検索する-find">指定した拡張子のファイルを検索する (find)&lt;/h3>
&lt;p>次のようにすると、カレントディレクトリ (&lt;code>.&lt;/code>) を起点にして、拡張子 &lt;code>.txt&lt;/code> を持つファイルを検索して一覧表示することができます。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-console" data-lang="console">&lt;span class="line">&lt;span class="cl">&lt;span class="gp">$&lt;/span> find . -name &lt;span class="s1">&amp;#39;*.txt&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="ファイル内の文字列を検索する-grep">ファイル内の文字列を検索する (grep)&lt;/h3>
&lt;p>次のようにすると、指定したテキストファイル内の文字列を検索することができます。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-console" data-lang="console">&lt;span class="line">&lt;span class="cl">&lt;span class="gp">$&lt;/span> grep &lt;span class="s1">&amp;#39;検索文字列&amp;#39;&lt;/span> hello.txt
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="find-で見つけたファイルの中身を-grep-検索する">find で見つけたファイルの中身を grep 検索する&lt;/h2>
&lt;p>&lt;code>find&lt;/code> で検索した結果のファイルそれぞれに対して、&lt;code>grep&lt;/code> コマンドを実行するには、&lt;code>xargs&lt;/code> を組み合わせて使用します。&lt;/p>

&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">例: 拡張子に txt を持つファイルを grep&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-console" data-lang="console">&lt;span class="line">&lt;span class="cl">&lt;span class="gp">$&lt;/span> find . -type f -name &lt;span class="s1">&amp;#39;*.txt&amp;#39;&lt;/span> &lt;span class="p">|&lt;/span> xargs grep &lt;span class="s1">&amp;#39;検索文字列&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>

&lt;p>拡張子などを絞り込まず、単純にそのディレクトリ以下のすべてのテキストファイルを検索するだけでよいのであれば、&lt;code>find&lt;/code> を使わず、&lt;code>grep&lt;/code> の再帰オプション (&lt;code>-r&lt;/code>) を使った方が簡単です。
念のため、テキストファイルのみを &lt;code>grep&lt;/code> 対象にするために &lt;code>-I&lt;/code> オプション (&lt;code>--binary-files-without-match&lt;/code>) も一緒に指定しておきます。&lt;/p>

&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">例: すべてのテキストファイルを grep&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-console" data-lang="console">&lt;span class="line">&lt;span class="cl">&lt;span class="gp">$&lt;/span> grep -r -I &lt;span class="s1">&amp;#39;検索文字列&amp;#39;&lt;/span> .
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>

&lt;h2 id="grep-で-notandor-検索する">grep で NOT、AND、OR 検索する&lt;/h2>
&lt;h3 id="not-検索">NOT 検索&lt;/h3>
&lt;p>&lt;code>grep&lt;/code> の &lt;strong>&lt;code>-v&lt;/code>&lt;/strong> オプションを指定すると、指定した &lt;strong>文字列を含まない&lt;/strong> 行だけを抽出できます。&lt;/p></description></item><item><title>Linuxメモ: Bash の構文: case による分岐処理</title><link>https://maku77.github.io/p/hro2nd4/</link><pubDate>Tue, 08 May 2007 00:00:00 +0900</pubDate><guid>https://maku77.github.io/p/hro2nd4/</guid><description>&lt;p>Bash スクリプトで &lt;strong>&lt;code>case&lt;/code>&lt;/strong> を使用すると、ある値がどのパターンに一致するかによって分岐処理を行うことができます。
構文は以下の通りです。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">&lt;span class="k">case&lt;/span> 式 in
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> パターン1&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> 処理1 &lt;span class="p">;;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> パターン2&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> 処理2 &lt;span class="p">;;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> パターン3&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> 処理3 &lt;span class="p">;;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> *&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> いずれにも一致しない場合の処理 &lt;span class="p">;;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">esac&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;code>式&lt;/code> の評価結果が、&lt;code>パターン1&lt;/code> ～ &lt;code>パターン3&lt;/code> のいずれかに一致すると、対応する &lt;code>処理1&lt;/code> 〜 &lt;code>処理3&lt;/code> が実行されます。&lt;/p>
&lt;p>パターンには正規表現を使うことができます。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">&lt;span class="k">case&lt;/span> &lt;span class="nv">$1&lt;/span> in
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> -&lt;span class="o">[&lt;/span>mM&lt;span class="o">])&lt;/span> &lt;span class="c1"># -m あるいは -M だったら&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> more &lt;span class="nv">$2&lt;/span>&lt;span class="p">;;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">esac&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>シェルスクリプトや関数に渡された引数の値 (&lt;code>$1&lt;/code>) によって処理を分岐させたいときに便利です。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">&lt;span class="k">case&lt;/span> &lt;span class="nv">$1&lt;/span> in
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> one &lt;span class="p">|&lt;/span> One&lt;span class="o">)&lt;/span> &lt;span class="nb">echo&lt;/span> &lt;span class="m">1&lt;/span> &lt;span class="p">;;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> two &lt;span class="p">|&lt;/span> Two&lt;span class="o">)&lt;/span> &lt;span class="nb">echo&lt;/span> &lt;span class="m">2&lt;/span> &lt;span class="p">;;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> three &lt;span class="p">|&lt;/span> Three&lt;span class="o">)&lt;/span> &lt;span class="nb">echo&lt;/span> &lt;span class="m">3&lt;/span> &lt;span class="p">;;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> *&lt;span class="o">)&lt;/span> &lt;span class="nb">echo&lt;/span> unknown &lt;span class="p">;;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">esac&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>次のように処理部分を複数行に分けて記述することもできます。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">&lt;span class="k">case&lt;/span> &lt;span class="nv">$1&lt;/span> in
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> one &lt;span class="p">|&lt;/span> One&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nb">echo&lt;/span> &lt;span class="m">1&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">;;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> two &lt;span class="p">|&lt;/span> Two&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nb">echo&lt;/span> &lt;span class="m">2&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">;;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> three &lt;span class="p">|&lt;/span> Three&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nb">echo&lt;/span> &lt;span class="m">3&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">;;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> *&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nb">echo&lt;/span> unknown
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">;;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">esac&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div></description></item><item><title>Linuxメモ: Bash の構文: if-else による分岐処理</title><link>https://maku77.github.io/p/seogpah/</link><pubDate>Tue, 08 May 2007 00:00:00 +0900</pubDate><guid>https://maku77.github.io/p/seogpah/</guid><description>&lt;h2 id="if-else-の基本">if-else の基本&lt;/h2>
&lt;p>Bash スクリプト内での &lt;code>if&lt;/code> による条件分岐は下記のように記述します。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">&lt;span class="k">if&lt;/span> 条件
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">then&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> 処理
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">fi&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;code>then&lt;/code> を &lt;code>if&lt;/code> と同じ行に記述しているスクリプトもよく見かけます。
Google もこのようなスタイルを採用しています。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">&lt;span class="k">if&lt;/span> 条件&lt;span class="p">;&lt;/span> &lt;span class="k">then&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> 処理
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">fi&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>処理内容が簡潔な場合は、下記のようにセミコロンを使用して一行で記述してしまうこともできます。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">&lt;span class="k">if&lt;/span> 条件&lt;span class="p">;&lt;/span> &lt;span class="k">then&lt;/span> 処理&lt;span class="p">;&lt;/span> &lt;span class="k">fi&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>複数の条件分岐を連ねる場合 (else if) は、以下のように &lt;code>elif&lt;/code> と &lt;code>else&lt;/code> を使って記述します。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">&lt;span class="k">if&lt;/span> 条件1&lt;span class="p">;&lt;/span> &lt;span class="k">then&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> 処理1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">elif&lt;/span> 条件2&lt;span class="p">;&lt;/span> &lt;span class="k">then&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> 処理2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">elif&lt;/span> 条件3&lt;span class="p">;&lt;/span> &lt;span class="k">then&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> 処理3
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">else&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> 処理4
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">fi&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="test-コマンドによる比較処理">test コマンドによる比較処理&lt;/h2>
&lt;p>&lt;code>if&lt;/code> の条件部では、&lt;strong>&lt;code>test&lt;/code>&lt;/strong> コマンドを使用して、数値比較や文字列比較を行うことができます。
実際には、&lt;code>test&lt;/code> コマンドへのシンボリックリンクである &lt;strong>&lt;code>[&lt;/code>&lt;/strong> を使って記述するのが一般的です。
例えば、以下では数値比較を行うために &lt;code>test&lt;/code> コマンドを使っていますが、&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">&lt;span class="k">if&lt;/span> &lt;span class="nb">test&lt;/span> &lt;span class="m">1&lt;/span> -gt 0&lt;span class="p">;&lt;/span> &lt;span class="k">then&lt;/span> &lt;span class="nb">echo&lt;/span> &lt;span class="s1">&amp;#39;OK&amp;#39;&lt;/span>&lt;span class="p">;&lt;/span> &lt;span class="k">fi&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>これは次のように書くことができます。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">&lt;span class="k">if&lt;/span> &lt;span class="o">[&lt;/span> &lt;span class="m">1&lt;/span> -gt &lt;span class="m">0&lt;/span> &lt;span class="o">]&lt;/span>&lt;span class="p">;&lt;/span> &lt;span class="k">then&lt;/span> &lt;span class="nb">echo&lt;/span> &lt;span class="s1">&amp;#39;OK&amp;#39;&lt;/span>&lt;span class="p">;&lt;/span> &lt;span class="k">fi&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;code>[&lt;/code> は単に &lt;code>test&lt;/code> コマンドのエイリアスなので、&lt;strong>&lt;code>[&lt;/code> の後ろには必ず 1 つ以上のスペースが必要です&lt;/strong>（上記では 1 が &lt;code>test&lt;/code> コマンドへ渡すパラメータとして扱われています）。
&lt;code>[&lt;/code> で使用できる &lt;code>-eq&lt;/code> や &lt;code>-gt&lt;/code> などのオプションは、&lt;code>man test&lt;/code> とすれば調べることができます。&lt;/p></description></item><item><title>Linuxメモ: シェルスクリプト: ランダムな数値を取得する ($RANDOM)</title><link>https://maku77.github.io/p/5fhvypy/</link><pubDate>Wed, 27 Jul 2005 00:00:00 +0900</pubDate><guid>https://maku77.github.io/p/5fhvypy/</guid><description>&lt;p>Bash のシェル変数 &lt;code>$RANDOM&lt;/code> を参照すると、0 ～ 32767 の範囲のランダムな整数を取得することができます。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-console" data-lang="console">&lt;span class="line">&lt;span class="cl">&lt;span class="gp">$&lt;/span> &lt;span class="nb">echo&lt;/span> &lt;span class="nv">$RANDOM&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">27591
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div></description></item><item><title>Linuxメモ: Linux でリダイレクトによってファイルが上書きされてしまうのを防ぐ (`set -o noclobber`)</title><link>https://maku77.github.io/p/jw5xt77/</link><pubDate>Thu, 26 May 2005 00:00:00 +0900</pubDate><guid>https://maku77.github.io/p/jw5xt77/</guid><description>&lt;p>例えば Linux で下記のように標準出力をリダイレクトしようとしたときに、すでに出力先のファイルが存在する場合は、そのファイルの内容が上書きされてしまいます。&lt;/p>

&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">例: hoge.txt が上書きされてしまう&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-console" data-lang="console">&lt;span class="line">&lt;span class="cl">&lt;span class="gp">$&lt;/span> &lt;span class="nb">echo&lt;/span> Hello &amp;gt; hoge.txt
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>

&lt;p>こういったリダイレクトによるファイルの上書きを抑制するには、シェルオプションの &lt;strong>&lt;code>noclobber&lt;/code>&lt;/strong> を有効化します（bash と zsh で共通です）。
有効化後に &lt;code>hoge.txt&lt;/code> が上書きされるような処理を実行すると、以下のようにエラーになります。&lt;/p>

&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">例: hoge.txt が上書きされてしまう&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-console" data-lang="console">&lt;span class="line">&lt;span class="cl">&lt;span class="gp">$&lt;/span> &lt;span class="nb">set&lt;/span> -o noclobber 
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="gp">$&lt;/span> &lt;span class="nb">echo&lt;/span> Hello &amp;gt; hoge.txt
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">zsh: file exists: hoge.txt
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>

&lt;p>シェルオプションは、&lt;code>set -o&lt;/code> で有効化、&lt;code>set +o&lt;/code> で無効化できます。
bash では &lt;code>~/.bashrc&lt;/code>、zsh では &lt;code>~/.zshrc&lt;/code> に設定を追加しておくとよいでしょう。&lt;/p>

&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">~/.zshrc&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">&lt;span class="nb">set&lt;/span> -o noclobber &lt;span class="c1"># noclobberを有効化（既存ファイルの上書きを防止）&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">set&lt;/span> +o noclobber &lt;span class="c1"># noclobberを無効化（既存ファイルの上書きを許可）（デフォルト）&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>

&lt;p>ちなみに、現在のすべてのシェルオプションの設定を確認するには以下のようにします。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-console" data-lang="console">&lt;span class="line">&lt;span class="cl">&lt;span class="gp">$&lt;/span> &lt;span class="nb">set&lt;/span> -o &lt;span class="c1"># on, off 表示&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="gp">$&lt;/span> &lt;span class="nb">set&lt;/span> +o &lt;span class="c1"># 設定コマンド表示&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div></description></item><item><title>Linuxメモ: リダイレクトとパイプ処理のまとめ</title><link>https://maku77.github.io/p/knkamyp/</link><pubDate>Tue, 24 May 2005 00:00:00 +0900</pubDate><guid>https://maku77.github.io/p/knkamyp/</guid><description>&lt;h2 id="リダイレクトとパイプの役割">リダイレクトとパイプの役割&lt;/h2>
&lt;p>デフォルトでは、標準出力 (stdout) の出力先はモニタで、標準入力の入力元はキーボードになっています。
リダイレクトやパイプは、これを変更する役割を持っています。&lt;/p>
&lt;ul>
&lt;li>&lt;strong>&lt;code>command &amp;gt; file&lt;/code>&lt;/strong> &amp;hellip; &lt;code>command&lt;/code> の標準出力の内容をファイルへ出力する&lt;/li>
&lt;li>&lt;strong>&lt;code>command &amp;lt; file&lt;/code>&lt;/strong> &amp;hellip; ファイルの内容を &lt;code>command&lt;/code> の標準入力へ入力する&lt;/li>
&lt;li>&lt;strong>&lt;code>command1 | command2&lt;/code>&lt;/strong> &amp;hellip; &lt;code>command1&lt;/code> の標準出力を &lt;code>command2&lt;/code> の標準入力へ繋ぐ&lt;/li>
&lt;/ul>

&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">例: list.txt の内容を sort コマンドの標準入力へ渡す&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-console" data-lang="console">&lt;span class="line">&lt;span class="cl">&lt;span class="gp">$&lt;/span> sort -r &amp;lt; list.txt &lt;span class="c1"># リダイレクトを使う場合&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="gp">$&lt;/span> cat list.txt &lt;span class="p">|&lt;/span> sort -r &lt;span class="c1"># パイプを使う場合&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>

&lt;h2 id="標準出力のリダイレクト">標準出力のリダイレクト&lt;/h2>
&lt;h3 id="標準出力と標準エラー出力をリダイレクトする">標準出力と標準エラー出力をリダイレクトする&lt;/h3>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-console" data-lang="console">&lt;span class="line">&lt;span class="cl">&lt;span class="gp">$&lt;/span> &lt;span class="nb">command&lt;/span> &lt;span class="p">&amp;amp;&lt;/span>&amp;gt; output.txt
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>以下のように実行する方法もあり、Linux (bash) も Windows も共通の指定方法で実行できます。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-console" data-lang="console">&lt;span class="line">&lt;span class="cl">&lt;span class="gp">$&lt;/span> &lt;span class="nb">command&lt;/span> &amp;gt; output.txt 2&amp;gt;&lt;span class="p">&amp;amp;&lt;/span>&lt;span class="m">1&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;code>2&amp;gt;&amp;amp;1&lt;/code> は、STDERR (2) を STDOUT (1) に結合するという指示です。&lt;/p>
&lt;h3 id="標準出力と標準エラー出力を別々にリダイレクトする">標準出力と標準エラー出力を別々にリダイレクトする&lt;/h3>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-console" data-lang="console">&lt;span class="line">&lt;span class="cl">&lt;span class="gp">$&lt;/span> &lt;span class="nb">command&lt;/span> 1&amp;gt; stdout.txt 2&amp;gt; stderr.txt
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="標準エラー出力だけをリダイレクト">標準エラー出力だけをリダイレクト&lt;/h3>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-console" data-lang="console">&lt;span class="line">&lt;span class="cl">&lt;span class="gp">$&lt;/span> &lt;span class="nb">command&lt;/span> 2&amp;gt; stderr.txt
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>
&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">例: find コマンドを実行するときにエラー出力を抑制する（/dev/null へのリダイレクト）&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-plain" data-lang="plain">&lt;span class="line">&lt;span class="cl">$ find / -name ifconfig 2&amp;gt; /dev/null&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>

&lt;h2 id="標準エラーのパイプ">標準エラーのパイプ&lt;/h2>
&lt;h3 id="標準出力と標準エラー出力をパイプ">標準出力と標準エラー出力をパイプ&lt;/h3>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-console" data-lang="console">&lt;span class="line">&lt;span class="cl">&lt;span class="gp">$&lt;/span> command1 2&amp;gt;&lt;span class="p">&amp;amp;&lt;/span>&lt;span class="m">1&lt;/span> &lt;span class="p">|&lt;/span> command2
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="標準エラー出力だけをパイプ標準出力は破棄">標準エラー出力だけをパイプ（標準出力は破棄）&lt;/h3>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-console" data-lang="console">&lt;span class="line">&lt;span class="cl">&lt;span class="gp">$&lt;/span> &lt;span class="o">(&lt;/span>command1 1&amp;gt; /dev/null&lt;span class="o">)&lt;/span> 2&amp;gt;&lt;span class="p">&amp;amp;&lt;/span>&lt;span class="m">1&lt;/span> &lt;span class="p">|&lt;/span> command2
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div></description></item><item><title>Linuxメモ: ls コマンドが使えないときに echo コマンドで代用する</title><link>https://maku77.github.io/p/z3dxcch/</link><pubDate>Mon, 23 May 2005 00:00:00 +0900</pubDate><guid>https://maku77.github.io/p/z3dxcch/</guid><description>&lt;p>Linux 環境でパスが狂ってしまったりして、外部コマンドである &lt;code>ls&lt;/code> が使えないときは、内部コマンドの &lt;code>echo&lt;/code> とシェルのワイルドカード展開機能を使って、ディレクトリ内のファイル一覧を表示できます。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-console" data-lang="console">&lt;span class="line">&lt;span class="cl">&lt;span class="gp">$&lt;/span> &lt;span class="nb">echo&lt;/span> *
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="gp">$&lt;/span> &lt;span class="nb">echo&lt;/span> dir/*
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="gp">$&lt;/span> &lt;span class="nb">echo&lt;/span> test*
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div></description></item><item><title>Linuxメモ: ls コマンドでパターンに一致するファイルだけを列挙する</title><link>https://maku77.github.io/p/vtkjxha/</link><pubDate>Sun, 22 May 2005 00:00:00 +0900</pubDate><guid>https://maku77.github.io/p/vtkjxha/</guid><description>&lt;p>&lt;code>ls&lt;/code> コマンドでファイルを列挙するときに、Linux シェルのワイルドカードやグロブパターンを利用すると、特定のパターンにマッチするファイルだけを列挙できます。
&lt;strong>&lt;code>?&lt;/code>&lt;/strong> は任意の 1 文字、&lt;strong>&lt;code>*&lt;/code>&lt;/strong> は 0 文字以上の任意の文字列にマッチします。&lt;/p>

&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">例: 3文字以上のファイルを列挙する&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-console" data-lang="console">&lt;span class="line">&lt;span class="cl">&lt;span class="gp">$&lt;/span> ls ???*
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>


&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">例: 01, 02, 03 のいずれかの文字列を含むファイルを列挙する&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-console" data-lang="console">&lt;span class="line">&lt;span class="cl">&lt;span class="gp">$&lt;/span> ls *&lt;span class="o">{&lt;/span>01,02,03&lt;span class="o">}&lt;/span>* &lt;span class="c1"># 方法1&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="gp">$&lt;/span> ls *0&lt;span class="o">[&lt;/span>1-3&lt;span class="o">]&lt;/span>* &lt;span class="c1"># 方法2&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure></description></item><item><title>Linuxメモ: 今日の日付から YYYYMMDD のような文字列を作成する (date)</title><link>https://maku77.github.io/p/7aj35xe/</link><pubDate>Thu, 21 Apr 2005 00:00:00 +0900</pubDate><guid>https://maku77.github.io/p/7aj35xe/</guid><description>&lt;p>Linux の &lt;strong>&lt;code>date&lt;/code>&lt;/strong> コマンドを使用すると、現在時刻を表す文字列を自由なフォーマットで取得することができます。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-console" data-lang="console">&lt;span class="line">&lt;span class="cl">&lt;span class="gp">$&lt;/span> date +%Y%m%d-%H%M%S
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">20050521-231345
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>時刻入りの簡単なログを出力したいときや、バックアップを作成するときのファイル名構成のために使用することができます。&lt;/p>

&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">例: 現在日時をファイル名に付けてファイルコピー（バックアップ）&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-console" data-lang="console">&lt;span class="line">&lt;span class="cl">&lt;span class="gp">$&lt;/span> cp sample.txt sample.txt.&lt;span class="sb">`&lt;/span>date +%Y%m%d&lt;span class="sb">`&lt;/span>.back
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="gp">$&lt;/span> ls
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">sample.txt sample.txt.20050102.back
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure></description></item><item><title>Linuxメモ: 行番号付きでテキストファイルの内容を出力する (cat -n, cat -b)</title><link>https://maku77.github.io/p/sybn8yf/</link><pubDate>Thu, 21 Apr 2005 00:00:00 +0900</pubDate><guid>https://maku77.github.io/p/sybn8yf/</guid><description>&lt;p>&lt;code>cat&lt;/code> コマンドには行番号を付加して出力する &lt;strong>&lt;code>-n&lt;/code>&lt;/strong> オプションが用意されています。&lt;/p>

&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">行番号付きで出力&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-console" data-lang="console">&lt;span class="line">&lt;span class="cl">&lt;span class="gp">$&lt;/span> cat -b input.txt
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>

&lt;p>&lt;code>-n&lt;/code> オプションの代わりに &lt;strong>&lt;code>-b&lt;/code>&lt;/strong> オプションを使用すると、空行を除いた行に対して行番号が付加されます。&lt;/p>

&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">空行以外の行にだけ行番号を付ける&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-console" data-lang="console">&lt;span class="line">&lt;span class="cl">&lt;span class="gp">$&lt;/span> cat -b input.txt
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure></description></item></channel></rss>